<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤©å‘½é‘‘å®š Â· å®—å¸ˆæ­£æºå›½é£ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap');

        :root {
            --china-red: #b32d2e;      /* æ•…å®«æœ±çº¢ */
            --paper-yellow: #f4f1de;   /* å®£çº¸æ·¡é»„ */
            --ink-black: #1a1a1a;      /* æµ“å¢¨è‰² */
            --gold-leaf: #d4af37;     /* è´´é‡‘è‰² */
            --bg-paper: #edeae0;       /* ç²—ç²çº¸æ„Ÿ */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Serif SC', serif;
            background-color: var(--bg-paper);
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: var(--ink-black);
            margin: 0; padding: 20px 10px; min-height: 100vh;
            display: flex; justify-content: center;
        }

        .container { width: 100%; max-width: 750px; }

        /* é¡¶éƒ¨æ ‡é¢˜ï¼šå°ç« çº¹é¥° */
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { 
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 3.5rem; font-weight: 500; margin: 0; color: var(--china-red);
            line-height: 1.2; display: inline-block; position: relative;
        }
        .header h1::after {
            content: 'é‘‘å®š'; position: absolute; right: -55px; top: 5px;
            font-size: 0.9rem; background: var(--china-red); color: #fff;
            padding: 4px 6px; border-radius: 2px; line-height: 1; font-family: sans-serif;
        }

        /* å›½é£å¡ç‰‡ */
        .card {
            background: #fff;
            border: 1px solid #d8c3a5;
            padding: 30px; margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            position: relative;
        }
        .card::before {
            content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid #e8e4d9; pointer-events: none;
        }

        .label { 
            color: var(--china-red); font-size: 1rem; margin-bottom: 15px; 
            display: block; font-weight: bold; border-left: 4px solid var(--china-red);
            padding-left: 12px; letter-spacing: 1px;
        }
        
        .gender-box { display: flex; gap: 15px; margin-bottom: 25px; }
        .g-btn {
            flex: 1; padding: 16px; text-align: center; border: 1px solid #d8c3a5;
            background: #fff; color: #666; cursor: pointer; transition: 0.3s; font-weight: bold;
        }
        .g-btn.active { 
            border-color: var(--china-red); color: var(--china-red); 
            background: rgba(179, 45, 46, 0.05);
        }

        input[type="datetime-local"] {
            width: 100%; padding: 18px; background: #fafafa; border: 1px solid #d8c3a5;
            color: var(--ink-black); font-size: 1.1rem; outline: none; font-family: serif;
        }

        .btn-start {
            width: 100%; padding: 22px; border: none;
            background: var(--china-red); color: #fff; font-size: 1.4rem; font-weight: 900; 
            letter-spacing: 8px; cursor: pointer; margin-top: 25px; 
            box-shadow: 0 10px 25px rgba(179, 45, 46, 0.3);
        }

        #result-area { display: none; }

        /* é‰´å®šå¤´ */
        .role-header { text-align: center; margin-bottom: 40px; }
        .role-icon { font-size: 4.5rem; display: block; margin-bottom: 15px; }
        .role-title { font-family: 'Ma Shan Zheng', cursive; font-size: 3rem; color: var(--china-red); margin: 0; }
        .role-sub { color: #555; font-size: 1.1rem; margin-top: 10px; letter-spacing: 2px; }
        .role-tags { display: flex; justify-content: center; gap: 12px; margin-top: 20px; }
        .tag { font-size: 0.8rem; padding: 6px 16px; border: 1px solid var(--china-red); color: var(--china-red); font-weight: bold; }
        .tag.ssr { background: var(--china-red); color: #fff; }

        /* çœŸç¥å¸ä»¤ */
        .siling-bar {
            text-align: center; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0;
            padding: 20px 0; margin: 30px 0; font-weight: bold; color: var(--china-red);
            background: rgba(179, 45, 46, 0.03); font-size: 1.2rem;
        }

        /* ç«–ç‰ˆä¿¡ç¬ºæ’ç›˜ */
        .pillars { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 45px; }
        .ofuda { 
            background: #fff; border: 1px solid var(--china-red); padding: 25px 5px;
            text-align: center; box-shadow: 6px 6px 0px rgba(179, 45, 46, 0.1);
        }
        .ofuda-head { font-size: 0.8rem; color: #999; margin-bottom: 12px; }
        .ofuda-god { font-size: 0.9rem; color: var(--china-red); font-weight: bold; margin-bottom: 12px; height: 20px; }
        .ofuda-char { font-family: 'Ma Shan Zheng', cursive; font-size: 2.8rem; font-weight: 900; line-height: 1; margin-bottom: 8px; }
        .ofuda-cs { font-size: 0.85rem; color: #777; border-top: 1px dashed #eee; padding-top: 12px; margin-top: 5px; }

        /* é›·è¾¾å›¾ */
        .chart-box { height: 260px; width: 100%; border: 1px solid #eee; background: #fff; margin-bottom: 40px; border-radius: 4px; }

        /* å·è½´åˆ†æå†…å®¹ */
        .guide-section { border-top: 4px double var(--china-red); padding-top: 45px; }
        .guide-item { margin-bottom: 55px; }
        .guide-title { 
            font-family: 'Ma Shan Zheng', cursive; font-size: 2rem; color: var(--china-red); 
            margin-bottom: 25px; display: flex; align-items: center; gap: 15px;
        }
        .guide-title::before { content: 'â˜¯'; font-size: 1.4rem; color: var(--china-red); }
        .guide-text { font-size: 1.15rem; line-height: 2.2; color: #333; text-align: justify; }
        .guide-text b { color: var(--china-red); background: rgba(179, 45, 46, 0.05); padding: 0 6px; margin: 0 2px; }

        /* å–œå¿Œé€»è¾‘ */
        .logic-bar { background: #fafafa; border: 1px solid #eee; padding: 30px; margin-bottom: 30px; }
        .joy-text { color: #2d6a4f; font-weight: bold; font-size: 1.1rem; }
        .taboo-text { color: #bc4749; font-weight: bold; font-size: 1.1rem; }

        /* äº”è¡Œè‰²è°ƒ */
        .wx-é‡‘ { color: #b8860b; } .wx-æœ¨ { color: #2d6a4f; } .wx-æ°´ { color: #0077b6; } .wx-ç« { color: #bc4749; } .wx-åœŸ { color: #7f5539; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>å¤©å‘½é‘‘å®š</h1><br>
        <span class="stamp">å®—å¸ˆå…¨è§£ Â· ä¹™å·³ä¿®æ­£</span>
    </div>

    <div class="card">
        <div class="input-group">
            <span class="label">ä¹¾å¤ä¹‹é€ </span>
            <div class="gender-box">
                <div class="g-btn active" onclick="setGender(1, this)">ä¹¾é€  (é˜³)</div>
                <div class="g-btn" onclick="setGender(0, this)">å¤é€  (é˜´)</div>
            </div>
        </div>
        <div class="input-group">
            <span class="label">å‡ºç”Ÿæ—¶è¾° (å…¬å†)</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-start" onclick="startScan()">å¼€å¯ Â· å‘½è¿å·è½´</button>
    </div>

    <div id="result-area">
        <div class="card">
            <div class="role-header">
                <span id="role-icon" class="role-icon">?</span>
                <h2 id="role-name" class="role-title">é‘‘å®šä¸­...</h2>
                <div id="role-slogan" class="role-sub">...</div>
                <div id="role-tags" class="role-tags"></div>
            </div>

            <div class="siling-bar">
                ğŸ“œ å½“ä»¤çœŸç¥ï¼š<span id="siling-text">æ­£åœ¨æ„Ÿåº”å¤©åœ°...</span>
            </div>

            <div class="pillars" id="pillars-box"></div>

            <div class="chart-box">
                <canvas id="energy-canvas"></canvas>
            </div>

            <div class="logic-bar">
                <span class="label">ğŸ”® æ ¼å±€å¥¥ä¹‰é€è§†</span>
                <div id="pattern-reason" style="margin-bottom:20px; color:#444; line-height:1.8; font-size:1.1rem;"></div>
                <div class="joy-text">å–œç”¨ç¥ï¼š<span id="txt-joy">...</span></div>
                <div class="taboo-text" style="margin-top:12px;">å¿Œè®³ç¥ï¼š<span id="txt-taboo">...</span></div>
            </div>
        </div>

        <div class="card guide-section">
            <div id="guide-content"></div>
        </div>

        <div style="text-align:center; font-size:13px; color:#999; margin: 50px 0; letter-spacing: 3px;">
            FATE REVEALED BY GRANDMASTER Â· 2025
        </div>
    </div>
</div>

<script>
    let currentGender = 1;
    // ç»Ÿä¸€å®šä¹‰
    const WX_COLOR_MAP = { 'é‡‘':'#b8860b', 'æœ¨':'#2d6a4f', 'æ°´':'#0077b6', 'ç«':'#bc4749', 'åœŸ':'#7f5539' };
    const WUXING_MAP = {'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ','åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´','å­':'æ°´','ä¸‘':'åœŸ','å¯…':'æœ¨','å¯':'æœ¨','è¾°':'åœŸ','å·³':'ç«','åˆ':'ç«','æœª':'åœŸ','ç”³':'é‡‘','é…‰':'é‡‘','æˆŒ':'åœŸ','äº¥':'æ°´'};
    const ZHI_MAIN_QI = {'å­':'ç™¸', 'ä¸‘':'å·±', 'å¯…':'ç”²', 'å¯':'ä¹™', 'è¾°':'æˆŠ', 'å·³':'ä¸™', 'åˆ':'ä¸', 'æœª':'å·±', 'ç”³':'åºš', 'é…‰':'è¾›', 'æˆŒ':'æˆŠ', 'äº¥':'å£¬'};
    
    const SILING_RULES = {
        'å¯…': [['æˆŠ',7], ['ä¸™',7], ['ç”²',16]], 'å¯': [['ç”²',10], ['ä¹™',20]], 'è¾°': [['ä¹™',9], ['ç™¸',3], ['æˆŠ',18]],
        'å·³': [['æˆŠ',5], ['åºš',9], ['ä¸™',16]], 'åˆ': [['ä¸™',10], ['å·±',9], ['ä¸',11]], 'æœª': [['ä¸',9], ['ä¹™',3], ['å·±',18]],
        'ç”³': [['æˆŠ',7], ['å£¬',7], ['åºš',16]], 'é…‰': [['åºš',10], ['è¾›',20]], 'æˆŒ': [['è¾›',9], ['ä¸',3], ['æˆŠ',18]],
        'äº¥': [['æˆŠ',7], ['ç”²',5], ['å£¬',18]], 'å­': [['å£¬',10], ['ç™¸',20]], 'ä¸‘': [['ç™¸',9], ['è¾›',3], ['å·±',18]]
    };

    const ROOT_MAP = {
        'ç”²':['å¯…','å¯','äº¥','è¾°','æœª'], 'ä¹™':['å¯','å¯…','è¾°','æœª','äº¥'], 'ä¸™':['å·³','åˆ','å¯…','æˆŒ'], 'ä¸':['åˆ','å·³','æœª','æˆŒ','å¯…'],
        'æˆŠ':['è¾°','æˆŒ','ä¸‘','æœª','å·³','åˆ'], 'å·±':['ä¸‘','æœª','è¾°','æˆŒ','åˆ','å·³'], 'åºš':['ç”³','é…‰','å·³','ä¸‘','æˆŒ'], 
        'è¾›':['é…‰','ç”³','ä¸‘','æˆŒ','å·³'], 'å£¬':['äº¥','å­','ç”³','è¾°'], 'ç™¸':['å­','äº¥','è¾°','ä¸‘','ç”³']
    };

    const CHANGSHENG_TABLE = {"ç”²":{"äº¥":"é•¿ç”Ÿ","å­":"æ²æµ´","ä¸‘":"å† å¸¦","å¯…":"ä¸´å®˜","å¯":"å¸æ—º","è¾°":"è¡°","å·³":"ç—…","åˆ":"æ­»","æœª":"å¢“","ç”³":"ç»","é…‰":"èƒ","æˆŒ":"å…»"},"ä¹™":{"åˆ":"é•¿ç”Ÿ","å·³":"æ²æµ´","è¾°":"å† å¸¦","å¯":"ä¸´å®˜","å¯…":"å¸æ—º","ä¸‘":"è¡°","å­":"ç—…","äº¥":"æ­»","æˆŒ":"å¢“","é…‰":"ç»","ç”³":"èƒ","æœª":"å…»"},"ä¸™":{"å¯…":"é•¿ç”Ÿ","å¯":"æ²æµ´","è¾°":"å† å¸¦","å·³":"ä¸´å®˜","åˆ":"å¸æ—º","æœª":"è¡°","ç”³":"ç—…","é…‰":"æ­»","æˆŒ":"å¢“","äº¥":"ç»","å­":"èƒ","ä¸‘":"å…»"},"ä¸":{"é…‰":"é•¿ç”Ÿ","ç”³":"æ²æµ´","æœª":"å† å¸¦","åˆ":"ä¸´å®˜","å·³":"å¸æ—º","è¾°":"è¡°","å¯":"ç—…","å¯…":"æ­»","ä¸‘":"å¢“","å­":"ç»","äº¥":"èƒ","æˆŒ":"å…»"},"æˆŠ":{"å¯…":"é•¿ç”Ÿ","å¯":"æ²æµ´","è¾°":"å† å¸¦","å·³":"ä¸´å®˜","åˆ":"å¸æ—º","æœª":"è¡°","ç”³":"ç—…","é…‰":"æ­»","æˆŒ":"å¢“","äº¥":"ç»","å­":"èƒ","ä¸‘":"å…»"},"å·±":{"é…‰":"é•¿ç”Ÿ","ç”³":"æ²æµ´","æœª":"å† å¸¦","åˆ":"ä¸´å®˜","å·³":"å¸æ—º","è¾°":"è¡°","å¯":"ç—…","å¯…":"æ­»","ä¸‘":"å¢“","å­":"ç»","äº¥":"èƒ","æˆŒ":"å…»"},"åºš":{"å·³":"é•¿ç”Ÿ","åˆ":"æ²æµ´","æœª":"å† å¸¦","ç”³":"ä¸´å®˜","é…‰":"å¸æ—º","æˆŒ":"è¡°","äº¥":"ç—…","å­":"æ­»","ä¸‘":"å¢“","å¯…":"ç»","å¯":"èƒ","è¾°":"å…»"},"è¾›":{"å­":"é•¿ç”Ÿ","äº¥":"æ²æµ´","æˆŒ":"å† å¸¦","é…‰":"ä¸´å®˜","ç”³":"å¸æ—º","æœª":"è¡°","åˆ":"ç—…","å·³":"æ­»","è¾°":"å¢“","å¯":"ç»","å¯…":"èƒ","ä¸‘":"å…»"},"å£¬":{"ç”³":"é•¿ç”Ÿ","é…‰":"æ²æµ´","æˆŒ":"å† å¸¦","äº¥":"ä¸´å®˜","å­":"å¸æ—º","ä¸‘":"è¡°","å¯…":"ç—…","å¯":"æ­»","è¾°":"å¢“","å·³":"ç»","åˆ":"èƒ","æœª":"å…»"},"ç™¸":{"å¯":"é•¿ç”Ÿ","å¯…":"æ²æµ´","ä¸‘":"å† å¸¦","å­":"ä¸´å®˜","äº¥":"å¸æ—º","æˆŒ":"è¡°","é…‰":"ç—…","ç”³":"æ­»","æœª":"å¢“","åˆ":"ç»","å·³":"èƒ","è¾°":"å…»"}};
    const SHISHEN_MAP = {"ç”²":{"ç”²":"æ¯”è‚©","ä¹™":"åŠ«è´¢","ä¸™":"é£Ÿç¥","ä¸":"ä¼¤å®˜","æˆŠ":"åè´¢","å·±":"æ­£è´¢","åºš":"ä¸ƒæ€","è¾›":"æ­£å®˜","å£¬":"åå°","ç™¸":"æ­£å°"},"ä¹™":{"ä¹™":"æ¯”è‚©","ç”²":"åŠ«è´¢","ä¸":"é£Ÿç¥","ä¸™":"ä¼¤å®˜","å·±":"åè´¢","æˆŠ":"æ­£è´¢","è¾›":"ä¸ƒæ€","åºš":"æ­£å®˜","ç™¸":"åå°","å£¬":"æ­£å°"},"ä¸™":{"ä¸™":"æ¯”è‚©","ä¸":"åŠ«è´¢","æˆŠ":"é£Ÿç¥","å·±":"ä¼¤å®˜","åºš":"åè´¢","è¾›":"æ­£è´¢","å£¬":"ä¸ƒæ€","ç™¸":"æ­£å®˜","ç”²":"åå°","ä¹™":"æ­£å°"},"ä¸":{"ä¸":"æ¯”è‚©","ä¸™":"åŠ«è´¢","å·±":"é£Ÿç¥","æˆŠ":"ä¼¤å®˜","è¾›":"åè´¢","åºš":"æ­£è´¢","ç™¸":"ä¸ƒæ€","å£¬":"æ­£å®˜","ä¹™":"åå°","ç”²":"æ­£å°"},"æˆŠ":{"æˆŠ":"æ¯”è‚©","å·±":"åŠ«è´¢","åºš":"é£Ÿç¥","è¾›":"ä¼¤å®˜","å£¬":"åè´¢","ç™¸":"æ­£è´¢","ç”²":"ä¸ƒæ€","ä¹™":"æ­£å®˜","ä¸™":"åå°","ä¸":"æ­£å°"},"å·±":{"å·±":"æ¯”è‚©","æˆŠ":"åŠ«è´¢","è¾›":"é£Ÿç¥","åºš":"ä¼¤å®˜","ç™¸":"åè´¢","å£¬":"æ­£è´¢","ä¹™":"ä¸ƒæ€","ç”²":"æ­£å®˜","ä¸":"åå°","ä¸™":"æ­£å°"},"åºš":{"åºš":"æ¯”è‚©","è¾›":"åŠ«è´¢","å£¬":"é£Ÿç¥","ç™¸":"ä¼¤å®˜","ç”²":"åè´¢","ä¹™":"æ­£è´¢","ä¸™":"ä¸ƒæ€","ä¸":"æ­£å®˜","æˆŠ":"åå°","å·±":"æ­£å°"},"è¾›":{"è¾›":"æ¯”è‚©","åºš":"åŠ«è´¢","ç™¸":"é£Ÿç¥","å£¬":"ä¼¤å®˜","ä¹™":"åè´¢","ç”²":"æ­£è´¢","ä¸":"ä¸ƒæ€","ä¸™":"æ­£å®˜","å·±":"åå°","æˆŠ":"æ­£å°"},"å£¬":{"å£¬":"æ¯”è‚©","ç™¸":"åŠ«è´¢","ç”²":"é£Ÿç¥","ä¹™":"ä¼¤å®˜","ä¸™":"åè´¢","ä¸":"æ­£è´¢","æˆŠ":"ä¸ƒæ€","å·±":"æ­£å®˜","åºš":"åå°","è¾›":"æ­£å°"},"ç™¸":{"ç™¸":"æ¯”è‚©","å£¬":"åŠ«è´¢","ä¹™":"é£Ÿç¥","ç”²":"ä¼¤å®˜","ä¸":"åè´¢","ä¸™":"æ­£è´¢","å·±":"ä¸ƒæ€","æˆŠ":"æ­£å®˜","è¾›":"åå°","åºš":"æ­£å°"}};

    // --- æ–‡æ¡ˆåº“å…¨é‡æ‰©å…… (800å­—+æ·±åº¦è§£æ) ---
    const GAME_DB = {
        "é‡‘æ°´ä¼¤å®˜": { 
            name: "â„ï¸ å¯’å†°å‰‘ä»™", tags: ["SSR","å’Œé£","æƒè°‹"], icon: "ğŸ—¡ï¸", slogan: "é‡‘å¯’æ°´å†·ï¼Œå”¯ç«æš–å¿ƒã€‚", 
            male: { c:"<b>[å¤©èµ‹æ ¸å¿ƒï¼šæƒè°‹æ´å¯Ÿ]</b><br>é‡‘æ°´ä¼¤å®˜äººæœ€èªæ˜ï¼Œä½†ä¹Ÿæœ€å‚²æ°”ã€‚ä½ å¤©ç”Ÿé€‚åˆä»äº‹æ”¿æ²»ã€ç®¡ç†ã€æˆ˜ç•¥ç­–åˆ’æˆ–é«˜å±‚å¹•åƒšçš„å·¥ä½œã€‚ä½ çš„æ€ç»´åƒå†°åˆ€ä¸€æ ·é”åˆ©ï¼Œèƒ½ç¬é—´åˆ‡å¼€å¤æ‚é—®é¢˜çš„æ ¸å¿ƒã€‚æ ¼å±€æˆè´¥çš„å…³é”®åœ¨äºâ€œç«ï¼ˆå®˜æ€ï¼‰â€ã€‚è§ç«ï¼Œä½ å°±æ˜¯æ‰‹æ¡é‡æƒçš„å®°ç›¸æˆ–é«˜ç®¡ï¼›æ— ç«ï¼Œä½ å¯èƒ½åªæ˜¯ä¸€ä¸ªæ„¤ä¸–å«‰ä¿—çš„ç©·é…¸ç§€æ‰ï¼Œç©ºæœ‰ä¸€èº«æ‰åå´æ— äººèµè¯†ã€‚è®°å¾—ï¼Œä½ çš„æ‰åå¿…é¡»ä¾é™„äºä½“åˆ¶æˆ–æƒå¨ï¼ˆç«ï¼‰æ‰èƒ½å‘å…‰ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘ï¼šå¯Œè´µé™©ä¸­æ±‚]</b><br>ä½ çš„è´¢è¿é€šå¸¸ä¼´éšç€åœ°ä½è€Œæ¥ã€‚æœ‰äº†æƒï¼ˆå®˜ï¼‰è‡ªç„¶æœ‰é’±ã€‚ä½†å› ä¸ºé‡‘æ°´å¤ªæ¸…ï¼Œä½ ä¹Ÿå®¹æ˜“å› ä¸ºâ€œæ¸…é«˜â€è€Œé”™å¤±èµšå¿«é’±çš„æœºä¼šã€‚åˆ‡å¿Œè´ªæ±¡è…è´¥æˆ–èµ°ç°è‰²åœ°å¸¦ï¼Œå› ä¸ºæ°´å¤ªæ¸…ï¼Œä¸€ç‚¹ç‚¹å¢¨æ±éƒ½ä¼šè¢«çœ‹å¾—æ¸…æ¸…æ¥šæ¥šï¼Œææ˜“è¢«æŸ¥ã€‚èµ°ç«è¿ï¼ˆå—æ–¹è¿ï¼‰æ—¶ï¼Œæ˜¯è´¢å¯Œçˆ†å‘çš„é«˜å…‰æ—¶åˆ»ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Šï¼šå¯»æ‰¾æš–é˜³]</b><br>ä½ çš„å†…å¿ƒå¤ªå†·äº†ï¼Œåƒä¸€åº§å†°å±±ã€‚è™½ç„¶ä½ å¤–è¡¨å¯èƒ½å¾ˆé£æµæˆ–å¥è°ˆï¼Œä½†å†…å¿ƒæ·±å¤„æ¸´æœ›è¢«æ¸©æš–ã€‚ä½ éœ€è¦ä¸€ä¸ªçƒ­æƒ…å¦‚ç«ã€å¼€æœ—å¤§æ–¹çš„ä¼´ä¾£ï¼Œå¯¹æ–¹å¯èƒ½æ˜¯ä½ çš„ä¸Šå¸ã€å´‡æ‹œè€…ï¼Œæˆ–è€…æ˜¯é‚£ç§æ²¡å¿ƒæ²¡è‚ºçš„â€œå°å¤ªé˜³â€ã€‚åªæœ‰è¿™æ ·çš„äººï¼Œæ‰èƒ½èåŒ–ä½ çš„å†°å†·ï¼Œè®©ä½ å¸ä¸‹é˜²å¤‡ã€‚", k:"<b>[åä»£ä¼ æ‰¿ï¼šä¸¥çˆ¶å‡ºå­å­]</b><br>ä½ å¯¹å­©å­çš„è¦æ±‚æé«˜ï¼Œç”šè‡³æœ‰äº›è‹›åˆ»ã€‚ä½ å¸Œæœ›ä»–ä»¬å‡ºäººå¤´åœ°ï¼Œç»§æ‰¿ä½ çš„æ™ºæ…§ã€‚å­©å­å¤šåŠèªæ˜ä¸”æœ‰å‡ºæ¯ï¼Œä½†è¦æ³¨æ„åˆ«ç»™å¤ªå¤§å‹åŠ›ï¼Œå¦åˆ™äº²å­å…³ç³»å®¹æ˜“å˜å¾—å†·æ¼ ã€‚å¤šç»™å­©å­ä¸€ç‚¹æ¸©æƒ…çš„æ‹¥æŠ±ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b><br>ä½ çš„å‘½å±€å¯’æ°”å¤ªé‡ã€‚åŠ¡å¿…å¤šæ™’å¤ªé˜³ï¼Œå¤šç©¿çº¢è¡£ï¼Œå±…ä½ç¯å¢ƒè¦å…‰ç…§å……è¶³ã€‚å¿Œå»åŒ—æ–¹å‘å±•ï¼Œå®œå¾€å—æ–¹ã€‚èº«ä½“ä¸Šè¦æ³¨æ„é£æ¹¿å¯’ç—‡ã€è‚¾è„ä»¥åŠå¿ƒè¡€ç®¡ç³»ç»Ÿçš„å¥åº·ã€‚å†¬å¤©æ˜¯ä½ æœ€éš¾ç†¬çš„å­£èŠ‚ï¼Œè¦æ³¨æ„ä¿æš–ã€‚" }, 
            female: { c:"<b>[å¤©èµ‹æ ¸å¿ƒï¼šå†°å±±ç¾äºº]</b><br>æ‰è²ŒåŒå…¨ï¼Œæ°”è´¨é«˜å†·ï¼Œä½ æ˜¯äººç¾¤ä¸­é‚£ä¸ªè®©äººä¸æ•¢è½»æ˜“é è¿‘çš„å­˜åœ¨ã€‚é€‚åˆæ¼”è‰ºã€å¤–äº¤ã€å…¬å…³é«˜ç®¡ã€é«˜ç«¯é”€å”®ã€‚ä½ å¿…é¡»æœ‰ç«æš–å±€ï¼Œä¹Ÿå°±æ˜¯è¦æœ‰èˆå°ã€æœ‰èšå…‰ç¯ï¼Œå¦åˆ™ä½ çš„æ‰åä¼šå˜æˆå­¤èŠ³è‡ªèµï¼Œç”šè‡³å¯¼è‡´æŠ‘éƒã€‚ä½ çš„æ‰åéœ€è¦â€œè¢«çœ‹è§â€ï¼Œä¸è¦èº²åœ¨è§’è½é‡Œã€‚", w:"<b>[è´¢å¯Œé€»è¾‘ï¼šå¤«è£å¦»è´µ]</b><br>è¿™æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„æ ¼å±€ã€‚å¯¹äºé‡‘æ°´ä¼¤å®˜å¥³å‘½æ¥è¯´ï¼Œå®˜æ˜Ÿï¼ˆç«ï¼‰ä¸ä»…æ˜¯å¤«æ˜Ÿï¼Œä¹Ÿæ˜¯å–œç”¨ç¥ã€‚è¿™æ„å‘³ç€ä½ çš„è´¢å¯Œå’Œåœ°ä½ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¼šæ¥è‡ªäºä½ çš„ä¼´ä¾£æˆ–è€…ä½ æ‰€åœ¨çš„å¹³å°ï¼ˆå…¬å¸/ä½“åˆ¶ï¼‰ã€‚â€œæ—ºå¤«å³æ—ºå·±â€ï¼Œæˆå°±ä½ çš„å¦ä¸€åŠï¼Œå°±æ˜¯æˆå°±ä½ è‡ªå·±ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Šï¼šæƒæ‰å‚²ç‰©ä¸æ¸´æœ›å‘µæŠ¤]</b><br>ä¼¤å®˜æœ¬æ˜¯å…‹å®˜ï¼ˆå¤«ï¼‰çš„ï¼Œä½†é‡‘æ°´ä¼¤å®˜æ˜¯ç‰¹ä¾‹ï¼Œâ€œç‹¬å–œå®˜â€ã€‚ä½ å†…å¿ƒéå¸¸æ¸´æœ›ç”·äººçš„å‘µæŠ¤å’Œæ¸©æš–ï¼Œä½†è¡¨ç°å‡ºæ¥çš„å´æ˜¯æŒ‘å‰”å’Œé«˜å‚²ã€‚åƒä¸‡åˆ«ä½œï¼é‡åˆ°é‚£ä¸ªæ„¿æ„åŒ…å®¹ä½ åè„¾æ°”ã€è¿˜èƒ½ç»™ä½ æš–è¢«çªçš„äººï¼Œå°±å«äº†å§ã€‚ä¸è¦è¯•å›¾å»é©¾é©­ç”·äººï¼Œè€Œæ˜¯å­¦ä¼šç¤ºå¼±ï¼Œè¿™æ‰æ˜¯ä½ çš„å¿…æ€æŠ€ã€‚", k:"<b>[åä»£ä¼ æ‰¿ï¼šè´µå­ä¸´é—¨]</b><br>ä½ çš„å­©å­é€šå¸¸é•¿ç›¸æ¼‚äº®ï¼Œèªæ˜ä¼¶ä¿ï¼Œæ˜¯ä½ ç”Ÿå‘½çš„å»¶ç»­å’Œå¸Œæœ›ã€‚ç”Ÿå­©å­å¯¹ä½ çš„è¿åŠ¿æœ‰æå‡ä½œç”¨ï¼Œå› ä¸ºå­©å­ä»£è¡¨é£Ÿä¼¤ï¼Œä¹Ÿæ˜¯ä½ æ‰åçš„å…·è±¡åŒ–ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b><br>ä½ æ˜¯å…¸å‹çš„â€œå†·åº•å­â€ã€‚ç‰¹åˆ«è¦æ³¨æ„å¦‡ç§‘å¯’ç—‡ã€ç—›ç»ã€æ‰‹è„šå†°å‡‰çš„é—®é¢˜ã€‚åšæŒæ³¡è„šï¼Œå°‘åƒç”Ÿå†·é£Ÿç‰©ï¼ˆå†°æ·‡æ·‹ã€åˆºèº«ï¼‰ï¼Œå¤šåƒæ¸©è¡¥çš„é£Ÿç‰©ã€‚ä¿æŒä½“æ¸©ï¼Œå°±æ˜¯ä¿æŒè¿æ°”ã€‚" } 
        },
        "é‡‘æ°´é£Ÿç¥": { name: "ğŸŒŠ çµåŠ¨æ™ºè€…", tags: ["SSR","æ¸…è´µ"], icon: "ğŸŒŠ", slogan: "é‡‘ç™½æ°´æ¸…ï¼Œæ‰åæ¨ªæº¢ã€‚", male: { c:"[å¤©èµ‹] å†…ç§€ä¹¾å¤ã€‚å­¦æœ¯æˆ–è‰ºæœ¯å¤©æ‰ã€‚æ‰åå†…æ•›ï¼Œæˆå°±äºæ·±è€•ã€‚è§ç«åæ‰¬å¤©ä¸‹ã€‚", w:"[è´¢å¯Œ] æŠ€è‰ºç”Ÿè´¢ã€‚é ä¸å¯æ›¿ä»£çš„ä¸“ä¸šå£å’è‡´å¯Œã€‚", l:"[ç¾ç»Š] çµé­‚çŸ¥å·±ã€‚è¿½æ±‚ç²¾ç¥é«˜åº¦å¥‘åˆã€‚", k:"[ä¼ æ‰¿] èªæ…§éº’éºŸã€‚çˆ¶å­å¦‚å‹ã€‚", h:"[é”¦å›Š] è¡¥ç«æš–å±€ã€‚ä¿æŒå¼€æœ—å¿ƒæ€ã€‚" }, female: { c:"[å¤©èµ‹] æ¸…æ–°è„±ä¿—ã€‚æ°”è´¨å¦‚æœˆï¼Œæ–‡åŒ–ã€æ•™è‚²è¡Œä¸šèƒ½è‡ªæˆå¤§å®¶ã€‚", w:"[è´¢å¯Œ] å°ç¡®å¹¸ä¸æ–­ã€‚æ€»æœ‰è´µäººä¸ºä¼´ã€‚", l:"[ç¾ç»Š] å¯’è°·å›æ˜¥ã€‚æ¸©æŸ”æ˜¯ç»ˆææ­¦å™¨ã€‚", k:"[ä¼ æ‰¿] å­å¥³å­é¡ºã€‚æ™šå¹´ç¦æ°”æ»¡æ»¡ã€‚", h:"[é”¦å›Š] æ»‹é˜´è¡¥é˜³ã€‚ä¿æŒå¿ƒæƒ…æ„‰å¿«ã€‚" } },
        "ä¼¤å®˜é…å°": { 
            name: "ğŸ”® æ™ºè€…ç¥å¯ (Oracle)", tags: ["UR","æ™ºæ…§","æ—¢æµ"], icon: "ğŸ“œ", slogan: "çƒˆç«çƒ¹æ²¹ï¼Œæ·±æ°´é™æµã€‚", 
            male: { c:"<b>[å¤©èµ‹æ ¸å¿ƒï¼šæ–‡ç†å…¼å¤‡]</b><br>ä½ ç”Ÿäºç«ç‡¥ä¹‹æ—¶ï¼Œå¾—æ°´å°æ¶¦å±€ï¼Œå½¢æˆäº†æä¸ºç½•è§çš„â€œä¼¤å®˜é…å°â€ã€‚ä½ æ‹¥æœ‰ä¼¤å®˜çš„çˆ†å‘æ€§æ‰åå’Œå°æ˜Ÿçš„æ·±åšåº•è•´ã€‚é€‚åˆä»äº‹å­¦æœ¯ã€ç§‘ç ”ã€æ™ºå›Šã€ä¼ åª’é«˜å±‚ç­‰èŒä½ã€‚ä½ æ˜¯é‚£ç§èƒ½æŠŠå†²åŠ¨è½¬åŒ–ä¸ºåŠ¨åŠ›ï¼ŒæŠŠç›´è§‰å‡åä¸ºç†è®ºçš„é¡¶çº§å¤åˆå‹äººæ‰ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘ï¼šåæœ›å˜ç°]</b><br>ä½ çš„é’±ä¸æ˜¯æŠ¢æ¥çš„ï¼Œæ˜¯â€œå…»â€å‡ºæ¥çš„ã€‚ç”±äºæœ‰å°æ˜ŸæŠ¤æŒï¼Œä½ æœ€é€‚åˆé åå£°ã€ç‰ˆæƒã€çŸ¥è¯†äº§æƒè·åˆ©ã€‚å¿ŒåœŸï¼ˆè´¢ï¼‰åå°ã€‚ä¸€æ—¦ä½ å˜å¾—è¿‡äºè´ªå©ªæˆ–æ€¥åŠŸè¿‘åˆ©ï¼Œä½ çš„è´µæ°”å°±ä¼šå—æŸã€‚ä¿æŒä½ çš„ä¸“ä¸šé«˜åº¦ï¼Œè´¢å¯Œè‡ªç„¶è¿½éšã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Šï¼šç²¾ç¥äº’è¡¥]</b><br>ä½ çš„ä¼´ä¾£æ˜¯ä½ çš„æ•‘å‘½ç¨»è‰ï¼Œèƒ½è®©ä½ åœ¨ç„¦èºæ—¶å†·é™ã€‚å¯¹æ–¹å¯èƒ½ä¸ä¸€å®šå¤šå¯Œæœ‰ï¼Œä½†ä¸€å®šæ˜¯æœ‰æ™ºæ…§ã€èƒ½ç»™ä½ ç²¾ç¥æ”¯æŒçš„äººã€‚ä½ ä»¬çš„å©šå§»æ˜¯â€œæ°´ç«ç›¸æµâ€çš„å…¸èŒƒï¼Œå½¼æ­¤æˆå°±ï¼Œç¼ºä¸€ä¸å¯ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b><br>å­©å­èªæ˜ä¸”å¸¦æœ‰è´µæ°”ï¼Œå¤šåœ¨æ–‡åŒ–ç•Œæˆ–ç§‘æŠ€ç•Œæœ‰æ‰€æˆå°±ã€‚ä½ æ˜¯å­©å­æœ€å¥½çš„å¯è’™è€å¸ˆï¼Œä½ çš„è¨€è¡Œå°†å½±å“å­©å­çš„ä¸€ç”Ÿã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b><br>æ³¨æ„é¢„é˜²å¿ƒç«è¿‡æ—ºã€‚æ€è™‘è¿‡é‡ä¼šå¯¼è‡´å¤±çœ æˆ–å£è…”æºƒç–¡ã€‚å¤šå»æ°´è¾¹æ¼«æ­¥ï¼Œåˆ©ç”¨è‡ªç„¶çš„èƒ½é‡ä¸­å’Œä½“å†…çš„ç‡¥æ°”ã€‚ä¿æŒæ·¡å®šï¼Œæ˜¯ä½ é€šå¾€å·…å³°çš„å”¯ä¸€è·¯å¾„ã€‚" }, 
            female: { c:"<b>[å¤©èµ‹æ ¸å¿ƒï¼šè´µæ°”æ‰å¥³]</b><br>ä½ å…¼å…·çµæ°”ä¸ç¨³é‡ï¼Œæ˜¯å…¸å‹çš„èŒåœºå¤§å¥³ä¸»æˆ–å¤§å®¶é—ºç§€ã€‚åœ¨å¤ä»£ï¼Œè¿™æ˜¯æ ‡å‡†çš„çŠ¶å…ƒå¤«äººå‘½ï¼›åœ¨ç°ä»£ï¼Œä½ æ˜¯èƒ½åœ¨é«˜å‹ç¯å¢ƒä¸­ä¿æŒä¼˜é›…çš„ç²¾è‹±å¥³æ€§ã€‚ä½ é€‚åˆä»äº‹æ•™è‚²ã€å‡ºç‰ˆã€è‰ºæœ¯ç­–åˆ’æˆ–ç®¡ç†å±‚ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘ï¼šå®‰ç¨³ä¹‹è´¢]</b><br>ç”±äºæœ‰å°æ˜Ÿç”Ÿèº«ï¼Œä½ ä¸€è¾ˆå­è´µäººè¿æå¼ºï¼Œå…³é”®æ—¶åˆ»æ€»æœ‰äººæ‹‰ä½ ä¸€æŠŠã€‚ä¸å»ºè®®ä»äº‹é£é™©å·¨å¤§çš„æŠ•æœºæ´»åŠ¨ï¼Œé€‚åˆé•¿çº¿æŠ•èµ„å’Œç»è¥ä¸ªäººå“ç‰Œã€‚ä½ çš„ç”Ÿæ´»è´¨é‡ä¼šéšç€å¹´é¾„å¢é•¿è€ŒæŒç»­æå‡ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Šï¼šè´¤å†…åŠ©]</b><br>ä½ èƒ½å¾ˆå¥½åœ°å¹³è¡¡äº‹ä¸šä¸å®¶åº­ã€‚ä½ çš„ä¼´ä¾£å¤šä¸ºå„’é›…å›å­ï¼Œæˆ–è€…æ˜¯éå¸¸æ¬£èµä½ æ‰åçš„äººã€‚ä½ å¯¹ä¸ˆå¤«ä¸ä»…æœ‰çˆ±ï¼Œæ›´æœ‰æ”¯æŒï¼Œæ˜¯é‚£ç§èƒ½å¸®å¤«è¿çš„è´µæ°”å¥³å‘½ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b><br>å­å¥³çµæ°”é€¼äººï¼Œå–„è§£äººæ„ã€‚ä½ å’Œå­©å­çš„å…³ç³»éå¸¸äº²å¯†ï¼Œä½ ä¸ä»…æ˜¯æ¯äº²ï¼Œæ›´æ˜¯ä»–ä»¬çš„å¿ƒçµå¯¼å¸ˆã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b><br>ä¿å…»ç§˜è¯€åœ¨äºâ€œæ»‹é˜´â€ã€‚å¤šè¡¥æ°´ï¼Œå¤šåƒæ»‹æ¶¦ç±»é£Ÿç‰©ï¼Œå°‘ç†¬å¤œã€‚ä½ çš„å®¹è²Œå—æƒ…ç»ªå½±å“å¾ˆå¤§ï¼Œä¿æŒå¿ƒæƒ…å¹³å’Œï¼Œå°±æ˜¯æœ€å¥½çš„ç¾å®¹ã€‚æ³¨æ„çœ¼éƒ¨ä¿å…»ã€‚" } 
        },
        "ä¼¤å®˜åˆæ€": { name: "âš¡ å±æœºç»ˆç»“è€…", tags: ["SSR","æƒè°‹"], icon: "ğŸ—¡ï¸", slogan: "æ··ä¹±æ˜¯é˜¶æ¢¯ï¼Œæƒè°‹æ˜¯åˆ©åˆƒã€‚", male: { c:"[å¤©èµ‹] ä¹±ä¸–æ­é›„ã€‚å±æœºå…¬å…³ã€é»‘ç™½é€šåƒã€‚æ“…é•¿é™ç»´æ‰“å‡»ã€‚", w:"[è´¢å¯Œ] ç‹©çŒè€…ã€‚é™ç»´æ‰“å‡»ã€‚çˆ†å‘åŠ›æå¼ºã€‚", l:"[ç¾ç»Š] ç›¸çˆ±ç›¸æ€ã€‚å©šå§»å……æ»¡åšå¼ˆã€‚", k:"[ä¼ æ‰¿] å›é€†å¤©æ‰ã€‚åˆ«é€¼å­©å­å¬è¯ã€‚", h:"[é”¦å›Š] é˜²è¿‡è½½ã€‚å­¦ä¼šå¼ºåˆ¶ä¼‘å‡ã€‚" }, female: { c:"[å¤©èµ‹] é“å¨˜å­ã€‚é•‡å¾—ä½åœºå­ï¼Œèƒ½æå®šæœ€éš¾ç¼ çš„å¯¹æ‰‹ã€‚", w:"[è´¢å¯Œ] åæ°”å˜ç°ã€‚åœˆå±‚ç½®æ¢ã€‚", l:"[ç¾ç»Š] æ…•å¼ºã€‚æ¬£èµç¡¬æ±‰ï¼Œä½ æ˜¯ä¸»æ§æ ¸å¿ƒã€‚", k:"[ä¼ æ‰¿] ç²¾è‹±ã€‚å­©å­å‡ºç±»æ‹”èƒã€‚", h:"[é”¦å›Š] è°ƒå†…åˆ†æ³Œã€‚å¤šå†¥æƒ³ï¼Œå°‘åŠ¨æ€’ã€‚" } },
        "æ­£è´¢æ ¼": { name: "ğŸ§± å‹¤å‹‰ç­‘æ¢¦å¸ˆ", tags: ["R+","ç¨³å¥"], icon: "ğŸ§±", slogan: "ä¸€ç –ä¸€ç“¦ï¼Œèšæ²™æˆå¡”ã€‚", male: { c:"[å¤©èµ‹] è¸å®å®å¹²ã€‚é‡‘èã€å®ä¸šä¸­åšã€‚", w:"[è´¢å¯Œ] å¤åˆ©è‡´å¯Œã€‚å…¸å‹çš„ç§¯ç´¯å‹è´¢å¯Œã€‚", l:"[ç¾ç»Š] å® å¦»ç‹‚é­”ã€‚å·¥èµ„å¡ä¸Šäº¤ã€‚", k:"[ä¼ æ‰¿] æœ´å®æ­£ç›´ã€‚", h:"[é”¦å›Š] åˆ«é€æ”¯ï¼Œä¿æŠ¤è…°æ¤ã€‚" }, female: { c:"[å¤©èµ‹] ç²¾ç»†ç®¡å®¶ã€‚é€»è¾‘ä¸¥æ•´ã€‚", w:"[è´¢å¯Œ] å­˜é’±ç½ã€‚ç†è´¢æç¨³ã€‚", l:"[ç¾ç»Š] è´¤æƒ æŒå®¶ã€‚", k:"[ä¼ æ‰¿] ç‹¬ç«‹æˆé•¿ã€‚", h:"[é”¦å›Š] æ°”è¡€è™šã€‚å¤šåƒæ¸©è¡¥ã€‚" } },
        "æ‚æ ¼": { name: "ğŸŒ± æ½œé¾™å‹¿ç”¨", tags: ["N","æ½œåŠ›"], icon: "ğŸŒ±", slogan: "æ—¶è¿æœªåˆ°ï¼Œæ½œå¿ƒä¿®ç‚¼ã€‚", male: { c:"[å¤©èµ‹] å¤šé¢æ‰‹ã€‚ç»¼åˆå¹³è¡¡ã€‚", w:"[è´¢å¯Œ] å‹¤åŠ³è‡´å¯Œã€‚", l:"[ç¾ç»Š] å¹³æ·¡æ˜¯çœŸã€‚", k:"[ä¼ æ‰¿] å¥åº·å¹³å®‰ã€‚", h:"[é”¦å›Š] åšæŒé”»ç‚¼ã€‚" }, female: { c:"[å¤©èµ‹] è¸å®åå‹¤ã€‚", w:"[è´¢å¯Œ] èŠ‚ä¿­æŒå®¶ã€‚", l:"[ç¾ç»Š] ä¾é è€å®äººã€‚", k:"[ä¼ æ‰¿] æ…ˆæ¯å¿ƒã€‚", h:"[é”¦å›Š] ä¿è¯ç¡çœ ã€‚" } }
    };

    const XIJI_RULES = {
        "é‡‘æ°´ä¼¤å®˜": { desc: "å†¬é‡‘å¯’å†·ï¼Œå¿…ç”¨ç«è°ƒå€™ã€‚å–œå®˜æ€ã€è´¢æ˜Ÿã€‚å¿Œé‡‘æ°´è¿‡æ—ºåŠ å¯’ã€‚", joy: ["ğŸ”¥ ç« (è°ƒå€™)","ğŸŒ² æœ¨ (è´¢æ˜Ÿ)"], taboo: ["ğŸ’§ æ°´ (ä¼¤å®˜)","â›°ï¸ åœŸ (åŸ‹é‡‘)"] },
        "é‡‘æ°´é£Ÿç¥": { desc: "é‡‘ç™½æ°´æ¸…ï¼Œæ‰åå†…æ•›ã€‚å–œç«è°ƒå€™ï¼Œå¿ŒåœŸå…‹é£Ÿã€‚æ°´å†·é‡‘å¯’éœ€ç«æ•‘ã€‚", joy: ["ğŸ”¥ ç« (æš–å±€)","ğŸŒ² æœ¨ (é€šå…³)"], taboo: ["â›°ï¸ åœŸ (å¤ºé£Ÿ)","ğŸ’§ æ°´ (æ²‰æ²¦)"] },
        "ä¼¤å®˜é…å°": { desc: "å¤æœ¨ç„¦æ¸´æˆ–èº«å¼±ä¼¤æ—ºã€‚æ€¥éœ€æ°´å°æ¶¦å±€ç”Ÿèº«ï¼Œåˆ¶ä¼¤ä¸ºè´µã€‚è°ƒå€™å¾—åŠ›ï¼Œæ—¢æµä¹‹åŠŸã€‚", joy: ["ğŸ’§ æ°´ (å°æ˜Ÿ)","ğŸŒ² æœ¨ (å¸®èº«)"], taboo: ["â›°ï¸ åœŸ (åå°)","ğŸ”¥ ç« (ç‡¥çƒ­)"] },
        "ä¼¤å®˜åˆæ€": { desc: "ä¼¤æ€ä¸¤æ—ºï¼Œåˆæ€ä¸ºæƒã€‚ä»¥æ™ºæ…§è°‹ç•¥åŒ–è§£å±æœºï¼Œè½¬å‡¶ä¸ºå‰ã€‚", joy: ["ğŸ“œ å°æ˜Ÿ","ğŸ’ª æ¯”åŠ«"], taboo: ["ğŸ’° è´¢æ˜Ÿ","ğŸ—¡ï¸ å®˜æ€"] },
        "æ­£è´¢æ ¼": { desc: "è´¢æ˜Ÿå½“ä»¤ã€‚èº«å¼ºä»»è´¢ï¼Œèº«å¼±å–œå°æ¯”ã€‚æ­¥æ­¥ä¸ºè¥ä¹‹å¯Œã€‚", joy: ["ğŸ’ª æ¯”åŠ«","ğŸ“œ å°æ˜Ÿ"], taboo: ["ğŸ’° è´¢æ˜Ÿ (èº«å¼±)","ğŸ—¡ï¸ å®˜æ€"] },
        "æ‚æ ¼": { desc: "æ ¼å±€æœªæ¸…ï¼Œäº”è¡Œæ‚å±…ã€‚å…¨å‡­æ‰¶æŠ‘è°ƒå€™ï¼Œéœ€çœ‹æ—¥ä¸»åº•è•´ã€‚", joy: ["æ‰¶åŠ©ç”¨ç¥"], taboo: ["å…‹å®³ç”¨ç¥"] }
    };

    // --- æ ¸å¿ƒç®—æ³• (Core Algorithm) ---
    function hasRoot(gan, pillars) {
        const roots = ROOT_MAP[gan] || [];
        return pillars.some(p => roots.includes(p.z));
    }

    function calcCommander(lunar, monthZhi) {
        const prevJie = lunar.getPrevJie();
        const pjSolar = prevJie.getSolar();
        const jieTime = new Date(pjSolar.getYear(), pjSolar.getMonth()-1, pjSolar.getDay(), pjSolar.getHour(), pjSolar.getMinute()).getTime();
        const birthTime = new Date(lunar.getSolar().getYear(), lunar.getSolar().getMonth()-1, lunar.getSolar().getDay(), lunar.getSolar().getHour(), lunar.getSolar().getMinute()).getTime();
        const diffDays = Math.floor((birthTime - jieTime) / (1000 * 60 * 60 * 24));
        const rules = SILING_RULES[monthZhi];
        let commander = rules[rules.length-1][0]; 
        let sum = 0;
        for (let r of rules) { sum += r[1]; if (diffDays < sum) { commander = r[0]; break; } }
        return { commander, diffDays };
    }

    function analyzeClimate(dm, mz, pillars) {
        const isWinter = ["äº¥","å­","ä¸‘"].includes(mz);
        const isSummer = ["å·³","åˆ","æœª"].includes(mz);
        const dmWx = WUXING_MAP[dm];
        const hasFire = pillars.some(p => WUXING_MAP[p.g] === 'ç«' || WUXING_MAP[p.z] === 'ç«');
        const hasWater = pillars.some(p => WUXING_MAP[p.g] === 'æ°´' || WUXING_MAP[p.z] === 'æ°´');
        
        let adv = null;
        if (dmWx === 'åœŸ' && isWinter && !hasFire) adv = "âš ï¸ æ°´å†·åœŸå†»ï¼Œä¸‡ç‰©ä¸ç”Ÿï¼Œæ€¥éœ€ç«æ°”è½¬è¿ã€‚";
        if (dmWx === 'æœ¨' && isSummer && !hasWater) adv = "âš ï¸ æœ¨ç„¦ç«ç‡¥ï¼Œæ— æ°´æ»‹æ¶¦ï¼Œæ‰åæ˜“æˆæ˜™èŠ±ä¸€ç°ã€‚";
        
        let spec = null;
        if (dmWx === 'é‡‘' && isWinter) {
            spec = pillars.some(p => SHISHEN_MAP[dm][p.g] === 'ä¼¤å®˜') ? "é‡‘æ°´ä¼¤å®˜" : "é‡‘æ°´é£Ÿç¥";
        }
        if (dmWx === 'æœ¨' && ["å¯…","å¯"].includes(mz) && pillars.some(p => WUXING_MAP[p.g]==='ç«')) spec = "æœ¨ç«é€šæ˜";
        // å¤æœ¨é…å°é€»è¾‘
        if (dmWx === 'æœ¨' && isSummer && hasWater) {
             const hasSG = pillars.some(p => SHISHEN_MAP[dm][p.g] === 'ä¼¤å®˜');
             if(hasSG) spec = "ä¼¤å®˜é…å°";
        }
        
        return { special: spec, advice: adv };
    }

    function determinePattern(climate, pillars, dm, mz, cmd) {
        if (climate.special) return climate.special;
        const stems = [pillars[0].g, pillars[1].g, pillars[3].g];
        const gods = stems.map(s => SHISHEN_MAP[dm][s]);

        // 1. æ€æ˜Ÿä¼˜å…ˆ
        if (gods.includes("ä¸ƒæ€")) {
            if (gods.includes("ä¼¤å®˜")) return "ä¼¤å®˜åˆæ€";
            if (gods.includes("é£Ÿç¥") && stems.some(s => SHISHEN_MAP[dm][s]==="é£Ÿç¥" && hasRoot(s, pillars))) return "é£Ÿç¥åˆ¶æ€";
            if (gods.includes("æ­£å°") || gods.includes("åå°")) return "æ€å°ç›¸ç”Ÿ";
        }

        // 2. ä¼¤å®˜ä¼˜å…ˆ (é€šæ ¹æ£€æµ‹)
        if (gods.includes("ä¼¤å®˜")) {
            const sgStem = stems.find(s => SHISHEN_MAP[dm][s] === "ä¼¤å®˜");
            if (hasRoot(sgStem, pillars)) {
                // ä¼¤å®˜é…å° (å°è¦æœ‰æ ¹)
                const hasStrongYin = stems.some(s => (SHISHEN_MAP[dm][s]==="æ­£å°" || SHISHEN_MAP[dm][s]==="åå°") && hasRoot(s, pillars));
                if (hasStrongYin) return "ä¼¤å®˜é…å°";
                if (gods.some(g => g && g.includes("è´¢"))) return "ä¼¤å®˜ç”Ÿè´¢";
                return "ä¼¤å®˜æ ¼";
            }
        }

        // 3. å¸ä»¤é€å¹²
        if (stems.includes(cmd.commander)) {
            const g = SHISHEN_MAP[dm][cmd.commander];
            const m = {"æ­£è´¢":"æ­£è´¢æ ¼","åè´¢":"åè´¢æ ¼","æ­£å®˜":"æ­£å®˜æ ¼","æ­£å°":"æ­£å°æ ¼","é£Ÿç¥":"é£Ÿç¥æ ¼"};
            if (m[g]) return m[g];
        }

        const mainGod = SHISHEN_MAP[dm][ZHI_MAIN_QI[mz]];
        const fallback = {"æ­£è´¢":"æ­£è´¢æ ¼","æ­£å®˜":"æ­£å®˜æ ¼","ä¸ƒæ€":"ä¸ƒæ€æ ¼","æ­£å°":"æ­£å°æ ¼","é£Ÿç¥":"é£Ÿç¥æ ¼","ä¼¤å®˜":"ä¼¤å®˜æ ¼"};
        return fallback[mainGod] || "æ‚æ ¼";
    }

    function startScan() {
        const timeStr = document.getElementById('birth-input').value;
        if (!timeStr) return alert("è¯·é€‰ä¸‹é™æ—¶åˆ»");
        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const baziObj = lunar.getEightChar();
            baziObj.setSect(2);

            const pillars = [
                {t:'å¹´', g:baziObj.getYearGan().toString(), z:baziObj.getYearZhi().toString()},
                {t:'æœˆ', g:baziObj.getMonthGan().toString(), z:baziObj.getMonthZhi().toString()},
                {t:'æ—¥', g:baziObj.getDayGan().toString(), z:baziObj.getDayZhi().toString()},
                {t:'æ—¶', g:baziObj.getTimeGan().toString(), z:baziObj.getTimeZhi().toString()}
            ];

            const dm = pillars[2].g;
            const mz = pillars[1].z;
            const cmd = calcCommander(lunar, mz);
            const climate = analyzeClimate(dm, mz, pillars);
            const pattern = determinePattern(climate, pillars, dm, mz, cmd);

            document.getElementById('result-area').style.display = 'block';
            renderUI(pattern, cmd, dm, climate, pillars);
            drawChart(pillars);
            document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
        } catch (e) { alert("ä¸­æ–­ï¼š" + e.message); console.error(e); }
    }

    function renderUI(key, cmd, dm, climate, pillars) {
        const data = GAME_DB[key] || GAME_DB["æ‚æ ¼"];
        const xiji = XIJI_RULES[key] || XIJI_RULES["æ‚æ ¼"];
        const detail = data[currentGender === 1 ? 'male' : 'female'];

        document.getElementById('role-icon').innerText = data.icon;
        document.getElementById('role-name').innerText = data.name;
        document.getElementById('role-slogan').innerText = data.slogan;
        document.getElementById('role-tags').innerHTML = `<span class="tag ssr">${key}</span>` + data.tags.map(t => `<span class="tag">${t}</span>`).join('');
        document.getElementById('siling-text').innerText = `${cmd.commander} (${SHISHEN_MAP[dm][cmd.commander]}) Â· æ‰§æ”¿ç¬¬ ${cmd.diffDays} å¤©`;
        
        let reason = xiji.desc;
        if (climate.advice) reason += ` <br><span style='color:var(--china-red);'>${climate.advice}</span>`;
        document.getElementById('pattern-reason').innerHTML = reason;
        document.getElementById('txt-joy').innerText = xiji.joy.join(" ");
        document.getElementById('txt-taboo').innerText = xiji.taboo.join(" ");

        let p_html = '';
        pillars.forEach(p => {
            const god = p.t.includes('æ—¥') ? 'å…ƒç¥' : (SHISHEN_MAP[dm][p.g] || "");
            p_html += `<div class="ofuda"><div class="ofuda-head">${p.t}</div><div class="ofuda-god">${god}</div><div class="ofuda-char ${WX_COLOR_MAP[WUXING_MAP[p.g]] ? '' : ''}" style="color:${WX_COLOR_MAP[WUXING_MAP[p.g]]}">${p.g}</div><div class="ofuda-char" style="color:${WX_COLOR_MAP[WUXING_MAP[p.z]]}">${p.z}</div><span class="ofuda-cs">${CHANGSHENG_TABLE[p.g][p.z] || ""}</span></div>`;
        });
        document.getElementById('pillars-box').innerHTML = p_html;

        document.getElementById('guide-content').innerHTML = `
            <div class="guide-item"><div class="guide-title">âš”ï¸ äº‹ä¸šå¤©èµ‹</div><div class="guide-text">${detail.c}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ’° è´¢å¯Œé€»è¾‘</div><div class="guide-text">${detail.w}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ’ æƒ…æ„Ÿç¾ç»Š</div><div class="guide-text">${detail.l}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸŒ± åä»£ä¼ æ‰¿</div><div class="guide-text">${detail.k}</div></div>
            <div class="guide-item"><div class="guide-title">âš”ï¸ å®æˆ˜é”¦å›Š</div><div class="guide-text">${detail.h}</div></div>
        `;
    }

    function drawChart(pillars) {
        const canvas = document.getElementById('energy-canvas');
        const ctx = canvas.getContext('2d');
        const w = canvas.offsetWidth, h = canvas.offsetHeight;
        canvas.width = w; canvas.height = h;
        const counts = {'é‡‘':0,'æœ¨':0,'æ°´':0,'ç«':0,'åœŸ':0};
        pillars.forEach(p => { counts[WUXING_MAP[p.g]]++; counts[WUXING_MAP[p.z]]++; });
        const cx = w/2, cy = h/2, r = 70;
        ctx.strokeStyle = "#ddd"; ctx.lineWidth = 1;
        for(let j=1; j<=3; j++) {
            ctx.beginPath();
            for(let i=0; i<5; i++) {
                const a = (Math.PI*2/5)*i - Math.PI/2;
                ctx.lineTo(cx + Math.cos(a)*r*(j/3), cy + Math.sin(a)*r*(j/3));
            }
            ctx.closePath(); ctx.stroke();
        }
        ctx.fillStyle = "rgba(179, 45, 46, 0.2)"; ctx.strokeStyle = "#b32d2e"; ctx.lineWidth = 3;
        ctx.beginPath();
        Object.keys(counts).forEach((k, i) => {
            const a = (Math.PI*2/5)*i - Math.PI/2;
            const l = (counts[k]/8)*r*3.5; 
            const x = cx + Math.cos(a)*l, y = cy + Math.sin(a)*l;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            ctx.save();
            ctx.fillStyle = "#111"; ctx.font = "bold 12px KaiTi";
            ctx.fillText(k, cx + Math.cos(a)*(r+20)-5, cy + Math.sin(a)*(r+20)+5);
            ctx.restore();
        });
        ctx.closePath(); ctx.fill(); ctx.stroke();
    }

    function setGender(v, el) {
        currentGender = v;
        document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }
</script>
</body>
</html>
