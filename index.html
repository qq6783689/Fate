<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>天命鑑定 · 宗师传记典藏版</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&display=swap');

        :root {
            --china-red: #8e1818;      /* 故宫深红 */
            --paper-bg: #f7f6f2;       /* 宣纸灰白 */
            --ink-main: #2b2b2b;       /* 徽墨 */
            --gold-accent: #cfa972;    /* 沉金 */
            --border-color: #dcd6cb;
            --wood: #3a7ca5; --fire: #d64045; --earth: #9c6644; --metal: #e9c46a; --water: #2a9d8f;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Serif SC', 'Source Han Serif SC', serif;
            background-color: #eee;
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: var(--ink-main); margin: 0; padding: 40px 15px; min-height: 100vh;
            display: flex; justify-content: center;
        }

        .container { width: 100%; max-width: 900px; padding-bottom: 100px; }

        /* Header */
        .header { text-align: center; margin-bottom: 60px; }
        .header h1 { 
            font-family: 'Ma Shan Zheng', cursive; font-size: 4rem; margin: 0; 
            color: var(--china-red); letter-spacing: 8px; line-height: 1.2;
            text-shadow: 2px 2px 0px rgba(142, 24, 24, 0.1);
        }
        .header .sub-title {
            font-size: 1rem; color: #888; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc;
            display: inline-block; padding: 8px 30px; margin-top: 20px; letter-spacing: 5px; 
            text-transform: uppercase; font-weight: bold;
        }

        /* Card */
        .card {
            background: var(--paper-bg); border: 1px solid #dcdcdc;
            padding: 45px; margin-bottom: 40px; border-radius: 4px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.04); position: relative;
        }
        .card::before {
            content: ''; position: absolute; top: 6px; left: 6px; right: 6px; bottom: 6px;
            border: 1px solid rgba(0,0,0,0.05); pointer-events: none;
        }

        /* Input */
        .label { 
            color: var(--china-red); font-size: 1.1rem; margin-bottom: 15px; 
            display: block; font-weight: bold; font-family: 'Ma Shan Zheng', cursive; letter-spacing: 2px;
        }
        .gender-box { display: flex; gap: 20px; margin-bottom: 30px; }
        .g-btn {
            flex: 1; padding: 18px; text-align: center; border: 1px solid #ccc;
            background: #fff; color: #888; cursor: pointer; transition: 0.3s;
            font-family: 'Noto Serif SC', serif; font-weight: bold; font-size: 1.1rem;
        }
        .g-btn.active { 
            border-color: var(--china-red); color: var(--china-red); 
            background: rgba(142, 24, 24, 0.04);
        }
        input[type="datetime-local"] {
            width: 100%; padding: 18px; background: #fff; border: 1px solid #ccc;
            color: var(--ink-main); font-size: 1.2rem; outline: none; font-family: 'Noto Serif SC', serif;
        }
        .btn-start {
            width: 100%; padding: 22px; border: none; background: var(--china-red);
            color: #fff; font-size: 1.4rem; font-weight: 900; letter-spacing: 8px;
            cursor: pointer; margin-top: 30px; transition: all 0.3s;
            font-family: 'Noto Serif SC', serif; box-shadow: 0 10px 30px rgba(142, 24, 24, 0.2);
        }
        .btn-start:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(142, 24, 24, 0.3); }

        #result-area { display: none; animation: fadeInUp 1s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

        /* Role Header */
        .role-header { text-align: center; margin-bottom: 50px; border-bottom: 1px dashed #ccc; padding-bottom: 40px; }
        .role-icon { font-size: 5rem; display: block; margin-bottom: 20px; }
        .role-title { font-family: 'Ma Shan Zheng', cursive; font-size: 3.5rem; color: var(--china-red); margin: 0; line-height: 1.2; }
        .role-sub { color: #666; font-size: 1.2rem; margin-top: 15px; font-style: italic; letter-spacing: 1px; }
        .role-tags { display: flex; justify-content: center; gap: 15px; margin-top: 30px; flex-wrap: wrap; }
        .tag { font-size: 0.9rem; padding: 6px 18px; border: 1px solid var(--china-red); color: var(--china-red); font-weight: bold; }
        .tag.ssr { background: var(--china-red); color: #fff; }

        /* Activation & Commander */
        .activation-box {
            background: #fffaf0; border: 1px solid var(--gold-accent);
            padding: 25px; margin-bottom: 40px; text-align: center; display: none;
        }
        .activation-title { color: var(--gold-accent); font-weight: 900; font-size: 1.2rem; display: block; margin-bottom: 8px; }
        .activation-desc { font-size: 1.05rem; color: #555; line-height: 1.6; }

        .siling-bar {
            text-align: center; padding: 15px 0; margin-bottom: 40px; 
            color: #555; font-size: 1.1rem; border-top: 3px double #e0e0e0; border-bottom: 3px double #e0e0e0;
        }
        .siling-bar b { color: var(--china-red); margin: 0 8px; font-size: 1.3rem; }

        /* Pillars */
        .pillars { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 50px; }
        .ofuda { 
            background: #fff; border: 2px solid var(--ink-main); padding: 30px 5px; text-align: center;
            box-shadow: 8px 8px 0px rgba(0,0,0,0.05); position: relative; transition: transform 0.3s;
        }
        .ofuda:hover { transform: translateY(-5px); }
        .ofuda-head { 
            font-size: 1rem; color: #fff; background: var(--ink-main); 
            display: inline-block; padding: 4px 15px; margin-bottom: 20px; 
            font-family: 'Noto Serif SC', serif; letter-spacing: 2px;
        }
        .ofuda-god { font-size: 0.9rem; color: #888; margin-bottom: 10px; display: block; height: 18px; font-weight: bold; }
        .ofuda-char { font-family: 'Ma Shan Zheng', cursive; font-size: 3rem; font-weight: 900; line-height: 1.1; display: block; }
        .hidden-stems { 
            margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 12px; 
            display: flex; flex-direction: column; gap: 5px; opacity: 0.8;
        }
        .hs-row { font-size: 0.8rem; color: #555; display: flex; justify-content: center; gap: 8px; align-items: baseline; }
        .hs-gan { font-weight: bold; color: var(--ink-main); font-size: 0.9rem; }
        .hs-god { font-size: 0.75rem; color: #999; transform: scale(0.9); }

        /* Wuxing Bar */
        .wuxing-bar-container { margin-bottom: 50px; padding: 25px; background: #fafafa; border: 1px solid #eee; }
        .wuxing-flex { display: flex; height: 12px; border-radius: 6px; overflow: hidden; margin-top: 15px; }
        .wx-segment { height: 100%; transition: width 1s ease; }
        .wx-legend { display: flex; justify-content: center; gap: 20px; margin-top: 15px; font-size: 0.9rem; color: #666; }
        .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 6px; }

        /* Logic Panel */
        .logic-panel { 
            background: #fffbf0; padding: 40px; margin-bottom: 50px; 
            border-left: 5px solid var(--china-red); position: relative;
        }
        .logic-text { font-size: 1.15rem; line-height: 2; color: #333; margin-bottom: 25px; text-align: justify; }
        .joy-taboo { display: flex; flex-direction: column; gap: 12px; font-size: 1.1rem; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 25px; }
        .joy { color: #276749; font-weight: bold; }
        .taboo { color: #c53030; font-weight: bold; }

        /* Biography Section */
        .guide-section { border-top: 5px double var(--china-red); padding-top: 60px; }
        .guide-item { margin-bottom: 70px; }
        .guide-title { 
            font-family: 'Ma Shan Zheng', cursive; font-size: 2.2rem; color: var(--china-red); 
            margin-bottom: 30px; display: flex; align-items: center; 
        }
        .guide-title::before { content: '◈'; font-size: 1.2rem; margin-right: 15px; color: var(--gold-accent); }
        .guide-text { 
            font-size: 1.2rem; line-height: 2.3; color: #2c2c2c; text-align: justify; 
            text-indent: 2em; letter-spacing: 0.5px;
        }
        .guide-text b { color: var(--china-red); font-weight: bold; background: transparent; padding: 0 4px; border-bottom: 1px solid rgba(142, 24, 24, 0.2); }

        .action-bar { text-align: center; margin-top: 60px; }
        .btn-copy {
            background: #fff; border: 1px solid #aaa; color: #666;
            padding: 12px 30px; cursor: pointer; border-radius: 4px; font-family: inherit;
            transition: 0.3s; font-size: 1rem; font-weight: bold;
        }
        .btn-copy:hover { border-color: var(--china-red); color: var(--china-red); background: #fff5f5; }

        .footer { text-align: center; font-size: 0.8rem; color: #aaa; margin-top: 80px; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>降生鑑定</h1>
        <div class="sub-title">宗师传记 · 命理正源</div>
    </div>

    <div class="card">
        <div class="form-group">
            <span class="label">乾坤之造</span>
            <div class="gender-box">
                <div class="g-btn active" onclick="setGender(1, this)">乾造 (男)</div>
                <div class="g-btn" onclick="setGender(0, this)">坤造 (女)</div>
            </div>
        </div>
        <div class="form-group">
            <span class="label">降生时刻 (公历)</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-start" onclick="startScan()">开启 · 天命卷轴</button>
    </div>

    <div id="result-area">
        <div class="card">
            <div class="role-header">
                <span id="role-icon" class="role-icon">?</span>
                <h2 id="role-title" class="role-title">鑑定中...</h2>
                <div id="role-sub" class="role-sub">...</div>
                <div id="role-tags" class="role-tags"></div>
            </div>

            <div class="activation-box" id="activation-area">
                <span class="activation-title" id="activation-status"></span>
                <div class="activation-desc" id="activation-desc"></div>
            </div>

            <div class="siling-bar">
                📜 当令真神：<b id="siling-text">...</b>
            </div>

            <div class="pillars" id="pillars-box"></div>

            <div class="wuxing-bar-container">
                <div style="text-align:center; margin-bottom:15px; font-weight:bold; color:#888;">五行气数分布 (含地支藏干)</div>
                <div class="wuxing-flex" id="wx-bar"></div>
                <div class="wx-legend">
                    <span><span class="dot" style="background:var(--metal)"></span>金</span>
                    <span><span class="dot" style="background:var(--wood)"></span>木</span>
                    <span><span class="dot" style="background:var(--water)"></span>水</span>
                    <span><span class="dot" style="background:var(--fire)"></span>火</span>
                    <span><span class="dot" style="background:var(--earth)"></span>土</span>
                </div>
            </div>

            <div class="logic-panel">
                <div class="label" style="border:none; padding:0; margin-bottom:15px; font-size:1.3rem;">🔮 格局奥义</div>
                <div id="pattern-reason" class="logic-text"></div>
                <div class="joy-taboo">
                    <span class="joy">★ 喜用：<span id="txt-joy">...</span></span>
                    <span class="taboo">★ 忌讳：<span id="txt-taboo">...</span></span>
                </div>
            </div>
        </div>

        <div class="card guide-section">
            <div class="guide-item">
                <div class="guide-title">🏮 本纪 · 元神</div>
                <div class="guide-text" id="dm-desc"></div>
            </div>
            <div id="guide-content"></div>
        </div>

        <div class="action-bar">
            <button class="btn-copy" onclick="copyResult()">📥 保存天命书 (复制全文)</button>
        </div>

        <div class="footer">FATE AUTHENTICATED BY GRANDMASTER · 2025</div>
    </div>
</div>

<script>
    // ==========================================
    // 1. 核心全局字典 (Global Constants)
    // ==========================================
    let currentGender = 1;
    function safeSetText(id, text) { const el = document.getElementById(id); if (el) el.innerText = text; }
    function safeSetHTML(id, html) { const el = document.getElementById(id); if (el) el.innerHTML = html; }

    const WX_COLOR_DATA = { '金':'#e9c46a', '木':'#2a9d8f', '水':'#264653', '火':'#e76f51', '土':'#a67c52' };
    const WUXING_MAP = {'甲':'木','乙':'木','丙':'火','丁':'火','戊':'土','己':'土','庚':'金','辛':'金','壬':'水','癸':'水','子':'水','丑':'土','寅':'木','卯':'木','辰':'土','巳':'火','午':'火','未':'土','申':'金','酉':'金','戌':'土','亥':'水'};
    const HIDDEN_STEMS = {'子':['癸'],'丑':['己','癸','辛'],'寅':['甲','丙','戊'],'卯':['乙'],'辰':['戊','乙','癸'],'巳':['丙','戊','庚'],'午':['丁','己'],'未':['己','丁','乙'],'申':['庚','壬','戊'],'酉':['辛'],'戌':['戊','辛','丁'],'亥':['壬','甲']};
    const ZHI_MAIN_QI = {'子':'癸', '丑':'己', '寅':'甲', '卯':'乙', '辰':'戊', '巳':'丙', '午':'丁', '未':'己', '申':'庚', '酉':'辛', '戌':'戊', '亥':'壬'};
    const YANG_REN_MAP = {'甲':'卯', '丙':'午', '戊':'午', '庚':'酉', '壬':'子'};
    const SHISHEN_MAP = {"甲":{"甲":"比肩","乙":"劫财","丙":"食神","丁":"伤官","戊":"偏财","己":"正财","庚":"七杀","辛":"正官","壬":"偏印","癸":"正印"},"乙":{"乙":"比肩","甲":"劫财","丁":"食神","丙":"伤官","己":"偏财","戊":"正财","辛":"七杀","庚":"正官","癸":"偏印","壬":"正印"},"丙":{"丙":"比肩","丁":"劫财","戊":"食神","己":"伤官","庚":"偏财","辛":"正财","壬":"七杀","癸":"正官","甲":"偏印","乙":"正印"},"丁":{"丁":"比肩","丙":"劫财","己":"食神","戊":"伤官","辛":"偏财","庚":"正财","癸":"七杀","壬":"正官","乙":"偏印","甲":"正印"},"戊":{"戊":"比肩","己":"劫财","庚":"食神","辛":"伤官","壬":"偏财","癸":"正财","甲":"七杀","乙":"正官","丙":"偏印","丁":"正印"},"己":{"己":"比肩","戊":"劫财","辛":"食神","庚":"伤官","癸":"偏财","壬":"正财","乙":"七杀","甲":"正官","丁":"偏印","丙":"正印"},"庚":{"庚":"比肩","辛":"劫财","壬":"食神","癸":"伤官","甲":"偏财","乙":"正财","丙":"七杀","丁":"正官","戊":"偏印","己":"正印"},"辛":{"辛":"比肩","庚":"劫财","癸":"食神","壬":"伤官","乙":"偏财","甲":"正财","丁":"七杀","丙":"正官","己":"偏印","戊":"正印"},"壬":{"壬":"比肩","癸":"劫财","甲":"食神","乙":"伤官","丙":"偏财","丁":"正财","戊":"七杀","己":"正官","庚":"偏印","辛":"正印"},"癸":{"癸":"比肩","壬":"劫财","乙":"食神","甲":"伤官","丁":"偏财","丙":"正财","己":"七杀","戊":"正官","辛":"偏印","庚":"正印"}};
    const SILING_RULES = {'寅': [['戊',7], ['丙',7], ['甲',16]], '卯': [['甲',10], ['乙',20]], '辰': [['乙',9], ['癸',3], ['戊',18]], '巳': [['戊',5], ['庚',9], ['丙',16]], '午': [['丙',10], ['己',9], ['丁',11]], '未': [['丁',9], ['乙',3], ['己',18]], '申': [['戊',7], ['壬',7], ['庚',16]], '酉': [['庚',10], ['辛',20]], '戌': [['辛',9], ['丁',3], ['戊',18]], '亥': [['戊',7], ['甲',5], ['壬',18]], '子': [['壬',10], ['癸',20]], '丑': [['癸',9], ['辛',3], ['己',18]]};
    const ROOT_MAP = {'甲':['寅','卯','亥','辰','未'], '乙':['卯','寅','辰','未','亥'], '丙':['巳','午','寅','戌'], '丁':['午','巳','未','戌','寅'], '戊':['辰','戌','丑','未','巳','午'], '己':['丑','未','辰','戌','午','巳'], '庚':['申','酉','巳','丑','戌'], '辛':['酉','申','丑','戌','巳'], '壬':['亥','子','申','辰'], '癸':['子','亥','辰','丑','申']};

    // ==========================================
    // 2. 文案库 (传记体深度扩充)
    // ==========================================
    const GAME_DB = {
        "金水伤官": { 
            name: "❄️ 寒冰剑仙 (Frost Blade)", tags: ["SSR","极贵"], icon: "🗡️", slogan: "金寒水冷，唯火暖心。", 
            male: { c:"<b>[天赋传记]</b> 金水伤官者，乃是天地间最锋利的“思考机器”。你的脑力如深渊般不可测，思维如冰刀切开复杂核心。你天生适合政治高层、战略策划、或高精尖技术领域。你的智慧不是温吞的，而是带有侵略性的、颠覆性的。局中若见丁火暖局，即为“金白水清，贵不可言”，主名动天下，异路功名。若无火气，则才华流于孤芳自赏，容易成为愤世嫉俗的隐士。", w:"<b>[财富逻辑]</b> 随位而生。你的财运通常伴随着你的社会地位而来。你对财富的眼光精准而毒辣，适合从事高净值理财、并购或危机公关。切忌走灰色地带，因为水清易察，一丁点墨汁都会让你陷入官非。走南方火运时，是你财富爆发的高光时刻。", l:"<b>[情感羁绊]</b> 内心如冰山，外表或健谈或风流，实则极难动情。你需要一个“小太阳”型的伴侣，对方的开朗与热情是你生命的救赎。对方多为你的崇拜者，能融化你的冰冷。你的婚姻带有很强的“宿命感”。", k:"<b>[后代传承]</b> 孩子聪明过人，多为学霸精英。但由于你过于严厉和高标准，亲子关系可能稍显冷淡。建议多进行温情教育，不要把职场的一套带回家。", h:"<b>[实战锦囊]</b> 必用火调候。多穿红衣，宜向南方发展。注意预防风湿、呼吸系统寒疾以及抑郁情绪。多晒太阳，保持内心的温度。" }, 
            female: { c:"<b>[天赋传记]</b> 冰山美人。才貌双全，气质清冽脱俗。在公关、演艺或文化行业，你是不战而屈人之兵的女神。你的才华需要“舞台”来点亮，你的存在本身就是一种无言的压力。", w:"<b>[财富逻辑]</b> 夫荣妻贵。火为夫星不仅是爱人，更是你的命中真神。成就伴侣的事业，能成倍反馈你的财富。典型的“贵妇”格局，生活品质极高。", l:"<b>[情感羁绊]</b> 独喜官星呵护。外表高冷挑剔，内心极其渴望被强大的男人征服。遇到能包容你坏脾气的人，便是天作之合。不要试图驾驭对方，而是学会分享光芒。", k:"<b>[传承]</b> 子女灵动秀气。生孩子对你的运势有“破冰”之功，能让你的性格变得柔软。", h:"<b>[锦囊]</b> 暖宫驱寒，少食生冷。多泡脚，保持体温即是保住运势。" } 
        },
        "伤官配印": { 
            name: "🔮 智者神启 (Oracle)", tags: ["UR","智慧","既济"], icon: "📜", slogan: "烈火烹油，深水静流。", 
            male: { c:"<b>[天赋传记]</b> 你的格局，是“狂才”与“理性”的完美联姻。伤官代表你那不可一世的才华、敏锐的直觉和打破常规的勇气；而印星则是你内心的定海神针，赋予你深厚的学养、克制力和大局观。这种组合，让你既有冲锋陷阵的锐气，又有运筹帷幄的深沉。你适合成为幕后的国师、战略科学家、或是掌控舆论导向的传媒巨擘。你的一生，注定是用思想去征服世界的。", w:"<b>[财富逻辑]</b> 你的钱财，带有浓厚的“文化属性”或“名望属性”。你很难像纯粹的商人那样去锱铢必较，你的财富往往来自于你的专利、版权、咨询费或是社会地位带来的溢价。切记“贪财坏印”，一旦你过于追逐眼前的蝇头小利，你的贵气就会消散，财运反而受阻。保持清高，反而是你致富的捷径。", l:"<b>[情感羁绊]</b> 你的伴侣，必须是你精神上的“同频者”。你无法忍受庸俗和浅薄。在婚姻中，你往往处于一种精神引导者的地位，但你也极度依赖伴侣提供的情绪价值。对方的温柔和包容，是你对抗外界压力的避风港。你们的结合，是典型的“才子佳人”模式，彼此欣赏，相互成就。", k:"<b>[后代传承]</b> 你的孩子，大概率会继承你的高智商和书卷气。你对孩子的教育方式往往是开明而有深度的，你更看重他们的人格修养和思维逻辑，而不是单纯的分数。他们未来极有可能在学术界或艺术界崭露头角，成为你的骄傲。", h:"<b>[实战锦囊]</b> 你的大脑时刻处于高速运转状态，神经衰弱是你最大的潜敌。务必学会“关机”，多接触大自然的山水，用水的灵动来滋养你的印星。失眠多梦时，睡前冥想是你最好的药物。" }, 
            female: { c:"<b>[天赋传记]</b> 你是那种在人群中一眼就能被认出的“高知女神”。伤官赋予了你灵动的才情和不俗的审美，印星则赋予了你端庄的仪态和深沉的内涵。在职场上，你是那种不显山露水，却掌握着核心话语权的关键人物。你懂得如何用最温柔的语言，说出最有力量的话。你是天生的管理者和教育家，能轻易收服人心。", w:"<b>[财富逻辑]</b> 你的一生，贵人运极佳。因为你的气质和谈吐，总能吸引到高层次的合作者和提携者。你的财富积累是稳步向上的，随着年龄和资历的增长，你的身价会呈指数级上升。适合从事长周期的品牌经营或资产管理，时间是你的朋友。", l:"<b>[情感羁绊]</b> “帮夫运”极强。你不仅是丈夫的爱人，更是他的军师和盟友。你的睿智和远见，能帮他在关键时刻做出正确的选择。你的伴侣通常也是儒雅君子或行业精英，你们的婚姻生活充满了精神层面的默契与尊重。", k:"<b>[后代传承]</b> 你的孩子天生带有贵气，性格温和且聪慧。你不仅给了他们生命，更给了他们高起点的灵魂教育。在你的熏陶下，他们会成长为有教养、有担当的社会栋梁。", h:"<b>[实战锦囊]</b> 女命伤官配印，最重“滋阴”。多喝汤水，多吃胶原蛋白丰富的食物，保持身体的滋润度。你的情绪稳定就是全家最好的风水。遇到烦心事，练字或阅读是最好的排解方式。" } 
        },
        "正财格": { 
            name: "🧱 勤勉筑梦师 (Builder)", tags: ["R+","守成"], icon: "🐜", slogan: "一砖一瓦，聚沙成塔。", 
            male: { c:"<b>[天赋传记]</b> 你是这个浮躁社会中难得的“基石”。你不相信一夜暴富的鬼话，只信奉勤劳致富的真理。在金融、实业、制造等传统领域，你是最踏实、最靠谱的中坚力量。你的执行力强，对数字敏感，善于在细节中发现价值。你的人生信条是“积跬步以至千里”。", w:"<b>[财富逻辑]</b> 复利致富。你是典型的富一代，财富是靠时间积累起来的。积少成多，晚年富足。不乱花钱，每一笔开支都有计划。适合稳健型投资，如储蓄、国债、房产。你对高风险的投机行为嗤之以鼻，认为那是赌博。", l:"<b>[情感羁绊]</b> 宠妻狂魔。在命理中，正财代表妻子。正财格的男人通常非常疼老婆，甚至有点“惧内”。你愿意把工资卡上交，觉得听老婆话才会有出息。你对家庭非常负责，是标准的模范丈夫。", k:"<b>[后代传承]</b> 朴实家风。你的孩子会继承你勤劳朴实的优良品质。你会教导他们节约和努力，不会溺爱。孩子将来可能不会大富大贵，但一定是个正直、有用的人。", h:"<b>[实战锦囊]</b> 防劳损。你最大的敌人是“过度劳累”。因为太想给家人更好的生活，你容易透支身体。职业病多集中在颈椎、腰椎和肠胃。记住，身体是革命的本钱。" }, 
            female: { c:"<b>[天赋传记]</b> 你是天生的“管家婆”，拥有化繁为简的魔力。无论是复杂的财务报表还是琐碎的家庭事务，你都能打理得井井有条。你对细节的把控无人能及，能从纷繁复杂的数据中理出头绪。你是团队中不可或缺的“管家婆”，老板最放心的定海神针。", w:"<b>[财富逻辑]</b> 存钱罐。你是天生的理财高手，精打细算，看着余额增长是你最大的快乐。你是家里的CFO，把每一分钱都花在刀刃上。你适合掌管财政大权，能把家庭资产打理得井井有条。", l:"<b>[情感羁绊]</b> 贤惠持家。你能把日子过得红红火火，是标准的贤妻良母。但要注意，生活不仅是柴米油盐，还需要一点浪漫。不要因为太过于关注现实而忽略了伴侣的情感需求。", k:"<b>[后代传承]</b> 严母。你对孩子的学业抓得很紧，希望他们能考上好大学。要注意不要给孩子太大的压力，多关注他们的心理健康。", h:"<b>[实战锦囊]</b> 补气血。你有点宅，不爱运动。容易气血不足，手脚冰凉。多吃红枣枸杞，多出去走走。不要把钱看得太重，适当的消费能让你更快乐。" } 
        },
        "伤官合杀": { name: "⚡ 危机终结者", tags: ["SSR","权谋"], icon: "⚔️", slogan: "混乱是阶梯，权谋是利刃。", male: { c:"<b>[天赋传记]</b> 你是乱世中的枭雄。越是混乱、危险的局面，越能激发你的S级潜能。你适合从事危机公关、律师、特种行业。你懂得如何利用对手的力量来成就自己。", w:"<b>[财富逻辑]</b> 爆发力极强。你的财富往往来自于对资源的重新整合和对规则的巧妙利用。", l:"<b>[情感羁绊]</b> 你的爱情是一场势均力敌的博弈，充满了征服与被征服的快感。", k:"<b>[后代传承]</b> 孩子多半也是叛逆天才，不要试图用常规手段约束他。", h:"<b>[实战锦囊]</b> 精神长期紧绷，易患偏头痛。学会强制关机休息。" }, female: { c:"<b>[天赋传记]</b> 职场铁娘子。你拥有不输男性的魄力和手腕，能镇得住各种复杂场面。你是天生的领导者。", w:"<b>[财富逻辑]</b> 名气即财气。适合经营个人品牌，利用影响力变现。", l:"<b>[情感羁绊]</b> 慕强心理。你只会被比你更强的男人征服。", k:"<b>[后代传承]</b> 精英教育。你会倾尽全力培养孩子成为人中龙凤。", h:"<b>[实战锦囊]</b> 肝火易旺。少动怒，多做瑜伽调节内分泌。" } },
        "正官格": { name: "⚖️ 秩序守护者", tags: ["SR","稳健"], icon: "🏛️", slogan: "规则是基石，稳步登顶。", male: { c:"<b>[天赋传记]</b> 天生吃皇粮的命。你稳重、讲规矩、有大局观。在体制内或大型企业中，你是晋升最稳的那一个。", w:"<b>[财富逻辑]</b> 正财稳固。旱涝保收，不求暴富但求长久。", l:"<b>[情感羁绊]</b> 门当户对。你很看重伴侣的家世和教养。", k:"<b>[后代传承]</b> 孩子多半规矩懂事，学习成绩好。", h:"<b>[实战锦囊]</b> 容易焦虑。不要给自己太大的精神枷锁，偶尔放松一下。" }, female: { c:"<b>[天赋传记]</b> 完美管家。行政、教师、HR。你做事滴水不漏，让人挑不出毛病。", w:"<b>[财富逻辑]</b> 财务稳定。家底殷实，生活优渥。", l:"<b>[情感羁绊]</b> 旺夫体质。你懂得如何维护丈夫的面子和地位。", k:"<b>[后代传承]</b> 教子有方。孩子非常有礼貌。", h:"<b>[实战锦囊]</b> 注意颈椎和腰椎的保养，避免久坐。" } },
        "七杀格": { name: "🔥 孤胆英雄", tags: ["SSR","搏杀"], icon: "🚀", slogan: "人生就是无限的战斗。", male: { c:"<b>[天赋传记]</b> 攻坚能手。你是为挑战而生的战士。平淡的生活会让你窒息，唯有在充满变数的战场上，你才能感到活着。", w:"<b>[财富逻辑]</b> 险中求胜。财运大起大落，适合高风险高回报的项目。", l:"<b>[情感羁绊]</b> 烈火情人。爱得轰轰烈烈，恨得咬牙切齿。", k:"<b>[后代传承]</b> 严父。棍棒底下出孝子。", h:"<b>[实战锦囊]</b> 易有外伤。开车慢点，多做慈善化解煞气。" }, female: { c:"<b>[天赋传记]</b> 业务一姐。在男人堆里抢饭吃，你比男人更狠、更决断。", w:"<b>[财富逻辑]</b> 赚钱机器。享受赚钱带来的征服感。", l:"<b>[情感羁绊]</b> 霸总收割机。喜欢强悍霸道的异性。", k:"<b>[后代传承]</b> 超人妈妈。为孩子撑起一片天。", h:"<b>[实战锦囊]</b> 容易长结节。少生气，多疏通肝胆经。" } },
        "食神格": { name: "🎨 逍遥散人", tags: ["SR","安稳"], icon: "🎐", slogan: "人间不值得，美食值得。", male: { c:"<b>[天赋传记]</b> 灵感源泉。你适合轻松、自由、充满创意的工作环境。你讨厌卷，但你总能凭才华轻松赚到钱。", w:"<b>[财富逻辑]</b> 躺赢之财。一生不缺钱，总有贵人送饭吃。", l:"<b>[情感羁绊]</b> 暖男。会做饭、懂生活，情绪价值拉满。", k:"<b>[后代传承]</b> 福星。晚年享子女福。", h:"<b>[实战锦囊]</b> 心宽体胖。注意控制体重，防止三高。" }, female: { c:"<b>[天赋传记]</b> 亲和力极佳。人见人爱，花见花开。适合教育、服务、艺术行业。", w:"<b>[财富逻辑]</b> 小确幸。容易满足，生活滋润。", l:"<b>[情感羁绊]</b> 仪式感。注重生活情调，喜欢浪漫。", k:"<b>[后代传承]</b> 溺爱。孩子是你的心头肉。", h:"<b>[实战锦囊]</b> 防懒惰。多去户外走走，呼吸新鲜空气。" } },
        "金水食神": { name: "🌊 灵动智者", tags: ["SSR","清贵"], icon: "🌊", slogan: "金白水清，才思泉涌。", male: { c:"<b>[天赋传记]</b> 内秀乾坤。你是纯粹的学术或艺术天才。不同于伤官的锋芒，你更偏向于内敛和深耕。你在科研、文学、设计领域有着极高的造诣。见火则名扬天下。", w:"<b>[财富逻辑]</b> 技艺生财。你不需要去争抢，靠自己不可替代的专业壁垒就能获得优渥的回报。你的财运是涓涓细流，长久不衰。", l:"<b>[情感羁绊]</b> 灵魂知己。你追求精神层面的高度契合，外貌家世都是次要的，唯有“懂你”才是核心。", k:"<b>[后代传承]</b> 聪慧麒麟。父子如友，你的开明教育让孩子受益终生。", h:"<b>[实战锦囊]</b> 补火暖局。多做户外运动，避免陷入精神内耗。" }, female: { c:"<b>[天赋传记]</b> 脱俗白月光。在文化、教育行业能自成大家，受人尊敬。", w:"<b>[财富逻辑]</b> 小确幸不断。你一生衣食无忧，总有贵人为你铺路。", l:"<b>[情感羁绊]</b> 寒谷回春。你的温柔是终极杀器，能让百炼钢化为绕指柔。", k:"<b>[后代传承]</b> 子女孝顺。晚年福厚，儿孙绕膝。", h:"<b>[实战锦囊]</b> 保持心情愉快，心情好身体就好。" } },
        "木火通明": { name: "🔥 薪火传人", tags: ["SSR","名望"], icon: "🔥", slogan: "木火交辉，光耀千秋。", male: { c:"<b>[天赋传记]</b> 文昌降世。你是天生的学者、作家、思想家。你的文章和观点能影响一代人。", w:"<b>[财富逻辑]</b> 名利双收。钱是名声的副产品，名气越大，财富越多。", l:"<b>[情感羁绊]</b> 灵魂知音。你需要一个能读懂你作品的人。", k:"<b>[后代传承]</b> 书香门第。孩子多半继承你的文化基因。", h:"<b>[实战锦囊]</b> 护眼养心。注意心血管健康。" }, female: { c:"<b>[天赋传记]</b> 才女下凡。适合从事媒体、教育、艺术。", w:"<b>[财富逻辑]</b> 清贵之财。适合知识付费。", l:"<b>[情感羁绊]</b> 晚婚或不婚。眼光极高，宁缺毋滥。", k:"<b>[后代传承]</b> 优生优育。孩子有艺术天分。", h:"<b>[实战锦囊]</b> 注意心血管。" } },
        "食神制杀": { name: "🦁 铁腕统帅", tags: ["SSR","威权"], icon: "🦁", slogan: "以智制暴，权威立身。", male: { c:"<b>[天赋传记]</b> 不怒自威。解决硬核难题的高手。适合公检法、外科医生、技术总监。你是团队的定海神针。", w:"<b>[财富逻辑]</b> 资历加成。你的财富曲线是“大后期型”。资历越老，威望越高，收入越稳。", l:"<b>[情感羁绊]</b> 一家之主。你在家中地位极高。", k:"<b>[后代传承]</b> 栋梁之材。孩子规矩懂事。", h:"<b>[实战锦囊]</b> 控制脾气。预防高血压。" }, female: { c:"<b>[天赋传记]</b> 逻辑女王。不屑于宫斗，靠硬实力说话。财务总监、审计、学术带头人。", w:"<b>[财富逻辑]</b> 财政大臣。理财圣手，能守得住大江山。", l:"<b>[情感羁绊]</b> 严妻。管老公像管兵，需多一点温柔。", k:"<b>[后代传承]</b> 贴心棉袄。母慈子孝。", h:"<b>[实战锦囊]</b> 保护肠胃。少思虑。" } },
        "杀印相生": { name: "👑 权柄执掌者", tags: ["UR","掌权"], icon: "🛡️", slogan: "化煞为权，威震四方。", male: { c:"<b>[天赋传记]</b> 你拥有极佳的领导力与抗压性。恩威并施，适合在体制内或大型机构发展。你能将压力转化为权力。", w:"<b>[财富逻辑]</b> 权中取利。职位越高，财运越好。", l:"<b>[情感羁绊]</b> 贤内助。你需要一个能帮你打理后方的伴侣。", k:"<b>[后代传承]</b> 显贵名门。孩子多有出息。", h:"<b>[实战锦囊]</b> 防过劳。注意心脑血管健康。" }, female: { c:"<b>[天赋传记]</b> 女皇风范。决策力极强，不让须眉。适合做管理者。", w:"<b>[财富逻辑]</b> 积累深厚。正财稳固。", l:"<b>[情感羁绊]</b> 贵夫。丈夫多为成功人士。", k:"<b>[后代传承]</b> 严母教子。孩子有很好的教养。", h:"<b>[实战锦囊]</b> 调理肝胆。少动怒。" } },
        "正印格": { name: "📜 圣贤导师", tags: ["SR","守护"], icon: "🙏", slogan: "但行好事，莫问前程。", male: { c:"<b>[天赋传记]</b> 贵人扶持。工作清闲福利好。你是团队的精神领袖，大家有了困难都喜欢找你。", w:"<b>[财富逻辑]</b> 清贵之财。名声换钱，适合版税分红。", l:"<b>[情感羁绊]</b> 依赖伴侣。习惯被照顾。", k:"<b>[后代传承]</b> 知书达理。", h:"<b>[实战锦囊]</b> 防肥胖。多动少宅。" }, female: { c:"<b>[天赋传记]</b> 岁月静好。职场白月光。", w:"<b>[财富逻辑]</b> 天生福命。总有人为你买单。", l:"<b>[情感羁绊]</b> 被宠溺。嫁得好。", k:"<b>[后代传承]</b> 亲子如友。", h:"<b>[实战锦囊]</b> 排湿。代谢较慢。" } },
        "偏印格": { name: "👽 异次元行者", tags: ["SR","洞察"], icon: "👁️", slogan: "真相掌握在少数人手中。", male: { c:"<b>[天赋传记]</b> 独门绝技。冷门领域的权威，思维怪异。适合侦探、研发、玄学。", w:"<b>[财富逻辑]</b> 副业之王。靠特殊技能赚钱。", l:"<b>[情感羁绊]</b> 冰山内心。很难真正走进你的心。", k:"<b>[后代传承]</b> 代沟。教育方式另类。", h:"<b>[实战锦囊]</b> 防抑郁。多晒太阳。" }, female: { c:"<b>[天赋传记]</b> 灵感直觉。心理学家或玄学天才。", w:"<b>[财富逻辑]</b> 变现独特。", l:"<b>[情感羁绊]</b> 边缘恋情。容易接受非主流感情。", k:"<b>[后代传承]</b> 丁克倾向。喜欢自由。", h:"<b>[实战锦囊]</b> 神经痛。注意休息。" } },
        "偏财格": { name: "🎩 商业大亨", tags: ["SSR","横财"], icon: "💎", slogan: "钱是赚出来的。", male: { c:"<b>[天赋传记]</b> 资源整合专家。善交际，眼光独到。适合经商、贸易。", w:"<b>[财富逻辑]</b> 投机获利。敢于冒险。", l:"<b>[情感羁绊]</b> 桃花劫。异性缘太好。", k:"<b>[后代传承]</b> 带见世面。培养孩子的财商。", h:"<b>[实战锦囊]</b> 护肝。少应酬。" }, female: { c:"<b>[天赋传记]</b> 商务公关。长袖善舞。", w:"<b>[财富逻辑]</b> 能赚会花。喜欢奢侈品。", l:"<b>[情感羁绊]</b> 择优。喜欢有能力的男人。", k:"<b>[后代传承]</b> 贵族培养。", h:"<b>[实战锦囊]</b> 防富贵病。" } },
        "建禄格": { name: "🏰 独立领主", tags: ["SR","自强"], icon: "🗿", slogan: "我的领土我做主。", male: { c:"<b>[天赋传记]</b> 中流砥柱。你很难给别人打工一辈子，迟早要自己单干。你的执行力超强，是实干家。", w:"<b>[财富逻辑]</b> 辛苦致富。每一分都是汗水换来的。", l:"<b>[情感羁绊]</b> 强硬。大男子主义。", k:"<b>[后代传承]</b> 独立。放养式教育。", h:"<b>[实战锦囊]</b> 防过劳。注意休息。" }, female: { c:"<b>[天赋传记]</b> 职场铁娘子。比男人还拼。", w:"<b>[财富逻辑]</b> 漏斗效应。赚钱快花钱快。", l:"<b>[情感羁绊]</b> 强势。容易给伴侣压力。", k:"<b>[后代传承]</b> 能干妈妈。", h:"<b>[实战锦囊]</b> 调理内分泌。" } },
        "月劫格": { name: "🤜 豪侠义士", tags: ["SR","义气"], icon: "⚔️", slogan: "仁义值千金。", male: { c:"<b>[天赋传记]</b> 团队灵魂。善于聚集人气，适合做团队Leader。但要防备手下或合伙人背刺。", w:"<b>[财富逻辑]</b> 散财童子。对朋友大方，存不住钱。", l:"<b>[情感羁绊]</b> 克妻。容易有竞争者。", k:"<b>[后代传承]</b> 难管。孩子比较叛逆。", h:"<b>[实战锦囊]</b> 戒躁。控制情绪。" }, female: { c:"<b>[天赋传记]</b> 巾帼豪杰。性格直爽。", w:"<b>[财富逻辑]</b> 月光族。存不住钱。", l:"<b>[情感羁绊]</b> 防背叛。感情路坎坷。", k:"<b>[后代传承]</b> 朋友关系。像哥们。", h:"<b>[实战锦囊]</b> 保护呼吸道。" } },
        "伤官生财": { name: "⚗️ 炼金术士", tags: ["SSR","爆发"], icon: "💸", slogan: "万物皆可交易。", male: { c:"<b>[天赋传记]</b> 创业奇才。脑子灵活，点石成金。适合科技、媒体、电商等轻资产行业。", w:"<b>[财富逻辑]</b> 现金流极强。周转快，但花销也大。", l:"<b>[情感羁绊]</b> 颜控。喜欢漂亮的伴侣。", k:"<b>[后代传承]</b> 自由生长。", h:"<b>[实战锦囊]</b> 防脱发失眠。用脑过度。" }, female: { c:"<b>[天赋传记]</b> 带货女王。口才极佳，感染力强。", w:"[财富逻辑]</b> 购买力极强。喜欢购物解压。", l:"<b>[情感羁绊]</b> 挑剔。眼光毒辣。", k:"<b>[后代传承]</b> 倾力投入。", h:"<b>[实战锦囊]</b> 通乳腺。注意淋巴健康。" } },
        "食神生财": { name: "🎐 逍遥财主", tags: ["SR","安稳"], icon: "💰", slogan: "快乐才是第一生产力。", male: { c:"<b>[天赋传记]</b> 快乐赚钱。适合餐饮、娱乐、服务业。你做事讲究顺其自然。", w:"<b>[财富逻辑]</b> 细水长流。财源不断。", l:"<b>[情感羁绊]</b> 温馨浪漫。懂得享受生活。", k:"<b>[后代传承]</b> 福星。晚年享福。", h:"<b>[实战锦囊]</b> 防肥胖。注意饮食节制。" }, female: { c:"<b>[天赋传记]</b> 生活美学家。适合从事与美相关的行业。", w:"<b>[财富逻辑]</b> 物质优渥。不缺零花钱。", l:"<b>[情感羁绊]</b> 撒娇好命。备受宠爱。", k:"<b>[后代传承]</b> 慈母多福。", h:"<b>[实战锦囊]</b> 多运动。保持活力。" } },
        "阳刃格": { name: "🗡️ 镇国大将", tags: ["SSR","极强"], icon: "⚔️", slogan: "宁为玉碎，不为瓦全。", male: { c:"<b>[天赋传记]</b> 天生的将军。性格刚烈，不怒自威。适合军警、外科医生、体育竞技。", w:"<b>[财富逻辑]</b> 险中求富。不适合存钱，适合置办硬资产。", l:"<b>[情感羁绊]</b> 克妻。需要找一个极其温柔或同样强势的伴侣。", k:"<b>[后代传承]</b> 严厉。孩子多半怕你。", h:"<b>[实战锦囊]</b> 防血光之灾。定期献血。" }, female: { c:"<b>[天赋传记]</b> 巾帼英雄。性格像男孩子，敢作敢当。", w:"<b>[财富逻辑]</b> 独立致富。不靠男人。", l:"<b>[情感羁绊]</b> 晚婚。容易争吵。", k:"<b>[后代传承]</b> 剖腹产概率大。", h:"<b>[实战锦囊]</b> 调理经期。" } },
        "从财格": { name: "💰 陶朱公", tags: ["SSR","富豪"], icon: "🧧", slogan: "顺势而为，富甲一方。", male: { c:"<b>[天赋传记]</b> 审时度势的天才。你懂得顺应大局，借力打力。适合从商、金融。", w:"<b>[财富逻辑]</b> 巨富之命。财气通门户。", l:"<b>[情感羁绊]</b> 惧内。听老婆话会发财。", k:"<b>[后代传承]</b> 继承家业。", h:"<b>[实战锦囊]</b> 富贵病。注意饮食。" }, female: { c:"<b>[天赋传记]</b> 豪门阔太。或者自己就是豪门。", w:"<b>[财富逻辑]</b> 旺夫益子。", l:"<b>[情感羁绊]</b> 嫁入豪门。", k:"<b>[后代传承]</b> 贵子。", h:"<b>[实战锦囊]</b> 保持身材。" } },
        "从杀格": { name: "⚖️ 权倾天下", tags: ["SSR","权贵"], icon: "🏛️", slogan: "舍身取义，威震四海。", male: { c:"<b>[天赋传记]</b> 极具政治头脑。为了目标可以牺牲一切。适合政界、军界高层。", w:"<b>[财富逻辑]</b> 权钱交易。地位带来财富。", l:"<b>[情感羁绊]</b> 攀附权贵。", k:"<b>[后代传承]</b> 显赫。", h:"<b>[实战锦囊]</b> 压力过大。注意心脏。" }, female: { c:"<b>[天赋传记]</b> 诰命夫人。丈夫极其优秀。", w:"<b>[财富逻辑]</b> 夫荣妻贵。", l:"<b>[情感羁绊]</b> 依附强者。", k:"<b>[后代传承]</b> 精英。", h:"<b>[实战锦囊]</b> 抑郁风险。" } },
        "杂格": { name: "🌱 潜龙勿用", tags: ["N","潜力"], icon: "🌱", slogan: "时运未到，潜心修炼。", male: { c:"<b>[天赋传记]</b> 多面手。你可能没有特别突出的单一强项，但胜在综合能力不错。适合在中小企业做全能型人才。", w:"<b>[财富逻辑]</b> 勤劳致富。没有暴富的命，只有勤劳的手。多劳多得。建议学习一门手艺，深耕细作，也能小康。不要想着走捷径，脚踏实地才是硬道理。", l:"<b>[情感羁绊]</b> 平淡是真。婚姻生活波澜不惊。找个过日子的人，安安稳稳过一生。不要有太高的不切实际的幻想。平平淡淡才是真，陪伴是最长情的告白。", k:"<b>[后代传承]</b> 平安是福。孩子资质平平，健康就好。不要逼孩子太紧，快乐成长最重要。儿孙自有儿孙福，不要太操心。", h:"<b>[实战锦囊]</b> 锻炼身体。身体是革命的本钱。保持良好的作息，少熬夜。你的身体需要你好好呵护，别等到生病了才后悔。" }, female: { c:"<b>[天赋传记]</b> 踏实后勤。适合做后勤、辅助类工作。你做事认真负责，虽然不出彩，但很让人放心。你是团队中默默奉献的那个人。你的价值在于你的可靠。", w:"<b>[财富逻辑]</b> 节俭持家。持家有道。你懂得省钱，也能把家里打理得井井有条。你的财富是省出来的。你会精打细算，把日子过得有滋有味。", l:"<b>[情感羁绊]</b> 依靠老实人。找个老实人嫁了。你需要一个踏实的肩膀依靠。平平淡淡才是真。你的婚姻可能没有激情，但很稳定。", k:"<b>[后代传承]</b> 慈母心。孩子平安长大。你对孩子的要求不高，只要他们开心健康就好。你会是一个很慈祥的母亲。", h:"<b>[实战锦囊]</b> 保证睡眠。保持充足睡眠。心情放松，不要想太多。多听听音乐，看看书，丰富自己的内心世界。" } },
        "伤官格": { name: "🎭 艺术玩家", tags: ["SR","创新"], icon: "🎨", slogan: "我不是为了迎合而生。", male: { c:"<b>[天赋传记]</b> 创新灵魂。天生的规则破坏者。适合设计、艺术、演艺。你的才华是你的通行证，但你的傲气也是你的绊脚石。", w:"<b>[财富逻辑]</b> 技能变现。不屑于求人，靠手艺吃饭。一单吃三年。", l:"<b>[情感羁绊]</b> 不羁之风。晚婚或不婚。你需要极大的自由空间。", k:"<b>[后代传承]</b> 像哥们。更在乎精神交流。", h:"<b>[实战锦囊]</b> 情绪化。注意心理健康，多冥想。" }, female: { c:"<b>[天赋传记]</b> 灵气逼人。极具艺术天分。受不了枯燥重复的工作，必须做自己喜欢的事才能发光。", w:"<b>[财富逻辑]</b> 随性。看心情赚钱。对金钱看得不重。", l:"<b>[情感羁绊]</b> 挑剔伴侣。容易看到对方缺点。需要找宽容度极高的伴侣。", k:"<b>[后代传承]</b> 生命羁绊。孩子是你的一切。", h:"<b>[实战锦囊]</b> 通经络。气血不通，多运动。" } }
    };

    const XIJI_RULES = {
        "金水伤官": { desc: "冬金极寒，必用火（官杀）调候。此格见火即激活显贵，无火则如寒潭之剑。", joy: ["🔥 火 (调候)","🌲 木 (财星)"], taboo: ["💧 水 (伤官)","⛰️ 土 (埋金)"] },
        "金水食神": { desc: "金白水清。喜火调候。若无火，则才华流于孤冷，难获世俗功名。", joy: ["🔥 火 (暖局)","🌲 木 (通关)"], taboo: ["⛰️ 土 (夺食)","💧 水 (沉沦)"] },
        "木火通明": { desc: "木生春月，见火泄秀。忌金克伐，忌水灭火。文彩风流，名扬天下。", joy: ["🔥 火 (泄秀)","🌲 木 (助势)"], taboo: ["🗡️ 金 (克木)","💧 水 (灭火)"] },
        "伤官配印": { desc: "局中伤官有力，且水印护身。犹如狂飙之马配以金络，文武兼备。调候得力。", joy: ["💧 水 (印星)","🌲 木 (帮身)"], taboo: ["⛰️ 土 (坏印)","🔥 火 (燥热)"] },
        "伤官合杀": { desc: "伤杀两旺，合杀为权。以智慧谋略化解危机，典型的'险中求贵'之格。", joy: ["📜 印星","💪 比劫"], taboo: ["💰 财星","🗡️ 官杀"] },
        "食神制杀": { desc: "七杀有力，食神制之。身强杀浅，权柄极重。", joy: ["🎨 食神","📜 印星"], taboo: ["💰 财星","🗡️ 官杀"] },
        "杀印相生": { desc: "杀势汹汹，赖印化之。化煞为权，主武职或掌握实权的管理者。", joy: ["📜 印星","💪 比劫"], taboo: ["💰 财星","🗡️ 官杀"] },
        "正财格": { desc: "财星当令，求财有道。身强任财，身弱喜印比。步步为营之富。", joy: ["💪 比劫","📜 印星"], taboo: ["💰 财 (身弱)","🗡️ 官杀"] },
        "偏财格": { desc: "偏财当令，慷慨大方。喜官杀护财，喜食伤生财。", joy: ["🗡️ 官杀","🎨 食伤"], taboo: ["💪 比劫","空亡"] },
        "正官格": { desc: "正官纯正，贵气天然。喜财生官，喜印护官。忌伤官见官。", joy: ["💰 财星","📜 印星"], taboo: ["🎨 伤官","🗡️ 七杀"] },
        "七杀格": { desc: "杀神威严。需制化方成大格。无制则压力重重，灾厄丛生。", joy: ["🎨 食伤 (制)","📜 印星 (化)"], taboo: ["💰 财星 (助杀)"] },
        "正印格": { desc: "印绶生身，慈悲温厚。喜官杀生印，忌财坏印。", joy: ["🗡️ 官杀","💪 比劫"], taboo: ["💰 财星"] },
        "偏印格": { desc: "偏印当权，鬼才逻辑。喜偏财制枭。", joy: ["💰 偏财","天月德"], taboo: ["🎨 食神"] },
        "食神格": { desc: "食神生财，福寿双全。忌枭神夺食。", joy: ["💰 财星","💪 比劫"], taboo: ["📜 偏印"] },
        "伤官格": { desc: "伤官当令，才华横溢。需印制或财化。", joy: ["📜 印星","💰 财星"], taboo: ["🗡️ 官杀","💪 比劫"] },
        "伤官生财": { desc: "伤官有根，生财有情。技艺致富。", joy: ["💰 财星","🎨 伤官"], taboo: ["📜 印星","💪 比劫"] },
        "食神生财": { desc: "食神有根，生财安稳。福气之局。", joy: ["💰 财星","🎨 食神"], taboo: ["📜 偏印","🗡️ 官杀"] },
        "建禄格": { desc: "月令建禄，身强财弱。喜财官食伤泄秀。", joy: ["💰 财星","🗡️ 官杀"], taboo: ["💪 比劫","📜 印星"] },
        "月劫格": { desc: "月令劫财，争财夺利。需官杀制劫或食伤化劫。", joy: ["🗡️ 官杀","🎨 食伤"], taboo: ["💪 比劫","📜 印星"] },
        "阳刃格": { desc: "阳刃当权，刚强无比。喜七杀制刃，喜食伤泄秀。忌财旺生杀。", joy: ["🗡️ 七杀","🎨 食伤"], taboo: ["💰 财星"] },
        "从财格": { desc: "满盘财星，日主无根。弃命从财。喜财官食伤。", joy: ["💰 财星","🎨 食伤"], taboo: ["💪 比劫","📜 印星"] },
        "从杀格": { desc: "满盘官杀，日主无根。舍命从杀。喜财官。", joy: ["💰 财星","🗡️ 官杀"], taboo: ["💪 比劫","📜 印星","🎨 食伤"] },
        "杂格": { desc: "格局未清，五行杂居。全凭扶抑调候，需看日主底蕴。", joy: ["扶助用神"], taboo: ["克害用神"] }
    };

    // ==========================================
    // 3. 算法核心 (Algorithm)
    // ==========================================
    function safeSetText(id, text) { const el = document.getElementById(id); if (el) el.innerText = text; }
    function safeSetHTML(id, html) { const el = document.getElementById(id); if (el) el.innerHTML = html; }

    function hasRoot(gan, pillars) {
        const roots = ROOT_MAP[gan] || [];
        return pillars.some(p => roots.includes(p.z));
    }

    function calcCommander(lunar, mz) {
        const pj = lunar.getPrevJie();
        const s = lunar.getSolar();
        const pjs = pj.getSolar();
        const d1 = new Date(s.getYear(), s.getMonth()-1, s.getDay(), s.getHour(), s.getMinute());
        const d2 = new Date(pjs.getYear(), pjs.getMonth()-1, pjs.getDay(), pjs.getHour(), pjs.getMinute());
        const diff = Math.floor((d1.getTime() - d2.getTime()) / (1000 * 60 * 60 * 24));
        const rules = SILING_RULES[mz];
        let commander = rules[rules.length-1][0]; 
        let sum = 0;
        for (let r of rules) { sum += r[1]; if (diff < sum) { commander = r[0]; break; } }
        return { commander, diffDays: diff };
    }

    function determinePattern(climate, pillars, dm, mz, cmd) {
        if (climate.special) return climate.special;
        const stems = [pillars[0].g, pillars[1].g, pillars[3].g];
        const gods = stems.map(s => SHISHEN_MAP[dm][s]);

        // 1. 阳刃格 (优先级极高)
        if (["甲","丙","戊","庚","壬"].includes(dm) && mz === YANG_REN_MAP[dm]) return "阳刃格";

        // 2. 杀星组合 (有杀先论杀)
        if (gods.includes("七杀")) {
            if (gods.includes("伤官")) return "伤官合杀";
            if (gods.includes("食神") && stems.some(s => SHISHEN_MAP[dm][s]==="食神" && hasRoot(s, pillars))) return "食神制杀";
            if (gods.includes("正印") || gods.includes("偏印")) return "杀印相生";
            return "七杀格";
        }
        
        // 3. 伤官优先 (配印/生财)
        if (gods.includes("伤官")) {
            const sgStem = stems.find(s => SHISHEN_MAP[dm][s] === "伤官");
            if (hasRoot(sgStem, pillars)) {
                if (gods.includes("正印") || gods.includes("偏印")) {
                    if (stems.some(s => (SHISHEN_MAP[dm][s]==="正印" || SHISHEN_MAP[dm][s]==="偏印") && hasRoot(s, pillars))) return "伤官配印";
                }
                if (gods.some(g => g && g.includes("财"))) return "伤官生财";
                return "伤官格";
            }
        }

        // 4. 食神
        if (gods.includes("食神") && stems.some(s => SHISHEN_MAP[dm][s]==="食神" && hasRoot(s, pillars))) {
             if (gods.some(g => g && g.includes("财"))) return "食神生财";
             return "食神格";
        }

        // 5. 真神定格
        if (stems.includes(cmd.commander)) {
            const g = SHISHEN_MAP[dm][cmd.commander];
            const m = {"正财":"正财格","偏财":"偏财格","正官":"正官格","正印":"正印格","偏印":"偏印格","食神":"食神格","伤官":"伤官格","七杀":"七杀格"};
            if (m[g]) return m[g];
        }

        // 6. 本气兜底
        const mzMainGod = SHISHEN_MAP[dm][ZHI_MAIN_QI[mz]];
        const fallback = {"正财":"正财格","偏财":"偏财格","正官":"正官格","七杀":"七杀格","正印":"正印格","偏印":"偏印格","食神":"食神格","伤官":"伤官格","比肩":"建禄格","劫财":"月劫格"};
        return fallback[mzMainGod] || "杂格";
    }

    function getDMDesc(dm, mz) {
        const season = ["亥","子","丑"].includes(mz) ? "冬" : ["巳","午","未"].includes(mz) ? "夏" : ["寅","卯","辰"].includes(mz) ? "春" : "秋";
        const nature = {
            '甲': '通天建木，生于'+season+'季。性格刚直，宁折不弯。',
            '乙': '花草藤蔓，生于'+season+'季。性格柔韧，适应力强。',
            '丙': '太阳之火，生于'+season+'季。热情奔放，光芒万丈。',
            '丁': '星河灯烛，生于'+season+'季。内敛深沉，洞察人心。',
            '戊': '城墙厚土，生于'+season+'季。稳重如山，守信重义。',
            '己': '田园之土，生于'+season+'季。包容万物，心思细腻。',
            '庚': '斧钺之金，生于'+season+'季。刚毅果断，杀伐决断。',
            '辛': '珠玉之金，生于'+season+'季。温润秀气，追求完美。',
            '壬': '江河之水，生于'+season+'季。奔腾不息，智慧超群。',
            '癸': '雨露之水，生于'+season+'季。至弱至柔，无孔不入。'
        };
        return nature[dm] || "日元中和";
    }

    function startScan() {
        if (typeof Lunar === 'undefined') return alert("⚠️ 核心组件加载失败，请检查网络连接！");
        const timeStr = document.getElementById('birth-input').value;
        if (!timeStr) return alert("请选择以降生时刻");
        
        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const baziObj = lunar.getEightChar();
            baziObj.setSect(2);

            const pillars = [
                {t:'年', g:baziObj.getYearGan().toString(), z:baziObj.getYearZhi().toString()},
                {t:'月', g:baziObj.getMonthGan().toString(), z:baziObj.getMonthZhi().toString()},
                {t:'日', g:baziObj.getDayGan().toString(), z:baziObj.getDayZhi().toString()},
                {t:'时', g:baziObj.getTimeGan().toString(), z:baziObj.getTimeZhi().toString()}
            ];

            const dm = pillars[2].g, mz = pillars[1].z;
            const cmd = calcCommander(lunar, mz);
            
            // 调候激活
            const isWinter = ["亥","子","丑"].includes(mz);
            const isSummer = ["巳","午","未"].includes(mz);
            const hasFire = pillars.some(p => WUXING_MAP[p.g]==='火' || WUXING_MAP[p.z]==='火');
            const hasWater = pillars.some(p => WUXING_MAP[p.g]==='水' || WUXING_MAP[p.z]==='水');
            
            let actStatus = "", actDesc = "";
            let isActivated = false;

            if ((WUXING_MAP[dm]==='金' && isWinter && hasFire) || 
                (WUXING_MAP[dm]==='木' && isSummer && hasWater) ||
                (WUXING_MAP[dm]==='土' && isWinter && hasFire)) {
                isActivated = true;
                actStatus = "🔥 紫气东来 · 格局变贵";
                actDesc = "局中见调候“奢侈品”，犹如寒金遇火、焦木逢雨。原格力量瞬间激活，层次倍增，名利双收之象。";
            }

            const climate = { special: null };
            if (WUXING_MAP[dm]==='金' && isWinter) climate.special = pillars.some(p => SHISHEN_MAP[dm][p.g]==='伤官') ? "金水伤官" : "金水食神";
            if (WUXING_MAP[dm]==='木' && ["寅","卯"].includes(mz) && hasFire) climate.special = "木火通明";
            if (WUXING_MAP[dm]==='木' && (isSummer || mz==='巳') && hasWater && pillars.some(p => SHISHEN_MAP[dm][p.g]==='伤官' && hasRoot(p.g, pillars))) climate.special = "伤官配印";

            const pattern = determinePattern(climate, pillars, dm, mz, cmd);
            
            // 渲染
            const resultArea = document.getElementById('result-area');
            resultArea.style.display = 'block';
            
            if (isActivated) {
                document.getElementById('activation-area').style.display = 'block';
                safeSetText('activation-status', actStatus);
                safeSetText('activation-desc', actDesc);
            } else {
                document.getElementById('activation-area').style.display = 'none';
            }

            renderUI(pattern, cmd, dm, mz, pillars);
            renderWuxingBar(pillars);

            resultArea.scrollIntoView({ behavior: 'smooth' });

        } catch (e) { alert("鑑定中断：" + e.message); console.error(e); }
    }

    function renderUI(key, cmd, dm, mz, pillars) {
        const data = GAME_DB[key] || GAME_DB["杂格"];
        // 喜忌规则兜底
        const xijiMap = {
            "金水伤官": { joy:["火","木"], taboo:["水","土"] },
            "金水食神": { joy:["火","木"], taboo:["土","水"] },
            "木火通明": { joy:["火","木"], taboo:["金","水"] },
            "伤官配印": { joy:["水","木"], taboo:["土","火"] },
            "伤官合杀": { joy:["印","比"], taboo:["财","官"] },
            "食神制杀": { joy:["食","印"], taboo:["财","杀"] },
            "杀印相生": { joy:["印","比"], taboo:["财"] },
            "正财格": { joy:["比","印"], taboo:["财","官"] },
            "偏财格": { joy:["官","食"], taboo:["比","劫"] },
            "正官格": { joy:["财","印"], taboo:["伤","杀"] },
            "七杀格": { joy:["食","印"], taboo:["财"] },
            "正印格": { joy:["官","比"], taboo:["财"] },
            "偏印格": { joy:["偏财"], taboo:["食"] },
            "食神格": { joy:["财","比"], taboo:["枭"] },
            "伤官格": { joy:["印","财"], taboo:["官"] },
            "伤官生财": { joy:["财","伤"], taboo:["印","比"] },
            "食神生财": { joy:["财","食"], taboo:["枭","官"] },
            "建禄格": { joy:["财","官"], taboo:["比","印"] },
            "月劫格": { joy:["官","食"], taboo:["比","印"] },
            "阳刃格": { joy:["杀","食"], taboo:["财"] },
            "杂格": { joy:["扶抑"], taboo:["失衡"] }
        };
        const xiji = xijiMap[key] || xijiMap["杂格"];
        const detail = data[currentGender === 1 ? 'male' : 'female'];

        safeSetText('role-icon', data.icon);
        safeSetText('role-title', data.name);
        safeSetText('role-sub', data.slogan);
        safeSetHTML('role-tags', `<span class="tag ssr">${key}</span>`);
        safeSetHTML('siling-text', `${cmd.commander} <small>(${SHISHEN_MAP[dm][cmd.commander] || '真神'})</small> · 掌权 ${cmd.diffDays} 日`);
        
        safeSetText('pattern-reason', `此局定为【${key}】。${detail.c.replace(/<[^>]*>/g, '').substring(0, 50)}...`);
        safeSetText('txt-joy', xiji.joy.join(" / "));
        safeSetText('txt-taboo', xiji.taboo.join(" / "));
        safeSetText('dm-desc', getDMDesc(dm, mz));

        let p_html = '';
        pillars.forEach(p => {
            const god = p.t.includes('日') ? '元神' : (SHISHEN_MAP[dm][p.g] || "");
            const colorG = WX_COLOR_DATA[WUXING_MAP[p.g]] || '#333';
            const colorZ = WX_COLOR_DATA[WUXING_MAP[p.z]] || '#333';
            // 显示藏干
            const hiddens = HIDDEN_STEMS[p.z] || [];
            let hiddenStr = "";
            hiddens.forEach(h => {
                hiddenStr += `<div class="hs-row"><span class="hs-gan" style="color:${WX_COLOR_DATA[WUXING_MAP[h]]}">${h}</span><span class="hs-god">${SHISHEN_MAP[dm][h]}</span></div>`;
            });

            p_html += `<div class="ofuda"><div class="ofuda-god">${god}</div><div class="ofuda-char" style="color:${colorG}">${p.g}</div><div class="ofuda-char" style="color:${colorZ}">${p.z}</div><div class="ofuda-head">${p.t}</div><div class="hidden-stems">${hiddenStr}</div></div>`;
        });
        document.getElementById('pillars-box').innerHTML = p_html;

        document.getElementById('guide-content').innerHTML = `
            <div class="guide-item"><div class="guide-title">⚔️ 事业与才情</div><div class="guide-text">${detail.c}</div></div>
            <div class="guide-item"><div class="guide-title">💰 财富与气数</div><div class="guide-text">${detail.w}</div></div>
            <div class="guide-item"><div class="guide-title">💞 情缘与羁绊</div><div class="guide-text">${detail.l}</div></div>
            <div class="guide-item"><div class="guide-title">🌱 后代与传承</div><div class="guide-text">${detail.k}</div></div>
            <div class="guide-item"><div class="guide-title">🛡️ 实战与锦囊</div><div class="guide-text">${detail.h}</div></div>
        `;
    }

    function renderWuxingBar(pillars) {
        // 简单计算天干地支（不含藏干比例，仅主气）
        const counts = {'金':0,'木':0,'水':0,'火':0,'土':0};
        pillars.forEach(p => { 
            counts[WUXING_MAP[p.g]] += 1; 
            counts[WUXING_MAP[p.z]] += 1; 
            // 藏干简单加权
            const hiddens = HIDDEN_STEMS[p.z] || [];
            hiddens.forEach(h => counts[WUXING_MAP[h]] += 0.5);
        });
        
        let total = 0;
        for(let w in counts) total += counts[w];

        let barHtml = "";
        for(let w in counts) {
            if(counts[w] > 0) {
                const pct = (counts[w] / total) * 100;
                barHtml += `<div class="wx-segment" style="width:${pct}%; background:${WX_COLOR_DATA[w]};"></div>`;
            }
        }
        document.getElementById('wx-bar').innerHTML = barHtml;
    }

    function setGender(v, el) { 
        currentGender = v; 
        document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active')); 
        el.classList.add('active'); 
    }

    window.onload = function() {
        try {
            const now = new Date();
            const str = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('birth-input').value = str;
        } catch(e){}
    };
</script>
</body>
</html>
