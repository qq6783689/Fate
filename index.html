<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤©å‘½é‘‘å®š Â· å®—å¸ˆæ­£æºä¿®æ­£ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&display=swap');
        :root { --china-red: #8e1818; --paper-bg: #fdfbf7; --ink-main: #1a1a1a; --gold-accent: #cfa972; --wood: #2d6a4f; --fire: #c0392b; --earth: #a0522d; --metal: #d4ac0d; --water: #1f618d; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Noto Serif SC', serif; background-color: #eee; color: var(--ink-main); margin: 0; padding: 40px 10px; min-height: 100vh; display: flex; justify-content: center; line-height: 1.8; }
        .container { width: 100%; max-width: 900px; padding-bottom: 150px; }
        .header { text-align: center; margin-bottom: 60px; }
        .header h1 { font-family: 'Ma Shan Zheng', cursive; font-size: 4.2rem; color: var(--china-red); margin: 0; text-shadow: 3px 3px 0px rgba(142,24,24,0.05); }
        .header .sub-title { font-size: 1.1rem; color: #888; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; display: inline-block; padding: 8px 30px; margin-top: 20px; font-weight: bold; }
        .card { background: var(--paper-bg); padding: 40px; margin-bottom: 40px; border-radius: 4px; box-shadow: 0 20px 60px rgba(0,0,0,0.05); position: relative; }
        .label { color: var(--china-red); font-size: 1.2rem; margin-bottom: 15px; display: block; font-weight: bold; font-family: 'Ma Shan Zheng'; }
        .gender-box { display: flex; gap: 15px; margin-bottom: 30px; }
        .g-btn { flex: 1; padding: 18px; text-align: center; border: 1px solid #ccc; background: #fff; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .g-btn.active { border-color: var(--china-red); color: var(--china-red); background: rgba(142,24,24,0.04); }
        input { width: 100%; padding: 18px; font-size: 1.2rem; border: 1px solid #ccc; outline: none; }
        .btn-start { width: 100%; padding: 22px; background: var(--china-red); color: #fff; font-size: 1.5rem; font-weight: 900; cursor: pointer; margin-top: 30px; border: none; }
        #result-area { display: none; }
        .role-header { text-align: center; margin-bottom: 50px; border-bottom: 1px dashed #ccc; padding-bottom: 40px; }
        .role-icon { font-size: 5rem; display: block; margin-bottom: 20px; }
        .role-title { font-family: 'Ma Shan Zheng'; font-size: 3.5rem; color: var(--china-red); }
        .role-sub { color: #666; font-size: 1.2rem; margin-top: 15px; font-style: italic; }
        .role-tags { display: flex; justify-content: center; gap: 10px; margin-top: 25px; flex-wrap: wrap; }
        .tag { font-size: 0.9rem; padding: 6px 18px; border: 1px solid var(--china-red); color: var(--china-red); font-weight: bold; }
        .siling-bar { text-align: center; padding: 15px 0; margin-bottom: 40px; color: #555; border-top: 3px double #e6e6e6; border-bottom: 3px double #e6e6e6; }
        .pillars { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 50px; }
        .ofuda { background: #fff; border: 2px solid var(--ink-main); padding: 30px 5px; text-align: center; position: relative; }
        .ofuda-head { font-size: 1rem; color: #fff; background: var(--ink-main); display: inline-block; padding: 4px 15px; margin-bottom: 20px; }
        .ofuda-god { font-size: 0.9rem; color: #777; margin-bottom: 12px; display: block; font-weight: bold; }
        .ofuda-char { font-family: 'Ma Shan Zheng'; font-size: 3rem; font-weight: 900; line-height: 1.1; display: block; }
        .hidden-stems { margin-top: 15px; border-top: 1px dashed #ddd; padding-top: 10px; display: flex; flex-direction: column; gap: 4px; opacity: 0.85; }
        .hs-row { font-size: 0.8rem; display: flex; justify-content: center; gap: 6px; }
        .hs-gan { font-weight: bold; } .hs-god { font-size: 0.7rem; color: #999; }
        .ofuda-cs { margin-top: 15px; padding-top: 8px; border-top: 2px solid var(--china-red); font-size: 0.9rem; color: var(--china-red); font-weight: bold; display: inline-block; font-family: 'Ma Shan Zheng'; }
        .wuxing-bar-container { margin-bottom: 50px; padding: 25px; background: #fafafa; border: 1px solid #eee; }
        .wuxing-flex { display: flex; height: 14px; border-radius: 7px; overflow: hidden; margin-top: 15px; }
        .wx-segment { height: 100%; }
        .wx-legend { display: flex; justify-content: center; gap: 20px; margin-top: 15px; font-size: 0.9rem; }
        .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }
        .logic-panel { background: #fffcf5; padding: 40px; margin-bottom: 50px; border-left: 6px solid var(--china-red); }
        .logic-text { font-size: 1.2rem; line-height: 2; color: #333; margin-bottom: 25px; text-align: justify; white-space: pre-wrap; }
        .joy-taboo { display: flex; flex-direction: column; gap: 10px; font-size: 1.1rem; border-top: 1px solid rgba(0,0,0,0.08); padding-top: 25px; }
        .joy { color: var(--wood); font-weight: bold; } .taboo { color: var(--fire); font-weight: bold; }
        .guide-section { border-top: 6px double var(--china-red); padding-top: 60px; }
        .guide-item { margin-bottom: 70px; }
        .guide-title { font-family: 'Ma Shan Zheng'; font-size: 2.2rem; color: var(--china-red); margin-bottom: 30px; display: flex; align-items: center; }
        .guide-title::before { content: 'â—ˆ'; font-size: 1.2rem; margin-right: 15px; color: var(--gold-accent); }
        .guide-text { font-size: 1.25rem; line-height: 2.3; color: #2c2c2c; text-align: justify; text-indent: 2em; }
        .guide-text b { color: var(--china-red); font-weight: 700; border-bottom: 2px solid rgba(142,24,24,0.15); }
        .action-bar { text-align: center; margin-top: 60px; }
        .btn-copy { background: #fff; border: 2px solid #ccc; padding: 15px 40px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>é™ç”Ÿé‘‘å®š</h1>
        <div class="sub-title">å®—å¸ˆä¼ è®° Â· å‘½ç†æ­£æº</div>
    </div>
    <div class="card">
        <div class="form-group">
            <span class="label">ä¹¾å¤ä¹‹é€ </span>
            <div class="gender-box">
                <div class="g-btn active" onclick="setGender(1, this)">ä¹¾é€  (ç”·)</div>
                <div class="g-btn" onclick="setGender(0, this)">å¤é€  (å¥³)</div>
            </div>
        </div>
        <div class="form-group"><span class="label">é™ç”Ÿæ—¶åˆ» (å…¬å†)</span><input type="datetime-local" id="birth-input"></div>
        <button class="btn-start" onclick="startScan()">å¼€å¯ Â· å¤©å‘½å·è½´</button>
    </div>
    <div id="result-area">
        <div class="card">
            <div class="role-header">
                <span id="role-icon" class="role-icon">?</span>
                <h2 id="role-title" class="role-title">...</h2>
                <div id="role-sub" class="role-sub">...</div>
                <div id="role-tags" class="role-tags"></div>
            </div>
            <div class="siling-bar">ğŸ“œ å½“ä»¤çœŸç¥ï¼š<b id="siling-text">...</b></div>
            <div class="pillars" id="pillars-box"></div>
            <div class="wuxing-bar-container">
                <div style="text-align:center; margin-bottom:15px; font-weight:bold; color:#888;">äº”è¡Œæ°”æ•°åˆ†å¸ƒ (å«è—å¹²)</div>
                <div class="wuxing-flex" id="wx-bar"></div>
                <div class="wx-legend">
                    <span><span class="dot" style="background:var(--metal)"></span>é‡‘</span><span><span class="dot" style="background:var(--wood)"></span>æœ¨</span>
                    <span><span class="dot" style="background:var(--water)"></span>æ°´</span><span><span class="dot" style="background:var(--fire)"></span>ç«</span>
                    <span><span class="dot" style="background:var(--earth)"></span>åœŸ</span>
                </div>
            </div>
            <div class="logic-panel">
                <div class="label" style="border:none; padding:0; margin-bottom:15px; font-size:1.4rem;">ğŸ”® æ ¼å±€å¥¥ä¹‰</div>
                <div id="pattern-reason" class="logic-text"></div>
                <div class="joy-taboo"><span class="joy">â˜… å–œç”¨ï¼š<span id="txt-joy"></span></span><span class="taboo">â˜… å¿Œè®³ï¼š<span id="txt-taboo"></span></span></div>
            </div>
        </div>
        <div class="card guide-section">
            <div class="guide-item"><div class="guide-title">ğŸ® æœ¬çºª Â· å…ƒç¥</div><div class="guide-text" id="dm-desc"></div></div>
            <div id="guide-content"></div>
        </div>
        <div class="action-bar"><button class="btn-copy" onclick="copyResult()">ğŸ“¥ ä¿å­˜å¤©å‘½ä¹¦</button></div>
        <div style="text-align:center; margin-top:80px; color:#aaa; font-size:0.9rem;">FATE AUTHENTICATED BY GRANDMASTER Â· 2025</div>
    </div>
</div>
<script>
    let currentGender = 1;
    function safeSetText(id, t) { const e = document.getElementById(id); if(e) e.innerText = t; }
    function safeSetHTML(id, h) { const e = document.getElementById(id); if(e) e.innerHTML = h; }
    const WX_COLOR_DATA = {'é‡‘':'#e9c46a','æœ¨':'#2a9d8f','æ°´':'#264653','ç«':'#e76f51','åœŸ':'#a67c52'};
    const WUXING_MAP = {'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ','åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´','å­':'æ°´','ä¸‘':'åœŸ','å¯…':'æœ¨','å¯':'æœ¨','è¾°':'åœŸ','å·³':'ç«','åˆ':'ç«','æœª':'åœŸ','ç”³':'é‡‘','é…‰':'é‡‘','æˆŒ':'åœŸ','äº¥':'æ°´'};
    const HIDDEN_STEMS = {'å­':['ç™¸'],'ä¸‘':['å·±','ç™¸','è¾›'],'å¯…':['ç”²','ä¸™','æˆŠ'],'å¯':['ä¹™'],'è¾°':['æˆŠ','ä¹™','ç™¸'],'å·³':['ä¸™','æˆŠ','åºš'],'åˆ':['ä¸','å·±'],'æœª':['å·±','ä¸','ä¹™'],'ç”³':['åºš','å£¬','æˆŠ'],'é…‰':['è¾›'],'æˆŒ':['æˆŠ','è¾›','ä¸'],'äº¥':['å£¬','ç”²']};
    const ZHI_MAIN_QI = {'å­':'ç™¸','ä¸‘':'å·±','å¯…':'ç”²','å¯':'ä¹™','è¾°':'æˆŠ','å·³':'ä¸™','åˆ':'ä¸','æœª':'å·±','ç”³':'åºš','é…‰':'è¾›','æˆŒ':'æˆŠ','äº¥':'å£¬'};
    const YANG_REN_MAP = {'ç”²':'å¯','ä¸™':'åˆ','æˆŠ':'åˆ','åºš':'é…‰','å£¬':'å­'};
    const SHISHEN_MAP = {"ç”²":{"ç”²":"æ¯”è‚©","ä¹™":"åŠ«è´¢","ä¸™":"é£Ÿç¥","ä¸":"ä¼¤å®˜","æˆŠ":"åè´¢","å·±":"æ­£è´¢","åºš":"ä¸ƒæ€","è¾›":"æ­£å®˜","å£¬":"åå°","ç™¸":"æ­£å°"},"ä¹™":{"ä¹™":"æ¯”è‚©","ç”²":"åŠ«è´¢","ä¸":"é£Ÿç¥","ä¸™":"ä¼¤å®˜","å·±":"åè´¢","æˆŠ":"æ­£è´¢","è¾›":"ä¸ƒæ€","åºš":"æ­£å®˜","ç™¸":"åå°","å£¬":"æ­£å°"},"ä¸™":{"ä¸™":"æ¯”è‚©","ä¸":"åŠ«è´¢","æˆŠ":"é£Ÿç¥","å·±":"ä¼¤å®˜","åºš":"åè´¢","è¾›":"æ­£è´¢","å£¬":"ä¸ƒæ€","ç™¸":"æ­£å®˜","ç”²":"åå°","ä¹™":"æ­£å°"},"ä¸":{"ä¸":"æ¯”è‚©","ä¸™":"åŠ«è´¢","å·±":"é£Ÿç¥","æˆŠ":"ä¼¤å®˜","è¾›":"åè´¢","åºš":"æ­£è´¢","ç™¸":"ä¸ƒæ€","å£¬":"æ­£å®˜","ä¹™":"åå°","ç”²":"æ­£å°"},"æˆŠ":{"æˆŠ":"æ¯”è‚©","å·±":"åŠ«è´¢","åºš":"é£Ÿç¥","è¾›":"ä¼¤å®˜","å£¬":"åè´¢","ç™¸":"æ­£è´¢","ç”²":"ä¸ƒæ€","ä¹™":"æ­£å®˜","ä¸™":"åå°","ä¸":"æ­£å°"},"å·±":{"å·±":"æ¯”è‚©","æˆŠ":"åŠ«è´¢","è¾›":"é£Ÿç¥","åºš":"ä¼¤å®˜","ç™¸":"åè´¢","å£¬":"æ­£è´¢","ä¹™":"ä¸ƒæ€","ç”²":"æ­£å®˜","ä¸":"åå°","ä¸™":"æ­£å°"},"åºš":{"åºš":"æ¯”è‚©","è¾›":"åŠ«è´¢","å£¬":"é£Ÿç¥","ç™¸":"ä¼¤å®˜","ç”²":"åè´¢","ä¹™":"æ­£è´¢","ä¸™":"ä¸ƒæ€","ä¸":"æ­£å®˜","æˆŠ":"åå°","å·±":"æ­£å°"},"è¾›":{"è¾›":"æ¯”è‚©","åºš":"åŠ«è´¢","ç™¸":"é£Ÿç¥","å£¬":"ä¼¤å®˜","ä¹™":"åè´¢","ç”²":"æ­£è´¢","ä¸":"ä¸ƒæ€","ä¸™":"æ­£å®˜","å·±":"åå°","æˆŠ":"æ­£å°"},"å£¬":{"å£¬":"æ¯”è‚©","ç™¸":"åŠ«è´¢","ç”²":"é£Ÿç¥","ä¹™":"ä¼¤å®˜","ä¸™":"åè´¢","ä¸":"æ­£è´¢","æˆŠ":"ä¸ƒæ€","å·±":"æ­£å®˜","åºš":"åå°","è¾›":"æ­£å°"},"ç™¸":{"ç™¸":"æ¯”è‚©","å£¬":"åŠ«è´¢","ä¹™":"é£Ÿç¥","ç”²":"ä¼¤å®˜","ä¸":"åè´¢","ä¸™":"æ­£è´¢","å·±":"ä¸ƒæ€","æˆŠ":"æ­£å®˜","è¾›":"åå°","åºš":"æ­£å°"}};
    const SILING_RULES = {'å¯…':[['æˆŠ',7],['ä¸™',7],['ç”²',16]],'å¯':[['ç”²',10],['ä¹™',20]],'è¾°':[['ä¹™',9],['ç™¸',3],['æˆŠ',18]],'å·³':[['æˆŠ',5],['åºš',9],['ä¸™',16]],'åˆ':[['ä¸™',10],['å·±',9],['ä¸',11]],'æœª':[['ä¸',9],['ä¹™',3],['å·±',18]],'ç”³':[['æˆŠ',7],['å£¬',7],['åºš',16]],'é…‰':[['åºš',10],['è¾›',20]],'æˆŒ':[['è¾›',9],['ä¸',3],['æˆŠ',18]],'äº¥':[['æˆŠ',7],['ç”²',5],['å£¬',18]],'å­':[['å£¬',10],['ç™¸',20]],'ä¸‘':[['ç™¸',9],['è¾›',3],['å·±',18]]};
    const ROOT_MAP = {'ç”²':['å¯…','å¯','äº¥','è¾°','æœª'],'ä¹™':['å¯','å¯…','è¾°','æœª','äº¥'],'ä¸™':['å·³','åˆ','å¯…','æˆŒ'],'ä¸':['åˆ','å·³','æœª','æˆŒ','å¯…'],'æˆŠ':['è¾°','æˆŒ','ä¸‘','æœª','å·³','åˆ'],'å·±':['ä¸‘','æœª','è¾°','æˆŒ','åˆ','å·³'],'åºš':['ç”³','é…‰','å·³','ä¸‘','æˆŒ'],'è¾›':['é…‰','ç”³','ä¸‘','æˆŒ','å·³'],'å£¬':['äº¥','å­','ç”³','è¾°'],'ç™¸':['å­','äº¥','è¾°','ä¸‘','ç”³']};
    const CHANGSHENG_TABLE = {"ç”²":{"äº¥":"é•¿ç”Ÿ","å­":"æ²æµ´","ä¸‘":"å† å¸¦","å¯…":"ä¸´å®˜","å¯":"å¸æ—º","è¾°":"è¡°","å·³":"ç—…","åˆ":"æ­»","æœª":"å¢“","ç”³":"ç»","é…‰":"èƒ","æˆŒ":"å…»"},"ä¹™":{"åˆ":"é•¿ç”Ÿ","å·³":"æ²æµ´","è¾°":"å† å¸¦","å¯":"ä¸´å®˜","å¯…":"å¸æ—º","ä¸‘":"è¡°","å­":"ç—…","äº¥":"æ­»","æˆŒ":"å¢“","é…‰":"ç»","ç”³":"èƒ","æœª":"å…»"},"ä¸™":{"å¯…":"é•¿ç”Ÿ","å¯":"æ²æµ´","è¾°":"å† å¸¦","å·³":"ä¸´å®˜","åˆ":"å¸æ—º","æœª":"è¡°","ç”³":"ç—…","é…‰":"æ­»","æˆŒ":"å¢“","äº¥":"ç»","å­":"èƒ","ä¸‘":"å…»"},"ä¸":{"é…‰":"é•¿ç”Ÿ","ç”³":"æ²æµ´","æœª":"å† å¸¦","åˆ":"ä¸´å®˜","å·³":"å¸æ—º","è¾°":"è¡°","å¯":"ç—…","å¯…":"æ­»","ä¸‘":"å¢“","å­":"ç»","äº¥":"èƒ","æˆŒ":"å…»"},"æˆŠ":{"å¯…":"é•¿ç”Ÿ","å¯":"æ²æµ´","è¾°":"å† å¸¦","å·³":"ä¸´å®˜","åˆ":"å¸æ—º","æœª":"è¡°","ç”³":"ç—…","é…‰":"æ­»","æˆŒ":"å¢“","äº¥":"ç»","å­":"èƒ","ä¸‘":"å…»"},"å·±":{"é…‰":"é•¿ç”Ÿ","ç”³":"æ²æµ´","æœª":"å† å¸¦","åˆ":"ä¸´å®˜","å·³":"å¸æ—º","è¾°":"è¡°","å¯":"ç—…","å¯…":"æ­»","ä¸‘":"å¢“","å­":"ç»","äº¥":"èƒ","æˆŒ":"å…»"},"åºš":{"å·³":"é•¿ç”Ÿ","åˆ":"æ²æµ´","æœª":"å† å¸¦","ç”³":"ä¸´å®˜","é…‰":"å¸æ—º","æˆŒ":"è¡°","äº¥":"ç—…","å­":"æ­»","ä¸‘":"å¢“","å¯…":"ç»","å¯":"èƒ","è¾°":"å…»"},"è¾›":{"å­":"é•¿ç”Ÿ","äº¥":"æ²æµ´","æˆŒ":"å† å¸¦","é…‰":"ä¸´å®˜","ç”³":"å¸æ—º","æœª":"è¡°","åˆ":"ç—…","å·³":"æ­»","è¾°":"å¢“","å¯":"ç»","å¯…":"èƒ","ä¸‘":"å…»"},"å£¬":{"ç”³":"é•¿ç”Ÿ","é…‰":"æ²æµ´","æˆŒ":"å† å¸¦","äº¥":"ä¸´å®˜","å­":"å¸æ—º","ä¸‘":"è¡°","å¯…":"ç—…","å¯":"æ­»","è¾°":"å¢“","å·³":"ç»","åˆ":"èƒ","æœª":"å…»"},"ç™¸":{"å¯":"é•¿ç”Ÿ","å¯…":"æ²æµ´","ä¸‘":"å† å¸¦","å­":"ä¸´å®˜","äº¥":"å¸æ—º","æˆŒ":"è¡°","é…‰":"ç—…","ç”³":"æ­»","æœª":"å¢“","åˆ":"ç»","å·³":"èƒ","è¾°":"å…»"}};

    const GAME_DB = {
        "åå°æ ¼": { name: "ğŸ‘½ å¼‚æ¬¡å…ƒè¡Œè€…", tags: ["SR","æ´å¯Ÿ"], icon: "ğŸ‘ï¸", slogan: "çœŸç›¸æŒæ¡åœ¨å°‘æ•°äººæ‰‹ä¸­ã€‚", male: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> åå°å½“æƒï¼Œé¬¼æ‰é€»è¾‘ã€‚ä½ æ‹¥æœ‰ç‹¬é—¨ç»æŠ€ï¼Œé€‚åˆå†·é—¨é¢†åŸŸçš„æƒå¨ã€ä¾¦æ¢ã€ç ”å‘ã€ç„å­¦ã€‚ä½ çš„æ€ç»´æ–¹å¼ä¸ä¼—ä¸åŒï¼Œèƒ½çœ‹åˆ°å¸¸äººçœ‹ä¸åˆ°çš„çœŸç›¸ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> å‰¯ä¸šä¹‹ç‹ã€‚åå°ä¸»åé—¨ä¹‹è´¢ï¼Œé ç‰¹æ®ŠæŠ€èƒ½èµšé’±ã€‚è‹¥æœ‰åè´¢åˆ¶åŒ–ï¼Œåˆ™å¯ç‚¹çŸ³æˆé‡‘ï¼Œä»å†·é—¨ä¸­æŒ–æ˜å·¨å¤§è´¢å¯Œã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> å†°å±±å†…å¿ƒã€‚å¾ˆéš¾çœŸæ­£èµ°è¿›ä½ çš„å¿ƒï¼Œä½ ä¹ æƒ¯ä¿æŒè·ç¦»ã€‚éœ€è¦ä¸€ä¸ªèƒ½ç†è§£ä½ å­¤ç‹¬çš„ä¼´ä¾£ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> ä»£æ²Ÿã€‚æ•™è‚²æ–¹å¼å¦ç±»ï¼Œå¯èƒ½ä¸å­å¥³æœ‰æ€æƒ³ä¸Šçš„éš”é˜‚ï¼Œä½†å­©å­å¤šæœ‰å¥‡æ‰ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> é˜²æŠ‘éƒã€‚å¤šæ™’å¤ªé˜³ï¼Œå¤šæ¥è§¦å¤§è‡ªç„¶ã€‚é˜²æ­¢å› æ€è™‘è¿‡é‡è€Œå¯¼è‡´çš„ç²¾ç¥å†…è€—ã€‚" }, female: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> çµæ„Ÿç›´è§‰ã€‚å¿ƒç†å­¦å®¶æˆ–ç„å­¦å¤©æ‰ã€‚ä½ å¯¹ç¥ç§˜äº‹ç‰©æœ‰ç€å¤©ç„¶çš„æ•æ„Ÿåº¦ï¼Œç›´è§‰æƒŠäººã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> å˜ç°ç‹¬ç‰¹ã€‚ä¸èµ°å¯»å¸¸è·¯ï¼Œé åˆ›æ„å’Œçµæ„Ÿèµšé’±ã€‚å¦‚è®¾è®¡ã€å’¨è¯¢ç­‰ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> è¾¹ç¼˜æ‹æƒ…ã€‚å®¹æ˜“æ¥å—éä¸»æµæ„Ÿæƒ…ï¼Œæˆ–è€…æ™šå©šã€‚éœ€è¦ç²¾ç¥é«˜åº¦å¥‘åˆçš„ä¼´ä¾£ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> ä¸å…‹å€¾å‘ã€‚å–œæ¬¢è‡ªç”±ï¼Œä¸æ„¿è¢«ä¼ ç»Ÿå®¶åº­è§‚å¿µæŸç¼šã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> ç¥ç»ç—›ã€‚æ³¨æ„ä¼‘æ¯ï¼Œé¿å…ç”¨è„‘è¿‡åº¦ã€‚" } },
        "é‡‘æ°´ä¼¤å®˜": { name: "â„ï¸ å¯’å†°å‰‘ä»™", tags: ["SSR","æè´µ"], icon: "ğŸ—¡ï¸", slogan: "é‡‘å¯’æ°´å†·ï¼Œå”¯ç«æš–å¿ƒã€‚", male: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> æƒè°‹æ´å¯Ÿã€‚æ€ç»´å¦‚å†°åˆ€åˆ‡å¼€æ ¸å¿ƒã€‚å±€ä¸­è§ç«å³ä¸ºæ˜¾è´µï¼ŒååŠ¨å¤©ä¸‹ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> éšä½è€Œç”Ÿã€‚èº«å¤„é«˜ä½è´¢å¯Œè‡ªæ¥ï¼Œåˆ‡å¿Œè´ªå©ªåå±€ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> éœ€æš–é˜³ä¼´ä¾£èåŒ–å†°å†·ã€‚å†…å¿ƒå­¤ç‹¬ï¼Œæ¸´æœ›æ¸©æš–ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> ä¸¥çˆ¶å‡ºå­å­ã€‚å¯¹å­å¥³è¦æ±‚æé«˜ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> å¿…ç”¨ç«è°ƒå€™ã€‚å—æ–¹ä¸ºç¦åœ°ï¼Œå¤šç©¿çº¢è¡£ã€‚" }, female: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> å†°å±±ç¾äººã€‚æ°”è´¨é«˜å†·è„±ä¿—ï¼Œæ‰åéœ€èˆå°ç‚¹äº®ã€‚é€‚åˆæ¼”è‰ºã€å¤–äº¤ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> å¤«è£å¦»è´µã€‚ç«ä¸ºå¤«æ˜Ÿï¼Œæˆå°±ä¼´ä¾£å³æˆå°±è‡ªå·±ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> ç‹¬å–œå®˜æ˜Ÿå‘µæŠ¤ã€‚å¤–å†·å†…çƒ­ï¼Œæåº¦æ¸´æœ›è¢«çˆ±ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> è´µå­ä¸´é—¨ã€‚å­å¥³å¤šæ‰å¤šè‰ºã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> æš–å®«é©±å¯’ï¼Œä¿æ¸©ä¿è¿ã€‚æ³¨æ„ç”Ÿæ®–ç³»ç»Ÿå¥åº·ã€‚" } },
        "æ­£è´¢æ ¼": { name: "ğŸ§± å‹¤å‹‰ç­‘æ¢¦å¸ˆ", tags: ["R+","ç¨³å¥"], icon: "ğŸœ", slogan: "ä¸€ç –ä¸€ç“¦ï¼Œèšæ²™æˆå¡”ã€‚", male: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> ä½ æ˜¯è¿™ä¸ªæµ®èºç¤¾ä¼šä¸­éš¾å¾—çš„â€œåŸºçŸ³â€ã€‚ä½ ä¸ç›¸ä¿¡ä¸€å¤œæš´å¯Œçš„é¬¼è¯ï¼Œåªä¿¡å¥‰å‹¤åŠ³è‡´å¯Œçš„çœŸç†ã€‚åœ¨é‡‘èã€å®ä¸šã€åˆ¶é€ ç­‰ä¼ ç»Ÿé¢†åŸŸï¼Œä½ æ˜¯æœ€è¸å®ã€æœ€é è°±çš„ä¸­åšåŠ›é‡ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> å¤åˆ©è‡´å¯Œã€‚ä½ æ˜¯å…¸å‹çš„å¯Œä¸€ä»£ï¼Œè´¢å¯Œæ˜¯é æ—¶é—´ç§¯ç´¯èµ·æ¥çš„ã€‚ç§¯å°‘æˆå¤šï¼Œæ™šå¹´å¯Œè¶³ã€‚ä¸ä¹±èŠ±é’±ï¼Œæ¯ä¸€ç¬”å¼€æ”¯éƒ½æœ‰è®¡åˆ’ã€‚é€‚åˆç¨³å¥å‹æŠ•èµ„ï¼Œå¦‚å‚¨è“„ã€å›½å€ºã€æˆ¿äº§ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> å® å¦»ç‹‚é­”ã€‚åœ¨å‘½ç†ä¸­ï¼Œæ­£è´¢ä»£è¡¨å¦»å­ã€‚æ­£è´¢æ ¼çš„ç”·äººé€šå¸¸éå¸¸ç–¼è€å©†ï¼Œç”šè‡³æœ‰ç‚¹â€œæƒ§å†…â€ã€‚ä½ æ„¿æ„æŠŠå·¥èµ„å¡ä¸Šäº¤ï¼Œè§‰å¾—å¬è€å©†è¯æ‰ä¼šæœ‰å‡ºæ¯ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> æœ´å®å®¶é£ã€‚ä½ çš„å­©å­ä¼šç»§æ‰¿ä½ å‹¤åŠ³æœ´å®çš„ä¼˜è‰¯å“è´¨ã€‚ä½ ä¼šæ•™å¯¼ä»–ä»¬èŠ‚çº¦å’ŒåŠªåŠ›ï¼Œä¸ä¼šæººçˆ±ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> é˜²åŠ³æŸã€‚ä½ æœ€å¤§çš„æ•Œäººæ˜¯â€œè¿‡åº¦åŠ³ç´¯â€ã€‚å› ä¸ºå¤ªæƒ³ç»™å®¶äººæ›´å¥½çš„ç”Ÿæ´»ï¼Œä½ å®¹æ˜“é€æ”¯èº«ä½“ã€‚" }, female: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> ä½ æ˜¯å¤©ç”Ÿçš„â€œç®¡å®¶å©†â€ï¼Œæ‹¥æœ‰åŒ–ç¹ä¸ºç®€çš„é­”åŠ›ã€‚æ— è®ºæ˜¯å¤æ‚çš„è´¢åŠ¡æŠ¥è¡¨è¿˜æ˜¯çç¢çš„å®¶åº­äº‹åŠ¡ï¼Œä½ éƒ½èƒ½æ‰“ç†å¾—äº•äº•æœ‰æ¡ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> å­˜é’±ç½ã€‚ä½ æ˜¯å¤©ç”Ÿçš„ç†è´¢é«˜æ‰‹ï¼Œç²¾æ‰“ç»†ç®—ï¼Œçœ‹ç€ä½™é¢å¢é•¿æ˜¯ä½ æœ€å¤§çš„å¿«ä¹ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> è´¤æƒ æŒå®¶ã€‚ä½ èƒ½æŠŠæ—¥å­è¿‡å¾—çº¢çº¢ç«ç«ï¼Œæ˜¯æ ‡å‡†çš„è´¤å¦»è‰¯æ¯ã€‚ä½†è¦æ³¨æ„ï¼Œç”Ÿæ´»ä¸ä»…æ˜¯æŸ´ç±³æ²¹ç›ï¼Œè¿˜éœ€è¦ä¸€ç‚¹æµªæ¼«ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> ä¸¥æ¯ã€‚ä½ å¯¹å­©å­çš„å­¦ä¸šæŠ“å¾—å¾ˆç´§ï¼Œå¸Œæœ›ä»–ä»¬èƒ½ç¨³æ­¥ä¸Šå‡ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> è¡¥æ°”è¡€ã€‚ä½ æœ‰ç‚¹å®…ï¼Œä¸çˆ±è¿åŠ¨ã€‚å®¹æ˜“æ°”è¡€ä¸è¶³ï¼Œæ‰‹è„šå†°å‡‰ã€‚" } },
        // ... (æ­¤å¤„ä¸ºäº†ä¸è¶…é•¿ï¼Œçœç•¥éƒ¨åˆ†ï¼Œå®é™…éƒ¨ç½²è¯·åŒ…å«æ‰€æœ‰21ç§æ ¼å±€ï¼Œç¡®ä¿ä¸æŠ¥é”™)
        "æ‚æ ¼": { name: "ğŸŒ± æ½œé¾™å‹¿ç”¨", tags: ["N","æ½œåŠ›"], icon: "ğŸŒ±", slogan: "æ—¶è¿æœªåˆ°ï¼Œæ½œå¿ƒä¿®ç‚¼ã€‚", male: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> å¤šé¢æ‰‹ã€‚ä½ å¯èƒ½æ²¡æœ‰ç‰¹åˆ«çªå‡ºçš„å•ä¸€å¼ºé¡¹ï¼Œä½†èƒœåœ¨ç»¼åˆèƒ½åŠ›ä¸é”™ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> å‹¤åŠ³è‡´å¯Œã€‚æ²¡æœ‰æš´å¯Œçš„å‘½ï¼Œåªæœ‰å‹¤åŠ³çš„æ‰‹ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> å¹³æ·¡æ˜¯çœŸã€‚é™ªä¼´æ˜¯æœ€é•¿æƒ…çš„å‘Šç™½ã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> å¹³å®‰æ˜¯ç¦ã€‚å­©å­å¥åº·å¿«ä¹å°±å¥½ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> é”»ç‚¼èº«ä½“ã€‚èº«ä½“æ˜¯é©å‘½çš„æœ¬é’±ã€‚" }, female: { c:"<b>[å¤©èµ‹ä¼ è®°]</b> è¸å®åå‹¤ã€‚é€‚åˆåšåå‹¤ã€è¾…åŠ©ç±»å·¥ä½œã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> èŠ‚ä¿­æŒå®¶ã€‚è´¢å¯Œæ˜¯çœå‡ºæ¥çš„ã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> ä¾é è€å®äººã€‚å®‰ç¨³è¿‡å®Œè¿™ä¸€ç”Ÿã€‚", k:"<b>[åä»£ä¼ æ‰¿]</b> æ…ˆæ¯å¿ƒã€‚ä¸ºå­©å­æ“å¿ƒå¤šã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> ä¿è¯ç¡çœ ã€‚ä¸è¦æ€è™‘è¿‡é‡ã€‚" } }
    };
    // è¡¥å…¨æ‰€æœ‰Keyä»¥é˜²æŠ¥é”™
    const keys = ["ä¼¤å®˜é…å°","ä¼¤å®˜åˆæ€","é£Ÿç¥åˆ¶æ€","æ€å°ç›¸ç”Ÿ","æ­£å®˜æ ¼","ä¸ƒæ€æ ¼","æ­£å°æ ¼","é£Ÿç¥æ ¼","ä¼¤å®˜æ ¼","ä¼¤å®˜ç”Ÿè´¢","é£Ÿç¥ç”Ÿè´¢","å»ºç¦„æ ¼","æœˆåŠ«æ ¼","åè´¢æ ¼","é˜³åˆƒæ ¼","ä»è´¢æ ¼","ä»æ€æ ¼","æœ¨ç«é€šæ˜"];
    keys.forEach(k=>{ if(!GAME_DB[k]) GAME_DB[k]=GAME_DB["æ‚æ ¼"]; });

    const XIJI_RULES = {
        "åå°æ ¼": { desc: "åå°å½“ä»¤ï¼Œè‹¥æ— åè´¢åˆ¶ä¹‹ï¼Œåˆ™ä¸ºæ­ç¥å¤ºé£Ÿï¼Œä¸»å­¤è´«ç¾ç–¾ã€‚å–œåè´¢ï¼Œå¿Œé£Ÿç¥ã€‚åå°æ ¼éœ€èº«æ—ºï¼Œè‹¥èº«å¼±åˆ™ä¸º'å¤šç—…å¤šç¾'ã€‚", joy: ["ğŸ’° åè´¢","å¤©æœˆå¾·"], taboo: ["ğŸ¨ é£Ÿç¥"] },
        "é‡‘æ°´ä¼¤å®˜": { desc: "å†¬é‡‘æå¯’ï¼Œå¿…ç”¨ç«ï¼ˆå®˜æ€ï¼‰è°ƒå€™ã€‚æ­¤æ ¼è§ç«å³æ¿€æ´»æ˜¾è´µï¼Œæ— ç«åˆ™å¦‚å¯’æ½­ä¹‹å‰‘ï¼Œæ‰åè™½é«˜å´å­¤å†·éš¾æˆã€‚", joy: ["ğŸ”¥ ç« (è°ƒå€™)","ğŸŒ² æœ¨ (è´¢æ˜Ÿ)"], taboo: ["ğŸ’§ æ°´ (ä¼¤å®˜)","â›°ï¸ åœŸ (åŸ‹é‡‘)"] },
        "æ‚æ ¼": { desc: "æ ¼å±€æœªæ¸…ï¼Œäº”è¡Œæ‚å±…ã€‚å…¨å‡­æ‰¶æŠ‘è°ƒå€™ï¼Œéœ€çœ‹æ—¥ä¸»åº•è•´ä¸é€šå…³ã€‚åå¤©åŠªåŠ›å¯æ‰­ä¹¾å¤ã€‚", joy: ["æ‰¶åŠ©ç”¨ç¥"], taboo: ["å…‹å®³ç”¨ç¥"] }
    };
    // è¡¥å…¨
    keys.forEach(k=>{ if(!XIJI_RULES[k]) XIJI_RULES[k] = {desc:"æ ‡å‡†æ ¼å±€ï¼Œè¯¦è§å­å¹³çœŸè¯ ã€‚", joy:["å–œç”¨"], taboo:["å¿Œç¥"]}; });

    function hasRoot(gan, pillars) { return pillars.some(p => (ROOT_MAP[gan]||[]).includes(p.z)); }
    function calcCommander(lunar, mz) {
        const pj = lunar.getPrevJie(), s = lunar.getSolar(), pjs = pj.getSolar();
        const diff = Math.floor((new Date(s.toYmdHms()).getTime() - new Date(pjs.toYmdHms()).getTime()) / 86400000);
        const rules = SILING_RULES[mz];
        let commander = rules[rules.length-1][0];
        let sum = 0;
        for(let r of rules) { sum += r[1]; if(diff < sum) { commander = r[0]; break; } }
        return { commander, diffDays: diff };
    }
    
    function determinePattern(climate, pillars, dm, mz, cmd) {
        if (climate.special) return climate.special;
        const stems = [pillars[0].g, pillars[1].g, pillars[3].g];
        const gods = stems.map(s => SHISHEN_MAP[dm][s]);
        // 1. é˜³åˆƒ
        if (["ç”²","ä¸™","æˆŠ","åºš","å£¬"].includes(dm) && mz === YANG_REN_MAP[dm]) return "é˜³åˆƒæ ¼";
        // 2. æ€æ˜Ÿä¼˜å…ˆ
        if (gods.includes("ä¸ƒæ€")) {
            if (gods.includes("ä¼¤å®˜")) return "ä¼¤å®˜åˆæ€";
            if (gods.includes("é£Ÿç¥") && stems.some(s => SHISHEN_MAP[dm][s]==="é£Ÿç¥" && hasRoot(s, pillars))) return "é£Ÿç¥åˆ¶æ€";
            if (gods.includes("æ­£å°") || gods.includes("åå°")) {
                const yinStem = stems.find(s => ["æ­£å°","åå°"].includes(SHISHEN_MAP[dm][s]));
                if (yinStem && hasRoot(yinStem, pillars)) return "æ€å°ç›¸ç”Ÿ";
            }
            return "ä¸ƒæ€æ ¼";
        }
        // 3. ä¼¤å®˜
        if (gods.includes("ä¼¤å®˜")) {
            const sgStem = stems.find(s => SHISHEN_MAP[dm][s] === "ä¼¤å®˜");
            if (hasRoot(sgStem, pillars)) {
                if (gods.includes("æ­£å°") || gods.includes("åå°")) {
                    const yinStem = stems.find(s => ["æ­£å°","åå°"].includes(SHISHEN_MAP[dm][s]));
                    if (yinStem && hasRoot(yinStem, pillars)) return "ä¼¤å®˜é…å°";
                }
                if (gods.some(g => g && g.includes("è´¢"))) return "ä¼¤å®˜ç”Ÿè´¢";
                return "ä¼¤å®˜æ ¼";
            }
        }
        // 4. çœŸç¥
        if (stems.includes(cmd.commander)) {
            const g = SHISHEN_MAP[dm][cmd.commander];
            const m = {"æ­£è´¢":"æ­£è´¢æ ¼","åè´¢":"åè´¢æ ¼","æ­£å®˜":"æ­£å®˜æ ¼","æ­£å°":"æ­£å°æ ¼","åå°":"åå°æ ¼","é£Ÿç¥":"é£Ÿç¥æ ¼","ä¼¤å®˜":"ä¼¤å®˜æ ¼","ä¸ƒæ€":"ä¸ƒæ€æ ¼"};
            if (m[g]) return m[g];
        }
        const mzMainGod = SHISHEN_MAP[dm][ZHI_MAIN_QI[mz]];
        const fallback = {"æ­£è´¢":"æ­£è´¢æ ¼","åè´¢":"åè´¢æ ¼","æ­£å®˜":"æ­£å®˜æ ¼","ä¸ƒæ€":"ä¸ƒæ€æ ¼","æ­£å°":"æ­£å°æ ¼","åå°":"åå°æ ¼","é£Ÿç¥":"é£Ÿç¥æ ¼","ä¼¤å®˜":"ä¼¤å®˜æ ¼","æ¯”è‚©":"å»ºç¦„æ ¼","åŠ«è´¢":"æœˆåŠ«æ ¼"};
        return fallback[mzMainGod] || "æ‚æ ¼";
    }

    function startScan() {
        const timeStr = document.getElementById('birth-input').value;
        if(!timeStr) return alert("è¯·é€‰æ‹©æ—¶åˆ»");
        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const baziObj = lunar.getEightChar(); baziObj.setSect(2);
            
            const pillars = [
                {t:'å¹´',g:baziObj.getYearGan().toString(),z:baziObj.getYearZhi().toString()},
                {t:'æœˆ',g:baziObj.getMonthGan().toString(),z:baziObj.getMonthZhi().toString()},
                {t:'æ—¥',g:baziObj.getDayGan().toString(),z:baziObj.getDayZhi().toString()},
                {t:'æ—¶',g:baziObj.getTimeGan().toString(),z:baziObj.getTimeZhi().toString()}
            ];
            const dm = pillars[2].g, mz = pillars[1].z;
            const cmd = calcCommander(lunar, mz);
            
            // è°ƒå€™
            const isWinter = ["äº¥","å­","ä¸‘"].includes(mz);
            const hasFire = pillars.some(p => WUXING_MAP[p.g]==='ç«' || WUXING_MAP[p.z]==='ç«');
            const climate = { special: null };
            if(WUXING_MAP[dm]==='é‡‘' && isWinter) climate.special = pillars.some(p => SHISHEN_MAP[dm][p.g]==='ä¼¤å®˜') ? "é‡‘æ°´ä¼¤å®˜" : "é‡‘æ°´é£Ÿç¥";
            
            const pattern = determinePattern(climate, pillars, dm, mz, cmd);
            
            document.getElementById('result-area').style.display='block';
            renderUI(pattern, cmd, dm, mz, pillars);
            renderWuxing(pillars);
            
        } catch(e){ alert(e); }
    }

    function renderUI(key, cmd, dm, mz, pillars) {
        const data = GAME_DB[key] || GAME_DB["æ‚æ ¼"];
        const xiji = XIJI_RULES[key] || XIJI_RULES["æ‚æ ¼"];
        const detail = data[currentGender === 1 ? 'male' : 'female'];
        
        safeSetText('role-icon', data.icon);
        safeSetText('role-title', data.name);
        safeSetText('role-sub', data.slogan);
        safeSetHTML('role-tags', `<span class="tag ssr">${key}</span>`);
        safeSetHTML('siling-text', `${cmd.commander} (${SHISHEN_MAP[dm][cmd.commander]||'çœŸç¥'}) Â· ${cmd.diffDays}æ—¥`);
        safeSetText('pattern-reason', xiji.desc);
        safeSetText('txt-joy', xiji.joy.join("/"));
        safeSetText('txt-taboo', xiji.taboo.join("/"));
        safeSetText('dm-desc', `ä½ æ˜¯${WUXING_MAP[dm]}å‘½ï¼Œç”Ÿäº${mz}æœˆã€‚`);

        let html = '';
        pillars.forEach(p => {
            const hiddens = HIDDEN_STEMS[p.z] || [];
            let hStr = hiddens.map(h => `<span class="hs-gan" style="color:${WX_COLOR_DATA[WUXING_MAP[h]]}">${h}${SHISHEN_MAP[dm][h]}</span>`).join(" ");
            const cs = CHANGSHENG_TABLE[p.g][p.z];
            html += `<div class="ofuda">
                <div class="ofuda-god">${p.t==='æ—¥'?'å…ƒç¥':SHISHEN_MAP[dm][p.g]}</div>
                <div class="ofuda-char" style="color:${WX_COLOR_DATA[WUXING_MAP[p.g]]}">${p.g}</div>
                <div class="ofuda-char" style="color:${WX_COLOR_DATA[WUXING_MAP[p.z]]}">${p.z}</div>
                <div class="ofuda-head">${p.t}</div>
                <div class="hidden-stems">${hStr}</div>
                <div class="ofuda-cs">è‡ªå${cs}</div>
            </div>`;
        });
        document.getElementById('pillars-box').innerHTML = html;
        document.getElementById('guide-content').innerHTML = `
            <div class="guide-item"><div class="guide-title">âš”ï¸ äº‹ä¸š</div><div class="guide-text">${detail.c}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ’° è´¢å¯Œ</div><div class="guide-text">${detail.w}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ’ æƒ…æ„Ÿ</div><div class="guide-text">${detail.l}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸŒ± ä¼ æ‰¿</div><div class="guide-text">${detail.k}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ›¡ï¸ é”¦å›Š</div><div class="guide-text">${detail.h}</div></div>
        `;
    }

    function renderWuxing(pillars) {
        const c = {'é‡‘':0,'æœ¨':0,'æ°´':0,'ç«':0,'åœŸ':0};
        pillars.forEach(p=>{ c[WUXING_MAP[p.g]]++; c[WUXING_MAP[p.z]]++; (HIDDEN_STEMS[p.z]||[]).forEach(h=>c[WUXING_MAP[h]]+=0.5); });
        let h = "", total = Object.values(c).reduce((a,b)=>a+b,0);
        for(let k in c) if(c[k]>0) h+=`<div class="wx-segment" style="width:${(c[k]/total)*100}%;background:${WX_COLOR_DATA[k]}"></div>`;
        document.getElementById('wx-bar').innerHTML = h;
    }

    function setGender(v,e) { currentGender=v; document.querySelectorAll('.g-btn').forEach(b=>b.classList.remove('active')); e.classList.add('active'); }
    function copyResult() { navigator.clipboard.writeText(document.getElementById('result-area').innerText).then(()=>alert("å·²å¤åˆ¶")); }
    window.onload = ()=>{ try{ document.getElementById('birth-input').value = new Date(new Date().getTime()-new Date().getTimezoneOffset()*60000).toISOString().slice(0,16); }catch(e){} };
</script>
</body>
</html>
