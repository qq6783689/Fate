<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>命运黑盒 Pro Max · 宗师全本典藏版</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        :root {
            --primary: #ff2e63; --accent: #08d9d6; --dark: #121212; --card: #1e1e24;
            --text: #e0e0e0; --gold: #ffd700; --border-r: 12px;
        }
        * { box-sizing: border-box; }
        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--dark); color: var(--text);
            margin: 0; padding: 20px 10px; min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #2a2d3e 0%, #121212 100%);
            display: flex; justify-content: center;
        }
        .container { width: 100%; max-width: 700px; padding-bottom: 120px; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .header h1 { 
            font-size: 2.2rem; font-weight: 900; margin: 0; letter-spacing: 4px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255, 46, 99, 0.3);
        }
        .sys-badge { 
            font-size: 0.7rem; border: 1px solid var(--accent); color: var(--accent);
            padding: 4px 10px; border-radius: 20px; display: inline-block; margin-top: 10px;
        }
        .card {
            background: var(--card); border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--border-r); padding: 25px; margin-bottom: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative; overflow: hidden;
        }
        .card::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        .input-group { margin-bottom: 20px; }
        .label { color: var(--accent); font-size: 0.85rem; margin-bottom: 8px; display: block; font-weight: bold; letter-spacing: 1px; }
        .gender-box { display: flex; gap: 15px; }
        .g-btn {
            flex: 1; padding: 14px; text-align: center; border-radius: 8px; background: rgba(255,255,255,0.05);
            border: 1px solid #333; color: #888; cursor: pointer; transition: 0.3s; font-weight: bold;
        }
        .g-btn.active { border-color: var(--primary); color: #fff; background: rgba(255, 46, 99, 0.2); }
        input[type="datetime-local"] {
            width: 100%; padding: 14px; background: rgba(255,255,255,0.05); border: 1px solid #333;
            color: #fff; border-radius: 8px; font-size: 1.1rem; outline: none;
        }
        .btn-start {
            width: 100%; padding: 16px; border: none; border-radius: 8px;
            background: linear-gradient(135deg, var(--primary), #8000ff);
            color: #fff; font-size: 1.2rem; font-weight: 900; letter-spacing: 3px;
            cursor: pointer; margin-top: 10px; box-shadow: 0 10px 30px rgba(255, 46, 99, 0.4);
        }
        #result-area { display: none; animation: slideUp 0.8s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        
        .role-header { display: flex; align-items: flex-start; padding-bottom: 20px; border-bottom: 1px dashed rgba(255,255,255,0.15); margin-bottom: 20px; }
        .role-icon {
            width: 80px; height: 80px; background: #2a2a35; border-radius: 16px;
            display: flex; align-items: center; justify-content: center; font-size: 40px;
            border: 2px solid var(--gold); margin-right: 20px; flex-shrink: 0;
        }
        .role-title { font-size: 1.6rem; font-weight: bold; color: #fff; margin: 0 0 5px 0; }
        .role-sub { font-size: 0.9rem; color: #888; font-style: italic; line-height: 1.4; }
        .role-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        .tag { font-size: 0.75rem; padding: 4px 10px; border-radius: 6px; background: rgba(255,255,255,0.08); color: #bbb; }
        .tag.ssr { background: linear-gradient(45deg, var(--primary), var(--gold)); color: #000; font-weight: bold; }
        .tag.logic { border: 1px solid var(--accent); color: var(--accent); background: transparent; }
        
        .siling-badge {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), transparent);
            border-left: 4px solid var(--gold); padding: 12px; margin-bottom: 20px; border-radius: 4px;
            color: var(--gold); font-weight: bold; font-size: 0.95rem; display: flex; align-items: center; gap: 10px;
        }
        
        .chart-box { height: 180px; width: 100%; border-radius: 12px; overflow: hidden; margin-bottom: 20px; position: relative; border: 1px solid rgba(255,255,255,0.1); }
        canvas { width: 100%; height: 100%; }

        .pillars { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .col { background: rgba(255,255,255,0.03); border-radius: 8px; padding: 12px 2px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .c-head { font-size: 0.65rem; color: #666; margin-bottom: 4px; }
        .c-god { font-size: 0.7rem; color: var(--accent); height: 14px; margin-bottom: 4px; }
        .c-char { font-family: "KaiTi", serif; font-size: 1.8rem; font-weight: bold; color: #fff; }
        .c-cs { font-size: 0.65rem; color: #888; margin-top: 4px; display: block; }
        .wx-金 { color: #ffeaa7; } .wx-木 { color: #55efc4; } .wx-水 { color: #74b9ff; } .wx-火 { color: #ff7675; } .wx-土 { color: #a29bfe; }

        .guide-item { margin-bottom: 25px; padding: 20px; border-radius: 12px; background: rgba(0,0,0,0.25); border-left: 4px solid var(--accent); }
        .guide-title { font-size: 1rem; font-weight: bold; color: var(--gold); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .guide-text { font-size: 0.95rem; line-height: 1.8; color: #ddd; text-align: justify; }
        
        .logic-bar { margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border: 1px solid #333; font-size: 0.9rem; line-height: 1.6; border-radius: 10px; }
        .logic-title { color: var(--accent); font-weight: bold; display: block; margin-bottom: 8px; }
        .good-text { color: #2ecc71; font-weight: bold; } .bad-text { color: #ff4757; font-weight: bold; }

        #error-msg { display:none; background:var(--primary); padding:10px; text-align:center; margin-bottom:15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>命运黑盒</h1>
        <div class="sys-badge">SYSTEM: MASTER CLASS · FULL LORE</div>
    </div>

    <div id="error-msg">⚠️ 核心组件加载异常，请检查网络 (jsDelivr)</div>

    <div class="card">
        <div class="input-group">
            <span class="label">选择角色性别 / CHARACTER GENDER</span>
            <div class="gender-box">
                <div class="g-btn active" onclick="setGender(1, this)">乾造 (Male)</div>
                <div class="g-btn" onclick="setGender(0, this)">坤造 (Female)</div>
            </div>
        </div>
        <div class="input-group">
            <span class="label">输入出生时间 / SPAWN DATE</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-start" onclick="startScan()">启动宗师级推演</button>
    </div>

    <div id="result-area">
        <div class="card">
            <div class="role-header">
                <div class="role-icon" id="role-icon">?</div>
                <div class="role-info">
                    <h2 class="role-title" id="role-name">分析中...</h2>
                    <div class="role-sub" id="role-slogan">...</div>
                    <div class="role-tags" id="role-tags"></div>
                </div>
            </div>

            <div class="siling-badge">
                <span style="font-size:1.2rem">👑</span> 
                <span id="siling-text">正在计算真神...</span>
            </div>
            
            <div class="chart-box">
                <canvas id="energy-canvas"></canvas>
            </div>

            <div class="pillars" id="pillars-box"></div>
            
            <div class="core-bar" id="core-analysis"></div>

            <div class="logic-bar">
                <span class="logic-title">⚡ 格局喜忌铁律 (Core Logic)</span>
                <div id="pattern-reason" style="margin-bottom:10px; color:#aaa;"></div>
                <div><span class="good-text">★ 喜用神：</span> <span id="txt-joy" style="color:#eee">...</span></div>
                <div style="margin-top:5px;"><span class="bad-text">✖ 忌神：</span> <span id="txt-taboo" style="color:#eee">...</span></div>
            </div>
        </div>

        <div class="card">
            <span class="label" style="margin-bottom:15px; font-size:1rem;">天命通关攻略 / STRATEGY GUIDE</span>
            <div id="guide-content"></div>
        </div>

        <div style="text-align:center; font-size:12px; color:#444; margin-top:40px;">
            Destiny Algorithm © 2025 · Verified
        </div>
    </div>
</div>

<script>
    let currentGender = 1;

    // --- 静态数据 ---
    const WUXING_MAP = {'甲':'木','乙':'木','丙':'火','丁':'火','戊':'土','己':'土','庚':'金','辛':'金','壬':'水','癸':'水','子':'水','丑':'土','寅':'木','卯':'木','辰':'土','巳':'火','午':'火','未':'土','申':'金','酉':'金','戌':'土','亥':'水'};
    const WX_COLOR = { '金':'wx-金', '木':'wx-木', '水':'wx-水', '火':'wx-火', '土':'wx-土' };
    const ZHI_MAIN_QI = {'子':'癸', '丑':'己', '寅':'甲', '卯':'乙', '辰':'戊', '巳':'丙', '午':'丁', '未':'己', '申':'庚', '酉':'辛', '戌':'戊', '亥':'壬'};

    // 司令规则 (日) - 严格遵循渊海子平，亥月前7日为戊土
    const SILING_RULES = {
        '寅': [['戊',7], ['丙',7], ['甲',16]], '卯': [['甲',10], ['乙',20]], '辰': [['乙',9], ['癸',3], ['戊',18]],
        '巳': [['戊',5], ['庚',9], ['丙',16]], '午': [['丙',10], ['己',9], ['丁',11]], '未': [['丁',9], ['乙',3], ['己',18]],
        '申': [['戊',7], ['壬',7], ['庚',16]], '酉': [['庚',10], ['辛',20]], '戌': [['辛',9], ['丁',3], ['戊',18]],
        '亥': [['戊',7], ['甲',5], ['壬',18]], '子': [['壬',10], ['癸',20]], '丑': [['癸',9], ['辛',3], ['己',18]]
    };

    const HIDDEN_GAN_MAP = {
        '子':['癸'], '丑':['己','癸','辛'], '寅':['甲','丙','戊'], '卯':['乙'], 
        '辰':['戊','乙','癸'], '巳':['丙','戊','庚'], '午':['丁','己'], '未':['己','丁','乙'], 
        '申':['庚','壬','戊'], '酉':['辛'], '戌':['戊','辛','丁'], '亥':['壬','甲']
    };

    // 阴阳长生 (阳顺阴逆)
    const CHANGSHENG_TABLE = {
        "甲": { "亥":"长生", "子":"沐浴", "丑":"冠带", "寅":"临官", "卯":"帝旺", "辰":"衰", "巳":"病", "午":"死", "未":"墓", "申":"绝", "酉":"胎", "戌":"养" },
        "乙": { "午":"长生", "巳":"沐浴", "辰":"冠带", "卯":"临官", "寅":"帝旺", "丑":"衰", "子":"病", "亥":"死", "戌":"墓", "酉":"绝", "申":"胎", "未":"养" },
        "丙": { "寅":"长生", "卯":"沐浴", "辰":"冠带", "巳":"临官", "午":"帝旺", "未":"衰", "申":"病", "酉":"死", "戌":"墓", "亥":"绝", "子":"胎", "丑":"养" },
        "丁": { "酉":"长生", "申":"沐浴", "未":"冠带", "午":"临官", "巳":"帝旺", "辰":"衰", "卯":"病", "寅":"死", "丑":"墓", "子":"绝", "亥":"胎", "戌":"养" },
        "戊": { "寅":"长生", "卯":"沐浴", "辰":"冠带", "巳":"临官", "午":"帝旺", "未":"衰", "申":"病", "酉":"死", "戌":"墓", "亥":"绝", "子":"胎", "丑":"养" },
        "己": { "酉":"长生", "申":"沐浴", "未":"冠带", "午":"临官", "巳":"帝旺", "辰":"衰", "卯":"病", "寅":"死", "丑":"墓", "子":"绝", "亥":"胎", "戌":"养" },
        "庚": { "巳":"长生", "午":"沐浴", "未":"冠带", "申":"临官", "酉":"帝旺", "戌":"衰", "亥":"病", "子":"死", "丑":"墓", "寅":"绝", "卯":"胎", "辰":"养" },
        "辛": { "子":"长生", "亥":"沐浴", "戌":"冠带", "酉":"临官", "申":"帝旺", "未":"衰", "午":"病", "巳":"死", "辰":"墓", "卯":"绝", "寅":"胎", "丑":"养" },
        "壬": { "申":"长生", "酉":"沐浴", "戌":"冠带", "亥":"临官", "子":"帝旺", "丑":"衰", "寅":"病", "卯":"死", "辰":"墓", "巳":"绝", "午":"胎", "未":"养" },
        "癸": { "卯":"长生", "寅":"沐浴", "丑":"冠带", "子":"临官", "亥":"帝旺", "戌":"衰", "酉":"病", "申":"死", "未":"墓", "午":"绝", "巳":"胎", "辰":"养" }
    };
    
    // 根气表 (判断通根，申酉戌巳丑为金根)
    const ROOT_MAP = {
        '甲':['寅','卯','亥','辰','未'], '乙':['卯','寅','辰','未','亥'],
        '丙':['巳','午','寅','戌'], '丁':['午','巳','未','戌','寅'],
        '戊':['辰','戌','丑','未','巳','午'], '己':['丑','未','辰','戌','午','巳'],
        '庚':['申','酉','巳','丑','戌'], '辛':['酉','申','丑','戌','巳'],
        '壬':['亥','子','申','辰'], '癸':['子','亥','辰','丑','申']
    };

    const SHISHEN_MAP = {
        "甲": { "甲":"比肩", "乙":"劫财", "丙":"食神", "丁":"伤官", "戊":"偏财", "己":"正财", "庚":"七杀", "辛":"正官", "壬":"偏印", "癸":"正印" },
        "乙": { "乙":"比肩", "甲":"劫财", "丁":"食神", "丙":"伤官", "己":"偏财", "戊":"正财", "辛":"七杀", "庚":"正官", "癸":"偏印", "壬":"正印" },
        "丙": { "丙":"比肩", "丁":"劫财", "戊":"食神", "己":"伤官", "庚":"偏财", "辛":"正财", "壬":"七杀", "癸":"正官", "甲":"偏印", "乙":"正印" },
        "丁": { "丁":"比肩", "丙":"劫财", "己":"食神", "戊":"伤官", "辛":"偏财", "庚":"正财", "癸":"七杀", "壬":"正官", "乙":"偏印", "甲":"正印" },
        "戊": { "戊":"比肩", "己":"劫财", "庚":"食神", "辛":"伤官", "壬":"偏财", "癸":"正财", "甲":"七杀", "乙":"正官", "丙":"偏印", "丁":"正印" },
        "己": { "己":"比肩", "戊":"劫财", "辛":"食神", "庚":"伤官", "癸":"偏财", "壬":"正财", "乙":"七杀", "甲":"正官", "丁":"偏印", "丙":"正印" },
        "庚": { "庚":"比肩", "辛":"劫财", "壬":"食神", "癸":"伤官", "甲":"偏财", "乙":"正财", "丙":"七杀", "丁":"正官", "戊":"偏印", "己":"正印" },
        "辛": { "辛":"比肩", "庚":"劫财", "癸":"食神", "壬":"伤官", "乙":"偏财", "甲":"正财", "丁":"七杀", "丙":"正官", "己":"偏印", "戊":"正印" },
        "壬": { "壬":"比肩", "癸":"劫财", "甲":"食神", "乙":"伤官", "丙":"偏财", "丁":"正财", "戊":"七杀", "己":"正官", "庚":"偏印", "辛":"正印" },
        "癸": { "癸":"比肩", "壬":"劫财", "乙":"食神", "甲":"伤官", "丁":"偏财", "丙":"正财", "己":"七杀", "戊":"正官", "辛":"偏印", "庚":"正印" }
    };

    // 核心数据库：格局喜忌规则 (XIJI RULES)
    const XIJI_RULES = {
        "金水伤官": { desc: "冬金寒冷，必须见火。喜火（官杀）暖局，喜木（财）生火。此为伤官见官反为贵的特殊格局。", joy: ["🔥 火","🌲 木"], taboo: ["💧 水","⛰️ 土"] },
        "金水食神": { desc: "金白水清，才华内敛。亦喜火暖局，忌土埋金、水过寒。", joy: ["🔥 火","🌲 木"], taboo: ["⛰️ 土","💧 水"] },
        "木火通明": { desc: "木生春月，见火泄秀。忌金克伐，忌水灭火。", joy: ["🔥 火","🌲 木"], taboo: ["🗡️ 金","💧 水"] },
        "伤官配印": { desc: "火炎土燥或身弱伤旺。急需水印润局生身。", joy: ["💧 水","🌲 木"], taboo: ["⛰️ 土","🔥 火"] },
        "食神制杀": { desc: "七杀攻身，食神制之。喜身强抗杀，喜食神制敌。", joy: ["🎨 食神","📜 印星","💪 比劫"], taboo: ["💰 财星","🗡️ 官杀"] },
        "伤官生财": { desc: "伤官有根，生财有情。技艺致富。伤官若无根则为虚名。", joy: ["💰 财星","🎨 伤官"], taboo: ["📜 印星","💪 比劫"] },
        "食神生财": { desc: "食神有根，生财安稳。福气之局。", joy: ["💰 财星","🎨 食神"], taboo: ["📜 偏印","🗡️ 官杀"] },
        "伤官合杀": { desc: "伤官合杀，异路功名。喜身旺。", joy: ["📜 印星","💪 比劫"], taboo: ["💰 财星","🗡️ 官杀"] },
        "伤官格": { desc: "伤官当令。需印制伤，或财引化。", joy: ["📜 印星","💰 财星"], taboo: ["🗡️ 官杀","💪 比劫"] },
        "建禄格": { desc: "月令建禄。喜财官食伤泄秀。", joy: ["🗡️ 官杀","🎨 食伤","💰 财星"], taboo: ["📜 印星","💪 比劫"] },
        "月劫格": { desc: "月令劫财。首取官杀制劫。", joy: ["🗡️ 官杀","🎨 食伤","💰 财星(需食伤)"], taboo: ["📜 印星","💪 比劫"] },
        "七杀格": { desc: "七杀当权。身弱取印，身强取食。", joy: ["📜 印星","🎨 食伤"], taboo: ["💰 财星","🗡️ 官杀"] },
        "杀印相生": { desc: "杀攻身，印化煞。贵气之局。", joy: ["📜 印星","💪 比劫"], taboo: ["💰 财星"] },
        "正官格": { desc: "正官纯正。喜财生官，喜印护官。", joy: ["💰 财星","📜 印星"], taboo: ["🎨 伤官","🗡️ 七杀"] },
        "正财格": { desc: "财星当令。身强任财，身弱喜印比。", joy: ["身强喜官/食","身弱喜印/比"], taboo: ["身强忌印","身弱忌财"] },
        "偏财格": { desc: "偏财当令。喜官护财，食伤生财。", joy: ["🗡️ 官杀","🎨 食伤"], taboo: ["💪 比劫","空亡"] },
        "正印格": { desc: "印绶生身。喜官生印，忌财坏印。", joy: ["🗡️ 官杀","💪 比劫"], taboo: ["💰 财星"] },
        "偏印格": { desc: "偏印当权。喜偏财制枭。", joy: ["💰 偏财","天月德"], taboo: ["🎨 食神"] },
        "食神格": { desc: "食神生财，福寿双全。忌枭神夺食。", joy: ["💰 财星","💪 比劫"], taboo: ["📜 偏印"] },
        "杂格": { desc: "格局未成，求其中和流通。", joy: ["扶抑","调候"], taboo: ["失衡"] }
    };

    // 终极文案库 (百万文案版 - 全量保留)
    const GAME_DB = {
        "金水伤官": { name: "❄️ 寒冰剑仙", tags: ["SSR","权谋"], icon: "🗡️", slogan: "金寒水冷，唯火暖心。", male: { c:"[天赋] 权谋洞察。适合从政、高管。", w:"[被动] 显贵致富。财随权来。", l:"[羁绊] 需暖阳伴侣融化冰冷。", k:"[传承] 严父出孝子。", h:"[锦囊] 必用火！多晒太阳，忌北方。" }, female: { c:"[天赋] 冰山美人。演艺、外交。", w:"[被动] 夫荣妻贵。旺夫旺己。", l:"[羁绊] 独喜官星呵护。", k:"[传承] 贵子临门。", h:"[锦囊] 暖宫驱寒，少吃生冷。" } },
        "金水食神": { name: "🌊 灵动智者", tags: ["SSR","清贵"], icon: "🌊", slogan: "金白水清，才华横溢。", male: { c:"[天赋] 内秀乾坤。学术、艺术、文学。才华内敛，不鸣则已一鸣惊人。喜火暖局，名扬四海。", w:"[被动] 技艺生财。财源细水长流。靠专业技能和名声赚钱，抗风险强。", l:"[羁绊] 灵魂知己。注重精神交流，需要懂你弦外之音的伴侣。", k:"[传承] 聪慧麒麟。孩子继承高智商，温和懂事。", h:"[锦囊] 金水过旺寒气重，务必补火！多做户外运动。" }, female: { c:"[天赋] 气质清流。貌美脱俗，适合文化、教育。与世无争反而赢。", w:"[被动] 福泽深厚。一生衣食无忧，安稳理财。", l:"[羁绊] 寒谷回春。虽食神克官，但金水喜火，故得夫宠。温柔是武器。", k:"[传承] 慈母福荫。疼爱孩子，晚年享福。", h:"[锦囊] 暖局养生。多穿暖色，注意妇科肾脏。" } },
        "木火通明": { name: "🔥 薪火传人", tags: ["SSR","名望"], icon: "🔥", slogan: "木火交辉，光耀千秋。", male: { c:"[天赋] 文昌降世。学者、教授、作家。名声比钱重要。忌金砍木。", w:"[被动] 名利双收。钱是名声的副产品。知识变现。", l:"[羁绊] 灵魂知音。追求精神共鸣，宁缺毋滥。", k:"[传承] 书香门第。孩子文质彬彬。", h:"[锦囊] 注意心血管，少熬夜。多接触大自然。" }, female: { c:"[天赋] 才女下凡。教育、媒体、设计。光芒耀眼，需防嫉妒。", w:"[被动] 清贵。品味极高，从事高雅行业。", l:"[羁绊] 晚婚或不婚。眼光高，不喜受管束。", k:"[传承] 优生优育。孩子有艺术天分。", h:"[锦囊] 护眼养心。少看屏幕，多看绿植。" } },
        "伤官配印": { name: "🔮 智者神启", tags: ["UR","智慧"], icon: "📜", slogan: "烈火烹油，深水静流。", male: { c:"[天赋] 降维打击。智慧与冷静。幕后运筹帷幄。适合学术、参谋。", w:"[被动] 知识付费。忌贪财坏印。赚慢钱大钱。", l:"[羁绊] 灵魂伴侣。伴侣能让你冷静，是救命稻草。", k:"[传承] 书香传承。重视教育，孩子优秀。", h:"[锦囊] 水火既济。注意心火过旺。" }, female: { c:"[天赋] 贵气才女。以柔克刚。教育、文化。备受尊重。", w:"[被动] 养财。适合长线投资，远离投机。", l:"[羁绊] 去官就食。找包容你的暖男，不强求豪门。", k:"[传承] 灵性。孩子善解人意，亲密无间。", h:"[锦囊] 滋阴养颜。多补水，少熬夜。" } },
        "食神制杀": { name: "🦁 铁腕驯兽师", tags: ["SR+","威望"], icon: "🦁", slogan: "力量与规则的完美驾驭。", male: { c:"[天赋] 不怒自威。公检法、技术总监。解决硬核难题。", w:"[被动] 资历加成。越老越值钱。靠手艺吃饭。", l:"[羁绊] 一家之主。家中地位高，责任感强。", k:"[传承] 栋梁之材。孩子规矩懂事。", h:"[锦囊] 防富贵病。三高、脂肪肝。" }, female: { c:"[天赋] 逻辑女王。财务、审计。靠硬实力说话。", w:"[被动] CFO。理财圣手，管钱有道。", l:"[羁绊] 严妻良母。管老公像管孩子，为家好。", k:"[传承] 贴心棉袄。母慈子孝。", h:"[锦囊] 肠胃敏感。注意饮食规律。" } },
        "正官格": { name: "⚖️ 秩序守护者", tags: ["SR","稳健"], icon: "🏛️", slogan: "规则是基石，稳步登顶。", male: { c:"[天赋] 仕途通达。天生皇粮命。体制内、管理层。稳重讲规矩，晋升之路虽慢但稳。你是那种领导最放心的人，从不越界，执行力强。", w:"[被动] 正财稳固。薪水高福利好，旱涝保收。别碰高风险投资（股票、期货），老实拿工资买房收租最适合你。你的财富是随着职级提升而增长的。", l:"[羁绊] 门当户对。妻子贤惠，家庭观念重。婚姻是你的避风港。你希望找一个能和你举案齐眉、相敬如宾的伴侣。家庭稳定是你事业成功的基础。", k:"[传承] 学霸苗子。孩子听话懂事，能继承你的优良家风。你对孩子的教育很传统，注重品德和礼貌。孩子在学校通常是班干部。", h:"[锦囊] 压力内藏。压力藏心里，易导致胃病或脱发。学会释放压力，不要太在意别人的看法。偶尔打破一下规则，会让你更轻松。" }, female: { c:"[天赋] 完美管家。行政、HR、高管助理、教师。做事井井有条，从不出错，老板最放心。你有很强的组织能力和服务意识，是团队的润滑剂。", w:"[被动] 财政部长。善于持家，积少成多。家底在你手里越攒越厚。你不乱花钱，但也绝不亏待自己和家人。由于你的规划，家庭抗风险能力很强。", l:"[羁绊] 旺夫体质。你是丈夫坚强的后盾。婚姻通常令人羡慕。你懂得维护丈夫的面子，也能在关键时刻给出中肯的建议。是标准的贤内助。", k:"[传承] 教子有方。注重品德培养，孩子有教养懂礼貌。你对孩子的爱是温柔而有原则的。", h:"[锦囊] 久坐伤身。注意久坐导致的腰椎、颈椎问题。多做拉伸运动。不要太操心，儿孙自有儿孙福。" } },
        "正印格": { name: "📜 圣贤导师", tags: ["SR","名望"], icon: "🙏", slogan: "但行好事，莫问前程。", male: { c:"[天赋] 贵人扶持。适合文教、慈善、出版、咨询。上面有人罩，晋升不用愁。工作清闲福利好。你不需要去勾心斗角，自然会有机会落到你头上。你是团队的精神领袖。", w:"[被动] 清贵之财。名声换钱。不适合做生意，易心软被骗。靠社会地位获利。你的钱是“躺赚”的，比如房租、版税、分红。", l:"[羁绊] 依赖型。有点妈宝倾向，喜欢成熟会照顾人的女性。婚姻平顺。你习惯了被照顾，在感情中比较被动。", k:"[传承] 知书达理。家庭传统氛围浓，孩子孝顺。你对孩子的教育是宽松的，注重品德而非分数。", h:"[锦囊] 心宽体胖。心宽体胖，易缺乏运动。注意三高和肥胖问题。多动动，别太懒了。" }, female: { c:"[天赋] 岁月静好。老师、图书管理员、公益人士。无野心，不喜竞争。追求安稳舒适。你的心态极好，知足常乐。", w:"[被动] 天生好命。长辈给的多，老公给的多。一生有人为你买单。你可能不是大富婆，但绝对不缺钱花。", l:"[羁绊] 受宠。嫁得好，一生被照顾。像温室里的花朵。你的婚姻通常是长辈撮合或门当户对，波折很少。", k:"[传承] 佛系育儿。顺其自然，孩子性格温和。你不会给孩子太大压力，亲子关系和谐。", h:"[锦囊] 代谢慢。太安逸导致代谢慢。多运动排湿。注意脾胃虚弱，少吃甜食。" } },
        "正财格": { name: "🐜 勤勉筑梦师", tags: ["R+","积累"], icon: "🧱", slogan: "一砖一瓦，聚沙成塔。", male: { c:"[天赋] 实干家。金融、实业、制造。勤劳致富典范，不信一夜暴富。相信努力就有回报。你是老板最喜欢的员工，踏实肯干。", w:"[被动] 复利效应。典型的富一代。积少成多，晚年富足。每一分钱都是汗水换来的。你不乱花钱，每一笔开支都有计划。", l:"[羁绊] 宠妻狂魔。工资上交，老婆掌权。觉得听老婆话才会有出息。你对家庭非常负责，是标准的模范丈夫。", k:"[传承] 朴实家风。子女规矩，继承勤劳家风。你会教导孩子节约和努力。", h:"[锦囊] 过度劳累。过度劳累，职业病。注意休息。别为了省钱而透支身体。" }, female: { c:"[天赋] 精细化。会计、银行、数据分析。工作细致，对细节把控无人能及。你适合处理繁琐、需要耐心的工作。", w:"[被动] 存钱罐。精打细算，看着余额增长最快乐。砍价高手。你是家里的CFO，把每一分钱都花在刀刃上。", l:"[羁绊] 贤惠。把家打理井井有条。生活略平淡，需制造浪漫。你是那种能把日子过得红红火火的女人。", k:"[传承] 包办。照顾无微不至，导致孩子自理能力弱。学会放手，让孩子自己成长。", h:"[锦囊] 气血不足。有点宅，不爱动。多吃红枣枸杞。注意气血不足的问题。" } },
        "偏财格": { name: "🎩 商业大亨", tags: ["SSR","横财"], icon: "💎", slogan: "钱是赚出来的，不是省出来的。", male: { c:"[天赋] 资源整合。经商、市场、贸易。善交际，四海皆兄弟。眼光独到，发现别人忽略的商机。你适合做生意，不适合坐办公室。", w:"[被动] 横财运。易中奖或投资获利。但也手松，财来财去。赚了钱马上买房，否则留不住。你的钱是用来生钱的。", l:"[羁绊] 桃花劫。风趣幽默，出手大方，太讨女人喜欢。需防后院起火。你的感情经历丰富，但真爱难寻。", k:"[传承] 哥们。跟孩子像朋友。看重情商培养。你会带孩子见世面，培养他的社交能力。", h:"[锦囊] 应酬伤身。应酬多，伤肝肾。少喝酒多喝茶。定期体检，注意脂肪肝。" }, female: { c:"[天赋] 长袖善舞。商务、公关、销售。名利场游刃有余。赚钱能力不输男人。你懂得如何利用女性优势获取资源。", w:"[被动] 奢靡。能赚会花，喜欢奢侈品。财运比老公好，经常贴补家用。你喜欢享受生活，觉得赚钱就是为了花。", l:"[羁绊] 择优。喜欢有钱有势的男人。婚姻晚成，一直在筛选绩优股。你很现实，但也清楚自己想要什么。", k:"[传承] 贵族范。给孩子最好条件，培养贵族气质。你会送孩子去最好的学校。", h:"[锦囊] 富贵病。注意富贵病，少吃油腻。多运动，保持身材。" } },
        "七杀格": { name: "🚀 孤胆英雄", tags: ["SSR","开创"], icon: "🔥", slogan: "人生就是一场无限的战斗。", male: { c:"[天赋] 开疆拓土。天生的创业者或销售冠军。平淡工作会让你发疯，只有挑战才能激发潜能。你适合去新市场、新领域开荒。你的执行力和魄力无人能及，是乱世中的枭雄。", w:"[被动] 险中求财。大起大落是常态。敢梭哈，有机会暴富，也容易暴负。赚到钱必须强制买固定资产留后路，防止一夜回到解放前。你的财运是波动向上的。", l:"[羁绊] 烈火情人。脾气爆，喜欢性感的女性。家里经常上演全武行，但床头吵架床尾和。你的感情生活充满了激情和戏剧性，平淡的日子你反而过不下去。", k:"[传承] 棍棒教育。对孩子太严厉。多展现温柔一面，孩子其实渴望父爱。不要把工作中的杀伐之气带回家。", h:"[锦囊] 外伤风险。易有外伤疤痕。开车慢点，少喝酒。注意肝胆健康。多做慈善，化解身上的煞气。" }, female: { c:"[天赋] 不让须眉。女老板、业务一姐。在男人堆里抢饭吃毫无惧色。执行力超强。你比男人更狠、更决断。适合从事高压、高强度的职业。", w:"[被动] 流水如注。赚钱机器，花钱如流水。需要懂理财的伙伴帮你打理。你对金钱没有太大的概念，只享受赚钱的快感。", l:"[羁绊] 霸总收割机。容易吸引霸道总裁或渣男。感情像过山车一样刺激。你喜欢的男人必须比你强，能征服你。但这种男人往往不好驾驭。", k:"[传承] 超人妈妈。既当爹又当妈，孩子是你坚持下去的最大动力。你会为了孩子变得无比坚强。", h:"[锦囊] 肝火旺。少生气，生气长结节。多做冥想，平复内心的燥气。注意乳腺和甲状腺健康。" } },
        "伤官格": { name: "🎭 孤傲艺术家", tags: ["SR","自由"], icon: "🎭", slogan: "我不是为了迎合世界而生。", male: { c:"[天赋] 创新灵魂。你天生就是规则的破坏者和新世界的创造者。传统的朝九晚五会让你窒息，你适合设计、艺术、演艺、自由职业等需要极强个人色彩的领域。你的才华是你的通行证，但你的傲气也是你的绊脚石。学会适度低头，不是认输，而是为了跳得更高。", w:"[被动] 技能变现。你不喜求人，也不屑于搞复杂的人际关系。你的财富来自于你的不可替代性。一单吃三年是常态，但也容易三年不开张。建议在收入高峰期强制储蓄，购买固定资产，为你的创作自由提供物质保障。", l:"[羁绊] 不羁之风。婚姻对你来说是束缚多于甜蜜。晚婚或不婚的概率较高。你需要一个能给你极大自由空间、不干涉你精神世界的伴侣。如果你觉得对方庸俗，这段关系就走到头了。", k:"[传承] 精神代沟。你与孩子的关系更像是朋友，而不是传统的父子。你更在乎精神层面的交流，可能会忽视生活上的照顾。孩子会觉得你很酷，但也可能会觉得你不够负责。", h:"[锦囊] 情绪化。情绪化严重，容易抑郁或狂躁。注意心理健康，多冥想。你的身体就像晴雨表，心情不好时身体立刻会出问题。" }, female: { c:"[天赋] 灵气逼人。极具艺术天分和审美能力。适合演艺、写作、设计、时尚。受不了枯燥重复的工作，必须做自己喜欢的事才能发光。你的直觉很准，有时候逻辑解释不通的事情，你的直觉能给你答案。", w:"[被动] 随性而富。开心就赚，不开心就躺。对金钱看得不重，但往往不缺小钱。你的钱大多花在了提升生活品质和个人爱好上。如果不善理财，建议找个靠谱的合伙人或管家。", l:"[羁绊] 克夫之叹。伤官太旺，对伴侣挑剔、毒舌。你容易看到对方的缺点并无限放大。需要找宽容度极高、性格温和、甚至有点“受虐”倾向的人。或者找年龄差距大的伴侣。", k:"[传承] 生命羁绊。孩子是你的一切，可能是你在这个世界上唯一的软肋。你会倾尽所有给孩子最好的，但要注意不要产生控制欲。", h:"[锦囊] 气郁。气血不通，多运动，释放多余的能量。注意甲状腺和乳腺健康，多做瑜伽疏通经络。" } },
        "食神格": { name: "🎨 逍遥散人", tags: ["SR","福气"], icon: "🎐", slogan: "人间不值得，但美食值得。", male: { c:"[天赋] 灵感源泉。艺术、餐饮、设计。才华横溢但不爱卷。灵感在玩乐中产生。你适合轻松、自由的工作环境。", w:"[被动] 躺赢。细水长流，一辈子不缺钱。总有贵人送钱，傻人有傻福。你的财运是“碰”出来的，不是“求”出来的。", l:"[羁绊] 暖男。懂疼老婆，会做饭。婚姻生活平淡温馨，令人羡慕。你没什么脾气，凡事好商量。", k:"[传承] 福星。晚年享子女福，孩子性格讨喜。你和孩子的关系非常融洽。", h:"[锦囊] 肥胖。心宽体胖，贪吃导致三高。动起来！注意控制饮食，多吃蔬菜。" }, female: { c:"[天赋] 亲和力。幼师、美食博主、服务业。不争不抢，人缘极好。工作环境单纯。大家都很喜欢和你相处。", w:"[被动] 小确幸。不计较钱，钱反而来找你。有不少私房钱。你容易满足，幸福感很高。", l:"[羁绊] 仪式感。有点作，注重浪漫。希望对方懂你的情趣。你需要一个能陪你吃喝玩乐的伴侣。", k:"[传承] 慈母。孩子是命根子，极其宠爱。孩子幸福感强。你可能会溺爱孩子。", h:"[锦囊] 懒惰。太懒了，缺乏运动。多去户外走走。注意消化系统健康。" } },
        "建禄格": { name: "🏰 独立领主", tags: ["SR","自立"], icon: "🗿", slogan: "我的领土，我说了算。", male: { c:"[天赋] 中流砥柱。技术总监、合伙人、区域经理。适合带队冲锋。你很难给别人打工一辈子，迟早要自己单干。你的执行力超强，是那种“说到做到”的实干家。", w:"[被动] 血汗筑基。你的每一分都是汗水换来的，没有侥幸。身旺任财，中晚年大富。但也容易被劫财（朋友借钱不还、合伙人坑钱）。最好的守财方式是把现金变成固定资产。", l:"[羁绊] 大男子主义。易克妻，因为你太强势了。需找温柔听话、能包容你的老婆。你在家里说一不二，希望对方完全服从你的安排。多听听伴侣的意见，会让家庭更和睦。", k:"[传承] 放养模式。孩子独立性强，将来可能不在身边发展。你对孩子的教育比较粗放，认为“儿孙自有儿孙福”。", h:"[锦囊] 透支。身体壮如牛，精力旺盛。但容易透支，注意运动过量导致的关节损伤。少熬夜，你的恢复能力虽然强，但也不是无限的。" }, female: { c:"[天赋] 不靠男人。比男人还拼的女强人。创业者或企业高管。不喜欢依赖别人，信奉“自己动手丰衣足食”。在职场上，你往往比男同事更有竞争力。", w:"[被动] 漏斗效应。赚钱猛守财难。容易因为义气或者冲动消费而破财。易被借钱不还。需找人打理财务，或者设定强制储蓄计划。", l:"[羁绊] 强势夺理。易遇第三者或老公能力弱。太强势让男人有压力，甚至想逃离。学会示弱，不是认输，而是为了经营感情。偶尔撒个娇，会有意想不到的效果。", k:"[传承] 健康基因。利生育，孩子身体健康，活泼好动，适应能力强。你是个能干的妈妈，但也别忘了给孩子一点温柔的陪伴。", h:"[锦囊] 上火。火气大，容易上火。注意甲状腺和内分泌系统。少吃辛辣刺激食物，多喝水。" } },
        "月劫格": { name: "⚔️ 豪侠义士", tags: ["SR","义气"], icon: "🤜", slogan: "路见不平一声吼。", male: { c:"[天赋] 团队领袖。善于聚集人气，适合做团队Leader、公会会长、带头大哥。但要防备手下或合伙人背刺。你的成功往往来自于兄弟朋友的帮衬，失败也往往因为被朋友拖累。用人要疑，疑人要用。", w:"[被动] 散财童子。对朋友大方，存不住钱。最好的存钱方式是买房或交给老婆管。不适合合伙做生意，因为容易因财失义。你的钱就像流沙，握得越紧流得越快。", l:"[羁绊] 克妻争夺。比劫夺财，感情容易有竞争者。晚婚为宜。你需要一个能包容你“讲义气”的伴侣，或者找一个同样豪爽的女性。避免把朋友看得比老婆重。", k:"[传承] 野蛮生长。孩子身体好，但不一定听话。教育上要多花心思，防止孩子染上不良习气。多进行户外亲子活动。", h:"[锦囊] 冲动。性格冲动，易与人起冲突。注意交通安全和运动伤害。凡事三思而后行，冲动是魔鬼。" }, female: { c:"[天赋] 女中豪杰。性格直爽，不让须眉。在职场上敢打敢拼，适合竞争激烈的行业，如销售、保险、竞技体育。你的抗压能力极强，越挫越勇。", w:"[被动] 月光族。喜欢购物，容易冲动消费。需强制储蓄。你的钱往往花在面子和朋友身上。建议把信用卡注销，只用现金。", l:"[羁绊] 争夫之象。感情路坎坷，容易遇到渣男或三角恋。要擦亮眼睛，不要被花言巧语蒙蔽。不要太快投入一段感情，多考察对方的人品。", k:"[传承] 独立自强。带孩子不娇气，培养孩子独立性。你和孩子的关系像朋友，能玩到一块去。", h:"[锦囊] 呼吸道。注意肺部和呼吸系统健康。少抽烟，少生气。多做深呼吸，练习瑜伽调节气息。" } },
        "伤官生财": { name: "💸 炼金术士", tags: ["SSR","高收益"], icon: "⚗️", slogan: "万物皆可交易。", male: { c:"[天赋] 点石成金。千万别去打死工！你是**创业、创意、营销**的天才。你的脑子就是印钞机，总能发现别人看不到的商机。适合科技、媒体、电商等轻资产行业。你的核心竞争力是“变废为宝”。", w:"[被动] 现金流。钱对你来说是流动的工具。赚钱快，花钱也快。你的财富在于**“周转”**。建议把赚到的虚钱及时置换成房产、黄金等实物，防止“财来财去一场空”。", l:"[羁绊] 颜控。你喜欢漂亮、时尚、带出去有面子的伴侣。但你脾气有点急躁，容易忽略对方感受。需要一个能包容你、或者能陪你一起疯的伴侣。", k:"[传承] 自由灵魂。子女可能早早出国或去外地发展，与你缘分略淡，但你提供的物质支持非常到位。彼此独立，互不干扰。", h:"[锦囊] 烧脑。思虑过重，容易失眠、脱发、神经衰弱。睡前必须强制自己“关机”。" }, female: { c:"[天赋] 超级带货。才华横溢，**自媒体、主播、自由撰稿人**。你的表达能力和感染力是核武器。只要你开口，就没有卖不出去的东西。坚持走技术、专才路线。", w:"[被动] 购物狂。赚钱是你能力的证明，花钱是你解压的方式。必须强制储蓄，或者买保险、信托。做一个快乐的“守财奴”是你晚年幸福的保障。", l:"[羁绊] 挑剔眼光。眼光毒辣，嫌弃老公穷、笨、没品位。这容易导致婚姻波折。建议找成熟稳重的“大叔型”伴侣，或者晚婚。", k:"[传承] 溺爱。孩子是你的软肋，也是你奋斗的动力。注意别把孩子宠坏了。", h:"[锦囊] 气郁。注意甲状腺、乳腺问题。多去旅游，换个环境能治百病。" } },
        "食神生财": { name: "🎨 逍遥财主", tags: ["SR","安稳"], icon: "🎐", slogan: "快乐是第一生产力。", male: { c:"[天赋] 才华变现。你和伤官生财不同，你不需要那种剑拔弩张的竞争。你适合**餐饮、艺术、设计、服务业**。你的亲和力和好脾气是你最大的资本。你做事讲究顺其自然，往往“无心插柳柳成荫”。你不是工作狂，但你总能找到轻松赚钱的方法。", w:"[被动] 细水长流。你的财运是涓涓细流，源源不断。虽然很难一夜暴富，但胜在稳定长久。你的钱往往是靠“口碑”赚来的。你是一辈子不缺钱花的人，总有贵人送钱上门。你的消费观比较理性，懂得享受生活但也留有余地。", l:"[羁绊] 温馨日常。你是个暖男，懂得心疼老婆，甚至做得一手好菜。你的婚姻生活平淡而温馨，没有太多的狗血剧情。你喜欢那种能和你一起享受生活的伴侣。家庭的和谐是你最大的追求。", k:"[传承] 福星高照。你的孩子性格多半随你，温和懂事，讨人喜欢。晚年你能享子女的福。你对孩子的教育比较宽松，不强求分数，更看重孩子的快乐和品德。", h:"[锦囊] 心宽体胖。心宽体胖是你的特征，要注意控制体重，防止三高。多做一些温和的运动，如散步、太极。保持好心情就是最好的养生，但也要注意节制饮食。" }, female: { c:"[天赋] 生活美学。你对美有独特的感知力，适合从事**美容、美食、幼教、生活博主**等行业。你的工作通常比较轻松愉快，人际关系简单。大家都很喜欢和你相处，因为你让人感到舒服。你是朋友圈里的“种草机”。", w:"[被动] 小确幸。你不计较钱，钱反而来找你。你可能没有太大的野心，但总能存下不少私房钱。你的幸福感很高，不被物质所累。你的财运往往来自你的兴趣爱好，比如烘焙、插花、手作等。", l:"[羁绊] 浪漫情怀。你有点小资情调，注重仪式感。希望对方懂你的情趣，能陪你吃喝玩乐。你适合找一个经济条件不错、能宠着你的丈夫。你的婚姻通常比较幸福，因为你懂得撒娇和示弱。", k:"[传承] 慈母典范。孩子是你的命根子，你对孩子极其宠爱，甚至有点溺爱。孩子在你的呵护下会非常有安全感，幸福指数很高。但要注意不要让孩子变成“妈宝”。", h:"[锦囊] 太懒。太懒了是你最大的敌人，缺乏运动会导致亚健康。多去户外走走，呼吸新鲜空气。注意消化系统的保养，少吃甜食，多喝水排毒。" } },
        "伤官合杀": { name: "⚡ 危机终结者", tags: ["SSR","爆发"], icon: "🗡️", slogan: "混乱是阶梯。", male: { c:"[天赋] 乱世枭雄。你天生自带反骨，不适合呆板的体制和按部就班的工作。你的主场在**危机公关、律师辩护、特种顾问、黑白通吃的中介**。越是混乱、高压、没人敢接的盘，越能激发你的S级潜能。别怕麻烦，麻烦就是你的经验包和晋升阶梯。", w:"[被动] 掠夺者。你的财富不靠积攒，靠**“狩猎”**。利用信息差、技术壁垒或胆识进行降维打击。爆发力极强，可能三年不开张，开张吃三年。建议配置“固定资产”护盾，防止财富流失过快。", l:"[羁绊] 相爱相杀。你看不上傻白甜，只有带点刺、有手段的女性才能激起你的征服欲。你的婚姻是一场**“高智商博弈”**，虽然吵吵闹闹，但彼此灵魂深度契合。控制欲别太强，给对方一点呼吸空间。", k:"[传承] 叛逆天才。你的后代大概率遗传了你的高智商和叛逆。别用“听话”来要求他，那是扼杀天才。引导他去搞科研、艺术或竞技，他会成为你的骄傲。", h:"[锦囊] 过载。大脑常年高速运转，容易神经衰弱。注意头部、眼部保养，以及激进运动带来的外伤风险。" }, female: { c:"[天赋] 女王气场。职场上的**“铁娘子”**。公关总监、操盘手、甚至创业领袖。你能搞定最难缠的客户，甚至让男人们敬畏三分。你的武器是犀利的言辞和雷厉风行的手段。你适合在男人堆里厮杀，并取得胜利。", w:"[被动] 名气变现。名气越大，财运越旺。适合经营个人品牌，或者利用圈层影响力进行资源置换变现。你适合做一个快乐的“守财奴”，把赚来的钱变成不动产，构建安全感壁垒。", l:"[羁绊] 慕强心理。你欣赏**“爹系”**硬汉或行业大佬。普通男人入不了你的眼。婚后你是家里的主心骨，但也容易因为太强势而让对方有压力。学会在家“卸甲”，能让感情升温。", k:"[传承] 精英教育。你对孩子投入极大，期望极高。孩子往往有特殊才艺。注意不要把你的焦虑投射给孩子。", h:"[锦囊] 内耗。情绪波动大，容易导致内分泌失调或妇科问题。适度医美，多做瑜伽，保持身心平衡。" } },
        "杀印相生": { name: "👑 权柄执掌者", tags: ["SSR","权威"], icon: "⚔️", slogan: "以德服人，以力服人。", male: { c:"[天赋] 御人有术。七杀攻身本凶，幸有印星化解，这叫“化敌为友”。你天生适合做**高管、军警、法官、企业主**。你既有七杀的魄力，又有印星的仁慈，恩威并施，下属对你既敬又畏。你善于在复杂的环境中生存，并能从危机中找到机会。你的领导力是天生的。", w:"[被动] 权中取利。你的财富来自于你的权力或影响力。职位越高，财运越旺。不要盯着小钱，要去争取更大的平台和话语权。你的财运是“正财”为主，可能有灰色收入，但只要印星有力，通常能逢凶化吉。", l:"[羁绊] 贤内助。你需要一个能帮你打理后方、让你无后顾之忧的伴侣。你的妻子通常比较贤惠，能包容你的忙碌和脾气。你对家庭是有责任感的，但你的重心往往在事业上。", k:"[传承] 显贵门庭。子女多半有出息，能继承你的事业或名望。你对孩子的教育非常严格，希望他们成为人中龙凤。孩子通常会比较敬畏你。", h:"[锦囊] 劳逸结合。注意劳逸结合，不要过度操劳。你的精神压力通常比较大，要学会放松。多喝茶，少喝酒，保持头脑清醒。注意心脑血管健康。" }, female: { c:"[天赋] 女皇范。气场强大，不怒自威。在职场上，你比男人更有决断力。适合做管理者，能镇得住场子。你不喜欢做琐碎的工作，更喜欢做决策。你的职业生涯通常会步步高升，成为行业内的权威。", w:"[被动] 正财旺盛。你的财运很稳，随着地位提升而增长。适合购买不动产，积累家业。你对金钱的掌控欲很强，不乱花钱，每一分钱都要花在有价值的地方。", l:"[羁绊] 贵夫之象。夫星得力，丈夫通常是有头有脸的人物。虽然你性格强势，但能帮夫运，是丈夫的得力助手。你们是典型的“强强联合”。不过要注意给丈夫留面子，不要在公开场合压他一头。", k:"[传承] 严母教子。对孩子要求严格，注重家教。孩子将来多半是社会精英，有很好的教养。你对孩子的爱是深沉而严肃的。", h:"[锦囊] 刚硬。注意乳腺和肝胆健康。少生气，多做瑜伽放松心情。你的身体需要柔和的运动来调节刚硬的气场。" } },
        "五行流通": { name: "☯️ 太极宗师", tags: ["SSR","全能"], icon: "🧘", slogan: "刚不可久，柔不可守。", male: { c:"[天赋] 六边形战士。你没有短板，是天生的**“版本之子”**。职场中的万金油，适合综合管理、统筹、协调。你像水一样适应任何容器。在动荡的经济周期中，别人在裸泳，而你能稳坐钓鱼台。你的生存能力S级，无论环境如何变化，你总能找到自己的位置。", w:"[被动] 稳如泰山。虽然没有一夜暴富的剧本，但也没有破产的风险。你的财富像滚雪球，抗风险能力极强。你是朋友圈里最“稳”的那个隐形富豪。你的资产配置非常合理，不偏激。", l:"[羁绊] 细水长流。你的婚姻没有狗血剧，只有温馨的日常。你是最适合过日子的伴侣，能提供极高的情绪价值和安全感。你的伴侣通常也是性格温和、通情达理的人。", k:"[传承] 孝顺。孩子身心健康，三观正。虽未必惊天动地，但能陪在你身边尽孝，这是最大的福气。你的家庭氛围非常和谐。", h:"[锦囊] 长寿。五行流通，百病不生。只要不作死，你大概率能活过99%的同龄人。保持现在的节奏，不要被别人的焦虑影响。" }, female: { c:"[天赋] 以柔克刚。文员、后勤、体制内。你不求大富大贵，只求工作顺心。你的心态是你最大的财富，让你在任何环境中都能游刃有余。你是那种“不争而争”的智慧女性。", w:"[被动] 无忧。不缺零花钱，总有父母或丈夫为你提供物质保障。生活滋润，岁月静好。你是天生的“福将”，总能逢凶化吉。", l:"[羁绊] 贤内助。家庭和睦，你是家里的调味剂。懂得经营生活，把家变得温馨舒适，旺夫旺家。你的丈夫会非常依赖你。", k:"[传承] 陪伴。花很多时间陪孩子，亲子关系极佳。孩子性格好，情商高。你教会孩子的是如何幸福地生活。", h:"[锦囊] 养生。没啥大毛病，很会照顾自己。懂得以食补身，容颜不老。继续保持这种乐观平和的心态。" } },
        "杂格": { name: "🌱 潜龙勿用", tags: ["N","潜力"], icon: "🌱", slogan: "时运未到，潜心修炼。", male: { c:"[天赋] 多面手。你可能没有特别突出的单一强项，但胜在综合能力不错。适合在中小企业做全能型人才。", w:"[被动] 勤劳致富。没有暴富的命，只有勤劳的手。多劳多得。", l:"[羁绊] 平淡是真。婚姻生活波澜不惊。", k:"[传承] 普通。孩子资质平平，健康就好。", h:"[锦囊] 锻炼。身体是革命的本钱。" }, female: { c:"[天赋] 踏实。适合做后勤、辅助类工作。", w:"[被动] 节俭。持家有道。", l:"[羁绊] 依靠。找个老实人嫁了。", k:"[传承] 平安。孩子平安长大。", h:"[锦囊] 睡眠。保持充足睡眠。" } }
    };

    // --- 初始化 ---
    window.onload = function() {
        try {
            const now = new Date();
            const str = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('birth-input').value = str;
        } catch(e){}
    };

    function setGender(val, el) {
        currentGender = val;
        document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    // --- 核心算法 ---
    function startScan() {
        const timeStr = document.getElementById('birth-input').value;
        if (!timeStr) return alert("请选择出生时间");
        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const bazi = lunar.getEightChar();
            bazi.setSect(2);

            const yg=bazi.getYearGan().toString(), yz=bazi.getYearZhi().toString();
            const mg=bazi.getMonthGan().toString(), mz=bazi.getMonthZhi().toString();
            const dg=bazi.getDayGan().toString(), dz=bazi.getDayZhi().toString();
            const hg=bazi.getTimeGan().toString(), hz=bazi.getTimeZhi().toString();

            const pillars = [{t:'年柱',g:yg,z:yz},{t:'月柱',g:mg,z:mz},{t:'日柱',g:dg,z:dz},{t:'时柱',g:hg,z:hz}];

            renderPillars(pillars, dg);
            const cmdInfo = calcCommander(lunar, mz);
            const climate = analyzeClimate(dg, mz, pillars);
            const patternKey = determinePattern(climate, pillars, dg, mz, cmdInfo);
            renderResult(patternKey, cmdInfo, dg, climate);
            drawArt(pillars);
            
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
        } catch (e) { console.error(e); alert("计算错误: "+e.message); }
    }

    function renderPillars(pillars, dm) {
        let html = '';
        pillars.forEach(p => {
            const god = p.t.includes('日柱') ? '日主' : (SHISHEN_MAP[dm][p.g] || "");
            const cs = CHANGSHENG_TABLE[p.g][p.z] || "";
            const gWx = WUXING_MAP[p.g], zWx = WUXING_MAP[p.z];
            html += `<div class="col"><div class="c-head">${p.t}</div><div class="c-god">${god}</div><div class="c-char ${WX_COLOR[gWx]}">${p.g}</div><div class="c-char ${WX_COLOR[zWx]}">${p.z}</div><span class="c-cs">${cs}</span></div>`;
        });
        document.getElementById('pillars-box').innerHTML = html;
    }

    // 司令计算 (亥月前7日为戊土)
    function calcCommander(lunar, monthZhi) {
        const prevJie = lunar.getPrevJie();
        const pjSolar = prevJie.getSolar();
        const jieTime = new Date(pjSolar.getYear(), pjSolar.getMonth()-1, pjSolar.getDay(), pjSolar.getHour(), pjSolar.getMinute()).getTime();
        const birthTime = new Date(lunar.getSolar().getYear(), lunar.getSolar().getMonth()-1, lunar.getSolar().getDay(), lunar.getSolar().getHour(), lunar.getSolar().getMinute()).getTime();
        const diffDays = Math.floor((birthTime - jieTime) / (1000 * 60 * 60 * 24));
        
        const rules = SILING_RULES[monthZhi] || [];
        let commander = rules[rules.length-1][0]; 
        let daysSum = 0;
        for (let rule of rules) {
            daysSum += rule[1];
            if (diffDays < daysSum) { commander = rule[0]; break; }
        }
        return { commander, diffDays };
    }

    // 通根检查
    function hasRoot(gan, pillars) {
        const roots = ROOT_MAP[gan] || [];
        for(let p of pillars) {
            if (roots.includes(p.z)) return true;
        }
        return false;
    }

    function analyzeClimate(dm, mz, pillars) {
        const dmWx = WUXING_MAP[dm];
        const season = ["亥","子","丑"].includes(mz) ? "冬" : ["巳","午","未"].includes(mz) ? "夏" : "平";
        let hasFire = pillars.some(p => WUXING_MAP[p.g] === '火' || WUXING_MAP[p.z] === '火');
        let hasWater = pillars.some(p => WUXING_MAP[p.g] === '水' || WUXING_MAP[p.z] === '水');

        if (dmWx === '土' && season === '冬') return { special: null, advice: "水冷土冻，非丙火不可救！" };
        if (dmWx === '金' && season === '冬') {
            const hasShangGuan = pillars.some(p => SHISHEN_MAP[dm][p.g] === '伤官');
            return { special: hasShangGuan ? "金水伤官" : "金水食神" };
        }
        if (dmWx === '木' && ["寅","卯"].includes(mz) && hasFire) return { special: "木火通明" };
        if (dmWx === '木' && season === '夏' && hasWater) return { special: "伤官配印" };
        return { special: null };
    }

    function determinePattern(climate, pillars, dm, mz, cmdInfo) {
        if (climate.special) return climate.special;

        const godMap = {}; 
        pillars.forEach((p, i) => { if(i!==2) godMap[i] = SHISHEN_MAP[dm][p.g]; });
        const stems = [pillars[0].g, pillars[1].g, pillars[3].g];

        // 1. 真神透干优先
        if (stems.includes(cmdInfo.commander)) {
            const god = SHISHEN_MAP[dm][cmdInfo.commander];
            // 透财 -> 查食伤生财 (必须有根)
            if (god === '正财' || god === '偏财') {
                for(let i of [0,1,3]) {
                    const g = SHISHEN_MAP[dm][pillars[i].g];
                    if ((g === '食神' || g === '伤官') && hasRoot(pillars[i].g, pillars)) {
                        return g === '食神' ? '食神生财' : '伤官生财';
                    }
                }
            }
            // 透杀 -> 查制化
            if (god === '七杀') {
                for(let i of [0,1,3]) {
                    const g = SHISHEN_MAP[dm][pillars[i].g];
                    if (g === '食神' && hasRoot(pillars[i].g, pillars)) return '食神制杀';
                    if (g === '伤官') return '伤官合杀';
                    if (g === '正印' || g === '偏印') return '杀印相生';
                }
            }
        }

        // 2. 有杀先论杀 (无论是否透真神)
        if (Object.values(godMap).includes("七杀")) {
             for(let i of [0,1,3]) {
                const g = SHISHEN_MAP[dm][pillars[i].g];
                if (g === '食神' && hasRoot(pillars[i].g, pillars)) return '食神制杀';
                if (g === '正印' || g === '偏印') return '杀印相生';
             }
             return '七杀格';
        }

        // 3. 伤官/食神 (需通根)
        if (Object.values(godMap).includes("伤官")) {
             let sgGan = null;
             for(let i of [0,1,3]) if (SHISHEN_MAP[dm][pillars[i].g] === '伤官') sgGan = pillars[i].g;
             if (sgGan && !hasRoot(sgGan, pillars)) {
                 if (Object.values(godMap).includes("正财")) return "正财格";
                 if (Object.values(godMap).includes("偏财")) return "偏财格";
             } else {
                 if (Object.values(godMap).some(g=>g.includes('财'))) return "伤官生财";
                 return "伤官格";
             }
        }

        // 4. 常规取格
        const mainGod = SHISHEN_MAP[dm][ZHI_MAIN_QI[mz]];
        const map = {
            "比肩":"建禄格", "劫财":"月劫格", "食神":"食神格", 
            "伤官":"伤官格", "正财":"正财格", "偏财":"偏财格", 
            "正官":"正官格", "七杀":"七杀格", "正印":"正印格", "偏印":"偏印格"
        };
        return map[mainGod] || "五行流通";
    }

    function renderResult(key, cmdInfo, dm, climate) {
        if(!GAME_DB[key]) key = "五行流通";
        const data = GAME_DB[key];
        const detail = data[currentGender === 1 ? 'male' : 'female'];

        document.getElementById('role-icon').innerText = data.icon;
        document.getElementById('role-name').innerText = data.name;
        document.getElementById('role-slogan').innerText = data.slogan;
        
        let tagsHtml = `<span class="tag logic">[${key}]</span>`;
        data.tags.forEach(t => tagsHtml += `<span class="tag ssr">${t}</span>`);
        document.getElementById('role-tags').innerHTML = tagsHtml;

        const cmdGod = SHISHEN_MAP[dm][cmdInfo.commander];
        document.getElementById('siling-text').innerText = `当令真神：${cmdInfo.commander} (${cmdGod}) · 执政第 ${cmdInfo.diffDays} 天`;

        let xiji = XIJI_RULES[key];
        let reason = xiji.desc;
        if (climate.advice) reason += " <br><span style='color:#ff4757'>⚠️ " + climate.advice + "</span>";

        document.getElementById('pattern-reason').innerHTML = reason;
        document.getElementById('txt-joy').innerText = xiji.joy.join(" ");
        document.getElementById('txt-taboo').innerText = xiji.taboo.join(" ");

        const guideHtml = `
            <div class="guide-item"><div class="guide-title">⚔️ 事业与成就</div><div class="guide-text">${detail.c}</div></div>
            <div class="guide-item"><div class="guide-title">💰 财富与资产</div><div class="guide-text">${detail.w}</div></div>
            <div class="guide-item"><div class="guide-title">💞 情感与婚姻</div><div class="guide-text">${detail.l}</div></div>
            <div class="guide-item"><div class="guide-title">🌱 后代与传承</div><div class="guide-text">${detail.k}</div></div>
            <div class="guide-item"><div class="guide-title">❤️ 健康与状态</div><div class="guide-text">${detail.h}</div></div>
        `;
        document.getElementById('guide-content').innerHTML = guideHtml;
    }

    function drawArt(pillars) {
        const canvas = document.getElementById('energy-canvas');
        const ctx = canvas.getContext('2d');
        const w = canvas.parentElement.offsetWidth, h = canvas.parentElement.offsetHeight;
        canvas.width = w; canvas.height = h;

        const counts = {'金':0,'木':0,'水':0,'火':0,'土':0};
        pillars.forEach(p => { counts[WUXING_MAP[p.g]]++; counts[WUXING_MAP[p.z]]++; });
        
        ctx.fillStyle = "#1e1e24"; ctx.fillRect(0,0,w,h);
        const colors = {"金":"#ffeaa7", "木":"#55efc4", "水":"#74b9ff", "火":"#ff7675", "土":"#a29bfe"};
        const keys = Object.keys(counts);
        const cx = w/2, cy = h/2, r = 60;
        
        ctx.strokeStyle = "#444";
        for(let j=1; j<=3; j++) {
            ctx.beginPath();
            for(let i=0; i<5; i++) {
                const a = (Math.PI*2/5)*i - Math.PI/2;
                const x = cx + Math.cos(a)*r*(j/3);
                const y = cy + Math.sin(a)*r*(j/3);
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.closePath(); ctx.stroke();
        }

        ctx.fillStyle = "rgba(8, 217, 214, 0.2)"; ctx.strokeStyle = "#08d9d6"; ctx.lineWidth = 2;
        ctx.beginPath();
        keys.forEach((k, i) => {
            const v = counts[k];
            const a = (Math.PI*2/5)*i - Math.PI/2;
            const l = (v/8)*r*3; 
            const x = cx + Math.cos(a)*l, y = cy + Math.sin(a)*l;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            
            ctx.fillStyle = colors[k]; ctx.font = "12px Arial";
            ctx.fillText(k, cx + Math.cos(a)*(r+20)-5, cy + Math.sin(a)*(r+20)+5);
        });
        ctx.closePath(); ctx.fill(); ctx.stroke();
    }
</script>
</body>
</html>
