<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‘½è¿é»‘ç›’ Pro Max (æ·±åº¦ä¿®å¤ç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.2.37/lunar.min.js"></script>
    <style>
        :root {
            --primary: #8E44AD;
            --primary-dark: #71368a;
            --secondary: #27AE60;
            --bg: #F5F7FA;
            --card-bg: #FFFFFF;
            --text-main: #2C3E50;
            --text-sub: #7F8C8D;
            --border-r: 16px;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
            color: var(--text-main);
            margin: 0;
            padding: 20px 10px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
            padding-bottom: 60px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0;
            font-size: 26px;
            background: linear-gradient(135deg, var(--primary), #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        .header p { margin: 8px 0 0; font-size: 13px; color: var(--text-sub); }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-r);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.02);
        }

        .form-group { margin-bottom: 15px; }
        .label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: var(--text-main); }
        
        .toggle-group {
            display: flex; background: #f0f2f5; border-radius: 10px; padding: 3px;
        }
        /* éšè—åŸç”Ÿ Radio */
        .toggle-group input[type="radio"] { display: none; }
        
        .toggle-group label {
            flex: 1; text-align: center; padding: 10px; cursor: pointer;
            border-radius: 8px; font-size: 14px; font-weight: 600; color: #95a5a6;
            transition: all 0.2s;
        }
        /* é€‰ä¸­çŠ¶æ€æ ·å¼ */
        .toggle-group input[type="radio"]:checked + label {
            background: #fff; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        input[type="datetime-local"] {
            width: 100%; padding: 12px; border: 1px solid #e1e4e8; border-radius: 10px;
            font-size: 16px; background: #f9f9f9; outline: none; transition: 0.2s;
            -webkit-appearance: none;
        }
        input[type="datetime-local"]:focus { border-color: var(--primary); background: #fff; }

        .btn-calc {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: #fff; font-size: 16px; font-weight: bold; margin-top: 10px;
            cursor: pointer; box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }
        .btn-calc:active { transform: scale(0.98); }

        #result-box { display: none; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .section-head {
            font-size: 16px; font-weight: 700; margin: 25px 0 12px;
            display: flex; align-items: center; gap: 8px;
        }
        .section-head::before {
            content: ''; width: 4px; height: 16px; background: var(--primary); border-radius: 2px;
        }

        .bazi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .pillar {
            background: #f8f9fa; border-radius: 8px; padding: 12px 2px;
            text-align: center; display: flex; flex-direction: column; align-items: center;
        }
        .pillar-head { font-size: 12px; color: #999; margin-bottom: 5px; }
        .gan-zhi { font-size: 22px; font-weight: bold; font-family: "KaiTi", "æ¥·ä½“", serif; line-height: 1.3; }
        .hidden-gan { font-size: 11px; color: #7f8c8d; margin-top: 5px; transform: scale(0.9); }

        .wx-é‡‘ { color: #D4AF37; }
        .wx-æœ¨ { color: #27AE60; }
        .wx-æ°´ { color: #2980B9; }
        .wx-ç« { color: #C0392B; }
        .wx-åœŸ { color: #795548; }

        .deep-card { background: #fff8f8; border: 1px solid #ffecec; }
        .highlight-box {
            background: rgba(142, 68, 173, 0.05); border-radius: 8px;
            padding: 12px; margin-top: 10px; font-size: 14px; line-height: 1.6;
        }
        .highlight-title { font-weight: bold; color: var(--primary); margin-bottom: 4px; display: block; }
        .tag {
            display: inline-block; padding: 2px 8px; border-radius: 4px; 
            font-size: 12px; font-weight: bold; margin-right: 5px;
        }
        .tag-wang { background: #e8f5e9; color: #27ae60; }
        .tag-shuai { background: #ffebee; color: #c0392b; }

        .wuxing-bar { display: flex; height: 8px; border-radius: 4px; overflow: hidden; margin: 15px 0 10px; }
        .bar-seg { height: 100%; transition: width 0.5s; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>å‘½è¿é»‘ç›’ Pro Max</h1>
        <p>äººå…ƒå¸ä»¤ Â· é—¨æ—ºåœ°è¡° Â· æ·±åº¦å¤ç›˜</p>
    </div>

    <div class="card">
        <div class="form-group">
            <span class="label">æ€§åˆ« (Gender)</span>
            <div class="toggle-group">
                <input type="radio" name="gender" id="g-male" value="1" checked>
                <label for="g-male">ç”·å‘½ (ä¹¾)</label>
                <input type="radio" name="gender" id="g-female" value="0">
                <label for="g-female">å¥³å‘½ (å¤)</label>
            </div>
        </div>
        <div class="form-group">
            <span class="label">å‡ºç”Ÿæ—¶é—´ (å…¬å†)</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-calc" onclick="doAnalyze()">æ·±åº¦æ¨æ¼”</button>
    </div>

    <div id="result-box">
        
        <div class="section-head">å››æŸ±ç»“æ„</div>
        <div class="card">
            <div class="bazi-grid" id="bazi-pillars"></div>
        </div>

        <div class="section-head">å¸ä»¤ä¸æ ¼å±€æ·±åº¦åˆ¤è¯»</div>
        <div class="card deep-card">
            <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                ğŸ“… èŠ‚æ°”æ•°æ®ï¼š<span id="jieqi-info" style="font-weight:bold;"></span>
            </div>
            
            <div class="highlight-box">
                <span class="highlight-title">ğŸ‘‘ äººå…ƒå¸ä»¤ (å€¼ç­çœŸç¥)</span>
                <div id="siling-desc"></div>
            </div>

            <div class="highlight-box" style="background: rgba(39, 174, 96, 0.05); margin-top: 8px;">
                <span class="highlight-title" style="color: var(--secondary);">âš–ï¸ é—¨æ—ºåœ°è¡°è¾©è¯</span>
                <div id="wang-shuai-desc"></div>
            </div>
        </div>

        <div class="section-head">äº”è¡Œèƒ½é‡åˆ†å¸ƒ</div>
        <div class="card">
            <div class="wuxing-bar" id="wuxing-chart"></div>
            <div id="wuxing-legend" style="display:flex; justify-content:space-between; font-size:12px; color:#666;"></div>
            <div style="margin-top:15px; font-size:13px; line-height:1.5; color:#555;" id="wuxing-advice"></div>
        </div>

        <div class="section-head">å…³é”®ç¥ç…</div>
        <div class="card" id="shensha-box" style="font-size:14px; line-height:1.6;"></div>

    </div>
</div>

<script>
    // --- 1. å…¨å±€å¸¸é‡å®šä¹‰ (ç§»è‡³æœ€å¤–å±‚ç¡®ä¿å®‰å…¨) ---

    // äº”è¡Œé¢œè‰²æ˜ å°„
    const wxColor = { 'é‡‘':'#D4AF37', 'æœ¨':'#27AE60', 'æ°´':'#2980B9', 'ç«':'#C0392B', 'åœŸ':'#795548' };

    // äººå…ƒå¸ä»¤æ‰§æ”¿å¤©æ•°è¡¨ (æŒ‰ç›²æ´¾ 9-3-18 æ ‡å‡†)
    const silingMap = {
        'å¯…': [['æˆŠ', 7], ['ä¸™', 7], ['ç”²', 16]],
        'å¯': [['ç”²', 10], ['ä¹™', 20]],
        'è¾°': [['ä¹™', 9], ['ç™¸', 3], ['æˆŠ', 18]],
        'å·³': [['æˆŠ', 5], ['åºš', 9], ['ä¸™', 16]],
        'åˆ': [['ä¸™', 10], ['å·±', 9], ['ä¸', 11]],
        'æœª': [['ä¸', 9], ['ä¹™', 3], ['å·±', 18]],
        'ç”³': [['æˆŠ', 7], ['å£¬', 7], ['åºš', 16]],
        'é…‰': [['åºš', 10], ['è¾›', 20]],
        'æˆŒ': [['è¾›', 9], ['ä¸', 3], ['æˆŠ', 18]],
        'äº¥': [['æˆŠ', 7], ['ç”²', 5], ['å£¬', 18]],
        'å­': [['å£¬', 10], ['ç™¸', 20]],
        'ä¸‘': [['ç™¸', 9], ['è¾›', 3], ['å·±', 18]]
    };

    // é¡µé¢åŠ è½½æ—¶å¡«å……é»˜è®¤æ—¶é—´
    window.onload = () => {
        try {
            const now = new Date();
            // æ ¼å¼åŒ–ä¸º datetime-local éœ€è¦çš„ YYYY-MM-DDTHH:mm
            const pad = (n) => n.toString().padStart(2, '0');
            const str = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
            document.getElementById('birth-input').value = str;
        } catch (e) {
            console.warn("è‡ªåŠ¨è®¾ç½®æ—¶é—´å¤±è´¥:", e);
        }
    };

    // --- 2. æ ¸å¿ƒåˆ†æä¸»å…¥å£ ---
    function doAnalyze() {
        try {
            // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½
            if (typeof Solar === 'undefined' || typeof Lunar === 'undefined') {
                alert("æ’ç›˜åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åˆ·æ–°é¡µé¢ã€‚");
                return;
            }

            const timeStr = document.getElementById('birth-input').value;
            if(!timeStr) {
                alert("è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´");
                return;
            }

            // è·å–è¾“å…¥
            const genderInput = document.querySelector('input[name="gender"]:checked');
            const gender = genderInput ? genderInput.value : "1"; // é»˜è®¤ç”·
            
            const date = new Date(timeStr);
            if (isNaN(date.getTime())) {
                alert("æ— æ•ˆçš„æ—¥æœŸæ ¼å¼");
                return;
            }
            
            // 1. Lunar åˆå§‹åŒ–
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const bazi = lunar.getEightChar();
            bazi.setSect(2); // 2ä¸ºæ™šå­æ—¶å¤„ç†

            // 2. æ¸²æŸ“å››æŸ±
            renderPillars(bazi);

            // 3. è®¡ç®—äººå…ƒå¸ä»¤ (æ ¸å¿ƒé€»è¾‘)
            const commanderInfo = calcCommander(lunar, bazi);
            renderDeepAnalysis(bazi, commanderInfo);

            // 4. äº”è¡Œä¸ç¥ç…
            renderWuxing(bazi);
            renderShensha(bazi, gender);

            // 5. æ˜¾ç¤ºç»“æœ
            const resultBox = document.getElementById('result-box');
            resultBox.style.display = 'block';
            resultBox.scrollIntoView({ behavior: 'smooth' });

        } catch (e) {
            console.error(e);
            alert("æ¨æ¼”è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: " + e.message);
        }
    }

    // --- 3. é€»è¾‘å­å‡½æ•° ---

    function calcCommander(lunar, bazi) {
        // è·å–ä¸Šä¸€ä¸ªèŠ‚æ°” (èŠ‚ï¼Œéæ°”)
        const prevJie = lunar.getPrevJie(); 
        const prevJieSolar = prevJie.getSolar();
        
        // è®¡ç®—å‡ºç”Ÿæ—¶é—´ä¸èŠ‚æ°”çš„æ—¶é—´å·® (è½¬ä¸ºå¤©æ•°)
        // ä½¿ç”¨ getCalendar() è·å–åŸç”Ÿ Date å¯¹è±¡è¿›è¡Œè®¡ç®—
        const birthDate = lunar.getSolar().getCalendar();
        const jieDate = prevJieSolar.getCalendar();
        
        const diffMs = birthDate.getTime() - jieDate.getTime();
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24)); // è¿‡å»äº†å¤šå°‘æ•´å¤©
        
        const monthZhi = bazi.getMonthZhi().getName();
        const distribution = silingMap[monthZhi];
        
        let currentSiling = "æœªçŸ¥";
        let daysCounted = 0;

        if (distribution) {
            for (let item of distribution) {
                let gan = item[0];
                let days = item[1];
                daysCounted += days;
                // å¦‚æœå·®å€¼å°äºç´¯è®¡å¤©æ•°ï¼Œè¯´æ˜è½åœ¨è¯¥åŒºé—´
                if (diffDays < daysCounted) {
                    currentSiling = gan;
                    break;
                }
            }
            // å…œåº•ï¼šå¦‚æœè¶…å‡ºå¤©æ•°ï¼ˆå¦‚èŠ‚æ°”è¯¯å·®ï¼‰ï¼Œå–æœ€åä¸€ä¸ªæœ¬æ°”
            if (currentSiling === "æœªçŸ¥") {
                currentSiling = distribution[distribution.length-1][0];
            }
        }

        return {
            prevJieName: prevJie.getName(),
            daysPassed: diffDays,
            silingGan: currentSiling,
            monthZhi: monthZhi
        };
    }

    function renderDeepAnalysis(bazi, info) {
        // æ˜¾ç¤ºèŠ‚æ°”ä¿¡æ¯
        document.getElementById('jieqi-info').innerHTML = 
            `${info.prevJieName}åç¬¬ <span style="color:var(--primary)">${info.daysPassed}</span> å¤©`;

        // 1. äººå…ƒå¸ä»¤æè¿°
        const dayMaster = bazi.getDayGan().getName();
        const dayMasterWx = bazi.getDayGan().getWuXing();
        const silingGan = info.silingGan;
        
        // äº”è¡Œæ˜ å°„è¾…åŠ©
        const getWx = (gan) => {
            if ("ç”²ä¹™".indexOf(gan) >= 0) return "æœ¨";
            if ("ä¸™ä¸".indexOf(gan) >= 0) return "ç«";
            if ("æˆŠå·±".indexOf(gan) >= 0) return "åœŸ";
            if ("åºšè¾›".indexOf(gan) >= 0) return "é‡‘";
            if ("å£¬ç™¸".indexOf(gan) >= 0) return "æ°´";
            return "";
        };
        const silingWx = getWx(silingGan);
        const monthZhiWx = bazi.getMonthZhi().getWuXing();

        let desc = `å½“ä»¤çœŸç¥ä¸º <b>${silingGan}${silingWx}</b>ã€‚<br>`;
        desc += `ä½ æ˜¯ <b>${dayMaster}${dayMasterWx}</b> æ—¥ä¸»ï¼Œç”Ÿäº <b>${info.monthZhi}æœˆ</b>ã€‚`;
        
        document.getElementById('siling-desc').innerHTML = desc;

        // 2. é—¨æ—ºåœ°è¡°é€»è¾‘åˆ¤å®š
        // åˆ¤å®šé€»è¾‘ï¼šç›®æ ‡äº”è¡Œæ˜¯å¦ ç”Ÿ/åŠ© æ—¥ä¸»
        const isHelp = (targetWx, masterWx) => {
            if (!targetWx || !masterWx) return false;
            // åŒæˆ‘è€…
            if (targetWx === masterWx) return true;
            // ç”Ÿæˆ‘è€…
            if (targetWx==="æœ¨" && masterWx==="ç«") return true;
            if (targetWx==="ç«" && masterWx==="åœŸ") return true;
            if (targetWx==="åœŸ" && masterWx==="é‡‘") return true;
            if (targetWx==="é‡‘" && masterWx==="æ°´") return true;
            if (targetWx==="æ°´" && masterWx==="æœ¨") return true;
            return false;
        };

        const isMenWang = isHelp(monthZhiWx, dayMasterWx);
        const isDiWang = isHelp(silingWx, dayMasterWx);

        let wangShuaiHTML = "";
        
        if (isMenWang && isDiWang) {
            wangShuaiHTML = `<span class="tag tag-wang">é—¨åœ°åŒæ—º</span> ä½ çš„èƒ½é‡æ ¹åŸºæå…¶æ·±åšã€‚å¾—æœˆä»¤ä¹‹ä½“ï¼ˆé—¨ï¼‰ï¼Œåˆå¾—æ‰§æ”¿çœŸç¥ä¹‹åŠ¿ï¼ˆåœ°ï¼‰ã€‚<br>ç»“è®ºï¼šçœŸèº«å¼ºï¼Œåº•æ°”è¶³ï¼Œå¯æ‹…å¤§è´¢å¤§å®˜ï¼Œä½†ä¹Ÿéœ€é˜²è¿‡åˆšæ˜“æŠ˜ï¼Œå–œé£Ÿä¼¤æ³„ç§€æˆ–å®˜æ€é›•ç¢ã€‚`;
        } else if (isMenWang && !isDiWang) {
            wangShuaiHTML = `<span class="tag tag-wang">é—¨æ—º</span> <span class="tag tag-shuai">åœ°è¡°</span> è¿™ç§æ ¼å±€å¸¸è¢«è¯¯åˆ¤ã€‚<br>è¡¨é¢çœ‹ç”Ÿåœ¨å¸®æ‰¶æœˆï¼ˆé—¨æ—ºï¼‰ï¼Œä½†å®é™…æ‰§æ”¿çš„çœŸç¥å¹¶ä¸å¸®ä½ ï¼ˆåœ°è¡°ï¼‰ã€‚<br>ç»“è®ºï¼šå¤–å¼ºä¸­å¹²ï¼Œè™šæ—ºã€‚çœ‹ä¼¼å¼ºå¤§ï¼Œå®åˆ™å†…é‡Œå®¹æ˜“ç©ºè™šï¼ŒæŠ—å‹èƒ½åŠ›ä¸å¦‚è¡¨é¢å¼ºã€‚éœ€è¦å°æ˜Ÿé€šå…³æˆ–æ¯”åŠ«å¸®èº«ã€‚`;
        } else if (!isMenWang && isDiWang) {
            wangShuaiHTML = `<span class="tag tag-shuai">é—¨è¡°</span> <span class="tag tag-wang">åœ°æ—º</span> ç»å¤„é€¢ç”Ÿä¹‹æ ¼ã€‚<br>è¡¨é¢çœ‹ç”Ÿåœ¨å…‹æ³„æœˆï¼ˆä¸å¾—ä»¤ï¼‰ï¼Œä½†çœŸç¥å´æš—ä¸­å¸®ä½ ã€‚<br>ç»“è®ºï¼šéšè—çš„å®åŠ›æ´¾ã€‚å¹³æ—¶ä¸æ˜¾å±±éœ²æ°´ï¼Œå…³é”®æ—¶åˆ»æœ‰ç»æ‹›ï¼Œç”Ÿå‘½åŠ›é¡½å¼ºã€‚`;
        } else {
            wangShuaiHTML = `<span class="tag tag-shuai">é—¨åœ°ä¿±è¡°</span> çœŸæ­£çš„èº«å¼±ã€‚<br>æœˆä»¤å’ŒçœŸç¥éƒ½ä¸å¸®ä½ ã€‚<br>ç»“è®ºï¼šéœ€ä¸¥æ ¼å¯»æ‰¾å°æ¯”ç”Ÿæ‰¶ï¼Œæˆ–è€ƒè™‘ä»æ ¼ï¼ˆè‹¥å…¨å±€æ°”åŠ¿çº¯ç²¹ï¼‰ã€‚ä¸å¯ç¡¬æŠ—å®˜æ€ã€‚`;
        }

        document.getElementById('wang-shuai-desc').innerHTML = wangShuaiHTML;
    }

    function renderPillars(bazi) {
        const pillars = [
            {n:'å¹´æŸ±', g:bazi.getYearGan(), z:bazi.getYearZhi()},
            {n:'æœˆæŸ±', g:bazi.getMonthGan(), z:bazi.getMonthZhi()},
            {n:'æ—¥æŸ±', g:bazi.getDayGan(), z:bazi.getDayZhi()},
            {n:'æ—¶æŸ±', g:bazi.getTimeGan(), z:bazi.getTimeZhi()}
        ];
        
        let html = '';
        pillars.forEach(p => {
            const hiddens = p.z.getHiddenGan().map(g => g.getName()).join('');
            html += `
                <div class="pillar">
                    <div class="pillar-head">${p.n}</div>
                    <div class="gan-zhi wx-${p.g.getWuXing()}">${p.g.getName()}</div>
                    <div class="gan-zhi wx-${p.z.getWuXing()}">${p.z.getName()}</div>
                    <div class="hidden-gan">${hiddens}</div>
                </div>
            `;
        });
        document.getElementById('bazi-pillars').innerHTML = html;
    }

    function renderWuxing(bazi) {
        const arr = [
            bazi.getYearGan(), bazi.getYearZhi(),
            bazi.getMonthGan(), bazi.getMonthZhi(),
            bazi.getDayGan(), bazi.getDayZhi(),
            bazi.getTimeGan(), bazi.getTimeZhi()
        ];
        const counts = {'é‡‘':0,'æœ¨':0,'æ°´':0,'ç«':0,'åœŸ':0};
        arr.forEach(x => {
            const w = x.getWuXing();
            if (counts[w] !== undefined) counts[w]++;
        });
        
        let barHtml = '', legendHtml = '';
        const total = 8;
        
        // æ‰¾æœ€å¼ºæœ€å¼±
        let maxWx = 'é‡‘', maxVal = -1;
        let minWx = 'é‡‘', minVal = 99;

        for(let w in counts) {
            if(counts[w] > maxVal) { maxVal = counts[w]; maxWx = w; }
            if(counts[w] < minVal) { minVal = counts[w]; minWx = w; }
            
            if(counts[w] > 0) {
                let pct = (counts[w]/total)*100;
                barHtml += `<div class="bar-seg" style="width:${pct}%; background:${wxColor[w]}"></div>`;
                legendHtml += `<div><span style="color:${wxColor[w]}">â—</span> ${w}${counts[w]}</div>`;
            }
        }
        
        document.getElementById('wuxing-chart').innerHTML = barHtml;
        document.getElementById('wuxing-legend').innerHTML = legendHtml;
        
        document.getElementById('wuxing-advice').innerHTML = 
            `<b>äº”è¡Œç®€è¯„ï¼š</b>å…¨ç›˜æ°”åŠ¿æœ€å¼ºä¸ºã€${maxWx}ã€‘ï¼Œæœ€å¼±/ç¼ºå¤±ä¸ºã€${minVal===0 ? 'æ— ' : minWx}ã€‘ã€‚<br>è‹¥ã€${maxWx}ã€‘ä¸ºå¿Œç¥ï¼Œåˆ™éœ€å…‹æ³„ï¼›è‹¥ä¸ºå–œç¥ï¼Œåˆ™é¡ºåŠ¿è€Œä¸ºã€‚è¯·ç»“åˆä¸Šæ–¹â€œæ·±åº¦æ ¼å±€â€åˆ¤æ–­ã€‚`;
    }

    function renderShensha(bazi, gender) {
        const dayGan = bazi.getDayGan().getName();
        const dayZhi = bazi.getDayZhi().getName();
        const yearZhi = bazi.getYearZhi().getName();
        const timeZhi = bazi.getTimeZhi().getName();
        
        let html = "";
        
        // 1. å¤©ä¹™è´µäºº (ç®€å•æŸ¥æ³•: ç”²æˆŠåºšç‰›ç¾Š, ä¹™å·±é¼ çŒ´ä¹¡, ä¸™ä¸çŒªé¸¡ä½, å£¬ç™¸å…”è›‡è—, å…­è¾›é€¢é©¬è™)
        // ä¹™å·±é¼ çŒ´ä¹¡ -> æ—¥å¹²ä¹™æˆ–å·±ï¼Œè§ å­(é¼ ) æˆ– ç”³(çŒ´)
        if (["å·±","ä¹™"].includes(dayGan) && ["å­","ç”³"].includes(timeZhi)) {
             html += "<div>âœ¨ <b>æ—¶æŸ±å¤©ä¹™è´µäºº</b>ï¼šæ™šè¿å¤§å‰ï¼Œé€¢å‡¶åŒ–å‰ã€‚</div>";
        }

        // 2. é©¿é©¬ (ç”³å­è¾°é©¬åœ¨å¯…, å·³é…‰ä¸‘é©¬åœ¨äº¥, å¯…åˆæˆŒé©¬åœ¨ç”³, äº¥å¯æœªé©¬åœ¨å·³)
        const yimaMap = {'ç”³':'å¯…','å­':'å¯…','è¾°':'å¯…', 'å·³':'äº¥','é…‰':'äº¥','ä¸‘':'äº¥', 'å¯…':'ç”³','åˆ':'ç”³','æˆŒ':'ç”³', 'äº¥':'å·³','å¯':'å·³','æœª':'å·³'};
        const yima = yimaMap[yearZhi];
        const pillarZhis = [bazi.getMonthZhi().getName(), bazi.getDayZhi().getName(), bazi.getTimeZhi().getName()];
        if (pillarZhis.includes(yima)) {
            html += `<div>ğŸ <b>å‘½å¸¦é©¿é©¬</b>ï¼šä¸€ç”Ÿå¤šå¥”æ³¢å˜åŠ¨ï¼ŒåŠ¨ä¸­æ±‚è´¢ã€‚</div>`;
        }
        
        // 3. åç›– (å¯…åˆæˆŒè§æˆŒ, å·³é…‰ä¸‘è§ä¸‘, ç”³å­è¾°è§è¾°, äº¥å¯æœªè§æœª)
        const huagaiMap = {'å¯…':'æˆŒ','åˆ':'æˆŒ','æˆŒ':'æˆŒ', 'å·³':'ä¸‘','é…‰':'ä¸‘','ä¸‘':'ä¸‘', 'ç”³':'è¾°','å­':'è¾°','è¾°':'è¾°', 'äº¥':'æœª','å¯':'æœª','æœª':'æœª'};
        const huagai = huagaiMap[yearZhi] || huagaiMap[dayZhi]; 
        
        // æ£€æŸ¥å››æŸ±æ˜¯å¦æœ‰åç›–
        const allZhis = [yearZhi, bazi.getMonthZhi().getName(), dayZhi, timeZhi];
        if (allZhis.includes(huagai)) {
             html += `<div>ğŸ¨ <b>å‘½å¸¦åç›–</b>ï¼šæ‰åæ¨ªæº¢ï¼Œå†…å¿ƒå­¤ç‹¬ï¼Œå–œå“²å­¦ç„å­¦ã€‚</div>`;
        }
        
        if (html === "") html = "<div>æš‚æ— æ˜¾è‘—æ ¸å¿ƒç¥ç…ï¼ˆå¤©ä¹™/é©¿é©¬/åç›–ï¼‰ï¼Œæ ¼å±€æ¸…çº¯äº¦æ˜¯ç¦ã€‚</div>";
        document.getElementById('shensha-box').innerHTML = html;
    }
</script>

</body>
</html>
