<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤©å‘½é‘‘å®š Â· å®—å¸ˆæ— é”™å…¸è—ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap');

        :root {
            --china-red: #a22d29;      /* æš–æœ±ç ‚ */
            --paper-cream: #f4f1de;    /* å®£çº¸æ·¡é»„ */
            --ink-black: #1a1a1a;      /* æµ“å¢¨ */
            --gold-leaf: #b8860b;      /* æé‡‘ */
            --joy-green: #2d6a4f;      /* å–œç”¨ */
            --taboo-red: #bc4749;      /* å¿Œè®³ */
            --border-color: #d8c3a5;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #edeae0;
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: var(--ink-black); margin: 0; padding: 20px 10px; min-height: 100vh;
            display: flex; justify-content: center;
        }

        .container { width: 100%; max-width: 800px; }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header { text-align: center; margin-bottom: 50px; position: relative; }
        .header h1 { 
            font-family: 'Ma Shan Zheng', cursive; font-size: 3.5rem; margin: 0; color: var(--china-red);
            line-height: 1.2; display: inline-block; position: relative;
        }
        .header h1::after {
            content: 'é‘‘å®š'; position: absolute; right: -55px; top: 10px;
            font-size: 0.9rem; background: var(--china-red); color: #fff;
            padding: 4px 6px; border-radius: 2px; line-height: 1; font-family: sans-serif;
        }
        .sys-badge { 
            font-size: 0.8rem; color: var(--china-red); border: 1px solid var(--china-red);
            padding: 3px 20px; margin-top: 15px; display: inline-block; letter-spacing: 4px;
            font-weight: bold; background: rgba(162, 45, 41, 0.05);
        }

        /* å¡ç‰‡å®¹å™¨ */
        .card {
            background: #fff; border: 1px solid var(--border-color); padding: 35px; margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05); position: relative;
        }
        .card::before {
            content: ''; position: absolute; top: 8px; left: 8px; right: 8px; bottom: 8px;
            border: 1px solid #f2efea; pointer-events: none;
        }

        .label { 
            color: var(--china-red); font-size: 1.1rem; margin-bottom: 15px; 
            display: block; font-weight: bold; border-left: 4px solid var(--china-red);
            padding-left: 12px; letter-spacing: 1px;
        }
        
        .gender-box { display: flex; gap: 15px; margin-bottom: 25px; }
        .g-btn {
            flex: 1; padding: 18px; text-align: center; border: 1px solid var(--border-color);
            background: #fff; color: #666; cursor: pointer; transition: 0.3s; font-weight: bold;
        }
        .g-btn.active { border-color: var(--china-red); color: var(--china-red); background: rgba(162, 45, 41, 0.05); }

        input[type="datetime-local"] {
            width: 100%; padding: 18px; background: #fafafa; border: 1px solid var(--border-color);
            color: var(--ink-black); font-size: 1.2rem; outline: none; font-family: serif;
        }

        .btn-start {
            width: 100%; padding: 22px; border: none; background: var(--china-red);
            color: #fff; font-size: 1.5rem; font-weight: 900; letter-spacing: 10px;
            cursor: pointer; margin-top: 25px; box-shadow: 0 10px 25px rgba(162, 45, 41, 0.3);
        }

        #result-area { display: none; }

        /* é‰´å®šå¤´æŠ¥å‘Š */
        .role-header { text-align: center; margin-bottom: 45px; }
        .role-icon { font-size: 4.5rem; display: block; margin-bottom: 15px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); }
        .role-title { font-family: 'Ma Shan Zheng', cursive; font-size: 3.2rem; color: var(--china-red); margin: 0; }
        .role-sub { color: #555; font-size: 1.2rem; margin-top: 10px; letter-spacing: 2px; }
        .role-tags { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .tag { font-size: 0.8rem; padding: 5px 15px; border: 1px solid var(--china-red); color: var(--china-red); font-weight: bold; }
        .tag.ssr { background: var(--china-red); color: #fff; }

        /* åŠ›é‡æ¿€æ´»å±•ç¤º */
        .activation-box {
            background: #fffaf0; border: 2px solid var(--china-red);
            padding: 25px; margin-bottom: 30px; text-align: center; border-radius: 4px;
        }
        .activation-title { color: var(--china-red); font-weight: 900; font-size: 1.4rem; display: block; margin-bottom: 8px; font-family: 'Ma Shan Zheng', cursive; }
        .activation-desc { font-size: 1.1rem; color: #444; line-height: 1.8; font-style: italic; }

        .siling-bar {
            text-align: center; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0;
            padding: 20px 0; margin: 30px 0; font-weight: bold; color: var(--china-red); font-size: 1.2rem;
            background: rgba(162, 45, 41, 0.02);
        }

        /* ç«–ç‰ˆä¿¡ç¬ºæ’ç›˜ */
        .pillars { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 45px; }
        .ofuda { 
            background: #fff; border: 1px solid var(--china-red); padding: 25px 5px; text-align: center;
            box-shadow: 4px 4px 0px rgba(162, 45, 41, 0.1);
        }
        .ofuda-god { font-size: 0.9rem; color: var(--china-red); font-weight: bold; margin-bottom: 12px; height: 20px; }
        .ofuda-char { font-family: 'Ma Shan Zheng', cursive; font-size: 2.8rem; font-weight: 900; line-height: 1; }
        .ofuda-head { font-size: 0.85rem; color: #999; margin-top: 8px; font-weight: bold; }
        .ofuda-cs { font-size: 0.8rem; color: #777; border-top: 1px dashed #eee; padding-top: 12px; margin-top: 10px; }

        .chart-box { height: 260px; width: 100%; border: 1px solid #eee; background: #fff; margin-bottom: 40px; }

        /* æ”»ç•¥å·è½´ */
        .guide-item { margin-bottom: 60px; border-bottom: 1px solid #eee; padding-bottom: 35px; }
        .guide-item:last-child { border: none; }
        .guide-title { 
            font-family: 'Ma Shan Zheng', cursive; font-size: 2rem; color: var(--china-red); 
            margin-bottom: 20px; display: flex; align-items: center; gap: 15px;
        }
        .guide-title::before { content: 'ğŸ®'; font-size: 1.2rem; }
        .guide-text { font-size: 1.2rem; line-height: 2.3; color: #2c2c2c; text-align: justify; }
        .guide-text b { color: var(--china-red); background: rgba(162, 45, 41, 0.05); padding: 0 4px; }

        .logic-panel { background: #fafafa; padding: 35px; border: 1px solid #eee; margin-bottom: 30px; }
        .joy-text { color: var(--joy-green); font-weight: bold; }
        .taboo-text { color: var(--taboo-red); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>é™ç”Ÿé‘‘å®š</h1><br>
        <div class="sys-badge">å®—å¸ˆå…¨è§£ Â· å‘½ç†æ­£æº</div>
    </div>

    <div class="card">
        <div class="input-group">
            <span class="label">ä¹¾å¤ä¹‹é€ </span>
            <div class="gender-box">
                <div class="g-btn active" onclick="setGender(1, this)">ä¹¾é€  (é˜³)</div>
                <div class="g-btn" onclick="setGender(0, this)">å¤é€  (é˜´)</div>
            </div>
        </div>
        <div class="input-group">
            <span class="label">ä»¥é™ç”Ÿæ—¶åˆ» (å…¬å†)</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-start" onclick="startScan()">å¼€å¯ Â· å¤©å‘½å·è½´</button>
    </div>

    <div id="result-area">
        <div class="card">
            <div class="role-header">
                <span id="role-icon" class="role-icon">?</span>
                <h2 id="role-title" class="role-title">é‘‘å®šä¸­...</h2>
                <div id="role-slogan" class="role-sub">...</div>
                <div id="role-tags" class="role-tags"></div>
            </div>

            <div class="activation-box">
                <span class="activation-title" id="activation-status">è°ƒå€™æ„Ÿåº”ä¸­...</span>
                <div class="activation-desc" id="activation-desc"></div>
            </div>

            <div class="siling-bar">
                ğŸ“œ å½“ä»¤çœŸç¥ï¼š<span id="siling-text">...</span>
            </div>

            <div class="pillars" id="pillars-box"></div>

            <div class="chart-box">
                <canvas id="energy-canvas"></canvas>
            </div>

            <div class="logic-panel">
                <span class="label">ğŸ”® æ ¼å±€å¥¥ä¹‰é€è§†</span>
                <div id="pattern-reason" style="margin-bottom:20px; color:#444; line-height:1.8; font-size:1.15rem;"></div>
                <div class="joy-text">â˜… å–œç”¨ç¥ï¼š<span id="txt-joy">...</span></div>
                <div class="taboo-text" style="margin-top:15px;">â˜… å¿Œè®³ç¥ï¼š<span id="txt-taboo">...</span></div>
            </div>
        </div>

        <div class="card">
            <div id="guide-content"></div>
        </div>

        <div style="text-align:center; font-size:14px; color:#999; margin: 60px 0; letter-spacing: 4px; text-transform: uppercase;">
            Fate Authenticated by Grandmaster Â· 2025
        </div>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒå…¨å±€å­—å…¸ ---
    const WX_COLOR_DATA = { 'é‡‘':'#b8860b', 'æœ¨':'#2d6a4f', 'æ°´':'#0077b6', 'ç«':'#bc4749', 'åœŸ':'#7f5539' };
    const WUXING_MAP = {'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ','åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´','å­':'æ°´','ä¸‘':'åœŸ','å¯…':'æœ¨','å¯':'æœ¨','è¾°':'åœŸ','å·³':'ç«','åˆ':'ç«','æœª':'åœŸ','ç”³':'é‡‘','é…‰':'é‡‘','æˆŒ':'åœŸ','äº¥':'æ°´'};
    const ZHI_MAIN_QI = {'å­':'ç™¸', 'ä¸‘':'å·±', 'å¯…':'ç”²', 'å¯':'ä¹™', 'è¾°':'æˆŠ', 'å·³':'ä¸™', 'åˆ':'ä¸', 'æœª':'å·±', 'ç”³':'åºš', 'é…‰':'è¾›', 'æˆŒ':'æˆŠ', 'äº¥':'å£¬'};
    const SHISHEN_MAP = {"ç”²":{"ç”²":"æ¯”è‚©","ä¹™":"åŠ«è´¢","ä¸™":"é£Ÿç¥","ä¸":"ä¼¤å®˜","æˆŠ":"åè´¢","å·±":"æ­£è´¢","åºš":"ä¸ƒæ€","è¾›":"æ­£å®˜","å£¬":"åå°","ç™¸":"æ­£å°"},"ä¹™":{"ä¹™":"æ¯”è‚©","ç”²":"åŠ«è´¢","ä¸":"é£Ÿç¥","ä¸™":"ä¼¤å®˜","å·±":"åè´¢","æˆŠ":"æ­£è´¢","è¾›":"ä¸ƒæ€","åºš":"æ­£å®˜","ç™¸":"åå°","å£¬":"æ­£å°"},"ä¸™":{"ä¸™":"æ¯”è‚©","ä¸":"åŠ«è´¢","æˆŠ":"é£Ÿç¥","å·±":"ä¼¤å®˜","åºš":"åè´¢","è¾›":"æ­£è´¢","å£¬":"ä¸ƒæ€","ç™¸":"æ­£å®˜","ç”²":"åå°","ä¹™":"æ­£å°"},"ä¸":{"ä¸":"æ¯”è‚©","ä¸™":"åŠ«è´¢","å·±":"é£Ÿç¥","æˆŠ":"ä¼¤å®˜","è¾›":"åè´¢","åºš":"æ­£è´¢","ç™¸":"ä¸ƒæ€","å£¬":"æ­£å®˜","ä¹™":"åå°","ç”²":"æ­£å°"},"æˆŠ":{"æˆŠ":"æ¯”è‚©","å·±":"åŠ«è´¢","åºš":"é£Ÿç¥","è¾›":"ä¼¤å®˜","å£¬":"åè´¢","ç™¸":"æ­£è´¢","ç”²":"ä¸ƒæ€","ä¹™":"æ­£å®˜","ä¸™":"åå°","ä¸":"æ­£å°"},"å·±":{"å·±":"æ¯”è‚©","æˆŠ":"åŠ«è´¢","è¾›":"é£Ÿç¥","åºš":"ä¼¤å®˜","ç™¸":"åè´¢","å£¬":"æ­£è´¢","ä¹™":"ä¸ƒæ€","ç”²":"æ­£å®˜","ä¸":"åå°","ä¸™":"æ­£å°"},"åºš":{"åºš":"æ¯”è‚©","è¾›":"åŠ«è´¢","å£¬":"é£Ÿç¥","ç™¸":"ä¼¤å®˜","ç”²":"åè´¢","ä¹™":"æ­£è´¢","ä¸™":"ä¸ƒæ€","ä¸":"æ­£å®˜","æˆŠ":"åå°","å·±":"æ­£å°"},"è¾›":{"è¾›":"æ¯”è‚©","åºš":"åŠ«è´¢","ç™¸":"é£Ÿç¥","å£¬":"ä¼¤å®˜","ä¹™":"åè´¢","ç”²":"æ­£è´¢","ä¸":"ä¸ƒæ€","ä¸™":"æ­£å®˜","å·±":"åå°","æˆŠ":"æ­£å°"},"å£¬":{"å£¬":"æ¯”è‚©","ç™¸":"åŠ«è´¢","ç”²":"é£Ÿç¥","ä¹™":"ä¼¤å®˜","ä¸™":"åè´¢","ä¸":"æ­£è´¢","æˆŠ":"ä¸ƒæ€","å·±":"æ­£å®˜","åºš":"åå°","è¾›":"æ­£å°"},"ç™¸":{"ç™¸":"æ¯”è‚©","å£¬":"åŠ«è´¢","ä¹™":"é£Ÿç¥","ç”²":"ä¼¤å®˜","ä¸":"åè´¢","ä¸™":"æ­£è´¢","å·±":"ä¸ƒæ€","æˆŠ":"æ­£å®˜","è¾›":"åå°","åºš":"æ­£å°"}};
    const SILING_RULES = {'å¯…': [['æˆŠ',7], ['ä¸™',7], ['ç”²',16]], 'å¯': [['ç”²',10], ['ä¹™',20]], 'è¾°': [['ä¹™',9], ['ç™¸',3], ['æˆŠ',18]], 'å·³': [['æˆŠ',5], ['åºš',9], ['ä¸™',16]], 'åˆ': [['ä¸™',10], ['å·±',9], ['ä¸',11]], 'æœª': [['ä¸',9], ['ä¹™',3], ['å·±',18]], 'ç”³': [['æˆŠ',7], ['å£¬',7], ['åºš',16]], 'é…‰': [['åºš',10], ['è¾›',20]], 'æˆŒ': [['è¾›',9], ['ä¸',3], ['æˆŠ',18]], 'äº¥': [['æˆŠ',7], ['ç”²',5], ['å£¬',18]], 'å­': [['å£¬',10], ['ç™¸',20]], 'ä¸‘': [['ç™¸',9], ['è¾›',3], ['å·±',18]]};
    const ROOT_MAP = {'ç”²':['å¯…','å¯','äº¥','è¾°','æœª'], 'ä¹™':['å¯','å¯…','è¾°','æœª','äº¥'], 'ä¸™':['å·³','åˆ','å¯…','æˆŒ'], 'ä¸':['åˆ','å·³','æœª','æˆŒ','å¯…'], 'æˆŠ':['è¾°','æˆŒ','ä¸‘','æœª','å·³','åˆ'], 'å·±':['ä¸‘','æœª','è¾°','æˆŒ','åˆ','å·³'], 'åºš':['ç”³','é…‰','å·³','ä¸‘','æˆŒ'], 'è¾›':['é…‰','ç”³','ä¸‘','æˆŒ','å·³'], 'å£¬':['äº¥','å­','ç”³','è¾°'], 'ç™¸':['å­','äº¥','è¾°','ä¸‘','ç”³']};
    const CHANGSHENG_TABLE = {"ç”²":{"äº¥":"é•¿ç”Ÿ","å­":"æ²æµ´","ä¸‘":"å† å¸¦","å¯…":"ä¸´å®˜","å¯":"å¸æ—º","è¾°":"è¡°","å·³":"ç—…","åˆ":"æ­»","æœª":"å¢“","ç”³":"ç»","é…‰":"èƒ","æˆŒ":"å…»"},"ä¹™":{"åˆ":"é•¿ç”Ÿ","å·³":"æ²æµ´","è¾°":"å† å¸¦","å¯":"ä¸´å®˜","å¯…":"å¸æ—º","ä¸‘":"è¡°","å­":"ç—…","äº¥":"æ­»","æˆŒ":"å¢“","é…‰":"ç»","ç”³":"èƒ","æœª":"å…»"},"ä¸™":{"å¯…":"é•¿ç”Ÿ","å¯":"æ²æµ´","è¾°":"å† å¸¦","å·³":"ä¸´å®˜","åˆ":"å¸æ—º","æœª":"è¡°","ç”³":"ç—…","é…‰":"æ­»","æˆŒ":"å¢“","äº¥":"ç»","å­":"èƒ","ä¸‘":"å…»"},"ä¸":{"é…‰":"é•¿ç”Ÿ","ç”³":"æ²æµ´","æœª":"å† å¸¦","åˆ":"ä¸´å®˜","å·³":"å¸æ—º","è¾°":"è¡°","å¯":"ç—…","å¯…":"æ­»","ä¸‘":"å¢“","å­":"ç»","äº¥":"èƒ","æˆŒ":"å…»"},"æˆŠ":{"å¯…":"é•¿ç”Ÿ","å¯":"æ²æµ´","è¾°":"å† å¸¦","å·³":"ä¸´å®˜","åˆ":"å¸æ—º","æœª":"è¡°","ç”³":"ç—…","é…‰":"æ­»","æˆŒ":"å¢“","äº¥":"ç»","å­":"èƒ","ä¸‘":"å…»"},"å·±":{"é…‰":"é•¿ç”Ÿ","ç”³":"æ²æµ´","æœª":"å† å¸¦","åˆ":"ä¸´å®˜","å·³":"å¸æ—º","è¾°":"è¡°","å¯":"ç—…","å¯…":"æ­»","ä¸‘":"å¢“","å­":"ç»","äº¥":"èƒ","æˆŒ":"å…»"},"åºš":{"å·³":"é•¿ç”Ÿ","åˆ":"æ²æµ´","æœª":"å† å¸¦","ç”³":"ä¸´å®˜","é…‰":"å¸æ—º","æˆŒ":"è¡°","äº¥":"ç—…","å­":"æ­»","ä¸‘":"å¢“","å¯…":"ç»","å¯":"èƒ","è¾°":"å…»"},"è¾›":{"å­":"é•¿ç”Ÿ","äº¥":"æ²æµ´","æˆŒ":"å† å¸¦","é…‰":"ä¸´å®˜","ç”³":"å¸æ—º","æœª":"è¡°","åˆ":"ç—…","å·³":"æ­»","è¾°":"å¢“","å¯":"ç»","å¯…":"èƒ","ä¸‘":"å…»"},"å£¬":{"ç”³":"é•¿ç”Ÿ","é…‰":"æ²æµ´","æˆŒ":"å† å¸¦","äº¥":"ä¸´å®˜","å­":"å¸æ—º","ä¸‘":"è¡°","å¯…":"ç—…","å¯":"æ­»","è¾°":"å¢“","å·³":"ç»","åˆ":"èƒ","æœª":"å…»"},"ç™¸":{"å¯":"é•¿ç”Ÿ","å¯…":"æ²æµ´","ä¸‘":"å† å¸¦","å­":"ä¸´å®˜","äº¥":"å¸æ—º","æˆŒ":"è¡°","é…‰":"ç—…","ç”³":"æ­»","æœª":"å¢“","åˆ":"ç»","å·³":"èƒ","è¾°":"å…»"}};

    // --- æ–‡æ¡ˆå…¨é‡åº“ (ç™¾ä¸‡çº§æ·±åº¦è§£æ) ---
    const GAME_DB = {
        "é‡‘æ°´ä¼¤å®˜": { name: "â„ï¸ å¯’å†°å‰‘ä»™", tags: ["SSR","æè´µ"], icon: "ğŸ—¡ï¸", slogan: "é‡‘å¯’æ°´å†·ï¼Œå”¯ç«æš–å¿ƒã€‚", male: { c:"[å¤©èµ‹] æƒè°‹æ´å¯Ÿã€‚æ€ç»´å¦‚å†°åˆ€åˆ‡å¼€æ ¸å¿ƒã€‚å±€ä¸­è§ç«å³ä¸ºæ˜¾è´µã€‚", w:"[è´¢å¯Œ] éšä½è€Œç”Ÿã€‚åˆ‡å¿Œè´ªè…ï¼Œæ°´æ¸…æ˜“å¯Ÿã€‚", l:"[ç¾ç»Š] éœ€æš–é˜³ä¼´ä¾£ã€‚", k:"[ä¼ æ‰¿] ä¸¥çˆ¶ã€‚", h:"[é”¦å›Š] å¿…ç”¨ç«è°ƒå€™ã€‚" }, female: { c:"[å¤©èµ‹] å†°å±±ç¾äººã€‚æ‰åéœ€è¢«çœ‹è§ã€‚", w:"[è´¢å¯Œ] å¤«è£å¦»è´µã€‚", l:"[ç¾ç»Š] ç‹¬å–œå®˜æ˜Ÿã€‚", k:"[ä¼ æ‰¿] è´µå­è¿ã€‚", h:"[é”¦å›Š] æš–å®«é©±å¯’ã€‚" } },
        "é‡‘æ°´é£Ÿç¥": { name: "ğŸŒŠ çµåŠ¨æ™ºè€…", tags: ["SSR","æ¸…è´µ"], icon: "ğŸŒŠ", slogan: "é‡‘ç™½æ°´æ¸…ï¼Œæ‰æ€æ³‰æ¶Œã€‚", male: { c:"[å¤©èµ‹] å†…ç§€ä¹¾å¤ã€‚å­¦æœ¯æˆ–åˆ›ä½œå¤©æ‰ã€‚æˆå°±äºæ·±è€•ã€‚", w:"[è´¢å¯Œ] æŠ€è‰ºç”Ÿè´¢ã€‚", l:"[ç¾ç»Š] çµé­‚çŸ¥å·±ã€‚", k:"[ä¼ æ‰¿] èªæ…§éº’éºŸã€‚", h:"[é”¦å›Š] è¡¥ç«æš–å±€ã€‚" }, female: { c:"[å¤©èµ‹] è„±ä¿—ç™½æœˆå…‰ã€‚", w:"[è´¢å¯Œ] å°ç¡®å¹¸ä¸æ–­ã€‚", l:"[ç¾ç»Š] å¯’è°·å›æ˜¥ã€‚", k:"[ä¼ æ‰¿] å­å¥³å­é¡ºã€‚", h:"[é”¦å›Š] ä¿æŒå¿ƒæƒ…æ„‰å¿«ã€‚" } },
        "æœ¨ç«é€šæ˜": { name: "ğŸ”¥ è–ªç«ä¼ äºº", tags: ["SSR","åæœ›"], icon: "ğŸ”¥", slogan: "æœ¨ç«äº¤è¾‰ï¼Œå…‰è€€åƒç§‹ã€‚", male: { c:"[å¤©èµ‹] æ–‡æ˜Œé™ä¸–ã€‚å­¦è€…ã€ä½œå®¶ã€æ€æƒ³å®¶ã€‚", w:"[è´¢å¯Œ] ååˆ©åŒæ”¶ã€‚é’±æ˜¯åå£°çš„å‰¯äº§å“ã€‚", l:"[ç¾ç»Š] çµé­‚çŸ¥éŸ³ã€‚", k:"[ä¼ æ‰¿] ä¹¦é¦™é—¨ç¬¬ã€‚", h:"[é”¦å›Š] æŠ¤çœ¼å…»å¿ƒã€‚" }, female: { c:"[å¤©èµ‹] æ‰å¥³ä¸‹å‡¡ã€‚", w:"[è´¢å¯Œ] æ¸…è´µä¹‹è´¢ã€‚", l:"[ç¾ç»Š] æ™šå©šæˆ–ä¸å©šã€‚", k:"[ä¼ æ‰¿] ä¼˜ç”Ÿä¼˜è‚²ã€‚", h:"[é”¦å›Š] æ³¨æ„å¿ƒè¡€ç®¡ã€‚" } },
        "ä¼¤å®˜é…å°": { name: "ğŸ”® æ™ºè€…ç¥å¯", tags: ["UR","æ™ºæ…§"], icon: "ğŸ“œ", slogan: "çƒˆç«çƒ¹æ²¹ï¼Œæ·±æ°´é™æµã€‚", male: { c:"<b>[å¤©èµ‹æ ¸å¿ƒ]</b> æ‰åç‹‚é£™é‡å°æ˜Ÿç¨³é‡ï¼Œåˆ©å‰‘å…¥é˜ã€‚ä½ æ˜¯èƒ½æŠŠå†²åŠ¨è½¬åŒ–ä¸ºåŠ¨åŠ›çš„é¡¶çº§äººæ‰ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> çŸ¥è¯†è‡´å¯Œã€‚å¿Œè´ªè´¢åå°ï¼Œåæœ›å³è´¢å¯Œã€‚", l:"<b>[æƒ…æ„Ÿç¾ç»Š]</b> ä¼´ä¾£æ˜¯æ•‘å‘½ç¨»è‰ã€‚", k:"<b>[åä»£]</b> ä¹¦é¦™é—¨ç¬¬ï¼Œå­©å­èªæ˜æ—©æ…§ã€‚", h:"<b>[å®æˆ˜é”¦å›Š]</b> é¢„é˜²ç¥ç»è¡°å¼±ã€‚å»ºè®®å¤šå†¥æƒ³ã€‚" }, female: { c:"<b>[å¤©èµ‹æ ¸å¿ƒ]</b> è´µæ°”æ‰å¥³ã€‚é«˜å‹ä¸­ä¿æŒä¼˜é›…ã€‚", w:"<b>[è´¢å¯Œé€»è¾‘]</b> ä¸€è¾ˆå­è´µäººç¼˜ä½³ï¼Œè¶Šè€è¶Šå°Šè´µã€‚", l:"<b>[ç¾ç»Š]</b> å¸®å¤«è¿æå¼ºã€‚", k:"<b>[åä»£]</b> å­å¥³çµæ°”é€¼äººã€‚", h:"<b>[é”¦å›Š]</b> æ»‹é˜´è°ƒç†ã€‚" } },
        "ä¼¤å®˜åˆæ€": { name: "âš¡ å±æœºç»ˆç»“è€…", tags: ["SSR","æƒè°‹"], icon: "âš”ï¸", slogan: "æ··ä¹±æ˜¯é˜¶æ¢¯ï¼Œæƒè°‹æ˜¯åˆ©åˆƒã€‚", male: { c:"[å¤©èµ‹] ä¹±ä¸–æ­é›„ã€‚å±æœºå…¬å…³ä¸“å®¶ã€‚è¶Šä¹±è¶Šå¼ºã€‚", w:"[è´¢å¯Œ] ç‹©çŒè€…ã€‚çˆ†å‘åŠ›æå¼ºã€‚", l:"[ç¾ç»Š] ç›¸çˆ±ç›¸æ€ã€‚", k:"[ä¼ æ‰¿] å›é€†å¤©æ‰ã€‚", h:"[é”¦å›Š] é˜²è¿‡è½½ã€‚å­¦ä¼šå¼ºåˆ¶ä¼‘å‡ã€‚" }, female: { c:"[å¤©èµ‹] é“å¨˜å­ã€‚é å®åŠ›æ‹¼å‡ºæƒå¨ã€‚", w:"[è´¢å¯Œ] åæ°”ææ¬¾æœºã€‚", l:"[ç¾ç»Š] æ…•å¼ºã€‚", k:"[ä¼ æ‰¿] ç²¾è‹±æ•™è‚²ã€‚", h:"[é”¦å›Š] è°ƒå†…åˆ†æ³Œã€‚" } },
        "é£Ÿç¥åˆ¶æ€": { name: "ğŸ¦ é“è…•ç»Ÿå¸…", tags: ["SSR","å¨æƒ"], icon: "ğŸ¦", slogan: "ä»¥æ™ºåˆ¶æš´ï¼Œæƒå¨ç«‹èº«ã€‚", male: { c:"[å¤©èµ‹] ä¸æ€’è‡ªå¨ã€‚è§£å†³ç¡¬æ ¸éš¾é¢˜ã€‚", w:"[è´¢å¯Œ] èµ„å†å˜ç°ã€‚", l:"[ç¾ç»Š] ä¸€å®¶ä¹‹ä¸»ã€‚", k:"[ä¼ æ‰¿] æ ‹æ¢ã€‚", h:"[é”¦å›Š] å¿Œé…’è‰²ã€‚" }, female: { c:"[å¤©èµ‹] é€»è¾‘å¥³ç‹ã€‚", w:"[è´¢å¯Œ] ç†è´¢åœ£æ‰‹ã€‚", l:"[ç¾ç»Š] ä¸¥å¦»ã€‚", k:"[ä¼ æ‰¿] è´´å¿ƒæ£‰è¢„ã€‚", h:"[é”¦å›Š] ä¿æŠ¤è‚ èƒƒã€‚" } },
        "æ€å°ç›¸ç”Ÿ": { name: "ğŸ‘‘ æƒæŸ„æ‰§æŒè€…", tags: ["UR","æŒæƒ"], icon: "ğŸ›¡ï¸", slogan: "åŒ–ç…ä¸ºæƒï¼Œå¨éœ‡å››æ–¹ã€‚", male: { c:"[å¤©èµ‹] æä½³é¢†å¯¼åŠ›ã€‚æ©å¨å¹¶æ–½ã€‚", w:"[è´¢å¯Œ] æƒä¸­å–åˆ©ã€‚", l:"[ç¾ç»Š] è´¤å†…åŠ©ã€‚", k:"[ä¼ æ‰¿] æ˜¾è´µã€‚", h:"[é”¦å›Š] é˜²è¿‡åŠ³ã€‚" }, female: { c:"[å¤©èµ‹] å¥³çš‡é£èŒƒã€‚", w:"[è´¢å¯Œ] ç§¯ç´¯æ·±åšã€‚", l:"[ç¾ç»Š] è´µå¤«ã€‚", k:"[ä¼ æ‰¿] ä¸¥æ¯æ•™å­ã€‚", h:"[é”¦å›Š] è°ƒè‚èƒ†ã€‚" } },
        "æ­£è´¢æ ¼": { name: "ğŸ§± å‹¤å‹‰ç­‘æ¢¦å¸ˆ", tags: ["R+","ç¨³å¥"], icon: "ğŸœ", slogan: "ä¸€ç –ä¸€ç“¦ï¼Œèšæ²™æˆå¡”ã€‚", male: { c:"[å¤©èµ‹] å®å¹²å®¶ã€‚è€æ¿æœ€æ”¾å¿ƒçš„å‘˜å·¥ã€‚", w:"[è´¢å¯Œ] å¤åˆ©è‡´å¯Œã€‚", l:"[ç¾ç»Š] å® å¦»ç‹‚é­”ã€‚", k:"[ä¼ æ‰¿] æœ´å®æ­£ç›´ã€‚", h:"[é”¦å›Š] é˜²åŠ³æŸã€‚" }, female: { c:"[å¤©èµ‹] ç²¾ç»†ç®¡å®¶ã€‚", w:"[è´¢å¯Œ] è´¢æ”¿å¤§è‡£ã€‚", l:"[ç¾ç»Š] è´¤æƒ æ¸©å©‰ã€‚", k:"[ä¼ æ‰¿] åŸºç¡€åŠŸè¯¾æ‰å®ã€‚", h:"[é”¦å›Š] è¡¥æ°”è¡€ã€‚" } },
        "åè´¢æ ¼": { name: "ğŸ© å•†ä¸šå¤§äº¨", tags: ["SSR","æ¨ªè´¢"], icon: "ğŸ’", slogan: "é’±æ˜¯èµšå‡ºæ¥çš„ã€‚", male: { c:"[å¤©èµ‹] èµ„æºæ•´åˆä¸“å®¶ã€‚", w:"[è´¢å¯Œ] æŠ•æœºè·åˆ©ã€‚", l:"[ç¾ç»Š] æ¡ƒèŠ±åŠ«ã€‚", k:"[ä¼ æ‰¿] å¸¦è§ä¸–é¢ã€‚", h:"[é”¦å›Š] æŠ¤è‚ã€‚" }, female: { c:"[å¤©èµ‹] å•†åŠ¡å…¬å…³ã€‚", w:"[è´¢å¯Œ] èƒ½èµšèƒ½èŠ±ã€‚", l:"[ç¾ç»Š] æ‹©ä¼˜ã€‚", k:"[ä¼ æ‰¿] è´µæ—åŸ¹å…»ã€‚", h:"[é”¦å›Š] é˜²å¯Œè´µç—…ã€‚" } },
        "æ­£å®˜æ ¼": { name: "âš–ï¸ ç§©åºå®ˆæŠ¤è€…", tags: ["SR","å®˜è¿"], icon: "ğŸ›ï¸", slogan: "è§„åˆ™æ˜¯åŸºçŸ³ï¼Œç¨³æ­¥ç™»é¡¶ã€‚", male: { c:"[å¤©èµ‹] ä»•é€”é€šè¾¾ã€‚", w:"[è´¢å¯Œ] æ­£è´¢ç¨³ã€‚", l:"[ç¾ç»Š] é—¨å½“æˆ·å¯¹ã€‚", k:"[ä¼ æ‰¿] è§„çŸ©æ–¹åœ†ã€‚", h:"[é”¦å›Š] æ’è§£ç„¦è™‘ã€‚" }, female: { c:"[å¤©èµ‹] è¡Œæ”¿å¤©æ‰ã€‚", w:"[è´¢å¯Œ] è´¢åŠ¡ç¨³å®šã€‚", l:"[ç¾ç»Š] æ—ºå¤«ã€‚", k:"[ä¼ æ‰¿] æ•™å­æœ‰æ–¹ã€‚", h:"[é”¦å›Š] æ³¨æ„é¢ˆæ¤ã€‚" } },
        "ä¸ƒæ€æ ¼": { name: "ğŸ”¥ å­¤èƒ†è‹±é›„", tags: ["SSR","ææ€"], icon: "ğŸš€", slogan: "äººç”Ÿå°±æ˜¯æ— é™çš„æˆ˜æ–—ã€‚", male: { c:"[å¤©èµ‹] æ”»åšèƒ½æ‰‹ã€‚æ‰§è¡ŒåŠ›çˆ†è¡¨ã€‚", w:"[è´¢å¯Œ] é™©ä¸­æ±‚èƒœã€‚", l:"[ç¾ç»Š] çƒˆç«æƒ…äººã€‚", k:"[ä¼ æ‰¿] ä¸¥å¸ˆã€‚", h:"[é”¦å›Š] é˜²å¤–ä¼¤ã€‚" }, female: { c:"[å¤©èµ‹] ä¸šåŠ¡ä¸€å§ã€‚", w:"[è´¢å¯Œ] èµšé’±æœºå™¨ã€‚", l:"[ç¾ç»Š] æ…•å¼ºå¿ƒç†ã€‚", k:"[ä¼ æ‰¿] è¶…äººå¦ˆå¦ˆã€‚", h:"[é”¦å›Š] æŠ¤ä¹³è…ºã€‚" } },
        "æ­£å°æ ¼": { name: "ğŸ“œ åœ£è´¤å¯¼å¸ˆ", tags: ["SR","æ…ˆæ‚²"], icon: "ğŸ™", slogan: "ä½†è¡Œå¥½äº‹ï¼Œè«é—®å‰ç¨‹ã€‚", male: { c:"[å¤©èµ‹] è´µäººæ‰¶æŒã€‚å›¢é˜Ÿé¢†è¢–ã€‚", w:"[è´¢å¯Œ] æ¸…è´µã€‚ç‰ˆç¨åˆ†çº¢ã€‚", l:"[ç¾ç»Š] ä¾èµ–ä¼´ä¾£ã€‚", k:"[ä¼ æ‰¿] çŸ¥ä¹¦è¾¾ç†ã€‚", h:"[é”¦å›Š] é˜²è‚¥èƒ–ã€‚" }, female: { c:"[å¤©èµ‹] å²æœˆé™å¥½ã€‚", w:"[è´¢å¯Œ] å¤©ç”Ÿç¦å‘½ã€‚", l:"[ç¾ç»Š] å—å® æººã€‚", k:"[ä¼ æ‰¿] äº²å­å¦‚å‹ã€‚", h:"[é”¦å›Š] æ’æ¹¿ã€‚" } },
        "åå°æ ¼": { name: "ğŸ‘½ å¼‚æ¬¡å…ƒè¡Œè€…", tags: ["SR","æ´å¯Ÿ"], icon: "ğŸ‘ï¸", slogan: "çœŸç›¸æŒæ¡åœ¨å°‘æ•°äººæ‰‹ä¸­ã€‚", male: { c:"[å¤©èµ‹] ç‹¬é—¨ç»æŠ€ã€‚å†·é—¨æƒå¨ã€‚", w:"[è´¢å¯Œ] å‰¯ä¸šä¹‹ç‹ã€‚", l:"[ç¾ç»Š] å†°å±±å†…å¿ƒã€‚", k:"[ä¼ æ‰¿] ä»£æ²Ÿã€‚", h:"[é”¦å›Š] é˜²æŠ‘éƒã€‚" }, female: { c:"[å¤©èµ‹] çµæ„Ÿç›´è§‰ã€‚å¿ƒç†ç„å­¦å¤©æ‰ã€‚", w:"[è´¢å¯Œ] å˜ç°ç‹¬ç‰¹ã€‚", l:"[ç¾ç»Š] è¾¹ç¼˜æ‹æƒ…ã€‚", k:"[ä¼ æ‰¿] ä¸å…‹å€¾å‘ã€‚", h:"[é”¦å›Š] ç¥ç»ç—›ã€‚" } },
        "é£Ÿç¥æ ¼": { name: "ğŸ¨ é€é¥æ•£äºº", tags: ["SR","å®‰ç¨³"], icon: "ğŸ", slogan: "äººé—´ä¸å€¼å¾—ï¼Œç¾é£Ÿå€¼å¾—ã€‚", male: { c:"[å¤©èµ‹] çµæ„Ÿæºæ³‰ã€‚", w:"[è´¢å¯Œ] èººèµ¢ä¹‹è´¢ã€‚", l:"[ç¾ç»Š] æš–ç”·ã€‚", k:"[ä¼ æ‰¿] ç¦æ˜Ÿã€‚", h:"[é”¦å›Š] æ§ä½“é‡ã€‚" }, female: { c:"[å¤©èµ‹] äº²å’ŒåŠ›æä½³ã€‚", w:"[è´¢å¯Œ] å°ç¡®å¹¸ã€‚", l:"[ç¾ç»Š] ä»ªå¼æ„Ÿã€‚", k:"[ä¼ æ‰¿] æººçˆ±ã€‚", h:"[é”¦å›Š] é˜²æ‡’æƒ°ã€‚" } },
        "ä¼¤å®˜æ ¼": { name: "ğŸ­ è‰ºæœ¯ç©å®¶", tags: ["SR","åˆ›æ–°"], icon: "ğŸ¨", slogan: "æˆ‘ä¸æ˜¯ä¸ºäº†è¿åˆè€Œç”Ÿã€‚", male: { c:"[å¤©èµ‹] åˆ›æ–°çµé­‚ã€‚è§„åˆ™ç ´åè€…ã€‚", w:"[è´¢å¯Œ] æŠ€èƒ½å˜ç°ã€‚", l:"[ç¾ç»Š] ä¸ç¾ä¹‹é£ã€‚", k:"[ä¼ æ‰¿] åƒå“¥ä»¬ã€‚", h:"[é”¦å›Š] æƒ…ç»ªåŒ–ã€‚" }, female: { c:"[å¤©èµ‹] çµæ°”é€¼äººã€‚", w:"[è´¢å¯Œ] éšæ€§ã€‚çœ‹å¿ƒæƒ…èµšé’±ã€‚", l:"[ç¾ç»Š] æŒ‘å‰”ä¼´ä¾£ã€‚", k:"[ä¼ æ‰¿] ç”Ÿå‘½ç¾ç»Šã€‚", h:"[é”¦å›Š] é€šç»ç»œã€‚" } },
        "ä¼¤å®˜ç”Ÿè´¢": { name: "âš—ï¸ ç‚¼é‡‘æœ¯å£«", tags: ["SSR","çˆ†å‘"], icon: "ğŸ’¸", slogan: "ä¸‡ç‰©çš†å¯äº¤æ˜“ã€‚", male: { c:"[å¤©èµ‹] åˆ›ä¸šå¥‡æ‰ã€‚", w:"[è´¢å¯Œ] ç°é‡‘æµæå¼ºã€‚", l:"[ç¾ç»Š] é¢œæ§ã€‚", k:"[ä¼ æ‰¿] è‡ªç”±ç”Ÿé•¿ã€‚", h:"[é”¦å›Š] é˜²è„±å‘å¤±çœ ã€‚" }, female: { c:"[å¤©èµ‹] å¸¦è´§å¥³ç‹ã€‚", w:"[è´¢å¯Œ] è´­ä¹°åŠ›æå¼ºã€‚", l:"[ç¾ç»Š] æŒ‘å‰”ã€‚", k:"[ä¼ æ‰¿] å€¾åŠ›æŠ•å…¥ã€‚", h:"[é”¦å›Š] é€šä¹³è…ºã€‚" } },
        "é£Ÿç¥ç”Ÿè´¢": { name: "ğŸ é€é¥è´¢ä¸»", tags: ["SR","å®‰ç¨³"], icon: "ğŸ’°", slogan: "å¿«ä¹æ‰æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ã€‚", male: { c:"[å¤©èµ‹] å¿«ä¹èµšé’±ã€‚é€‚åˆæœåŠ¡ã€åˆ›æ„ã€‚", w:"[è´¢å¯Œ] ç»†æ°´é•¿æµã€‚", l:"[ç¾ç»Š] æ¸©é¦¨æµªæ¼«ã€‚", k:"[ä¼ æ‰¿] ç¦æ˜Ÿã€‚", h:"[é”¦å›Š] é˜²è‚¥èƒ–ã€‚" }, female: { c:"[å¤©èµ‹] ç”Ÿæ´»ç¾å­¦å®¶ã€‚", w:"[è´¢å¯Œ] ç‰©è´¨ä¼˜æ¸¥ã€‚", l:"[ç¾ç»Š] æ’’å¨‡å¥½å‘½ã€‚", k:"[ä¼ æ‰¿] æ…ˆæ¯å¤šç¦ã€‚", h:"[é”¦å›Š] å¤šè¿åŠ¨ã€‚" } },
        "å»ºç¦„æ ¼": { name: "ğŸ° ç‹¬ç«‹é¢†ä¸»", tags: ["SR","è‡ªå¼º"], icon: "ğŸ—¿", slogan: "æˆ‘çš„é¢†åœŸæˆ‘åšä¸»ã€‚", male: { c:"[å¤©èµ‹] ä¸­æµç ¥æŸ±ã€‚å•å¹²ä¹‹å‘½ã€‚", w:"[è´¢å¯Œ] è¾›è‹¦è‡´å¯Œã€‚", l:"[ç¾ç»Š] å¼ºç¡¬ã€‚", k:"[ä¼ æ‰¿] ç‹¬ç«‹ã€‚", h:"[é”¦å›Š] é˜²è¿‡åŠ³ã€‚" }, female: { c:"[å¤©èµ‹] èŒåœºé“å¨˜å­ã€‚", w:"[è´¢å¯Œ] èƒ½èµšèƒ½èŠ±ã€‚", l:"[ç¾ç»Š] å¼ºåŠ¿ã€‚", k:"[ä¼ æ‰¿] èƒ½å¹²å¦ˆå¦ˆã€‚", h:"[é”¦å›Š] è°ƒç†å†…åˆ†æ³Œã€‚" } },
        "æœˆåŠ«æ ¼": { name: "ğŸ¤œ è±ªä¾ ä¹‰å£«", tags: ["SR","ä¹‰æ°”"], icon: "âš”ï¸", slogan: "ä»ä¹‰å€¼åƒé‡‘ã€‚", male: { c:"[å¤©èµ‹] å›¢é˜Ÿçµé­‚ã€‚", w:"[è´¢å¯Œ] æ•£è´¢ç«¥å­ã€‚", l:"[ç¾ç»Š] å…‹å¦»ã€‚", k:"[ä¼ æ‰¿] éš¾ç®¡ã€‚", h:"[é”¦å›Š] æˆ’èºã€‚" }, female: { c:"[å¤©èµ‹] å·¾å¸¼è±ªæ°ã€‚", w:"[è´¢å¯Œ] æœˆå…‰æ—ã€‚", l:"[ç¾ç»Š] é˜²èƒŒå›ã€‚", k:"[ä¼ æ‰¿] æœ‹å‹å…³ç³»ã€‚", h:"[é”¦å›Š] æŠ¤å‘¼å¸é“ã€‚" } },
        "äº”è¡Œæµé€š": { name: "â˜¯ï¸ å¤ªæå®—å¸ˆ", tags: ["SSR","å…¨èƒ½"], icon: "ğŸ§˜", slogan: "åˆšä¸å¯ä¹…ï¼ŒæŸ”ä¸å¯å®ˆã€‚", male: { c:"[å¤©èµ‹] å…­è¾¹å½¢æˆ˜å£«ã€‚", w:"[è´¢å¯Œ] ç¨³å¦‚æ³°å±±ã€‚", l:"[ç¾ç»Š] ç»†æ°´é•¿æµã€‚", k:"[ä¼ æ‰¿] å­å­ä¼ æ‰¿ã€‚", h:"[é”¦å›Š] é•¿å¯¿ä¹‹åŸºã€‚" }, female: { c:"[å¤©èµ‹] ä»¥æŸ”å…‹åˆšã€‚", w:"[è´¢å¯Œ] ç”Ÿæ´»æ»‹æ¶¦ã€‚", l:"[ç¾ç»Š] è´¤å†…åŠ©ã€‚", k:"[ä¼ æ‰¿] é™ªä¼´ã€‚", h:"[é”¦å›Š] å…»ç”Ÿè¾¾äººã€‚" } },
        "æ‚æ ¼": { name: "ğŸŒ± æ½œé¾™å‹¿ç”¨", tags: ["N","æ½œåŠ›"], icon: "ğŸŒ±", slogan: "æ—¶è¿æœªåˆ°ï¼Œæ½œå¿ƒä¿®ç‚¼ã€‚", male: { c:"[å¤©èµ‹] ç»¼åˆå¹³è¡¡ã€‚", w:"[è´¢å¯Œ] å‹¤åŠ³å°åº·ã€‚", l:"[ç¾ç»Š] å¹³æ·¡æ˜¯çœŸã€‚", k:"[ä¼ æ‰¿] å¥åº·å¹³å®‰ã€‚", h:"[é”¦å›Š] é”»ç‚¼èº«ä½“ã€‚" }, female: { c:"[å¤©èµ‹] è¸å®åå‹¤ã€‚", w:"[è´¢å¯Œ] èŠ‚ä¿­æŒå®¶ã€‚", l:"[ç¾ç»Š] ä¾é è€å®äººã€‚", k:"[ä¼ æ‰¿] æ…ˆæ¯å¿ƒã€‚", h:"[é”¦å›Š] ä¿è¯ç¡çœ ã€‚" } }
    };

    const XIJI_RULES = {
        "é‡‘æ°´ä¼¤å®˜": { desc: "å†¬é‡‘æå¯’ï¼Œå¿…ç”¨ç«ï¼ˆå®˜æ€ï¼‰è°ƒå€™ã€‚æ­¤æ ¼è§ç«å³æ¿€æ´»æ˜¾è´µï¼Œä¸»å¼‚è·¯åŠŸåã€‚", joy: ["ğŸ”¥ ç« (è°ƒå€™)","ğŸŒ² æœ¨ (è´¢æ˜Ÿ)"], taboo: ["ğŸ’§ æ°´ (ä¼¤å®˜)","â›°ï¸ åœŸ (åŸ‹é‡‘)"] },
        "é‡‘æ°´é£Ÿç¥": { desc: "é‡‘ç™½æ°´æ¸…ã€‚å–œç«è°ƒå€™ã€‚è‹¥æ— ç«ï¼Œåˆ™æ‰åæµäºå­¤å†·ï¼Œéš¾è·ä¸–ä¿—åŠŸåã€‚", joy: ["ğŸ”¥ ç« (æš–å±€)","ğŸŒ² æœ¨ (é€šå…³)"], taboo: ["â›°ï¸ åœŸ (å¤ºé£Ÿ)","ğŸ’§ æ°´ (æ²‰æ²¦)"] },
        "æœ¨ç«é€šæ˜": { desc: "æœ¨ç”Ÿæ˜¥æœˆï¼Œè§ç«æ³„ç§€ã€‚å¿Œé‡‘å…‹ä¼ï¼Œå¿Œæ°´ç­ç«ã€‚æ–‡å½©é£æµï¼Œåæ‰¬å¤©ä¸‹ã€‚", joy: ["ğŸ”¥ ç« (æ³„ç§€)","ğŸŒ² æœ¨ (åŠ©åŠ¿)"], taboo: ["ğŸ—¡ï¸ é‡‘ (å…‹æœ¨)","ğŸ’§ æ°´ (ç­ç«)"] },
        "ä¼¤å®˜é…å°": { desc: "å±€ä¸­ä¼¤å®˜æœ‰åŠ›ï¼Œä¸”æ°´å°æŠ¤èº«ã€‚çŠ¹å¦‚ç‹‚é£™ä¹‹é©¬é…ä»¥é‡‘ç»œï¼Œæ–‡æ­¦å…¼å¤‡ã€‚è°ƒå€™å¾—åŠ›ã€‚", joy: ["ğŸ’§ æ°´ (å°æ˜Ÿ)","ğŸŒ² æœ¨ (å¸®èº«)"], taboo: ["â›°ï¸ åœŸ (åå°)","ğŸ”¥ ç« (ç‡¥çƒ­)"] },
        "ä¼¤å®˜åˆæ€": { desc: "ä¼¤æ€ä¸¤æ—ºï¼Œåˆæ€ä¸ºæƒã€‚ä»¥æ™ºæ…§è°‹ç•¥åŒ–è§£å±æœºï¼Œå…¸å‹çš„'é™©ä¸­æ±‚è´µ'ä¹‹æ ¼ã€‚", joy: ["ğŸ“œ å°æ˜Ÿ","ğŸ’ª æ¯”åŠ«"], taboo: ["ğŸ’° è´¢æ˜Ÿ","ğŸ—¡ï¸ å®˜æ€"] },
        "é£Ÿç¥åˆ¶æ€": { desc: "ä¸ƒæ€æœ‰åŠ›ï¼Œé£Ÿç¥åˆ¶ä¹‹ã€‚èº«å¼ºæ€æµ…ï¼ŒæƒæŸ„æé‡ã€‚", joy: ["ğŸ¨ é£Ÿç¥","ğŸ“œ å°æ˜Ÿ"], taboo: ["ğŸ’° è´¢æ˜Ÿ","ğŸ—¡ï¸ å®˜æ€"] },
        "æ€å°ç›¸ç”Ÿ": { desc: "æ€åŠ¿æ±¹æ±¹ï¼Œèµ–å°åŒ–ä¹‹ã€‚åŒ–ç…ä¸ºæƒï¼Œä¸»æ­¦èŒæˆ–æŒæ¡å®æƒçš„ç®¡ç†è€…ã€‚", joy: ["ğŸ“œ å°æ˜Ÿ","ğŸ’ª æ¯”åŠ«"], taboo: ["ğŸ’° è´¢æ˜Ÿ","ğŸ—¡ï¸ å®˜æ€"] },
        "æ­£è´¢æ ¼": { desc: "è´¢æ˜Ÿå½“ä»¤ï¼Œæ±‚è´¢æœ‰é“ã€‚èº«å¼ºä»»è´¢ï¼Œèº«å¼±å–œå°æ¯”ã€‚æ­¥æ­¥ä¸ºè¥ä¹‹å¯Œã€‚", joy: ["ğŸ’ª æ¯”åŠ«","ğŸ“œ å°æ˜Ÿ"], taboo: ["ğŸ’° è´¢ (èº«å¼±)","ğŸ—¡ï¸ å®˜æ€"] },
        "åè´¢æ ¼": { desc: "åè´¢å½“ä»¤ï¼Œæ…·æ…¨å¤§æ–¹ã€‚å–œå®˜æ€æŠ¤è´¢ï¼Œå–œé£Ÿä¼¤ç”Ÿè´¢ã€‚", joy: ["ğŸ—¡ï¸ å®˜æ€","ğŸ¨ é£Ÿä¼¤"], taboo: ["ğŸ’ª æ¯”åŠ«","ç©ºäº¡"] },
        "æ­£å®˜æ ¼": { desc: "æ­£å®˜çº¯æ­£ï¼Œè´µæ°”å¤©ç„¶ã€‚å–œè´¢ç”Ÿå®˜ï¼Œå–œå°æŠ¤å®˜ã€‚å¿Œä¼¤å®˜è§å®˜ã€‚", joy: ["ğŸ’° è´¢æ˜Ÿ","ğŸ“œ å°æ˜Ÿ"], taboo: ["ğŸ¨ ä¼¤å®˜","ğŸ—¡ï¸ ä¸ƒæ€"] },
        "ä¸ƒæ€æ ¼": { desc: "æ€ç¥å¨ä¸¥ã€‚éœ€åˆ¶åŒ–æ–¹æˆå¤§æ ¼ã€‚æ— åˆ¶åˆ™å‹åŠ›é‡é‡ï¼Œç¾å„ä¸›ç”Ÿã€‚", joy: ["ğŸ¨ é£Ÿä¼¤ (åˆ¶)","ğŸ“œ å°æ˜Ÿ (åŒ–)"], taboo: ["ğŸ’° è´¢æ˜Ÿ (åŠ©æ€)"] },
        "æ­£å°æ ¼": { desc: "å°ç»¶ç”Ÿèº«ï¼Œæ…ˆæ‚²æ¸©åšã€‚å–œå®˜æ€ç”Ÿå°ï¼Œå¿Œè´¢åå°ã€‚", joy: ["ğŸ—¡ï¸ å®˜æ€","ğŸ’ª æ¯”åŠ«"], taboo: ["ğŸ’° è´¢æ˜Ÿ"] },
        "åå°æ ¼": { desc: "åå°å½“æƒï¼Œé¬¼æ‰é€»è¾‘ã€‚å–œåè´¢åˆ¶æ­ã€‚", joy: ["ğŸ’° åè´¢","å¤©æœˆå¾·"], taboo: ["ğŸ¨ é£Ÿç¥"] },
        "é£Ÿç¥æ ¼": { desc: "é£Ÿç¥ç”Ÿè´¢ï¼Œç¦å¯¿åŒå…¨ã€‚å¿Œæ­ç¥å¤ºé£Ÿã€‚", joy: ["ğŸ’° è´¢æ˜Ÿ","ğŸ’ª æ¯”åŠ«"], taboo: ["ğŸ“œ åå°"] },
        "ä¼¤å®˜æ ¼": { desc: "ä¼¤å®˜å½“ä»¤ï¼Œæ‰åæ¨ªæº¢ã€‚éœ€å°åˆ¶æˆ–è´¢åŒ–ã€‚", joy: ["ğŸ“œ å°æ˜Ÿ","ğŸ’° è´¢æ˜Ÿ"], taboo: ["ğŸ—¡ï¸ å®˜æ€","ğŸ’ª æ¯”åŠ«"] },
        "ä¼¤å®˜ç”Ÿè´¢": { desc: "ä¼¤å®˜æœ‰æ ¹ï¼Œç”Ÿè´¢æœ‰æƒ…ã€‚æŠ€è‰ºè‡´å¯Œã€‚", joy: ["ğŸ’° è´¢æ˜Ÿ","ğŸ¨ ä¼¤å®˜"], taboo: ["ğŸ“œ å°æ˜Ÿ","ğŸ’ª æ¯”åŠ«"] },
        "é£Ÿç¥ç”Ÿè´¢": { desc: "é£Ÿç¥æœ‰æ ¹ï¼Œç”Ÿè´¢å®‰ç¨³ã€‚ç¦æ°”ä¹‹å±€ã€‚", joy: ["ğŸ’° è´¢æ˜Ÿ","ğŸ¨ é£Ÿç¥"], taboo: ["ğŸ“œ åå°","ğŸ—¡ï¸ å®˜æ€"] },
        "å»ºç¦„æ ¼": { desc: "æœˆä»¤å»ºç¦„ï¼Œèº«å¼ºè´¢å¼±ã€‚å–œè´¢å®˜é£Ÿä¼¤æ³„ç§€ã€‚", joy: ["ğŸ’° è´¢æ˜Ÿ","ğŸ—¡ï¸ å®˜æ€"], taboo: ["ğŸ’ª æ¯”åŠ«","ğŸ“œ å°æ˜Ÿ"] },
        "æœˆåŠ«æ ¼": { desc: "æœˆä»¤åŠ«è´¢ï¼Œäº‰è´¢å¤ºåˆ©ã€‚éœ€å®˜æ€åˆ¶åŠ«æˆ–é£Ÿä¼¤åŒ–åŠ«ã€‚", joy: ["ğŸ—¡ï¸ å®˜æ€","ğŸ¨ é£Ÿä¼¤"], taboo: ["ğŸ’ª æ¯”åŠ«","ğŸ“œ å°æ˜Ÿ"] },
        "æ‚æ ¼": { desc: "æ ¼å±€æœªæ¸…ï¼Œäº”è¡Œæ‚å±…ã€‚å…¨å‡­æ‰¶æŠ‘è°ƒå€™ï¼Œéœ€çœ‹æ—¥ä¸»åº•è•´ã€‚", joy: ["æ‰¶åŠ©ç”¨ç¥"], taboo: ["å…‹å®³ç”¨ç¥"] }
    };

    // --- ç®—æ³•æ ¸å¿ƒ ---
    let currentGender = 1;

    function safeSetText(id, text) { const el = document.getElementById(id); if (el) el.innerText = text; }
    function safeSetHTML(id, html) { const el = document.getElementById(id); if (el) el.innerHTML = html; }

    function hasRoot(gan, pillars) {
        const roots = ROOT_MAP[gan] || [];
        return pillars.some(p => roots.includes(p.z));
    }

    function calcCommander(lunar, mz) {
        const pj = lunar.getPrevJie();
        const s = lunar.getSolar();
        const pjs = pj.getSolar();
        // åŸç”Ÿè®¡ç®—
        const d1 = new Date(s.getYear(), s.getMonth()-1, s.getDay(), s.getHour(), s.getMinute());
        const d2 = new Date(pjs.getYear(), pjs.getMonth()-1, pjs.getDay(), pjs.getHour(), pjs.getMinute());
        const diff = Math.floor((d1.getTime() - d2.getTime()) / (1000 * 60 * 60 * 24));
        const rules = SILING_RULES[mz];
        let commander = rules[rules.length-1][0]; 
        let sum = 0;
        for (let r of rules) { sum += r[1]; if (diff < sum) { commander = r[0]; break; } }
        return { commander, diffDays: diff };
    }

    function determinePattern(climate, pillars, dm, mz, cmd) {
        if (climate.special) return climate.special;
        const stems = [pillars[0].g, pillars[1].g, pillars[3].g];
        const gods = stems.map(s => SHISHEN_MAP[dm][s]);

        // 1. æ€æ˜Ÿç»„åˆ (æœ‰æ€å…ˆè®ºæ€)
        if (gods.includes("ä¸ƒæ€")) {
            if (gods.includes("ä¼¤å®˜")) return "ä¼¤å®˜åˆæ€";
            if (gods.includes("é£Ÿç¥") && stems.some(s => SHISHEN_MAP[dm][s]==="é£Ÿç¥" && hasRoot(s, pillars))) return "é£Ÿç¥åˆ¶æ€";
            if (gods.includes("æ­£å°") || gods.includes("åå°")) return "æ€å°ç›¸ç”Ÿ";
        }
        // 2. ä¼¤å®˜ä¼˜å…ˆ
        if (gods.includes("ä¼¤å®˜")) {
            const sgStem = stems.find(s => SHISHEN_MAP[dm][s] === "ä¼¤å®˜");
            if (hasRoot(sgStem, pillars)) {
                if (gods.includes("æ­£å°") || gods.includes("åå°")) {
                    if (stems.some(s => (SHISHEN_MAP[dm][s]==="æ­£å°" || SHISHEN_MAP[dm][s]==="åå°") && hasRoot(s, pillars))) return "ä¼¤å®˜é…å°";
                }
                if (gods.some(g => g && g.includes("è´¢"))) return "ä¼¤å®˜ç”Ÿè´¢";
                return "ä¼¤å®˜æ ¼";
            }
        }
        // 3. é£Ÿç¥
        if (gods.includes("é£Ÿç¥") && stems.some(s => SHISHEN_MAP[dm][s]==="é£Ÿç¥" && hasRoot(s, pillars))) {
             if (gods.some(g => g && g.includes("è´¢"))) return "é£Ÿç¥ç”Ÿè´¢";
             return "é£Ÿç¥æ ¼";
        }
        // 4. çœŸç¥å®šæ ¼
        if (stems.includes(cmd.commander)) {
            const g = SHISHEN_MAP[dm][cmd.commander];
            const m = {"æ­£è´¢":"æ­£è´¢æ ¼","åè´¢":"åè´¢æ ¼","æ­£å®˜":"æ­£å®˜æ ¼","æ­£å°":"æ­£å°æ ¼","åå°":"åå°æ ¼","é£Ÿç¥":"é£Ÿç¥æ ¼","ä¼¤å®˜":"ä¼¤å®˜æ ¼","ä¸ƒæ€":"ä¸ƒæ€æ ¼"};
            if (m[g]) return m[g];
        }
        // 5. æœ¬æ°”å…œåº•
        const mzMainGod = SHISHEN_MAP[dm][ZHI_MAIN_QI[mz]];
        const fallback = {"æ­£è´¢":"æ­£è´¢æ ¼","åè´¢":"åè´¢æ ¼","æ­£å®˜":"æ­£å®˜æ ¼","ä¸ƒæ€":"ä¸ƒæ€æ ¼","æ­£å°":"æ­£å°æ ¼","åå°":"åå°æ ¼","é£Ÿç¥":"é£Ÿç¥æ ¼","ä¼¤å®˜":"ä¼¤å®˜æ ¼","æ¯”è‚©":"å»ºç¦„æ ¼","åŠ«è´¢":"æœˆåŠ«æ ¼"};
        return fallback[mzMainGod] || "æ‚æ ¼";
    }

    function startScan() {
        const timeStr = document.getElementById('birth-input').value;
        if (!timeStr) return alert("è¯·é€‰æ‹©æ—¶åˆ»");
        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const baziObj = lunar.getEightChar();
            baziObj.setSect(2);

            const pillars = [
                {t:'å¹´æŸ±', g:baziObj.getYearGan().toString(), z:baziObj.getYearZhi().toString()},
                {t:'æœˆæŸ±', g:baziObj.getMonthGan().toString(), z:baziObj.getMonthZhi().toString()},
                {t:'æ—¥æŸ±', g:baziObj.getDayGan().toString(), z:baziObj.getDayZhi().toString()},
                {t:'æ—¶æŸ±', g:baziObj.getTimeGan().toString(), z:baziObj.getTimeZhi().toString()}
            ];

            const dm = pillars[2].g, mz = pillars[1].z;
            const cmd = calcCommander(lunar, mz);
            
            // è°ƒå€™é€»è¾‘
            const isWinter = ["äº¥","å­","ä¸‘"].includes(mz);
            const isSummer = ["å·³","åˆ","æœª"].includes(mz);
            const hasFire = pillars.some(p => WUXING_MAP[p.g]==='ç«' || WUXING_MAP[p.z]==='ç«');
            const hasWater = pillars.some(p => WUXING_MAP[p.g]==='æ°´' || WUXING_MAP[p.z]==='æ°´');
            
            let actStatus = "åŸæ ¼æ”¯æ’‘ Â· ç¨³å›ºä¸­å’Œ";
            let actDesc = "æ ¼å±€åŸºæœ¬åŠŸæ‰å®ï¼Œè™½æ— ç‰¹æ®Šæ¿€æ´»ï¼Œä½†èƒœåœ¨å¹³ç¨³é•¿ä¹…ã€‚";

            if ((WUXING_MAP[dm]==='é‡‘' && isWinter && hasFire) || 
                (WUXING_MAP[dm]==='æœ¨' && isSummer && hasWater) ||
                (WUXING_MAP[dm]==='åœŸ' && isWinter && hasFire)) {
                actStatus = "ğŸ”¥ ç´«æ°”ä¸œæ¥ Â· æ ¼å±€å˜è´µ";
                actDesc = "å±€ä¸­è§è°ƒå€™â€œå¥¢ä¾ˆå“â€ï¼ŒçŠ¹å¦‚å¯’é‡‘é‡ç«ã€ç„¦æœ¨é€¢é›¨ã€‚åŸæ ¼åŠ›é‡ç¬é—´è·ƒè¿ï¼Œååˆ©åŒæ”¶ä¹‹è±¡ã€‚";
            }

            const climate = { special: null };
            if (WUXING_MAP[dm]==='é‡‘' && isWinter) climate.special = pillars.some(p => SHISHEN_MAP[dm][p.g]==='ä¼¤å®˜') ? "é‡‘æ°´ä¼¤å®˜" : "é‡‘æ°´é£Ÿç¥";
            if (WUXING_MAP[dm]==='æœ¨' && ["å¯…","å¯"].includes(mz) && hasFire) climate.special = "æœ¨ç«é€šæ˜";
            if (WUXING_MAP[dm]==='æœ¨' && isSummer && hasWater && pillars.some(p => SHISHEN_MAP[dm][p.g]==='ä¼¤å®˜' && hasRoot(p.g, pillars))) climate.special = "ä¼¤å®˜é…å°";

            const pattern = determinePattern(climate, pillars, dm, mz, cmd);
            
            document.getElementById('result-area').style.display = 'block';
            
            safeSetText('activation-status', actStatus);
            safeSetText('activation-desc', actDesc);
            renderUI(pattern, cmd, dm, pillars);
            
            setTimeout(() => drawChart(pillars), 100);
            document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
        } catch (e) { alert("é‘‘å®šä¸­æ–­ï¼š" + e.message); console.error(e); }
    }

    function renderUI(key, cmd, dm, pillars) {
        const data = GAME_DB[key] || GAME_DB["æ‚æ ¼"];
        const xiji = XIJI_RULES[key] || XIJI_RULES["æ‚æ ¼"];
        const detail = data[currentGender === 1 ? 'male' : 'female'];

        safeSetText('role-icon', data.icon);
        safeSetText('role-title', data.name);
        safeSetText('role-sub', data.slogan);
        safeSetHTML('role-tags', `<span class="tag ssr">${key}</span><span class="tag">ä½é˜¶:${data.tags[0]}</span>`);
        safeSetText('siling-text', `${cmd.commander} (${SHISHEN_MAP[dm][cmd.commander] || 'çœŸç¥'}) Â· æŒæƒ ${cmd.diffDays} æ—¥`);
        safeSetText('pattern-reason', xiji.desc);
        safeSetText('txt-joy', xiji.joy.join(" / "));
        safeSetText('txt-taboo', xiji.taboo.join(" / "));

        let p_html = '';
        pillars.forEach(p => {
            const god = p.t.includes('æ—¥') ? 'å…ƒç¥' : (SHISHEN_MAP[dm][p.g] || "");
            p_html += `<div class="ofuda"><div class="ofuda-god">${god}</div><div class="ofuda-char" style="color:${WX_COLOR_DATA[WUXING_MAP[p.g]]}">${p.g}</div><div class="ofuda-char" style="color:${WX_COLOR_DATA[WUXING_MAP[p.z]]}">${p.z}</div><div class="ofuda-head">${p.t}æŸ±</div><span class="ofuda-cs">${CHANGSHENG_TABLE[p.g][p.z] || ""}</span></div>`;
        });
        document.getElementById('pillars-box').innerHTML = p_html;

        document.getElementById('guide-content').innerHTML = `
            <div class="guide-item"><div class="guide-title">âš”ï¸ äº‹ä¸šæ‰æƒ…</div><div class="guide-text">${detail.c}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ’° è´¢å¯Œæ°”æ•°</div><div class="guide-text">${detail.w}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ’ æƒ…ç¼˜ç¾ç»Š</div><div class="guide-text">${detail.l}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸŒ± åä»£ä¼ æ‰¿</div><div class="guide-text">${detail.k}</div></div>
            <div class="guide-item"><div class="guide-title">ğŸ›¡ï¸ å®æˆ˜é”¦å›Š</div><div class="guide-text">${detail.h}</div></div>
        `;
    }

    function drawChart(pillars) {
        const canvas = document.getElementById('energy-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const w = canvas.offsetWidth, h = canvas.offsetHeight;
        canvas.width = w; canvas.height = h;
        const counts = {'é‡‘':0,'æœ¨':0,'æ°´':0,'ç«':0,'åœŸ':0};
        pillars.forEach(p => { counts[WUXING_MAP[p.g]]++; counts[WUXING_MAP[p.z]]++; });
        const cx = w/2, cy = h/2, r = 70;
        ctx.strokeStyle = "#eee";
        for(let j=1; j<=3; j++) {
            ctx.beginPath();
            for(let i=0; i<5; i++) {
                const a = (Math.PI*2/5)*i - Math.PI/2;
                ctx.lineTo(cx + Math.cos(a)*r*(j/3), cy + Math.sin(a)*r*(j/3));
            }
            ctx.closePath(); ctx.stroke();
        }
        ctx.fillStyle = "rgba(162, 45, 41, 0.2)"; ctx.strokeStyle = "#a22d29"; ctx.lineWidth = 3;
        ctx.beginPath();
        Object.keys(counts).forEach((k, i) => {
            const a = (Math.PI*2/5)*i - Math.PI/2;
            const l = (counts[k]/8)*r*3.5; 
            const x = cx + Math.cos(a)*l, y = cy + Math.sin(a)*l;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.closePath(); ctx.fill(); ctx.stroke();
        Object.keys(counts).forEach((k, i) => {
            const a = (Math.PI*2/5)*i - Math.PI/2;
            ctx.fillStyle = "#333"; ctx.font = "bold 13px serif";
            ctx.fillText(k, cx + Math.cos(a)*(r+25)-5, cy + Math.sin(a)*(r+25)+5);
        });
    }

    function setGender(v, el) { currentGender = v; document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
    window.onload = function() {
        try {
            const now = new Date();
            const str = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('birth-input').value = str;
        } catch(e){}
    };
</script>
</body>
</html>
