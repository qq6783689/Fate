<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‘½è¿é»‘ç›’ Pro Max Â· ç¨³å¦‚æ³°å±±ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        :root {
            /* èµ›åšç„å­¦é…è‰² */
            --primary: #ff4757;      
            --success: #2ed573;     
            --dark: #2f3542;         
            --gray: #747d8c;         
            --bg: #f1f2f6;          
            --purple: #5352ed;
            --gold: #ffa502;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; 
            background: var(--bg); color: var(--dark);
            margin: 0; padding: 20px 10px;
            min-height: 100vh;
            background-image: radial-gradient(#dfe4ea 15%, transparent 16%); 
            background-size: 30px 30px;
            display: flex; justify-content: center;
        }

        .container {
            width: 100%; max-width: 650px;
            padding-bottom: 50px;
        }

        /* æ ‡é¢˜åŒº */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { 
            font-size: 28px; font-weight: 900; margin: 0; letter-spacing: 2px;
            background: linear-gradient(135deg, var(--dark), var(--primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .energy-bar {
            height: 4px; width: 60px; margin: 10px auto 0; border-radius: 2px;
            background: linear-gradient(90deg, var(--purple), var(--primary), var(--gold));
        }

        /* å¡ç‰‡é€šç”¨ */
        .card {
            background: var(--card-bg); border-radius: var(--radius);
            padding: 20px; margin-bottom: 20px;
            box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,0.8);
            position: relative; overflow: hidden;
        }

        /* è¾“å…¥åŒº */
        .input-group { margin-bottom: 15px; }
        .label { display: block; font-weight: bold; font-size: 14px; margin-bottom: 8px; color: var(--gray); }
        
        .gender-switch { display: flex; gap: 10px; margin-bottom: 15px; }
        .g-btn {
            flex: 1; padding: 12px; text-align: center; border-radius: 10px; font-weight: bold; font-size: 14px;
            background: #f1f2f6; color: #a4b0be; cursor: pointer; transition: all 0.3s;
            border: 2px solid transparent;
        }
        .g-btn.active {
            background: rgba(255, 71, 87, 0.05); color: var(--primary); border-color: var(--primary);
        }

        input[type="datetime-local"] {
            width: 100%; padding: 14px; border: 2px solid #e1e4e8; border-radius: 10px;
            font-size: 16px; outline: none; background: #f8f9fa; transition: 0.3s;
            -webkit-appearance: none;
        }
        input:focus { border-color: var(--primary); background: #fff; }

        .btn-calc {
            width: 100%; padding: 16px; border: none; border-radius: 50px;
            background: var(--dark); color: #fff; font-size: 18px; font-weight: bold;
            cursor: pointer; box-shadow: 0 8px 20px rgba(47, 53, 66, 0.25);
            transition: transform 0.2s;
        }
        .btn-calc:active { transform: scale(0.98); }

        /* ç»“æœå±•ç¤ºåŒº */
        #result-area { display: none; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:translateY(0); } }

        /* æ„è±¡ç”» Canvas */
        .art-box {
            height: 200px; border-radius: var(--radius); overflow: hidden; margin-bottom: 20px;
            position: relative; box-shadow: var(--shadow); border: 1px solid #fff;
        }
        canvas { width: 100%; height: 100%; display: block; }
        .art-tag {
            position: absolute; bottom: 10px; right: 10px; background: rgba(255,255,255,0.9);
            padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: var(--dark);
        }

        /* å››æŸ±æ’ç›˜ */
        .section-title { font-size: 16px; font-weight: 800; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .section-title::before { content:''; width:4px; height:16px; background:var(--primary); border-radius:2px; }

        .pillars-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .pillar {
            background: #fdfdfd; border: 1px solid #eee; border-radius: 10px;
            padding: 12px 2px; text-align: center; display: flex; flex-direction: column; align-items: center;
        }
        .p-head { font-size: 11px; color: #b2bec3; margin-bottom: 5px; }
        .god-tag { font-size: 10px; color: #636e72; height: 14px; margin-bottom: 2px; }
        .char { font-family: "KaiTi", "æ¥·ä½“", serif; font-size: 24px; font-weight: bold; line-height: 1.1; }
        .hidden-gan { font-size: 10px; color: #95a5a6; margin-top: 4px; transform: scale(0.9); white-space: nowrap; }
        
        /* è‡ªåé•¿ç”Ÿæ ‡ç­¾ */
        .cs-tag {
            font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-top: 6px;
            background: #f1f2f6; color: #a4b0be; transform: scale(0.9); white-space: nowrap;
        }
        .cs-strong { background: #fff3e0; color: #d35400; font-weight: bold; }

        /* äº”è¡Œè‰² */
        .wx-é‡‘ { color: #E6B33D; } .wx-æœ¨ { color: #27AE60; } .wx-æ°´ { color: #2980B9; } .wx-ç« { color: #C0392B; } .wx-åœŸ { color: #8D6E63; }

        /* æ·±åº¦åˆ†æç›’å­ */
        .deep-analysis {
            background: #fffbf0; border: 1px solid #fae3c4; padding: 15px; border-radius: 12px;
            font-size: 13px; line-height: 1.6; margin-bottom: 20px; color: #574b35;
        }
        .highlight { color: #d35400; font-weight: bold; }
        .tag-wang { background: #e8f5e9; color: #27ae60; padding: 1px 4px; border-radius: 3px; font-weight: bold; }
        .tag-shuai { background: #ffebee; color: #c0392b; padding: 1px 4px; border-radius: 3px; font-weight: bold; }

        /* äº”ç»´å¡ç‰‡ */
        .dim-row { display: flex; margin-bottom: 20px; align-items: flex-start; }
        .dim-icon { 
            width: 36px; height: 36px; background: #f1f2f6; border-radius: 50%; 
            text-align: center; line-height: 36px; font-size: 18px; margin-right: 12px; flex-shrink: 0;
        }
        .dim-content { flex: 1; }
        .dim-title { font-weight: bold; font-size: 15px; margin-bottom: 6px; color: var(--dark); }
        .dim-text { font-size: 13px; color: #636e72; line-height: 1.6; text-align: justify; }

        #error-msg { display:none; background:#ff7675; color:#fff; padding:10px; border-radius:8px; text-align:center; margin-bottom:15px; font-size:12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>å‘½è¿é»‘ç›’ Pro Max</h1>
        <div class="energy-bar"></div>
        <p>50å¹´ç»éªŒ Â· äººå…ƒå¸ä»¤ Â· äº”ç»´è§£å¯†</p>
    </div>

    <div id="error-msg">âš ï¸ æ ¸å¿ƒç»„ä»¶åŠ è½½å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ (jsDelivr)</div>

    <div class="card">
        <div class="input-group">
            <span class="label">æ€§åˆ« (Gender)</span>
            <div class="gender-switch">
                <div class="g-btn active" onclick="setGender(1, this)">ä¹¾é€  (ç”·)</div>
                <div class="g-btn" onclick="setGender(0, this)">å¤é€  (å¥³)</div>
            </div>
        </div>
        <div class="input-group">
            <span class="label">å‡ºç”Ÿæ—¶é—´ (å…¬å†)</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-calc" onclick="calculateDestiny()">å¼€å§‹æ¨æ¼”</button>
    </div>

    <div id="result-area">
        <div class="art-box">
            <canvas id="fate-canvas"></canvas>
            <div class="art-tag" id="art-tag">å‘½å±€å›¾æ™¯</div>
        </div>

        <div class="card">
            <div class="section-title">å››æŸ±æ’ç›˜ Â· è—å¹² Â· é•¿ç”Ÿ</div>
            <div class="pillars-grid" id="pillars-box"></div>
        </div>

        <div class="card">
            <div class="section-title">é«˜é˜¶æ ¼å±€ Â· å¸ä»¤çœŸç¥</div>
            <div id="commander-box" class="deep-analysis"></div>
            <div style="margin-top:10px;">
                <div style="font-size:18px; font-weight:900; color:var(--dark);" id="pattern-name">...</div>
                <div style="font-size:12px; color:var(--gray); font-style:italic;" id="pattern-slogan">...</div>
            </div>
        </div>

        <div class="card">
            <div class="section-title">äº”ç»´å¤©å‘½æŒ‡å—</div>
            <div id="five-dim-box"></div>
        </div>

        <div style="text-align:center; color:#ccc; font-size:12px; margin-top:20px;">
            Destiny Algorithm Â© 2025
        </div>
    </div>
</div>

<script>
    let currentGender = 1; // 1ç”· 0å¥³

    // ==========================================================
    // é™æ€æ•°æ®å­—å…¸ (æ ¸å¿ƒï¼šæ‰€æœ‰æŸ¥è¯¢å‡åŸºäºæ­¤ï¼Œä¸ä¾èµ–åº“å‡½æ•°æ–¹æ³•)
    // ==========================================================
    
    // äº”è¡Œæ˜ å°„è¡¨
    const WUXING_MAP = {
        'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ','åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´',
        'å­':'æ°´','ä¸‘':'åœŸ','å¯…':'æœ¨','å¯':'æœ¨','è¾°':'åœŸ','å·³':'ç«','åˆ':'ç«','æœª':'åœŸ','ç”³':'é‡‘','é…‰':'é‡‘','æˆŒ':'åœŸ','äº¥':'æ°´'
    };
    const WX_COLOR = { 'é‡‘':'wx-é‡‘', 'æœ¨':'wx-æœ¨', 'æ°´':'wx-æ°´', 'ç«':'wx-ç«', 'åœŸ':'wx-åœŸ' };

    // è—å¹²æŸ¥è¯¢è¡¨
    const HIDDEN_GAN_MAP = {
        'å­':['ç™¸'], 'ä¸‘':['å·±','ç™¸','è¾›'], 'å¯…':['ç”²','ä¸™','æˆŠ'], 'å¯':['ä¹™'], 
        'è¾°':['æˆŠ','ä¹™','ç™¸'], 'å·³':['ä¸™','æˆŠ','åºš'], 'åˆ':['ä¸','å·±'], 'æœª':['å·±','ä¸','ä¹™'], 
        'ç”³':['åºš','å£¬','æˆŠ'], 'é…‰':['è¾›'], 'æˆŒ':['æˆŠ','è¾›','ä¸'], 'äº¥':['å£¬','ç”²']
    };

    // è‡ªåé•¿ç”Ÿè¡¨
    const CHANGSHENG_TABLE = {
        "ç”²": { "äº¥":"é•¿ç”Ÿ", "å­":"æ²æµ´", "ä¸‘":"å† å¸¦", "å¯…":"ä¸´å®˜", "å¯":"å¸æ—º", "è¾°":"è¡°", "å·³":"ç—…", "åˆ":"æ­»", "æœª":"å¢“", "ç”³":"ç»", "é…‰":"èƒ", "æˆŒ":"å…»" },
        "ä¹™": { "åˆ":"é•¿ç”Ÿ", "å·³":"æ²æµ´", "è¾°":"å† å¸¦", "å¯":"ä¸´å®˜", "å¯…":"å¸æ—º", "ä¸‘":"è¡°", "å­":"ç—…", "äº¥":"æ­»", "æˆŒ":"å¢“", "é…‰":"ç»", "ç”³":"èƒ", "æœª":"å…»" },
        "ä¸™": { "å¯…":"é•¿ç”Ÿ", "å¯":"æ²æµ´", "è¾°":"å† å¸¦", "å·³":"ä¸´å®˜", "åˆ":"å¸æ—º", "æœª":"è¡°", "ç”³":"ç—…", "é…‰":"æ­»", "æˆŒ":"å¢“", "äº¥":"ç»", "å­":"èƒ", "ä¸‘":"å…»" },
        "ä¸": { "é…‰":"é•¿ç”Ÿ", "ç”³":"æ²æµ´", "æœª":"å† å¸¦", "åˆ":"ä¸´å®˜", "å·³":"å¸æ—º", "è¾°":"è¡°", "å¯":"ç—…", "å¯…":"æ­»", "ä¸‘":"å¢“", "å­":"ç»", "äº¥":"èƒ", "æˆŒ":"å…»" },
        "æˆŠ": { "å¯…":"é•¿ç”Ÿ", "å¯":"æ²æµ´", "è¾°":"å† å¸¦", "å·³":"ä¸´å®˜", "åˆ":"å¸æ—º", "æœª":"è¡°", "ç”³":"ç—…", "é…‰":"æ­»", "æˆŒ":"å¢“", "äº¥":"ç»", "å­":"èƒ", "ä¸‘":"å…»" },
        "å·±": { "é…‰":"é•¿ç”Ÿ", "ç”³":"æ²æµ´", "æœª":"å† å¸¦", "åˆ":"ä¸´å®˜", "å·³":"å¸æ—º", "è¾°":"è¡°", "å¯":"ç—…", "å¯…":"æ­»", "ä¸‘":"å¢“", "å­":"ç»", "äº¥":"èƒ", "æˆŒ":"å…»" },
        "åºš": { "å·³":"é•¿ç”Ÿ", "åˆ":"æ²æµ´", "æœª":"å† å¸¦", "ç”³":"ä¸´å®˜", "é…‰":"å¸æ—º", "æˆŒ":"è¡°", "äº¥":"ç—…", "å­":"æ­»", "ä¸‘":"å¢“", "å¯…":"ç»", "å¯":"èƒ", "è¾°":"å…»" },
        "è¾›": { "å­":"é•¿ç”Ÿ", "äº¥":"æ²æµ´", "æˆŒ":"å† å¸¦", "é…‰":"ä¸´å®˜", "ç”³":"å¸æ—º", "æœª":"è¡°", "åˆ":"ç—…", "å·³":"æ­»", "è¾°":"å¢“", "å¯":"ç»", "å¯…":"èƒ", "ä¸‘":"å…»" },
        "å£¬": { "ç”³":"é•¿ç”Ÿ", "é…‰":"æ²æµ´", "æˆŒ":"å† å¸¦", "äº¥":"ä¸´å®˜", "å­":"å¸æ—º", "ä¸‘":"è¡°", "å¯…":"ç—…", "å¯":"æ­»", "è¾°":"å¢“", "å·³":"ç»", "åˆ":"èƒ", "æœª":"å…»" },
        "ç™¸": { "å¯":"é•¿ç”Ÿ", "å¯…":"æ²æµ´", "ä¸‘":"å† å¸¦", "å­":"ä¸´å®˜", "äº¥":"å¸æ—º", "æˆŒ":"è¡°", "é…‰":"ç—…", "ç”³":"æ­»", "æœª":"å¢“", "åˆ":"ç»", "å·³":"èƒ", "è¾°":"å…»" }
    };
    const STRONG_CS = ["é•¿ç”Ÿ", "å¸æ—º", "ä¸´å®˜", "å† å¸¦"]; 

    // åç¥æŸ¥è¯¢è¡¨
    const SHISHEN_MAP = {
        "ç”²": { "ç”²":"æ¯”è‚©", "ä¹™":"åŠ«è´¢", "ä¸™":"é£Ÿç¥", "ä¸":"ä¼¤å®˜", "æˆŠ":"åè´¢", "å·±":"æ­£è´¢", "åºš":"ä¸ƒæ€", "è¾›":"æ­£å®˜", "å£¬":"åå°", "ç™¸":"æ­£å°" },
        "ä¹™": { "ä¹™":"æ¯”è‚©", "ç”²":"åŠ«è´¢", "ä¸":"é£Ÿç¥", "ä¸™":"ä¼¤å®˜", "å·±":"åè´¢", "æˆŠ":"æ­£è´¢", "è¾›":"ä¸ƒæ€", "åºš":"æ­£å®˜", "ç™¸":"åå°", "å£¬":"æ­£å°" },
        "ä¸™": { "ä¸™":"æ¯”è‚©", "ä¸":"åŠ«è´¢", "æˆŠ":"é£Ÿç¥", "å·±":"ä¼¤å®˜", "åºš":"åè´¢", "è¾›":"æ­£è´¢", "å£¬":"ä¸ƒæ€", "ç™¸":"æ­£å®˜", "ç”²":"åå°", "ä¹™":"æ­£å°" },
        "ä¸": { "ä¸":"æ¯”è‚©", "ä¸™":"åŠ«è´¢", "å·±":"é£Ÿç¥", "æˆŠ":"ä¼¤å®˜", "è¾›":"åè´¢", "åºš":"æ­£è´¢", "ç™¸":"ä¸ƒæ€", "å£¬":"æ­£å®˜", "ä¹™":"åå°", "ç”²":"æ­£å°" },
        "æˆŠ": { "æˆŠ":"æ¯”è‚©", "å·±":"åŠ«è´¢", "åºš":"é£Ÿç¥", "è¾›":"ä¼¤å®˜", "å£¬":"åè´¢", "ç™¸":"æ­£è´¢", "ç”²":"ä¸ƒæ€", "ä¹™":"æ­£å®˜", "ä¸™":"åå°", "ä¸":"æ­£å°" },
        "å·±": { "å·±":"æ¯”è‚©", "æˆŠ":"åŠ«è´¢", "è¾›":"é£Ÿç¥", "åºš":"ä¼¤å®˜", "ç™¸":"åè´¢", "å£¬":"æ­£è´¢", "ä¹™":"ä¸ƒæ€", "ç”²":"æ­£å®˜", "ä¸":"åå°", "ä¸™":"æ­£å°" },
        "åºš": { "åºš":"æ¯”è‚©", "è¾›":"åŠ«è´¢", "å£¬":"é£Ÿç¥", "ç™¸":"ä¼¤å®˜", "ç”²":"åè´¢", "ä¹™":"æ­£è´¢", "ä¸™":"ä¸ƒæ€", "ä¸":"æ­£å®˜", "æˆŠ":"åå°", "å·±":"æ­£å°" },
        "è¾›": { "è¾›":"æ¯”è‚©", "åºš":"åŠ«è´¢", "ç™¸":"é£Ÿç¥", "å£¬":"ä¼¤å®˜", "ä¹™":"åè´¢", "ç”²":"æ­£è´¢", "ä¸":"ä¸ƒæ€", "ä¸™":"æ­£å®˜", "å·±":"åå°", "æˆŠ":"æ­£å°" },
        "å£¬": { "å£¬":"æ¯”è‚©", "ç™¸":"åŠ«è´¢", "ç”²":"é£Ÿç¥", "ä¹™":"ä¼¤å®˜", "ä¸™":"åè´¢", "ä¸":"æ­£è´¢", "æˆŠ":"ä¸ƒæ€", "å·±":"æ­£å®˜", "åºš":"åå°", "è¾›":"æ­£å°" },
        "ç™¸": { "ç™¸":"æ¯”è‚©", "å£¬":"åŠ«è´¢", "ä¹™":"é£Ÿç¥", "ç”²":"ä¼¤å®˜", "ä¸":"åè´¢", "ä¸™":"æ­£è´¢", "å·±":"ä¸ƒæ€", "æˆŠ":"æ­£å®˜", "è¾›":"åå°", "åºš":"æ­£å°" }
    };

    // å¸ä»¤è§„åˆ™
    const SILING_RULES = {
        'å¯…': [['æˆŠ',7], ['ä¸™',7], ['ç”²',16]], 'å¯': [['ç”²',10], ['ä¹™',20]], 'è¾°': [['ä¹™',9], ['ç™¸',3], ['æˆŠ',18]],
        'å·³': [['æˆŠ',5], ['åºš',9], ['ä¸™',16]], 'åˆ': [['ä¸™',10], ['å·±',9], ['ä¸',11]], 'æœª': [['ä¸',9], ['ä¹™',3], ['å·±',18]],
        'ç”³': [['æˆŠ',7], ['å£¬',7], ['åºš',16]], 'é…‰': [['åºš',10], ['è¾›',20]], 'æˆŒ': [['è¾›',9], ['ä¸',3], ['æˆŠ',18]],
        'äº¥': [['æˆŠ',7], ['ç”²',5], ['å£¬',18]], 'å­': [['å£¬',10], ['ç™¸',20]], 'ä¸‘': [['ç™¸',9], ['è¾›',3], ['å·±',18]]
    };

    // æ–‡æ¡ˆåº“
    const WITTY_DB = {
        "ä¼¤å®˜åˆæ€": { 
            name: "ğŸ˜ å±æœºç»ˆç»“è€… (ä¼¤å®˜åˆæ€)", 
            slogan: "ä¹±ä¸–åˆ©åˆƒï¼Œä¸“æ²»å„ç§ä¸æœ", 
            male: { c:"å¤©ç”Ÿåéª¨ï¼Œä¸é€‚åˆä½“åˆ¶å†…æ··æ—¥å­ã€‚æ“…é•¿è§£å†³æ£˜æ‰‹éš¾é¢˜ï¼Œè¶Šæ˜¯é«˜å‹ç¯å¢ƒè¶Šå…´å¥‹ã€‚", w:"é™©ä¸­æ±‚è´¢ï¼Œé ä¿¡æ¯å·®å’Œèƒ†è¯†æ å¤ºã€‚çˆ†å‘åŠ›æå¼ºï¼Œä¸‰å¹´ä¸å¼€å¼ ï¼Œå¼€å¼ åƒä¸‰å¹´ã€‚", l:"å–œæ¬¢èªæ˜ã€å¸¦ç‚¹åˆºçš„å¥³äººã€‚æ§åˆ¶æ¬²å¼ºï¼Œå®¶é‡Œå¿…é¡»ä½ è¯´äº†ç®—ã€‚", k:"å­©å­èªæ˜å›é€†ï¼Œé—ä¼ äº†ä½ çš„é«˜æ™ºå•†ã€‚é€‚åˆå¼•å¯¼å»æç§‘ç ”æˆ–è‰ºæœ¯ã€‚", h:"å¤§è„‘é«˜é€Ÿè¿è½¬ï¼Œæ˜“ç¥ç»è¡°å¼±ã€‚åšäº‹æ¿€è¿›ï¼Œæ³¨æ„æ„å¤–æ“¦ä¼¤ã€‚" }, 
            female: { c:"èŒåœºå¤§å§å¤§ï¼Œé›·å‰é£è¡Œã€‚å…¬å…³ã€å±æœºå¤„ç†ä¸“å®¶ã€‚æ°”åœºå¼ºå¤§ï¼Œç”·äººæ•¬ç•ã€‚", w:"åæ°”è¶Šå¤§è´¢è¶Šå¤šã€‚é€‚åˆç»è¥ä¸ªäººå“ç‰Œï¼Œèµ„æºç½®æ¢å˜ç°ã€‚", l:"çœ¼å…‰é«˜ï¼Œæ¬£èµéœ¸æ°”ç”·äººï¼Œä½†åˆæƒ³é©¾é©­å¯¹æ–¹ã€‚æ„Ÿæƒ…å……æ»¡åšå¼ˆå¿«æ„Ÿã€‚", k:"å­©å­æœ‰ç‰¹æ®Šæ‰åã€‚ä½ æŠ•å…¥æå¤§ï¼ŒæœŸæœ›å€¼é«˜ï¼Œæ³¨æ„ä¸è¦ç»™å¤ªå¤§å‹åŠ›ã€‚", h:"æ³¨æ„å†…åˆ†æ³Œå¤±è°ƒï¼Œæƒ…ç»ªæ³¢åŠ¨å¤§ã€‚é€‚åº¦åŒ»ç¾ï¼Œåˆ«æŠ˜è…¾å¤ªè¿‡ã€‚" } 
        },
        "é£Ÿç¥åˆ¶æ€": { 
            name: "ğŸ¦ é“è…•é©¯å…½å¸ˆ (é£Ÿç¥åˆ¶æ€)", 
            slogan: "æ‰‹é‡Œæœ‰è‰ºï¼Œå¿ƒä¸­æœ‰å¨ï¼Œä»¥ç†æœäºº", 
            male: { c:"ä¸“å®¶å‹é¢†å¯¼ã€‚é ä¸“ä¸šèƒ½åŠ›æœä¼—ï¼Œå…¬æ£€æ³•æˆ–æŠ€æœ¯æ€»ç›‘é¦–é€‰ã€‚", w:"é æ‰‹è‰ºå’Œå¨æœ›èµšé’±ï¼Œèµ„å†è¶Šè€è¶Šå€¼é’±ã€‚æ”¶å…¥ç¨³å›ºé•¿ä¹…ã€‚", l:"å®¶åº­åœ°ä½é«˜ï¼Œè€å©†æ•¬é‡ã€‚å¤§äº‹ä¸€è¨€ä¹é¼ï¼Œäº«å—è¢«ä¾èµ–æ„Ÿã€‚", k:"å­©å­è§„çŸ©æ‡‚äº‹ï¼Œæˆç»©ä¼˜å¼‚ï¼Œæœªæ¥æ ‹æ¢ä¹‹æã€‚", h:"èº«ä½“åº•å­å¥½ï¼Œä½†æ˜“æœ‰å¯Œè´µç—…ï¼ˆè„‚è‚ªè‚é«˜è¡€å‹ï¼‰ï¼Œæ³¨æ„é¥®é£Ÿã€‚" }, 
            female: { c:"æŠ€æœ¯æµå¥³å¼ºäººã€‚é€»è¾‘ä¸¥å¯†ï¼Œæ»´æ°´ä¸æ¼ã€‚è´¢åŠ¡ã€å®¡è®¡ã€å­¦æœ¯å¸¦å¤´äººã€‚", w:"ç†è´¢æœ‰é“ï¼Œä¸ä¹±èŠ±é’±ï¼Œéšå½¢å¯Œè±ªã€‚ç§¯è“„ä¸°åšã€‚", l:"ç®¡è€å…¬åƒç®¡å­©å­ï¼Œè™½ç„¶å•°å—¦ä½†ä¸ºäº†å®¶å¥½ã€‚ä¸ˆå¤«é€šå¸¸æ¸©å’Œå¬è¯ã€‚", k:"å­å¥³ç¼˜å¥½ï¼Œè´´å¿ƒå°æ£‰è¢„ã€‚æ¯æ…ˆå­å­ï¼Œæ™šå¹´äº«ç¦ã€‚", h:"æ³¨æ„æ¶ˆåŒ–ç³»ç»Ÿï¼Œèƒƒç—›æˆ–æš´é¥®æš´é£Ÿã€‚é¥®é£Ÿè¦æ¸…æ·¡ã€‚" } 
        },
        "ä¼¤å®˜ç”Ÿè´¢": { 
            name: "ğŸ’¸ æé’±æœºå™¨ (ä¼¤å®˜ç”Ÿè´¢)", 
            slogan: "è°ˆæ„Ÿæƒ…ä¼¤é’±ï¼Œè¿˜æ˜¯è°ˆé’±å§", 
            male: { c:"ç§‘æŠ€åˆ›ä¸šã€åˆ›æ„è¥é”€ã€‚ç‚¹å­å¤šè·¯å­é‡ï¼Œåˆ«æ‰“æ­»å·¥ï¼Œæµªè´¹æ‰åã€‚", w:"åˆ›æ„æŠ€æœ¯å˜ç°ã€‚é’±æ˜¯æ»šå‡ºæ¥çš„ï¼Œè¶Šæ»šè¶Šå¤§ã€‚", l:"å–œæ¬¢æ¼‚äº®æ—¶å°šçš„å¥³äººï¼Œå¸¦å‡ºå»æœ‰é¢å­ã€‚è„¾æ°”å·®ï¼Œéœ€åŒ…å®¹ã€‚", k:"å­å¥³ç¼˜æµ…æˆ–æ—©æ—©å‡ºå›½ã€‚å½¼æ­¤ç‹¬ç«‹ï¼Œç‰©è´¨æ”¯æŒåˆ°ä½ã€‚", h:"æ€è™‘è¿‡é‡ï¼Œå¤±çœ è„±å‘ã€‚ç¡å‰è¿œç¦»æ‰‹æœºï¼Œç»™å¤§è„‘å…³æœºã€‚" }, 
            female: { c:"æ‰å¥³ï¼Œè‡ªåª’ä½“ã€ç›´æ’­å¸¦è´§ã€‚å¼€å£å°±èƒ½æŠŠç¨»è‰å–æˆé‡‘æ¡ã€‚", w:"èµšé’±å¿«èŠ±é’±æ›´å¿«ã€‚ä¹°ä¹°ä¹°è§£å‹ï¼Œéœ€å¼ºåˆ¶å‚¨è“„ã€‚", l:"çœ¼å…‰æ¯’è¾£ï¼Œå«Œå¼ƒè€å…¬ç©·ç¬¨ã€‚å»ºè®®æ™šå©šæˆ–æ‰¾å¤§å”ã€‚", k:"æººçˆ±å­©å­ï¼Œå­©å­æ˜¯è½¯è‚‹ä¹Ÿæ˜¯åŠ¨åŠ›ã€‚", h:"ç”²çŠ¶è…ºä¹³è…ºé—®é¢˜ï¼Œæƒ…ç»ªæ³¢åŠ¨è‡´ç—…ã€‚å¤šæ—…æ¸¸æ•£å¿ƒã€‚" } 
        },
        "å»ºç¦„æ ¼": { 
            name: "ğŸ’ª ç‹¬ç«‹é’¢é“ä¾  (å»ºç¦„/æ¯”åŠ«)", 
            slogan: "æ±‚äººä¸å¦‚æ±‚å·±ï¼Œæˆ‘å‘½ç”±æˆ‘ä¸ç”±å¤©", 
            male: { c:"äº‹å¿…èº¬äº²ï¼Œé—²ä¸ä¸‹æ¥ã€‚æŠ€æœ¯æ€»ç›‘ã€åˆä¼™äººã€‚å¸¦é˜Ÿå†²é”‹ã€‚", w:"è¾›è‹¦é’±ï¼Œæ¯ä¸€åˆ†éƒ½æ˜¯æ±—æ°´ã€‚èº«æ—ºä»»è´¢ï¼Œä¸­æ™šå¹´å¤§å¯Œã€‚", l:"å¤§ç”·å­ä¸»ä¹‰ï¼Œæ˜“å…‹å¦»ã€‚éœ€æ‰¾æ¸©æŸ”å¬è¯çš„è€å©†ã€‚", k:"å­©å­ç‹¬ç«‹ï¼Œæ”¾å…»å¼æ•™è‚²ã€‚å°†æ¥å¯èƒ½ä¸åœ¨èº«è¾¹ã€‚", h:"èº«ä½“å£®å¦‚ç‰›ï¼Œç²¾åŠ›æ—ºã€‚æ³¨æ„è¿åŠ¨è¿‡é‡å¯¼è‡´çš„æŸä¼¤ã€‚" }, 
            female: { c:"æ¯”ç”·äººè¿˜æ‹¼ã€‚åˆ›ä¸šæˆ–é«˜ç®¡ã€‚ä¸å–œæ¬¢ä¾èµ–ç”·äººã€‚", w:"èµšé’±çŒ›å®ˆè´¢éš¾ã€‚æ˜“è¢«å€Ÿé’±ä¸è¿˜æˆ–ç›²ç›®æŠ•èµ„ã€‚éœ€æ‰¾äººæ‰“ç†ã€‚", l:"æ˜“é‡ç¬¬ä¸‰è€…æˆ–è€å…¬èƒ½åŠ›å¼±ã€‚å¤ªå¼ºåŠ¿è®©ç”·äººæœ‰å‹åŠ›ï¼Œå­¦ä¼šç¤ºå¼±ã€‚", k:"åˆ©ç”Ÿè‚²ï¼Œå­©å­å¥åº·æ´»æ³¼ã€‚é€‚åº”èƒ½åŠ›å¼ºã€‚", h:"ç«æ°”å¤§ï¼Œæ˜“ä¸Šç«ã€‚æ³¨æ„ç”²çŠ¶è…ºã€‚å°‘åƒè¾›è¾£ã€‚" } 
        },
        "æ­£å®˜æ ¼": { 
            name: "ğŸ‘” ç¨³å¥è€å¹²éƒ¨ (æ­£å®˜æ ¼)", 
            slogan: "ç¨³ä½æˆ‘ä»¬èƒ½èµ¢ï¼ŒæŒ‰éƒ¨å°±ç­æ‰æ˜¯ç‹é“", 
            male: { c:"åƒçš‡ç²®çš„å‘½ã€‚ä½“åˆ¶å†…ã€å¤§å‚ã€‚ç¨³é‡è®²è§„çŸ©ï¼Œæœ€æ€•å˜åŠ¨ã€‚", w:"æ­£è´¢ç¨³ï¼Œç¦åˆ©å¥½ã€‚åˆ«ç‚’è‚¡ï¼Œè€å®æ‹¿å·¥èµ„ä¹°æˆ¿æ”¶ç§Ÿã€‚", l:"è€å©†è´¤æƒ é—¨å½“æˆ·å¯¹ã€‚å©šå§»ç¨³å®šï¼Œå®¶åº­è§‚å¿µé‡ã€‚", k:"å­©å­å¬è¯å­¦éœ¸è‹—å­ã€‚æ•™è‚²ä¸Šå¿ƒï¼Œè§„åˆ’é•¿è¿œã€‚", h:"å‹åŠ›åœ¨å¿ƒé‡Œï¼Œæ˜“èƒƒç—›ã€‚æ³¨æ„å‘é™…çº¿å’Œå•¤é…’è‚šã€‚" }, 
            female: { c:"è¡Œæ”¿ã€HRã€ç®¡å®¶ã€‚åšäº‹äº•äº•æœ‰æ¡ï¼Œè€æ¿æœ€æ”¾å¿ƒã€‚", w:"è´¢æ”¿éƒ¨é•¿ï¼Œå®¶åº•è¶Šæ”’è¶Šåšã€‚ä¸ä¹±èŠ±é’±ä¹Ÿä¸äºå¾…è‡ªå·±ã€‚", l:"æ—ºå¤«ï¼ä¸ˆå¤«çš„åšå¼ºåç›¾ã€‚å¤«å¦»æ©çˆ±ä»¤äººç¾¡æ…•ã€‚", k:"æ•™å­æœ‰æ–¹ï¼Œå­©å­æœ‰æ•™å…»ã€‚æ³¨é‡å“å¾·åŸ¹å…»ã€‚", h:"ç”Ÿæ´»è§„å¾‹å¥åº·ã€‚æ³¨æ„ä¹…åè…°æ¤é¢ˆæ¤é—®é¢˜ã€‚" } 
        },
        "äº”è¡Œæµé€š": { 
            name: "â˜¯ï¸ å¹³è¡¡å¤§å¸ˆ (äº”è¡Œæµé€š)", 
            slogan: "ä¸åä¸å€šï¼Œä¸­åº¸ä¹‹é“ï¼Œå¹³æ·¡æ˜¯çœŸ", 
            male: { c:"ä¸‡é‡‘æ²¹ï¼Œç»¼åˆç®¡ç†ã€‚é€‚åº”åŠ›å¼ºï¼Œå“ªéƒ½èƒ½æ··å¾—å¼€ã€‚", w:"å°åº·æ°´å¹³ï¼Œè¡£é£Ÿæ— å¿§ã€‚è´¢è¿å¹³ç¨³ä¸Šå‡ï¼Œç»ä¸å—ç©·ã€‚", l:"ç›¸æ•¬å¦‚å®¾ï¼Œå¹³æ·¡æ˜¯ç¦ã€‚å©šå§»åƒæ¸©æ°´ï¼Œè§£æ¸´é•¿ä¹…ã€‚", k:"å­©å­æ™®é€šå­é¡ºï¼Œèƒ½é™ªåœ¨èº«è¾¹å°½å­ã€‚", h:"é•¿å¯¿æ— å¤§ç¾ã€‚èº«ä½“å¹³è¡¡å…ç–«åŠ›å¥½ã€‚" }, 
            female: { c:"æ–‡å‘˜åå‹¤ã€‚å®‰ç¨³ç¬¬ä¸€ï¼Œæ±‚é¡ºå¿ƒç¦»å®¶è¿‘ã€‚", w:"ä¸ç¼ºé›¶èŠ±é’±ï¼Œè€å…¬çˆ¶æ¯ç»™ä¿éšœã€‚ç”Ÿæ´»æ»‹æ¶¦ã€‚", l:"è´¤å¦»è‰¯æ¯ï¼ŒæŠŠå®¶ç»è¥å¾—æ¸©é¦¨èˆ’é€‚ã€‚", k:"å­©å­ä¹–å·§ï¼Œé™ªä¼´å¤šäº²å­å…³ç³»å¥½ã€‚", h:"æ²¡å¤§æ¯›ç—…ï¼Œæ‡‚å…»ç”Ÿã€‚ä¼šç…§é¡¾è‡ªå·±ã€‚" } 
        }
    };

    // --- åˆå§‹åŒ– ---

    window.onload = function() {
        try {
            const now = new Date();
            const pad = (n) => n < 10 ? '0'+n : n;
            const str = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
            document.getElementById('birth-input').value = str;
        } catch(e) {}
        
        if (typeof Solar === 'undefined') {
            document.getElementById('error-msg').style.display = 'block';
        }
    };

    function setGender(val, el) {
        currentGender = val;
        document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    // --- ä¸»é€»è¾‘ ---
    
    function calculateDestiny() {
        const timeStr = document.getElementById('birth-input').value;
        if (!timeStr) return alert("è¯·é€‰æ‹©å‡ºç”Ÿæ—¶é—´");

        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const bazi = lunar.getEightChar();
            bazi.setSect(2); 

            // =======================================================
            // æ ¸å¿ƒä¿®å¤ï¼šå¼ºåˆ¶è½¬å­—ç¬¦ä¸²ï¼Œä¸è°ƒç”¨ä»»ä½•å¯èƒ½æŠ¥é”™çš„å¯¹è±¡æ–¹æ³•
            // =======================================================
            // è·å–å…«å­—å­—ç¬¦ä¸² (å¦‚ "ç”²", "å­") - toString() æ˜¯æœ€å®‰å…¨çš„
            const yg = bazi.getYearGan().toString();  const yz = bazi.getYearZhi().toString();
            const mg = bazi.getMonthGan().toString(); const mz = bazi.getMonthZhi().toString();
            const dg = bazi.getDayGan().toString();   const dz = bazi.getDayZhi().toString();
            const hg = bazi.getTimeGan().toString();  const hz = bazi.getTimeZhi().toString();

            // æ„é€ çº¯å­—ç¬¦ä¸²æ•°æ®ç»“æ„
            const pillars = [
                { t:'å¹´æŸ±', g:yg, z:yz },
                { t:'æœˆæŸ±', g:mg, z:mz },
                { t:'æ—¥æŸ±', g:dg, z:dz },
                { t:'æ—¶æŸ±', g:hg, z:hz }
            ];

            // ä¼ é€’çº¯å­—ç¬¦ä¸²è¿›è¡ŒæŸ¥è¡¨ï¼Œä¸è¿›è¡Œä»»ä½•åº“å‡½æ•°è°ƒç”¨
            renderPillars(pillars, dg);
            
            // å¸ä»¤é€»è¾‘åªä¾èµ– Lunar æ—¥æœŸè®¡ç®—å’Œå­—ç¬¦ä¸²æŸ¥è¡¨
            const cmdInfo = calcCommander(lunar, mz);
            renderCommander(cmdInfo, dg, mz);

            drawArt(pillars, mz);
            renderFateDetail(pillars, dg);

            const resArea = document.getElementById('result-area');
            resArea.style.display = 'block';
            resArea.scrollIntoView({ behavior: 'smooth' });

        } catch (e) {
            console.error(e);
            alert("æ¨æ¼”å¤±è´¥ï¼š" + e.message);
        }
    }

    function renderPillars(pillars, dayMaster) {
        let html = '';
        pillars.forEach(p => {
            // 1. æŸ¥åç¥å­—å…¸
            const god = p.t === 'æ—¥æŸ±' ? 'æ—¥ä¸»' : (SHISHEN_MAP[dayMaster][p.g] || "");
            
            // 2. æŸ¥é•¿ç”Ÿå­—å…¸
            const cs = CHANGSHENG_TABLE[p.g][p.z] || "";
            const csClass = STRONG_CS.includes(cs) ? 'cs-tag cs-strong' : 'cs-tag';
            
            // 3. æŸ¥è—å¹²å­—å…¸
            const hiddens = HIDDEN_GAN_MAP[p.z] ? HIDDEN_GAN_MAP[p.z].join('') : "";

            // 4. æŸ¥äº”è¡Œé¢œè‰²
            const gWx = WUXING_MAP[p.g];
            const zWx = WUXING_MAP[p.z];

            html += `
                <div class="pillar">
                    <div class="p-head">${p.t}</div>
                    <div class="god-tag">${god}</div>
                    <div class="char ${WX_COLOR[gWx]}">${p.g}</div>
                    <div class="char ${WX_COLOR[zWx]}">${p.z}</div>
                    <div class="hidden-gan">è—${hiddens}</div>
                    <div class="${csClass}">${cs}</div>
                </div>
            `;
        });
        document.getElementById('pillars-box').innerHTML = html;
    }

    // æ ¸å¿ƒä¿®å¤ï¼šæ‰‹åŠ¨è®¡ç®—æ—¶é—´æˆ³ï¼Œæ›¿ä»£ solar.getCalendar()
    function calcCommander(lunar, monthZhi) {
        const prevJie = lunar.getPrevJie();
        
        // æ‰‹åŠ¨è½¬æ¢ Previous JieQi Time
        const pjSolar = prevJie.getSolar();
        const jieTime = new Date(pjSolar.getYear(), pjSolar.getMonth()-1, pjSolar.getDay(), pjSolar.getHour(), pjSolar.getMinute(), pjSolar.getSecond()).getTime();
        
        // æ‰‹åŠ¨è½¬æ¢ Birth Time
        const bSolar = lunar.getSolar();
        const birthTime = new Date(bSolar.getYear(), bSolar.getMonth()-1, bSolar.getDay(), bSolar.getHour(), bSolar.getMinute(), bSolar.getSecond()).getTime();

        const diffDays = Math.floor((birthTime - jieTime) / (1000 * 60 * 60 * 24));
        
        const rules = SILING_RULES[monthZhi] || [];
        
        let commander = 'æœªçŸ¥';
        let daysSum = 0;
        for (let rule of rules) {
            daysSum += rule[1];
            if (diffDays < daysSum) {
                commander = rule[0];
                break;
            }
        }
        if (commander === 'æœªçŸ¥' && rules.length > 0) commander = rules[rules.length-1][0];
        
        return { commander, diffDays, prevJieName: prevJie.getName() };
    }

    function renderCommander(info, dm, mZ) {
        const dmWx = WUXING_MAP[dm];
        const mZWx = WUXING_MAP[mZ];
        const cmdWx = WUXING_MAP[info.commander];

        const isHelp = (tWx, sWx) => tWx===sWx || (tWx==="æœ¨"&&sWx==="ç«") || (tWx==="ç«"&&sWx==="åœŸ") || (tWx==="åœŸ"&&sWx==="é‡‘") || (tWx==="é‡‘"&&sWx==="æ°´") || (tWx==="æ°´"&&sWx==="æœ¨");

        const menWang = isHelp(mZWx, dmWx);
        const diWang = isHelp(cmdWx, dmWx);
        
        let status = "";
        if(menWang && diWang) status = "<span class='tag-wang'>é—¨åœ°åŒæ—º</span> çœŸèº«å¼ºï¼Œåº•æ°”è¶³ï¼Œå¯æ‹…å¤§è´¢ã€‚";
        else if(menWang && !diWang) status = "<span class='tag-wang'>é—¨æ—º</span> <span class='tag-shuai'>åœ°è¡°</span> å¤–å¼ºä¸­å¹²ï¼Œè¡¨é¢é£å…‰ï¼Œå†…é‡Œéœ€è¡¥æ°”ã€‚";
        else if(!menWang && diWang) status = "<span class='tag-shuai'>é—¨è¡°</span> <span class='tag-wang'>åœ°æ—º</span> ç»å¤„é€¢ç”Ÿï¼Œå…³é”®æ—¶åˆ»æœ‰é å±±ã€‚";
        else status = "<span class='tag-shuai'>é—¨åœ°ä¿±è¡°</span> çœŸèº«å¼±ï¼Œé€‚åˆç¨³å¥å‘å±•ï¼Œå¿Œç¡¬æŠ—ã€‚";

        const html = `
            <div>ğŸ“… <b>èŠ‚æ°”å®šä½</b>ï¼š${info.prevJieName}åç¬¬ <span class="highlight">${info.diffDays}</span> å¤©</div>
            <div style="margin-top:5px;">ğŸ¦ <b>äººå…ƒå¸ä»¤</b>ï¼šå½“å‰ç”± <span class="highlight">${info.commander}${cmdWx}</span> æ‰§æ”¿æŒæƒã€‚</div>
            <div style="margin-top:10px; border-top:1px dashed #eee; padding-top:10px;">${status}</div>
        `;
        document.getElementById('commander-box').innerHTML = html;
    }

    function drawArt(pillars, mZ) {
        const canvas = document.getElementById('fate-canvas');
        const ctx = canvas.getContext('2d');
        const w = canvas.parentElement.offsetWidth;
        const h = canvas.parentElement.offsetHeight;
        canvas.width = w;
        canvas.height = h;

        const counts = {'é‡‘':0,'æœ¨':0,'æ°´':0,'ç«':0,'åœŸ':0};
        pillars.forEach(p => {
            counts[WUXING_MAP[p.g]]++;
            counts[WUXING_MAP[p.z]]++;
        });
        
        const grad = ctx.createLinearGradient(0,0,0,h);
        if(["äº¥","å­","ä¸‘"].includes(mZ)) { grad.addColorStop(0,"#2c3e50"); grad.addColorStop(1,"#bdc3c7"); }
        else if(["å·³","åˆ","æœª"].includes(mZ)) { grad.addColorStop(0,"#ff7675"); grad.addColorStop(1,"#fab1a0"); }
        else if(["å¯…","å¯","è¾°"].includes(mZ)) { grad.addColorStop(0,"#55efc4"); grad.addColorStop(1,"#00b894"); }
        else { grad.addColorStop(0,"#ffeaa7"); grad.addColorStop(1,"#fab1a0"); }
        ctx.fillStyle = grad;
        ctx.fillRect(0,0,w,h);

        if(counts['æ°´']>0) {
            ctx.fillStyle = "rgba(52, 152, 219, 0.3)";
            ctx.beginPath(); ctx.moveTo(0,h); 
            for(let i=0; i<=w; i+=10) ctx.lineTo(i, h - 25*counts['æ°´'] + Math.sin(i*0.05)*10);
            ctx.lineTo(w,h); ctx.fill();
        }
        if(counts['ç«']>0) {
            ctx.fillStyle = "rgba(231, 76, 60, 0.5)";
            ctx.beginPath(); ctx.arc(w*0.8, h*0.2, 12*counts['ç«'], 0, Math.PI*2); ctx.fill();
        }
        if(counts['æœ¨']>0) {
            ctx.strokeStyle = "rgba(46, 204, 113, 0.5)"; ctx.lineWidth=2;
            for(let i=0; i<counts['æœ¨']*6; i++) {
                let x = Math.random()*w; let ht = 20 + Math.random()*60;
                ctx.beginPath(); ctx.moveTo(x,h); ctx.lineTo(x, h-ht); ctx.stroke();
            }
        }
        
        const maxWx = Object.keys(counts).reduce((a,b)=>counts[a]>counts[b]?a:b);
        document.getElementById('art-tag').innerText = `æ„è±¡ï¼š${maxWx}æ°”å……ç›ˆ`;
    }

    function renderFateDetail(pillars, dm) {
        const gods = [];
        // å–å¹´å¹²ã€æœˆå¹²ã€æ—¶å¹²çš„åç¥
        [pillars[0].g, pillars[1].g, pillars[3].g].forEach(gan => {
            gods.push(SHISHEN_MAP[dm][gan]);
        });
        
        let key = "äº”è¡Œæµé€š";
        if(gods.includes("ä¸ƒæ€")) {
            if(gods.includes("é£Ÿç¥")) key = "é£Ÿç¥åˆ¶æ€";
            else if(gods.includes("ä¼¤å®˜")) key = "ä¼¤å®˜åˆæ€";
            else key = "ä¸ƒæ€æ ¼"; 
        } else if(gods.includes("ä¼¤å®˜")) {
            if(gods.includes("æ­£è´¢")||gods.includes("åè´¢")) key = "ä¼¤å®˜ç”Ÿè´¢";
            else key = "ä¼¤å®˜æ ¼";
        } else if(gods.includes("æ¯”è‚©")||gods.includes("åŠ«è´¢")) key = "å»ºç¦„æ ¼";
        else if(gods.includes("æ­£å®˜")) key = "æ­£å®˜æ ¼";
        
        if(!WITTY_DB[key]) key = "äº”è¡Œæµé€š";

        const data = WITTY_DB[key];
        const genderKey = currentGender === 1 ? 'male' : 'female';
        const detail = data[genderKey];

        document.getElementById('pattern-name').innerText = data.name;
        document.getElementById('pattern-slogan').innerText = data.slogan;

        const html = `
            <div class="dim-row"><div class="dim-icon">ğŸ’¼</div><div class="dim-content"><div class="dim-title">äº‹ä¸š</div><div class="dim-text">${detail.c}</div></div></div>
            <div class="dim-row"><div class="dim-icon">ğŸ’°</div><div class="dim-content"><div class="dim-title">è´¢å¯Œ</div><div class="dim-text">${detail.w}</div></div></div>
            <div class="dim-row"><div class="dim-icon">ğŸ’</div><div class="dim-content"><div class="dim-title">æƒ…æ„Ÿ</div><div class="dim-text">${detail.l}</div></div></div>
            <div class="dim-row"><div class="dim-icon">ğŸ¼</div><div class="dim-content"><div class="dim-title">åä»£</div><div class="dim-text">${detail.k}</div></div></div>
            <div class="dim-row"><div class="dim-icon">ğŸ”‹</div><div class="dim-content"><div class="dim-title">èƒ½é‡</div><div class="dim-text">${detail.h}</div></div></div>
        `;
        document.getElementById('five-dim-box').innerHTML = html;
    }

</script>
</body>
</html>
