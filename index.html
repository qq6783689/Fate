<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>命运黑盒 Pro Max · 宗师典藏无错版</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <style>
        :root {
            --primary: #ff2a6d;      /* 故障红 */
            --accent: #05d9e8;       /* 赛博蓝 */
            --dark: #10101a;         /* 深空黑 */
            --card: #1f2029;         /* 曜石灰 */
            --text: #e1e1ff;         /* 荧光白 */
            --gold: #ffc857;         /* 帝王金 */
            --border-r: 12px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--dark); color: var(--text);
            margin: 0; padding: 20px 10px; min-height: 100vh;
            background-image: linear-gradient(160deg, #10101a 0%, #1a1a2e 100%);
            display: flex; justify-content: center;
        }

        .container { width: 100%; max-width: 720px; padding-bottom: 120px; }

        /* 标题头 */
        .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.08); padding-bottom: 20px; }
        .header h1 { 
            font-size: 2.2rem; font-weight: 900; margin: 0; letter-spacing: 3px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 25px rgba(255, 42, 109, 0.4);
        }
        .sys-badge { 
            font-size: 0.75rem; border: 1px solid var(--accent); color: var(--accent);
            padding: 4px 12px; border-radius: 20px; display: inline-block; margin-top: 10px;
            letter-spacing: 1.5px; font-weight: bold; text-transform: uppercase;
        }

        /* 卡片 */
        .card {
            background: var(--card); border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--border-r); padding: 25px; margin-bottom: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5); position: relative; overflow: hidden;
        }
        .card::after {
            content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--accent));
        }

        /* 表单控件 */
        .input-group { margin-bottom: 20px; }
        .label { color: var(--gold); font-size: 0.85rem; margin-bottom: 10px; display: block; font-weight: bold; letter-spacing: 1px; }
        
        .gender-box { display: flex; gap: 15px; }
        .g-btn {
            flex: 1; padding: 16px; text-align: center; border-radius: 8px; background: rgba(255,255,255,0.03);
            border: 1px solid #444; color: #888; cursor: pointer; transition: 0.3s; font-weight: bold; font-size: 1rem;
        }
        .g-btn.active { 
            border-color: var(--primary); color: #fff; background: rgba(255, 42, 109, 0.15); 
            box-shadow: 0 0 15px rgba(255, 42, 109, 0.2);
        }

        input[type="datetime-local"] {
            width: 100%; padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid #444;
            color: #fff; border-radius: 8px; font-size: 1.1rem; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); }

        .btn-start {
            width: 100%; padding: 18px; border: none; border-radius: 8px;
            background: linear-gradient(135deg, var(--primary), #9900ff);
            color: #fff; font-size: 1.2rem; font-weight: 900; letter-spacing: 3px;
            cursor: pointer; margin-top: 15px; box-shadow: 0 10px 30px rgba(255, 42, 109, 0.3);
            transition: transform 0.1s;
        }
        .btn-start:active { transform: scale(0.98); }

        #result-area { display: none; animation: slideUp 0.6s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

        /* 结果展示区 */
        .role-header { display: flex; align-items: flex-start; padding-bottom: 25px; border-bottom: 1px dashed rgba(255,255,255,0.1); margin-bottom: 25px; }
        .role-icon {
            width: 76px; height: 76px; background: #2a2a35; border-radius: 18px;
            display: flex; align-items: center; justify-content: center; font-size: 40px;
            border: 2px solid var(--gold); margin-right: 20px; flex-shrink: 0;
            box-shadow: 0 0 25px rgba(255, 200, 87, 0.2);
        }
        .role-title { font-size: 1.6rem; font-weight: bold; color: #fff; margin: 0 0 8px 0; }
        .role-sub { font-size: 0.9rem; color: #888; font-style: italic; line-height: 1.4; }
        .role-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        .tag { font-size: 0.75rem; padding: 5px 12px; border-radius: 6px; background: rgba(255,255,255,0.06); color: #bbb; }
        .tag.ssr { background: linear-gradient(45deg, var(--primary), var(--gold)); color: #000; font-weight: bold; border: none; }
        .tag.logic { border: 1px solid var(--accent); color: var(--accent); background: transparent; }

        /* 司令条 */
        .siling-badge {
            background: linear-gradient(90deg, rgba(255, 200, 87, 0.15), transparent);
            border-left: 4px solid var(--gold); padding: 12px; margin-bottom: 25px; border-radius: 4px;
            color: var(--gold); font-weight: bold; font-size: 0.95rem; display: flex; align-items: center; gap: 10px;
        }

        /* 能量图 */
        .chart-box { height: 180px; width: 100%; border-radius: 12px; overflow: hidden; margin-bottom: 25px; position: relative; background: rgba(0,0,0,0.3); }
        canvas { width: 100%; height: 100%; }

        /* 排盘 */
        .pillars { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .col { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 15px 5px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .c-head { font-size: 0.7rem; color: #666; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px; }
        .c-god { font-size: 0.75rem; color: var(--accent); height: 16px; margin-bottom: 5px; font-weight: bold; }
        .c-char { font-family: "KaiTi", serif; font-size: 1.8rem; font-weight: bold; color: #fff; margin-bottom: 6px; line-height: 1.1; }
        .c-cs { font-size: 0.7rem; color: #888; display: block; }
        .wx-金 { color: #ffeaa7; text-shadow: 0 0 10px rgba(255,234,167,0.3); } 
        .wx-木 { color: #55efc4; text-shadow: 0 0 10px rgba(85,239,196,0.3); } 
        .wx-水 { color: #74b9ff; text-shadow: 0 0 10px rgba(116,185,255,0.3); } 
        .wx-火 { color: #ff7675; text-shadow: 0 0 10px rgba(255,118,117,0.3); } 
        .wx-土 { color: #a29bfe; text-shadow: 0 0 10px rgba(162,155,254,0.3); }

        /* 核心逻辑条 */
        .logic-bar { 
            margin-top: 25px; padding: 20px; background: rgba(0,0,0,0.3); border: 1px solid #333; 
            font-size: 0.95rem; line-height: 1.6; border-radius: 10px;
        }
        .logic-title { color: var(--accent); font-weight: bold; display: block; margin-bottom: 12px; letter-spacing: 1px; font-size: 1rem; }
        .good-text { color: #2ecc71; font-weight: bold; margin-right: 8px; } 
        .bad-text { color: #ff4757; font-weight: bold; margin-right: 8px; }

        /* 攻略区 */
        .guide-item { 
            margin-bottom: 30px; padding: 25px; border-radius: 12px; 
            background: rgba(255,255,255,0.02); border-left: 4px solid var(--accent);
        }
        .guide-title { 
            font-size: 1.1rem; font-weight: bold; color: var(--gold); margin-bottom: 15px; 
            display: flex; align-items: center; gap: 10px; letter-spacing: 1px;
        }
        .guide-text { 
            font-size: 1rem; line-height: 1.9; color: #ccc; text-align: justify; 
        }
        .guide-text b { color: #fff; font-weight: bold; border-bottom: 1px dotted rgba(255,255,255,0.3); padding-bottom: 2px; }

        #error-msg { display:none; background:var(--primary); padding:12px; text-align:center; border-radius:6px; margin-bottom:20px; font-weight:bold; color: #fff; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>命运黑盒</h1>
        <div class="sys-badge">SYSTEM: GRANDMASTER COMPLETE V22.0</div>
    </div>

    <div id="error-msg">⚠️ 核心组件加载异常，请检查网络 (jsDelivr)</div>

    <div class="card">
        <div class="input-group">
            <span class="label">选择角色性别 / GENDER</span>
            <div class="gender-box">
                <div class="g-btn active" onclick="setGender(1, this)">乾造 (Male)</div>
                <div class="g-btn" onclick="setGender(0, this)">坤造 (Female)</div>
            </div>
        </div>
        <div class="input-group">
            <span class="label">输入出生时间 / DATE OF BIRTH</span>
            <input type="datetime-local" id="birth-input">
        </div>
        <button class="btn-start" onclick="startScan()">启动宗师级推演 / START SCAN</button>
    </div>

    <div id="result-area">
        <div class="card">
            <div class="role-header">
                <div class="role-icon" id="role-icon">?</div>
                <div class="role-info">
                    <h2 class="role-title" id="role-name">分析中...</h2>
                    <div class="role-sub" id="role-slogan">...</div>
                    <div class="role-tags" id="role-tags"></div>
                </div>
            </div>

            <div class="siling-badge" id="siling-box">
                <span style="font-size:1.4rem">👑</span> 
                <span id="siling-text">正在计算真神...</span>
            </div>
            
            <div class="chart-box">
                <canvas id="energy-canvas"></canvas>
            </div>

            <div class="pillars" id="pillars-box"></div>
            
            <div class="logic-bar">
                <span class="logic-title">⚡ 格局喜忌铁律 (Core Logic)</span>
                <div id="pattern-reason" style="margin-bottom:12px; color:#aaa;"></div>
                <div><span class="good-text">★ 喜用神：</span> <span id="txt-joy" style="color:#eee">...</span></div>
                <div style="margin-top:8px;"><span class="bad-text">✖ 忌神：</span> <span id="txt-taboo" style="color:#eee">...</span></div>
            </div>
        </div>

        <div class="card">
            <span class="label" style="margin-bottom:20px; font-size:1rem; color:var(--accent);">天命通关攻略 / STRATEGY GUIDE</span>
            <div id="guide-content"></div>
        </div>

        <div style="text-align:center; font-size:12px; color:#444; margin-top:40px;">
            Destiny Algorithm © 2025 · Verified by Master Gemini
        </div>
    </div>
</div>

<script>
    let currentGender = 1;

    // --- 静态数据 ---
    const WUXING_MAP = {'甲':'木','乙':'木','丙':'火','丁':'火','戊':'土','己':'土','庚':'金','辛':'金','壬':'水','癸':'水','子':'水','丑':'土','寅':'木','卯':'木','辰':'土','巳':'火','午':'火','未':'土','申':'金','酉':'金','戌':'土','亥':'水'};
    const WX_COLOR = { '金':'wx-金', '木':'wx-木', '水':'wx-水', '火':'wx-火', '土':'wx-土' };
    const ZHI_MAIN_QI = {'子':'癸', '丑':'己', '寅':'甲', '卯':'乙', '辰':'戊', '巳':'丙', '午':'丁', '未':'己', '申':'庚', '酉':'辛', '戌':'戊', '亥':'壬'};

    // 司令规则 (日) - 严格遵循古法，亥月前7日为戊土
    const SILING_RULES = {
        '寅': [['戊',7], ['丙',7], ['甲',16]], '卯': [['甲',10], ['乙',20]], '辰': [['乙',9], ['癸',3], ['戊',18]],
        '巳': [['戊',5], ['庚',9], ['丙',16]], '午': [['丙',10], ['己',9], ['丁',11]], '未': [['丁',9], ['乙',3], ['己',18]],
        '申': [['戊',7], ['壬',7], ['庚',16]], '酉': [['庚',10], ['辛',20]], '戌': [['辛',9], ['丁',3], ['戊',18]],
        '亥': [['戊',7], ['甲',5], ['壬',18]], '子': [['壬',10], ['癸',20]], '丑': [['癸',9], ['辛',3], ['己',18]]
    };

    const HIDDEN_GAN_MAP = {
        '子':['癸'], '丑':['己','癸','辛'], '寅':['甲','丙','戊'], '卯':['乙'], 
        '辰':['戊','乙','癸'], '巳':['丙','戊','庚'], '午':['丁','己'], '未':['己','丁','乙'], 
        '申':['庚','壬','戊'], '酉':['辛'], '戌':['戊','辛','丁'], '亥':['壬','甲']
    };

    const CHANGSHENG_TABLE = {
        "甲": { "亥":"长生", "子":"沐浴", "丑":"冠带", "寅":"临官", "卯":"帝旺", "辰":"衰", "巳":"病", "午":"死", "未":"墓", "申":"绝", "酉":"胎", "戌":"养" },
        "乙": { "午":"长生", "巳":"沐浴", "辰":"冠带", "卯":"临官", "寅":"帝旺", "丑":"衰", "子":"病", "亥":"死", "戌":"墓", "酉":"绝", "申":"胎", "未":"养" },
        "丙": { "寅":"长生", "卯":"沐浴", "辰":"冠带", "巳":"临官", "午":"帝旺", "未":"衰", "申":"病", "酉":"死", "戌":"墓", "亥":"绝", "子":"胎", "丑":"养" },
        "丁": { "酉":"长生", "申":"沐浴", "未":"冠带", "午":"临官", "巳":"帝旺", "辰":"衰", "卯":"病", "寅":"死", "丑":"墓", "子":"绝", "亥":"胎", "戌":"养" },
        "戊": { "寅":"长生", "卯":"沐浴", "辰":"冠带", "巳":"临官", "午":"帝旺", "未":"衰", "申":"病", "酉":"死", "戌":"墓", "亥":"绝", "子":"胎", "丑":"养" },
        "己": { "酉":"长生", "申":"沐浴", "未":"冠带", "午":"临官", "巳":"帝旺", "辰":"衰", "卯":"病", "寅":"死", "丑":"墓", "子":"绝", "亥":"胎", "戌":"养" },
        "庚": { "巳":"长生", "午":"沐浴", "未":"冠带", "申":"临官", "酉":"帝旺", "戌":"衰", "亥":"病", "子":"死", "丑":"墓", "寅":"绝", "卯":"胎", "辰":"养" },
        "辛": { "子":"长生", "亥":"沐浴", "戌":"冠带", "酉":"临官", "申":"帝旺", "未":"衰", "午":"病", "巳":"死", "辰":"墓", "卯":"绝", "寅":"胎", "丑":"养" },
        "壬": { "申":"长生", "酉":"沐浴", "戌":"冠带", "亥":"临官", "子":"帝旺", "丑":"衰", "寅":"病", "卯":"死", "辰":"墓", "巳":"绝", "午":"胎", "未":"养" },
        "癸": { "卯":"长生", "寅":"沐浴", "丑":"冠带", "子":"临官", "亥":"帝旺", "戌":"衰", "酉":"病", "申":"死", "未":"墓", "午":"绝", "巳":"胎", "辰":"养" }
    };
    
    // 根气表 (判断食伤是否有力，申酉戌巳丑为金根)
    const ROOT_MAP = {
        '甲':['寅','卯','亥','辰','未'], '乙':['卯','寅','辰','未','亥'],
        '丙':['巳','午','寅','戌'], '丁':['午','巳','未','戌','寅'],
        '戊':['辰','戌','丑','未','巳','午'], '己':['丑','未','辰','戌','午','巳'],
        '庚':['申','酉','巳','丑','戌'], '辛':['酉','申','丑','戌','巳'],
        '壬':['亥','子','申','辰'], '癸':['子','亥','辰','丑','申']
    };

    const SHISHEN_MAP = {
        "甲": { "甲":"比肩", "乙":"劫财", "丙":"食神", "丁":"伤官", "戊":"偏财", "己":"正财", "庚":"七杀", "辛":"正官", "壬":"偏印", "癸":"正印" },
        "乙": { "乙":"比肩", "甲":"劫财", "丁":"食神", "丙":"伤官", "己":"偏财", "戊":"正财", "辛":"七杀", "庚":"正官", "癸":"偏印", "壬":"正印" },
        "丙": { "丙":"比肩", "丁":"劫财", "戊":"食神", "己":"伤官", "庚":"偏财", "辛":"正财", "壬":"七杀", "癸":"正官", "甲":"偏印", "乙":"正印" },
        "丁": { "丁":"比肩", "丙":"劫财", "己":"食神", "戊":"伤官", "辛":"偏财", "庚":"正财", "癸":"七杀", "壬":"正官", "乙":"偏印", "甲":"正印" },
        "戊": { "戊":"比肩", "己":"劫财", "庚":"食神", "辛":"伤官", "壬":"偏财", "癸":"正财", "甲":"七杀", "乙":"正官", "丙":"偏印", "丁":"正印" },
        "己": { "己":"比肩", "戊":"劫财", "辛":"食神", "庚":"伤官", "癸":"偏财", "壬":"正财", "乙":"七杀", "甲":"正官", "丁":"偏印", "丙":"正印" },
        "庚": { "庚":"比肩", "辛":"劫财", "壬":"食神", "癸":"伤官", "甲":"偏财", "乙":"正财", "丙":"七杀", "丁":"正官", "戊":"偏印", "己":"正印" },
        "辛": { "辛":"比肩", "庚":"劫财", "癸":"食神", "壬":"伤官", "乙":"偏财", "甲":"正财", "丁":"七杀", "丙":"正官", "己":"偏印", "戊":"正印" },
        "壬": { "壬":"比肩", "癸":"劫财", "甲":"食神", "乙":"伤官", "丙":"偏财", "丁":"正财", "戊":"七杀", "己":"正官", "庚":"偏印", "辛":"正印" },
        "癸": { "癸":"比肩", "壬":"劫财", "乙":"食神", "甲":"伤官", "丁":"偏财", "丙":"正财", "己":"七杀", "戊":"正官", "辛":"偏印", "庚":"正印" }
    };

    // 核心数据库：格局喜忌规则 (XIJI RULES)
    const XIJI_RULES = {
        "金水伤官": { desc: "冬金寒冷，必须见火。喜火（官杀）暖局，喜木（财）生火。此为伤官见官反为贵的特殊格局。", joy: ["🔥 火","🌲 木"], taboo: ["💧 水","⛰️ 土"] },
        "金水食神": { desc: "金白水清，才华内敛。亦喜火暖局，忌土埋金、水过寒。", joy: ["🔥 火","🌲 木"], taboo: ["⛰️ 土","💧 水"] },
        "木火通明": { desc: "木生春月，见火泄秀。忌金克伐，忌水灭火。", joy: ["🔥 火","🌲 木"], taboo: ["🗡️ 金","💧 水"] },
        "伤官配印": { desc: "火炎土燥或身弱伤旺。急需水印润局生身。贵在有印，印星为第一救星。", joy: ["💧 水","🌲 木"], taboo: ["⛰️ 土","🔥 火"] },
        "食神制杀": { desc: "七杀攻身，食神制之。这是一个英雄独压万人的格局。喜身强抗杀，喜食神制敌。", joy: ["🎨 食神","📜 印星","💪 比劫"], taboo: ["💰 财星","🗡️ 官杀"] },
        "伤官生财": { desc: "伤官有根，生财有情。技艺致富。伤官若无根则为虚名。", joy: ["💰 财星","🎨 伤官"], taboo: ["📜 印星","💪 比劫"] },
        "食神生财": { desc: "食神有根，生财安稳。福气之局。", joy: ["💰 财星","🎨 食神"], taboo: ["📜 偏印","🗡️ 官杀"] },
        "伤官合杀": { desc: "伤官与七杀相合，化干戈为玉帛。这是异路功名之象。喜身旺，喜印绶。", joy: ["📜 印星","💪 比劫"], taboo: ["💰 财星","🗡️ 官杀"] },
        "伤官格": { desc: "伤官当令。需印制伤，或财引化。", joy: ["📜 印星","💰 财星"], taboo: ["🗡️ 官杀","💪 比劫"] },
        "建禄格": { desc: "月令建禄。喜财官食伤泄秀。", joy: ["🗡️ 官杀","🎨 食伤","💰 财星"], taboo: ["📜 印星","💪 比劫"] },
        "月劫格": { desc: "月令劫财。首取官杀制劫。", joy: ["🗡️ 官杀","🎨 食伤","💰 财星(需食伤)"], taboo: ["📜 印星","💪 比劫"] },
        "七杀格": { desc: "七杀当权。身弱取印，身强取食。", joy: ["📜 印星","🎨 食伤"], taboo: ["💰 财星","🗡️ 官杀"] },
        "杀印相生": { desc: "杀攻身，印化煞。贵气之局。", joy: ["📜 印星","💪 比劫"], taboo: ["💰 财星"] },
        "正官格": { desc: "正官纯正。喜财生官，喜印护官。", joy: ["💰 财星","📜 印星"], taboo: ["🎨 伤官","🗡️ 七杀"] },
        "正财格": { desc: "财星当令。身强任财，身弱喜印比。", joy: ["身强喜官/食","身弱喜印/比"], taboo: ["身强忌印","身弱忌财"] },
        "偏财格": { desc: "偏财当令。喜官护财，食伤生财。", joy: ["🗡️ 官杀","🎨 食伤"], taboo: ["💪 比劫","空亡"] },
        "正印格": { desc: "印绶生身。喜官生印，忌财坏印。", joy: ["🗡️ 官杀","💪 比劫"], taboo: ["💰 财星"] },
        "偏印格": { desc: "偏印当权。喜偏财制枭。", joy: ["💰 偏财","天月德"], taboo: ["🎨 食神"] },
        "食神格": { desc: "食神生财，福寿双全。忌枭神夺食。", joy: ["💰 财星","💪 比劫"], taboo: ["📜 偏印"] },
        "杂格": { desc: "格局未成，求其中和流通。", joy: ["扶抑","调候"], taboo: ["失衡"] }
    };

    // 终极文案库 (百万文案版 - 100%全量)
    const GAME_DB = {
        "金水伤官": { 
            name: "❄️ 寒冰剑仙 (Frost Blade)", tags: ["SSR","权谋","高冷"], icon: "🗡️", slogan: "金寒水冷，唯火暖心。", 
            male: { c:"<b>[天赋核心：权谋洞察]</b><br>金水伤官人，智商极高，但也极其傲气。你天生适合从事政治、管理、战略策划或高层幕僚的工作。你的思维像冰刀一样锐利，能瞬间切开复杂问题的核心。格局成败的关键在于“火（官杀）”。见火，你就是手握重权的宰相或高管；若无火，你可能只是一个愤世嫉俗的穷酸秀才，空有一身才华却无人赏识。记得，你的才华必须依附于体制或权威（火）才能发光，切勿单打独斗。", w:"<b>[财富逻辑：富贵险中求]</b><br>你的财运通常伴随着地位而来。有了权（官）自然有钱。但因为金水太清，你也容易因为“清高”而错失赚快钱的机会。切忌贪污腐败或走灰色地带，因为水太清，一点点墨汁都会被看得清清楚楚，极易被查。走火运（南方运）时，是财富爆发的高光时刻。", l:"<b>[情感羁绊：寻找暖阳]</b><br>你的内心太冷了，像一座冰山。虽然你外表可能很风流或健谈，但内心深处渴望被温暖。你需要一个热情如火、开朗大方的伴侣，对方可能是你的上司、崇拜者，或者是那种没心没肺的“小太阳”。只有这样的人，才能融化你的冰冷，让你卸下防备。", k:"<b>[后代传承：严父出孝子]</b><br>你对孩子的要求极高，甚至有些苛刻。你希望他们出人头地，继承你的智慧。孩子多半聪明且有出息，但要注意别给太大压力，否则亲子关系容易变得冷漠。多给孩子一点温情的拥抱。", h:"<b>[实战锦囊]</b><br>你的命局寒气太重。务必多晒太阳，多穿红衣，居住环境要光照充足。忌去北方发展，宜往南方。身体上要注意风湿寒症、肾脏以及心血管系统的健康。冬天是你最难熬的季节，要注意保暖。" }, 
            female: { c:"<b>[天赋核心：冰山美人]</b><br>才貌双全，气质高冷，你是人群中那个让人不敢轻易靠近的存在。适合演艺、外交、公关高管、高端销售。你必须有火暖局，也就是要有舞台、有聚光灯，否则你的才华会变成孤芳自赏，甚至导致抑郁。你的才华需要“被看见”，不要躲在角落里。", w:"<b>[财富逻辑：夫荣妻贵]</b><br>这是一个很特殊的格局。对于金水伤官女命来说，官星（火）不仅是夫星，也是喜用神。这意味着你的财富和地位，很大程度上会来自于你的伴侣或者你所在的平台（公司/体制）。“旺夫即旺己”，成就你的另一半，就是成就你自己。", l:"<b>[情感羁绊：恃才傲物与渴望呵护]</b><br>伤官本是克官（夫）的，但金水伤官是特例，“独喜官”。你内心非常渴望男人的呵护和温暖，但表现出来的却是挑剔和高傲。千万别作！遇到那个愿意包容你坏脾气、还能给你暖被窝的人，就嫁了吧。不要试图去驾驭男人，而是学会示弱，这才是你的必杀技。", k:"<b>[后代传承：贵子临门]</b><br>你的孩子通常长相漂亮，聪明伶俐，是你生命的延续和希望。生孩子对你的运势有提升作用，因为孩子代表食伤，也是你才华的具象化。", h:"<b>[实战锦囊]</b><br>你是典型的“冷底子”。特别要注意妇科寒症、痛经、手脚冰凉的问题。坚持泡脚，少吃生冷食物（冰淇淋、刺身），多吃温补的食物。保持体温，就是保持运气。" } 
        },
        "金水食神": { 
            name: "🌊 灵动智者 (Fluid Sage)", tags: ["SSR","聪慧","清贵"], icon: "🌊", slogan: "金白水清，才华横溢。", 
            male: { c:"<b>[天赋核心：内秀乾坤]</b><br>相比金水伤官的傲气逼人，金水食神更显温文尔雅、内敛深沉。你天生拥有S级的逻辑思维和极高的艺术感知力，适合从事学术研究、文学创作、艺术设计、高精尖技术等领域。你的才华不是用来攻击别人的武器，而是用来滋养世界的甘露。但金水太寒，若无火暖局，才华容易被埋没，变成“怀才不遇”的隐士；若见火（官印），则能名扬四海，成为一代宗师。你的成功是水到渠成的，而非强取豪夺。", w:"<b>[财富逻辑：技艺生财]</b><br>食神生财，财源细水长流，源源不断。你不屑于赚快钱、投机倒把，更看重长期的积累和名声。你的财富往往来自你的专业技能、知识产权或作品版税。这种财富虽然来得慢，但极其稳固，抗风险能力极强。只要你保持专业度，这辈子不仅不缺钱，还能积累可观的家底。切忌因为清高而视金钱如粪土，要学会让才华变现。", l:"<b>[情感羁绊：灵魂知己]</b><br>你注重精神层面的交流，外貌对你来说只是次要的，你更需要一个能听懂你弦外之音、能和你从诗词歌赋谈到人生哲学的伴侣。你的感情生活平淡而真实，不追求轰轰烈烈，只求细水长流。但因为金水偏寒，你有时会显得比较冷淡，让伴侣觉得难以接近，适度表达热情很重要。你的伴侣通常也是高学历或有修养的人。", k:"<b>[后代传承：聪慧麒麟]</b><br>你的孩子完美继承了你的高智商和艺术天赋，性格温和懂事，不需要你操太多心。你对孩子的教育方式宽容而开明，孩子视你为榜样和朋友。晚年能享子女之福，是真正的“福寿双全”之象。", h:"<b>[实战锦囊]</b><br>金水过旺，寒气入骨。你需要“补火”！多做户外运动（如跑步、登山），多晒太阳，保持心情开朗，避免陷入消极情绪。居住环境宜暖不宜冷。身体上重点保养肾脏、泌尿系统和呼吸系统，防止湿寒之气侵体。心情好，运气就好。" }, 
            female: { c:"<b>[天赋核心：气质清流]</b><br>金白水清的女命，多出美女，且气质清新脱俗，带有一种不食人间烟火的仙气。你适合从事文化、教育、艺术、慈善等高雅行业。你的存在本身就是一种美好的风景，容易得到长辈和贵人的喜爱。你的职场之路通常比较顺遂，因为你与世无争的态度反而让你赢得了更多的机会。你是团队中的“白月光”，人缘极佳。", w:"<b>[财富逻辑：福泽深厚]</b><br>食神代表福气和口福。你一生衣食无忧，福泽深厚。不需要像伤官格那样辛苦拼搏，自然有人（父母或丈夫）为你铺路，或者能轻松找到一份收入不错又体面的工作。你的财运是“安稳”的代名词，适合稳健理财，不宜涉足高风险投资。你的直觉很准，有时候跟着感觉走就能避坑。", l:"<b>[情感羁绊：寒谷回春]</b><br>虽然命理书上说“食神克官”，但金水食神是特例，因为冬金必须见火（官），所以你也能得到丈夫的宠爱和保护。你的伴侣通常能力不错，且对你体贴入微。只要你不过分任性或高冷，婚姻会非常美满。记住，你的温柔是你最大的武器，用你的似水柔情去温暖对方，而不是用冰冷去考验对方。", k:"<b>[后代传承：慈母福荫]</b><br>你是典型的慈母，对孩子疼爱有加。孩子也是你的福星，给你带来无尽的快乐。你的教育方式如春风化雨，孩子在你的教育下会成长为身心健康、性格开朗的人。你的晚年生活会因为子女的孝顺而变得非常幸福惬意。", h:"<b>[实战锦囊]</b><br>同样需要“暖局”。多穿暖色调的衣服，少吃冰冷食物（冷饮、寒性水果）。特别要注意妇科保养和肾脏健康，避免熬夜，保持规律的作息。你的心情直接影响你的健康，开心是你最好的补药。多接触大自然的花草树木（木生火），能提升运势。" } 
        },
        "正财格": { 
            name: "🐜 勤勉筑梦师 (Builder)", tags: ["R+","积累","稳健"], icon: "🧱", slogan: "一砖一瓦，聚沙成塔。", 
            male: { c:"<b>[天赋核心：实干家]</b><br>你是金融、实业、制造等传统行业的顶梁柱。你是那种最踏实、最靠谱的员工或老板。你不相信一夜暴富的神话，只相信勤劳致富的真理。你的执行力强，对数字敏感，善于在细节中发现价值。你的人生信条是“积跬步以至千里”。你可能不会是那个最耀眼的明星，但绝对是企业中最不可或缺的基石。老板放心把重要任务交给你，因为你从未让人失望。", w:"<b>[财富逻辑：复利效应]</b><br>你是典型的富一代，财富是靠时间积累起来的。积少成多，晚年富足。每一分钱都是汗水换来的，所以你格外珍惜。你不乱花钱，每一笔开支都有计划。适合稳健型投资，如储蓄、国债、房产。你对高风险的投机行为嗤之以鼻，认为那是赌博。你的财富增长曲线是平滑向上的，虽然慢，但绝不回撤。你是时间的朋友。", l:"<b>[情感羁绊：宠妻狂魔]</b><br>在命理中，正财代表妻子。正财格的男人通常非常疼老婆，甚至有点“惧内”。你愿意把工资卡上交，觉得听老婆话才会有出息。你对家庭非常负责，是标准的模范丈夫。你可能不懂太多的浪漫，但你会用实际行动来表达爱意，比如做饭、修水管、接送孩子。你的爱是深沉而持久的。", k:"<b>[后代传承：朴实家风]</b><br>你的孩子会继承你勤劳朴实的优良品质。你会教导他们节约和努力，不会溺爱。孩子将来可能不会大富大贵，但一定是个正直、有用的人。你注重培养孩子的生存技能和金钱观念，让他们明白“粒粒皆辛苦”的道理。你的家庭氛围是温馨而有序的。", h:"<b>[实战锦囊]</b><br>你最大的敌人是“过度劳累”。因为太想给家人更好的生活，你容易透支身体。职业病多集中在颈椎、腰椎和肠胃。记住，身体是革命的本钱，别为了省钱而舍不得体检。适当的放松和旅游不是浪费，而是为了走更远的路。多吃温补的食物，少吃寒凉。" }, 
            female: { c:"<b>[天赋核心：精细化管理]</b><br>你适合从事会计、银行、数据分析、行政管理等需要耐心和细致的工作。你对细节的把控无人能及，能从纷繁复杂的数据中理出头绪。你是团队中不可或缺的“管家婆”。你做事井井有条，从不出错，是老板和同事眼中的“定海神针”。你的职业生涯通常很稳定，一步一个脚印。", w:"<b>[财富逻辑：存钱罐]</b><br>你是天生的理财高手，精打细算，看着余额增长是你最大的快乐。你是家里的CFO，把每一分钱都花在刀刃上。你适合掌管财政大权，能把家庭资产打理得井井有条。你不会被消费主义洗脑，清楚地知道自己需要什么。你的积蓄是你安全感的来源。", l:"<b>[情感羁绊：贤惠持家]</b><br>你能把日子过得红红火火，是标准的贤妻良母。但要注意，生活不仅是柴米油盐，还需要一点浪漫。不要因为太过于关注现实而忽略了伴侣的情感需求。偶尔的惊喜和小礼物，能让婚姻生活更加甜蜜。你对丈夫的期望很高，希望他能和你一样努力上进。", k:"<b>[后代传承：事必躬亲]</b><br>你对孩子的照顾无微不至，但有时会因为太过于包办而导致孩子自理能力弱。学会放手，让孩子自己去摔打，他们才能成长得更快。你对孩子的学业抓得很紧，希望他们能考上好大学。要注意不要给孩子太大的压力，多关注他们的心理健康。", h:"<b>[实战锦囊]</b><br>你有点宅，不爱运动。容易气血不足，手脚冰凉。多吃红枣枸杞，多出去走走。不要把钱看得太重，适当的消费能让你更快乐。你的焦虑往往来自于对未来的担忧，活在当下，享受生活，你会发现世界很美好。" } 
        },
        "七杀格": { 
            name: "🚀 孤胆英雄 (Solo Hero)", tags: ["SSR","开创","爆发"], icon: "🔥", slogan: "人生就是一场无限的战斗。", 
            male: { c:"<b>[天赋核心：开疆拓土]</b><br>你是天生的创业者、销售冠军或改革者。平淡按部就班的工作会让你发疯，只有充满挑战和危机环境才能激发你的潜能。你适合去新市场、新领域开荒。你的执行力和魄力无人能及，是乱世中的枭雄。你敢于承担责任，但也容易独断专行。你的眼神中透着一股狠劲，那是你征服世界的武器。", w:"<b>[财富逻辑：险中求财]</b><br>你的财运是大起大落的。敢梭哈，有机会暴富，也容易暴负。你的钱通常来自于高风险高回报的项目。建议赚到钱后必须强制买固定资产留后路，防止一夜回到解放前。你的财运是波动向上的，关键在于守财。你对金钱的态度是“千金散尽还复来”，有钱就花，没钱再赚。", l:"<b>[情感羁绊：烈火情人]</b><br>你的脾气比较暴躁，喜欢性格鲜明、性感的女性。家里经常上演全武行，但床头吵架床尾和。你的感情生活充满了激情和戏剧性，平淡的日子你反而过不下去。你需要一个能读懂你内心脆弱的伴侣，在外你是硬汉，在家你其实很渴望温暖。", k:"<b>[后代传承：棍棒教育]</b><br>你对孩子太严厉了，奉行“棍棒底下出孝子”。虽然出发点是好的，但容易让孩子产生逆反心理。多展现温柔的一面，其实孩子很渴望父爱。不要把工作中的杀伐之气带回家，孩子不是你的兵。试着和孩子做朋友，你会发现不一样的世界。", h:"<b>[实战锦囊]</b><br>你易有外伤、疤痕或手术。开车慢点，少喝酒。注意肝胆健康。你的煞气太重，多做慈善、捐款可以化解身上的戾气，提升运势。定期去献血也是一种应灾的方式。学会控制情绪，怒伤肝，平和才是福。" }, 
            female: { c:"<b>[天赋核心：不让须眉]</b><br>你是女强人，女老板、业务一姐。在男人堆里抢饭吃毫无惧色。你的执行力超强，比男人更狠、更决断。适合从事高压、高强度的职业，如外科医生、律师、高管。你不需要依附男人，你自己就是豪门。你的成功是靠自己拼出来的，没人能否定你的努力。", w:"<b>[财富逻辑：流水如注]</b><br>你是赚钱机器，花钱如流水。你对金钱没有太大的概念，只享受赚钱带来的成就感和快感。需要找一个懂理财的伙伴或伴侣帮你打理财富，否则很容易财来财去。你喜欢买奢侈品来犒劳自己，这是你工作的动力。但要注意，现金流比面子更重要。", l:"<b>[情感羁绊：霸总收割机]</b><br>你容易吸引霸道总裁或渣男。感情像过山车一样刺激。你喜欢的男人必须比你强，能征服你。但这种男人往往不好驾驭，容易产生摩擦。你需要学会在感情中示弱，撒娇好命。不要把职场上的强势带到恋爱中，男人也需要面子。", k:"<b>[后代传承：超人妈妈]</b><br>你既当爹又当妈，孩子是你坚持下去的最大动力。你会为了孩子变得无比坚强，甚至牺牲自己的事业。孩子通常会非常崇拜你，视你为榜样。但你太忙了，可能会缺席孩子的成长，尽量多抽时间陪陪孩子。", h:"<b>[实战锦囊]</b><br>肝火太旺，容易长结节、增生。少生气，多做冥想，平复内心的燥气。注意乳腺和甲状腺健康。定期去美容院放松也是一种调理。你的身体一直处于紧绷状态，需要彻底的休息。睡个好觉，对你来说是最好的奢侈品。" } 
        },
        "正印格": { 
            name: "📜 圣贤导师 (The Sage)", tags: ["SR","名望","守护"], icon: "🙏", slogan: "但行好事，莫问前程。", 
            male: { c:"<b>[天赋核心：贵人扶持]</b><br>你适合从事文教、慈善、出版、咨询等行业。你上面有人罩，晋升不用愁。工作清闲福利好。你不需要去勾心斗角，自然会有机会落到你头上。你是团队的精神领袖，大家有了困难都喜欢找你倾诉。你的心地善良，乐于助人，这是你最大的福报。你可能不是最聪明的，但绝对是运气最好的。", w:"<b>[财富逻辑：清贵之财]</b><br>你是名声换钱。不适合做生意，心太软容易被骗。靠社会地位获利。你的钱是“躺赚”的，比如房租、版税、分红、顾问费。你的财运虽然不猛烈，但胜在长久。你不需要为了钱而奔波，钱自然会来找你。知足常乐是你的人生哲学。", l:"<b>[情感羁绊：依赖型]</b><br>你有点妈宝倾向，喜欢成熟、会照顾人的女性。婚姻平顺。你习惯了被照顾，在感情中比较被动。你需要一个能主事的妻子，帮你打理家务和琐事。你的婆媳关系通常处理得不错，因为你本身就很孝顺。家庭的和睦对你来说至关重要。", k:"<b>[后代传承：知书达理]</b><br>你的家庭传统氛围浓厚，孩子孝顺懂事。你对孩子的教育是宽松的，注重品德而非分数。孩子将来多半从事文化类工作。你会给孩子讲很多道理，孩子也愿意听你的。你的家风是仁爱和宽容。", h:"<b>[实战锦囊]</b><br>心宽体胖，易缺乏运动。注意三高和肥胖问题。多动动，别太懒了。你的身体素质不错，但要注意饮食节制。少吃甜食，多吃粗粮。保持良好的作息，不要睡懒觉。精神上的富足能让你更健康。" }, 
            female: { c:"<b>[天赋核心：岁月静好]</b><br>老师、图书管理员、公益人士。无野心，不喜竞争。追求安稳舒适。你的心态极好，知足常乐。在职场上，你是那个最稳定的存在，不会轻易跳槽。同事们都喜欢和你相处，因为你没有攻击性。你适合做辅助性的工作，能把琐事处理得井井有条。", w:"<b>[财富逻辑：天生好命]</b><br>长辈给的多，老公给的多。一生有人为你买单。你可能不是大富婆，但绝对不缺钱花。你的福气在于“受”，而不在于“争”。你不需要为了生计发愁，你的任务就是享受生活。你可能有继承遗产的运势。", l:"<b>[情感羁绊：受宠]</b><br>嫁得好，一生被照顾。像温室里的花朵。你的婚姻通常是长辈撮合或门当户对，波折很少。你对丈夫非常信任，家庭关系和谐。你是个传统的女人，相夫教子是你最大的幸福。你的温柔能化解一切矛盾。", k:"<b>[后代传承：佛系育儿]</b><br>顺其自然，孩子性格温和。你不会给孩子太大压力，亲子关系和谐。孩子喜欢和你在一起，把你当朋友。你的孩子可能不是成绩最好的，但一定是心理最健康的。你教会了孩子如何去爱。", h:"<b>[实战锦囊]</b><br>太安逸导致代谢慢。多运动排湿。注意脾胃虚弱，少吃甜食。你的身体需要一点“活力”来激活。多去户外走走，接触大自然。保持身材，不仅是为了美，更是为了健康。心情好，一切都好。" } 
        },
        "偏印格": { 
            name: "👽 异次元行者 (Mystic)", tags: ["SR","直觉","冷门"], icon: "👁️", slogan: "真理往往掌握在少数人手中。", 
            male: { c:"<b>[天赋核心：独门绝技]</b><br>偏印格的人思维怪异，不走寻常路。适合从事医生、程序员、玄学师、侦探、调查员等需要极强洞察力和逻辑推理的工作。你不喜欢热闹，喜欢独自钻研。在冷门领域，你是绝对的权威。你的脑洞很大，总能想出别人想不到的解决方案。你是孤独的天才。", w:"<b>[财富逻辑：副业王]</b><br>你的正财运可能一般，但偏财运极佳。你的收入不稳定，但常有大笔进账。直觉准，靠第六感投资也能赚。你适合做咨询、技术服务或者知识付费。你的技能越冷门，越值钱。不要随大流，坚持你的独特就是财富。", l:"<b>[情感羁绊：冰山]</b><br>你感情冷淡，不善表达。需要能读懂你沉默的伴侣。你习惯了独处，婚姻对你来说有时是一种负担。你需要极大的个人空间，黏人的伴侣会让你窒息。你是个慢热的人，但一旦认定，就会非常专一。", k:"<b>[后代传承：代沟]</b><br>你和孩子的关系比较疏离，孩子可能早早离家独立。你的教育方式另类，不按常理出牌。你可能不太会表达爱，但心里是爱孩子的。你更像是一个导师，而不是父亲。你会教给孩子生存的智慧。", h:"<b>[实战锦囊]</b><br>易抑郁，多晒太阳。养宠物陪伴。注意神经衰弱和失眠问题。多去人多的地方沾沾人气。不要总是把自己关在屋子里，走出去，你会发现世界很精彩。你的心理健康比身体健康更重要。" }, 
            female: { c:"<b>[天赋核心：洞察力]</b><br>设计、咨询、心理医生、占星师。能轻易看穿谎言。适合独立工作。你的灵感来源于孤独。在艺术和玄学领域，你有惊人的天赋。你对未知的世界充满好奇，喜欢探索神秘的事物。你是朋友圈里的“神婆”。", w:"<b>[财富逻辑：才华变现]</b><br>不屑赚辛苦钱。眼光独到，能发现潜力股。你的财富往往来自于你的创意和特殊技能。你适合做自由职业者，不被时间束缚。你的收入可能不稳定，但一旦开张，就能吃很久。相信你的直觉，它会带你找到财富。", l:"<b>[情感羁绊：边缘恋]</b><br>易遇性格古怪对象或异地恋、忘年恋。感情坎坷，太敏感易受伤。你需要一个能包容你敏感多疑的伴侣。你的爱情观很独特，不介意世俗的眼光。你追求灵魂的契合，而不是物质的堆砌。", k:"<b>[后代传承：丁克倾向]</b><br>觉得孩子是负担，但有了会很爱。你可能更喜欢宠物。你不会为了生孩子而生孩子。如果有了孩子，你会是个很酷的妈妈，带孩子一起探索世界。你尊重孩子的个性。", h:"<b>[实战锦囊]</b><br>神经衰弱，偏头痛。睡前泡脚放松。少想那些有的没的，活在当下。多做瑜伽，舒缓神经。你的身体比较敏感，容易过敏。注意饮食卫生，少吃刺激性食物。多听听轻音乐，放松心情。" } 
        }, 
        "偏财格": { 
            name: "🎩 商业大亨 (Tycoon)", tags: ["SSR","横财","交际"], icon: "💎", slogan: "钱是赚出来的，不是省出来的。", 
            male: { c:"<b>[天赋核心：资源整合]</b><br>经商、市场、贸易。善交际，四海皆兄弟。眼光独到，发现别人忽略的商机。你适合做生意，不适合坐办公室。你的核心能力是把不同的人和资源撮合在一起。你是天生的外交家，无论和谁都能聊得来。", w:"<b>[财富逻辑：横财运]</b><br>易中奖或投资获利。但也手松，财来财去。赚了钱马上买房，否则留不住。你的钱是用来生钱的，不是用来存的。你花钱大手大脚，但也总能赚回来。你有赌性，敢于冒险。但要注意，常在河边走，哪有不湿鞋。", l:"<b>[情感羁绊：桃花劫]</b><br>风趣幽默，出手大方，太讨女人喜欢。需防后院起火。你的感情经历丰富，但真爱难寻。你容易在感情中迷失，需要一个能管住你的伴侣。你是个多情的人，但也是个绝情的人。处理好异性关系是你一生的课题。", k:"<b>[后代传承：哥们]</b><br>跟孩子像朋友。看重情商培养。你会带孩子见世面，培养他的社交能力。孩子会觉得你是个很酷的父亲。你不会逼孩子死读书，更看重他们的实践能力。你的孩子将来也是社交达人。", h:"<b>[实战锦囊]</b><br>应酬多，伤肝肾。少喝酒多喝茶。定期体检，注意脂肪肝。多陪家人吃饭，少去酒局。你的身体需要保养，不要年轻时用命换钱，老了用钱换命。运动是你最好的解酒药。" }, 
            female: { c:"<b>[天赋核心：长袖善舞]</b><br>商务、公关、销售。名利场游刃有余。赚钱能力不输男人。你懂得如何利用女性优势获取资源。你在社交场合是焦点，总能左右逢源。你的情商极高，能搞定各种难缠的客户。", w:"<b>[财富逻辑：奢靡]</b><br>能赚会花，喜欢奢侈品。财运比老公好，经常贴补家用。你喜欢享受生活，觉得赚钱就是为了花。你对金钱的态度是开放的，不愿意做守财奴。你适合投资时尚、美容等女性行业。", l:"<b>[情感羁绊：择优]</b><br>喜欢有钱有势的男人。婚姻晚成，一直在筛选绩优股。你很现实，但也清楚自己想要什么。你不会为了爱情而降低生活标准。你的伴侣通常也是成功人士。你们是势均力敌的爱情。", k:"<b>[后代传承：贵族范]</b><br>给孩子最好条件，培养贵族气质。你会送孩子去最好的学校，接受最好的教育。你希望孩子将来能进入上流社会。你对孩子的打扮很讲究，总是把他们打扮得漂漂亮亮的。", h:"<b>[实战锦囊]</b><br>注意富贵病，少吃油腻。多运动，保持身材。定期做美容，保持自信。你的外表是你最大的资产，要好好呵护。注意内分泌失调，保持心情愉快。" } 
        },
        "食神格": { 
            name: "🎨 逍遥散人 (Artist)", tags: ["SR","福气","治愈"], icon: "🎐", slogan: "人间不值得，但美食值得。", 
            male: { c:"<b>[天赋核心：灵感源泉]</b><br>艺术、餐饮、设计。才华横溢但不爱卷。灵感在玩乐中产生。你适合轻松、自由的工作环境。你讨厌加班，讨厌复杂的职场斗争。你是个生活家，懂得如何把日子过得有滋有味。", w:"<b>[财富逻辑：躺赢]</b><br>细水长流，一辈子不缺钱。总有贵人送钱，傻人有傻福。你的财运是“碰”出来的，不是“求”出来的。你不需要太费力，只要做自己喜欢的事，钱自然会来。你是被财神爷眷顾的人。", l:"<b>[情感羁绊：暖男]</b><br>懂疼老婆，会做饭。婚姻生活平淡温馨，令人羡慕。你没什么脾气，凡事好商量。你是那种会让老婆很有安全感的男人。你的家庭氛围非常和谐，充满了欢声笑语。", k:"<b>[后代传承：福星]</b><br>晚年享子女福，孩子性格讨喜。你和孩子的关系非常融洽。你不会给孩子太大压力，只希望他们健康快乐。你的晚年生活会非常幸福，儿孙绕膝。", h:"<b>[实战锦囊]</b><br>心宽体胖，贪吃导致三高。动起来！注意控制饮食，多吃蔬菜。你的消化系统可能比较弱，少吃油腻。保持体型对你的健康至关重要。多去户外活动，呼吸新鲜空气。" }, 
            female: { c:"<b>[天赋核心：亲和力]</b><br>幼师、美食博主、服务业。不争不抢，人缘极好。工作环境单纯。大家都很喜欢和你相处。你是团队中的开心果，有你在的地方就没有尴尬。你适合从事需要耐心和爱心的工作。", w:"<b>[财富逻辑：小确幸]</b><br>不计较钱，钱反而来找你。有不少私房钱。你容易满足，幸福感很高。你的财运往往来自你的好人缘。你可能会收到很多礼物和红包。你是个有福气的女人。", l:"<b>[情感羁绊：仪式感]</b><br>有点作，注重浪漫。希望对方懂你的情趣。你需要一个能陪你吃喝玩乐的伴侣。你喜欢小惊喜，喜欢被宠爱的感觉。你的婚姻生活充满了甜蜜和浪漫。", k:"<b>[后代传承：慈母]</b><br>孩子是命根子，极其宠爱。孩子幸福感强。你可能会溺爱孩子。孩子在你的呵护下会非常有安全感。但要注意，不要让孩子变成温室里的花朵，要教会他们独立。", h:"<b>[实战锦囊]</b><br>太懒了，缺乏运动。多去户外走走。注意消化系统健康。少吃甜食，多喝水。你的身体需要一点活力。保持良好的作息，早睡早起。心情好，皮肤就好。" } 
        },
        "伤官合杀": { 
            name: "⚡ 危机终结者 (Terminator)", tags: ["SSR","爆发","乱世英雄"], icon: "🗡️", slogan: "混乱是阶梯。", 
            male: { c:"<b>[天赋核心：乱世枭雄]</b><br>你天生自带反骨，不适合呆板的体制和按部就班的工作。你的主场在**危机公关、律师辩护、特种顾问、黑白通吃的中介**。越是混乱、高压、没人敢接的盘，越能激发你的S级潜能。别怕麻烦，麻烦就是你的经验包和晋升阶梯。你善于利用规则的漏洞，达成自己的目的。", w:"<b>[财富逻辑：掠夺者]</b><br>你的财富不靠积攒，靠**“狩猎”**。利用信息差、技术壁垒或胆识进行降维打击。爆发力极强，可能三年不开张，开张吃三年。建议配置“固定资产”护盾，防止财富流失过快。你的财运是爆发式的，抓住一次机会就能翻身。", l:"<b>[情感羁绊：相爱相杀]</b><br>你看不上傻白甜，只有带点刺、有手段的女性才能激起你的征服欲。你的婚姻是一场**“高智商博弈”**，虽然吵吵闹闹，但彼此灵魂深度契合。控制欲别太强，给对方一点呼吸空间。你的爱情像火一样热烈，但也容易灼伤彼此。", k:"<b>[后代传承：叛逆天才]</b><br>你的后代大概率遗传了你的高智商和叛逆。别用“听话”来要求他，那是扼杀天才。引导他去搞科研、艺术或竞技，他会成为你的骄傲。你的孩子注定不凡。", h:"<b>[实战锦囊]</b><br>大脑常年高速运转，容易神经衰弱。注意头部、眼部保养，以及激进运动带来的外伤风险。学会放空自己，冥想是你最好的休息方式。注意交通安全，别开快车。" }, 
            female: { c:"<b>[天赋核心：女王气场]</b><br>职场上的**“铁娘子”**。公关总监、操盘手、甚至创业领袖。你能搞定最难缠的客户，甚至让男人们敬畏三分。你的武器是犀利的言辞和雷厉风行的手段。你适合在男人堆里厮杀，并取得胜利。你是天生的谈判专家。", w:"<b>[财富逻辑：名气变现]</b><br>名气越大，财运越旺。适合经营个人品牌，或者利用圈层影响力进行资源置换变现。你适合做一个快乐的“守财奴”，把赚来的钱变成不动产，构建安全感壁垒。你的每一分钱都是凭本事赚来的。", l:"<b>[情感羁绊：慕强心理]</b><br>你欣赏**“爹系”**硬汉或行业大佬。普通男人入不了你的眼。婚后你是家里的主心骨，但也容易因为太强势而让对方有压力。学会在家“卸甲”，能让感情升温。你需要一个能征服你的男人。", k:"<b>[后代传承：精英教育]</b><br>你对孩子投入极大，期望极高。孩子往往有特殊才艺。注意不要把你的焦虑投射给孩子。孩子会成为你的骄傲，但也可能会因为压力大而疏远你。", h:"<b>[实战锦囊]</b><br>情绪波动大，容易导致内分泌失调或妇科问题。适度医美，多做瑜伽，保持身心平衡。你的美丽来自于自信和力量。注意保养，别让岁月在脸上留下痕迹。" } 
        },
        "杀印相生": { 
            name: "👑 权柄执掌者 (Commander)", tags: ["SSR","权威","管理"], icon: "⚔️", slogan: "以德服人，以力服人。", 
            male: { c:"<b>[天赋核心：御人有术]</b><br>七杀攻身本凶，幸有印星化解，这叫“化敌为友”。你天生适合做**高管、军警、法官、企业主**。你既有七杀的魄力，又有印星的仁慈，恩威并施，下属对你既敬又畏。你善于在复杂的环境中生存，并能从危机中找到机会。你的领导力是天生的，大家愿意跟随你。", w:"<b>[财富逻辑：权中取利]</b><br>你的财富来自于你的权力或影响力。职位越高，财运越旺。不要盯着小钱，要去争取更大的平台和话语权。你的财运是“正财”为主，可能有灰色收入，但只要印星有力，通常能逢凶化吉。你的格局决定了你的财富高度。", l:"<b>[情感羁绊：贤内助]</b><br>你需要一个能帮你打理后方、让你无后顾之忧的伴侣。你的妻子通常比较贤惠，能包容你的忙碌和脾气。你对家庭是有责任感的，但你的重心往往在事业上。记得多回家吃饭，陪伴是最好的礼物。", k:"<b>[后代传承：显贵门庭]</b><br>子女多半有出息，能继承你的事业或名望。你对孩子的教育非常严格，希望他们成为人中龙凤。孩子通常会比较敬畏你。你会给孩子铺好路，让他们少走弯路。", h:"<b>[实战锦囊]</b><br>注意劳逸结合，不要过度操劳。你的精神压力通常比较大，要学会放松。多喝茶，少喝酒，保持头脑清醒。注意心脑血管健康。定期去体检，防患于未然。" }, 
            female: { c:"<b>[天赋核心：女皇范]</b><br>气场强大，不怒自威。在职场上，你比男人更有决断力。适合做管理者，能镇得住场子。你不喜欢做琐碎的工作，更喜欢做决策。你的职业生涯通常会步步高升，成为行业内的权威。你是女性的榜样。", w:"<b>[财富逻辑：正财旺盛]</b><br>你的财运很稳，随着地位提升而增长。适合购买不动产，积累家业。你对金钱的掌控欲很强，不乱花钱，每一分钱都要花在有价值的地方。你懂得如何用钱生钱，让财富增值。", l:"<b>[情感羁绊：贵夫之象]</b><br>夫星得力，丈夫通常是有头有脸的人物。虽然你性格强势，但能帮夫运，是丈夫的得力助手。你们是典型的“强强联合”。不过要注意给丈夫留面子，不要在公开场合压他一头。你的婚姻是让人羡慕的。", k:"<b>[后代传承：严母教子]</b><br>对孩子要求严格，注重家教。孩子将来多半是社会精英，有很好的教养。你对孩子的爱是深沉而严肃的。你会把孩子培养成独立、坚强的人。", h:"<b>[实战锦囊]</b><br>注意乳腺和肝胆健康。少生气，多做瑜伽放松心情。你的身体需要柔和的运动来调节刚硬的气场。多穿柔和颜色的衣服，增加亲和力。" } 
        },
        "五行流通": { 
            name: "☯️ 太极宗师 (Grandmaster)", tags: ["SSR","全能","平衡"], icon: "🧘", slogan: "刚不可久，柔不可守。", 
            male: { c:"<b>[天赋核心：六边形战士]</b><br>你没有短板，是天生的**“版本之子”**。职场中的万金油，适合综合管理、统筹、协调。你像水一样适应任何容器。在动荡的经济周期中，别人在裸泳，而你能稳坐钓鱼台。你的生存能力S级，无论环境如何变化，你总能找到自己的位置。你是那个笑到最后的人。", w:"<b>[财富逻辑：稳如泰山]</b><br>虽然没有一夜暴富的剧本，但也没有破产的风险。你的财富像滚雪球，抗风险能力极强。你是朋友圈里最“稳”的那个隐形富豪。你的资产配置非常合理，不偏激。你懂得分散风险，让财富稳步增长。", l:"<b>[情感羁绊：细水长流]</b><br>你的婚姻没有狗血剧，只有温馨的日常。你是最适合过日子的伴侣，能提供极高的情绪价值和安全感。你的伴侣通常也是性格温和、通情达理的人。你们的感情是经得起时间考验的。", k:"<b>[后代传承：孝顺]</b><br>孩子身心健康，三观正。虽未必惊天动地，但能陪在你身边尽孝，这是最大的福气。你的家庭氛围非常和谐。孩子会成为一个幸福的人，这就足够了。", h:"<b>[实战锦囊]</b><br>五行流通，百病不生。只要不作死，你大概率能活过99%的同龄人。保持现在的节奏，不要被别人的焦虑影响。你的健康是你最大的财富。" }, 
            female: { c:"<b>[天赋核心：以柔克刚]</b><br>文员、后勤、体制内。你不求大富大贵，只求工作顺心。你的心态是你最大的财富，让你在任何环境中都能游刃有余。你是那种“不争而争”的智慧女性。你的情商极高，能化解各种矛盾。", w:"<b>[财富逻辑：无忧]</b><br>不缺零花钱，总有父母或丈夫为你提供物质保障。生活滋润，岁月静好。你是天生的“福将”，总能逢凶化吉。你的生活质量很高，不用为钱发愁。", l:"<b>[情感羁绊：贤内助]</b><br>家庭和睦，你是家里的调味剂。懂得经营生活，把家变得温馨舒适，旺夫旺家。你的丈夫会非常依赖你。你的婚姻是幸福的典范。", k:"<b>[后代传承：陪伴]</b><br>花很多时间陪孩子，亲子关系极佳。孩子性格好，情商高。你教会孩子的是如何幸福地生活。你的孩子会非常爱你。", h:"<b>[实战锦囊]</b><br>没啥大毛病，很会照顾自己。懂得以食补身，容颜不老。继续保持这种乐观平和的心态。你的笑容能治愈一切。" } 
        },
        "杂格": { 
            name: "🌱 潜龙勿用 (Potential)", tags: ["N","潜力","厚积薄发"], icon: "🌱", slogan: "时运未到，潜心修炼。", 
            male: { c:"<b>[天赋核心：多面手]</b><br>你可能没有特别突出的单一强项，但胜在综合能力不错。适合在中小企业做全能型人才。你的适应能力很强，什么活都能干。你是那块哪里需要往哪搬的砖。不要灰心，平凡中也能造就伟大。", w:"<b>[财富逻辑：勤劳致富]</b><br>没有暴富的命，只有勤劳的手。多劳多得。建议学习一门手艺，深耕细作，也能小康。不要想着走捷径，脚踏实地才是硬道理。你的财富是靠一点一滴积累起来的。", l:"<b>[情感羁绊：平淡是真]</b><br>婚姻生活波澜不惊。找个过日子的人，安安稳稳过一生。不要有太高的不切实际的幻想。平平淡淡才是真，陪伴是最长情的告白。", k:"<b>[后代传承：普通]</b><br>孩子资质平平，健康就好。不要逼孩子太紧，快乐成长最重要。儿孙自有儿孙福，不要太操心。", h:"<b>[实战锦囊]</b><br>锻炼。身体是革命的本钱。保持良好的作息，少熬夜。你的身体需要你好好呵护，别等到生病了才后悔。" }, 
            female: { c:"<b>[天赋核心：踏实]</b><br>适合做后勤、辅助类工作。你做事认真负责，虽然不出彩，但很让人放心。你是团队中默默奉献的那个人。你的价值在于你的可靠。", w:"<b>[财富逻辑：节俭]</b><br>持家有道。你懂得省钱，也能把家里打理得井井有条。你的财富是省出来的。你会精打细算，把日子过得有滋有味。", l:"<b>[情感羁绊：依靠]</b><br>找个老实人嫁了。你需要一个踏实的肩膀依靠。平平淡淡才是真。你的婚姻可能没有激情，但很稳定。", k:"<b>[后代传承：平安]</b><br>孩子平安长大。你对孩子的要求不高，只要他们开心健康就好。你会是一个很慈祥的母亲。", h:"<b>[实战锦囊]</b><br>睡眠。保持充足睡眠。心情放松，不要想太多。多听听音乐，看看书，丰富自己的内心世界。" } 
        }
    };

    // --- 初始化 ---
    window.onload = function() {
        try {
            const now = new Date();
            const str = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('birth-input').value = str;
        } catch(e){}
    };

    function setGender(val, el) {
        currentGender = val;
        document.querySelectorAll('.g-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    // --- 核心算法 ---
    function startScan() {
        const timeStr = document.getElementById('birth-input').value;
        if (!timeStr) return alert("请选择出生时间");
        try {
            const date = new Date(timeStr);
            const solar = Solar.fromYmdHms(date.getFullYear(), date.getMonth()+1, date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds());
            const lunar = solar.getLunar();
            const bazi = lunar.getEightChar();
            bazi.setSect(2);

            const yg=bazi.getYearGan().toString(), yz=bazi.getYearZhi().toString();
            const mg=bazi.getMonthGan().toString(), mz=bazi.getMonthZhi().toString();
            const dg=bazi.getDayGan().toString(), dz=bazi.getDayZhi().toString();
            const hg=bazi.getTimeGan().toString(), hz=bazi.getTimeZhi().toString();

            const pillars = [{t:'年柱',g:yg,z:yz},{t:'月柱',g:mg,z:mz},{t:'日柱',g:dg,z:dz},{t:'时柱',g:hg,z:hz}];

            renderPillars(pillars, dg);
            const cmdInfo = calcCommander(lunar, mz);
            const climate = analyzeClimate(dg, mz, pillars);
            const patternKey = determinePattern(climate, pillars, dg, mz, cmdInfo);
            renderResult(patternKey, cmdInfo, dg, climate);
            drawArt(pillars);
            
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
        } catch (e) { console.error(e); alert("计算错误: "+e.message); }
    }

    function renderPillars(pillars, dm) {
        let html = '';
        pillars.forEach(p => {
            const god = p.t.includes('日柱') ? '日主' : (SHISHEN_MAP[dm][p.g] || "");
            const cs = CHANGSHENG_TABLE[p.g][p.z] || "";
            const gWx = WUXING_MAP[p.g], zWx = WUXING_MAP[p.z];
            html += `<div class="col"><div class="c-head">${p.t}</div><div class="c-god">${god}</div><div class="c-char ${WX_COLOR[gWx]}">${p.g}</div><div class="c-char ${WX_COLOR[zWx]}">${p.z}</div><span class="c-cs">${cs}</span></div>`;
        });
        document.getElementById('pillars-box').innerHTML = html;
    }

    // 司令计算 (亥月前7日为戊土)
    function calcCommander(lunar, monthZhi) {
        const prevJie = lunar.getPrevJie();
        const pjSolar = prevJie.getSolar();
        const jieTime = new Date(pjSolar.getYear(), pjSolar.getMonth()-1, pjSolar.getDay(), pjSolar.getHour(), pjSolar.getMinute()).getTime();
        const birthTime = new Date(lunar.getSolar().getYear(), lunar.getSolar().getMonth()-1, lunar.getSolar().getDay(), lunar.getSolar().getHour(), lunar.getSolar().getMinute()).getTime();
        const diffDays = Math.floor((birthTime - jieTime) / (1000 * 60 * 60 * 24));
        
        const rules = SILING_RULES[monthZhi] || [];
        let commander = rules[rules.length-1][0]; 
        let daysSum = 0;
        for (let rule of rules) {
            daysSum += rule[1];
            if (diffDays < daysSum) { commander = rule[0]; break; }
        }
        return { commander, diffDays };
    }

    // 通根检查
    function hasRoot(gan, pillars) {
        const roots = ROOT_MAP[gan] || [];
        for(let p of pillars) {
            if (roots.includes(p.z)) return true;
        }
        return false;
    }

    function analyzeClimate(dm, mz, pillars) {
        const dmWx = WUXING_MAP[dm];
        const season = ["亥","子","丑"].includes(mz) ? "冬" : ["巳","午","未"].includes(mz) ? "夏" : "平";
        let hasFire = pillars.some(p => WUXING_MAP[p.g] === '火' || WUXING_MAP[p.z] === '火');
        let hasWater = pillars.some(p => WUXING_MAP[p.g] === '水' || WUXING_MAP[p.z] === '水');

        if (dmWx === '土' && season === '冬' && !hasFire) return { special: null, advice: "水冷土冻，万物不生！急需丙火暖局！" };
        if (dmWx === '金' && season === '冬') {
            const hasShangGuan = pillars.some(p => SHISHEN_MAP[dm][p.g] === '伤官');
            return { special: hasShangGuan ? "金水伤官" : "金水食神" };
        }
        if (dmWx === '木' && ["寅","卯"].includes(mz) && hasFire) return { special: "木火通明" };
        if (dmWx === '木' && season === '夏' && hasWater) return { special: "伤官配印" };
        return { special: null };
    }

    function determinePattern(climate, pillars, dm, mz, cmdInfo) {
        if (climate.special) return climate.special;

        const godMap = {}; 
        pillars.forEach((p, i) => { if(i!==2) godMap[i] = SHISHEN_MAP[dm][p.g]; });
        const stems = [pillars[0].g, pillars[1].g, pillars[3].g];

        // 1. 真神透干优先
        if (stems.includes(cmdInfo.commander)) {
            const god = SHISHEN_MAP[dm][cmdInfo.commander];
            // 透财 -> 查食伤生财 (必须有根)
            if (god === '正财' || god === '偏财') {
                for(let i of [0,1,3]) {
                    const g = SHISHEN_MAP[dm][pillars[i].g];
                    if ((g === '食神' || g === '伤官') && hasRoot(pillars[i].g, pillars)) {
                        return g === '食神' ? '食神生财' : '伤官生财';
                    }
                }
            }
            // 透杀 -> 查制化
            if (god === '七杀') {
                for(let i of [0,1,3]) {
                    const g = SHISHEN_MAP[dm][pillars[i].g];
                    if (g === '食神' && hasRoot(pillars[i].g, pillars)) return '食神制杀';
                    if (g === '伤官') return '伤官合杀';
                    if (g === '正印' || g === '偏印') return '杀印相生';
                }
            }
        }

        // 2. 有杀先论杀 (无论是否透真神)
        if (Object.values(godMap).includes("七杀")) {
             for(let i of [0,1,3]) {
                const g = SHISHEN_MAP[dm][pillars[i].g];
                if (g === '食神' && hasRoot(pillars[i].g, pillars)) return '食神制杀';
                if (g === '正印' || g === '偏印') return '杀印相生';
             }
             return '七杀格';
        }

        // 3. 伤官/食神 (需通根)
        // 辛未 己亥 戊子 癸亥：辛金无根，不取伤官格。
        if (Object.values(godMap).includes("伤官")) {
             let sgGan = null;
             for(let i of [0,1,3]) if (SHISHEN_MAP[dm][pillars[i].g] === '伤官') sgGan = pillars[i].g;
             
             if (sgGan && !hasRoot(sgGan, pillars)) {
                 // 伤官无根，降级看财
                 if (Object.values(godMap).includes("正财")) return "正财格";
                 if (Object.values(godMap).includes("偏财")) return "偏财格";
             } else {
                 if (Object.values(godMap).some(g=>g.includes('财'))) return "伤官生财";
                 return "伤官格";
             }
        }

        // 4. 常规取格
        const mainGod = SHISHEN_MAP[dm][ZHI_MAIN_QI[mz]];
        const map = {
            "比肩":"建禄格", "劫财":"月劫格", "食神":"食神格", 
            "伤官":"伤官格", "正财":"正财格", "偏财":"偏财格", 
            "正官":"正官格", "七杀":"七杀格", "正印":"正印格", "偏印":"偏印格"
        };
        return map[mainGod] || "五行流通";
    }

    function renderResult(key, cmdInfo, dm, climate) {
        if(!GAME_DB[key]) key = "五行流通";
        const data = GAME_DB[key];
        const detail = data[currentGender === 1 ? 'male' : 'female'];

        document.getElementById('role-icon').innerText = data.icon;
        document.getElementById('role-name').innerText = data.name;
        document.getElementById('role-slogan').innerText = data.slogan;
        
        let tagsHtml = `<span class="tag logic">[${key}]</span>`;
        data.tags.forEach(t => tagsHtml += `<span class="tag ssr">${t}</span>`);
        document.getElementById('role-tags').innerHTML = tagsHtml;

        const cmdGod = SHISHEN_MAP[dm][cmdInfo.commander];
        document.getElementById('siling-text').innerText = `当令真神：${cmdInfo.commander} (${cmdGod}) · 执政第 ${cmdInfo.diffDays} 天`;

        let xiji = XIJI_RULES[key];
        let reason = xiji.desc;
        if (climate.advice) reason += " <br><span style='color:#ff4757;font-weight:bold;'>⚠️ " + climate.advice + "</span>";

        document.getElementById('pattern-reason').innerHTML = reason;
        document.getElementById('txt-joy').innerText = xiji.joy.join(" ");
        document.getElementById('txt-taboo').innerText = xiji.taboo.join(" ");

        const guideHtml = `
            <div class="guide-item"><div class="guide-title">⚔️ 事业与成就</div><div class="guide-text">${detail.c}</div></div>
            <div class="guide-item"><div class="guide-title">💰 财富与资产</div><div class="guide-text">${detail.w}</div></div>
            <div class="guide-item"><div class="guide-title">💞 情感与婚姻</div><div class="guide-text">${detail.l}</div></div>
            <div class="guide-item"><div class="guide-title">🌱 后代与传承</div><div class="guide-text">${detail.k}</div></div>
            <div class="guide-item"><div class="guide-title">❤️ 健康与状态</div><div class="guide-text">${detail.h}</div></div>
        `;
        document.getElementById('guide-content').innerHTML = guideHtml;
    }

    function drawArt(pillars) {
        const canvas = document.getElementById('energy-canvas');
        const ctx = canvas.getContext('2d');
        const w = canvas.parentElement.offsetWidth, h = canvas.parentElement.offsetHeight;
        canvas.width = w; canvas.height = h;

        const counts = {'金':0,'木':0,'水':0,'火':0,'土':0};
        pillars.forEach(p => { counts[WUXING_MAP[p.g]]++; counts[WUXING_MAP[p.z]]++; });
        
        ctx.fillStyle = "#1e1e24"; ctx.fillRect(0,0,w,h);
        const colors = {"金":"#ffeaa7", "木":"#55efc4", "水":"#74b9ff", "火":"#ff7675", "土":"#a29bfe"};
        const keys = Object.keys(counts);
        const cx = w/2, cy = h/2, r = 60;
        
        ctx.strokeStyle = "#444";
        for(let j=1; j<=3; j++) {
            ctx.beginPath();
            for(let i=0; i<5; i++) {
                const a = (Math.PI*2/5)*i - Math.PI/2;
                const x = cx + Math.cos(a)*r*(j/3);
                const y = cy + Math.sin(a)*r*(j/3);
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.closePath(); ctx.stroke();
        }

        ctx.fillStyle = "rgba(8, 217, 214, 0.2)"; ctx.strokeStyle = "#08d9d6"; ctx.lineWidth = 2;
        ctx.beginPath();
        keys.forEach((k, i) => {
            const v = counts[k];
            const a = (Math.PI*2/5)*i - Math.PI/2;
            const l = (v/8)*r*3; 
            const x = cx + Math.cos(a)*l, y = cy + Math.sin(a)*l;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            
            ctx.fillStyle = colors[k]; ctx.font = "12px Arial";
            ctx.fillText(k, cx + Math.cos(a)*(r+20)-5, cy + Math.sin(a)*(r+20)+5);
        });
        ctx.closePath(); ctx.fill(); ctx.stroke();
    }
</script>
</body>
</html>
